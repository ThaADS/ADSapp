{"version":3,"sources":["C:\\Ai Projecten\\ADSapp\\src\\lib\\cache\\redis-client.ts"],"sourcesContent":["/**\n * Redis Client with Upstash Integration\n *\n * Production-ready Redis client using Upstash REST API\n * Features:\n * - Automatic connection pooling\n * - Comprehensive error handling\n * - Typed cache operations\n * - TTL management\n * - Monitoring hooks\n * - Graceful degradation\n */\n\nimport { Redis } from '@upstash/redis';\n\n// Types\nexport interface CacheOptions {\n  ttl?: number; // Time to live in seconds\n  nx?: boolean; // Only set if not exists\n  xx?: boolean; // Only set if exists\n  exat?: number; // Expire at Unix timestamp (seconds)\n}\n\nexport interface CacheStats {\n  hits: number;\n  misses: number;\n  errors: number;\n  lastError?: string;\n  lastErrorTime?: number;\n}\n\nexport interface RedisConfig {\n  url: string;\n  token: string;\n  enableMonitoring?: boolean;\n  enableFallback?: boolean;\n  timeout?: number;\n}\n\n// Redis client singleton\nlet redisClient: Redis | null = null;\nlet clientConfig: RedisConfig | null = null;\nlet cacheStats: CacheStats = {\n  hits: 0,\n  misses: 0,\n  errors: 0,\n};\n\n/**\n * Initialize Redis client with Upstash\n */\nexport function initializeRedis(config?: Partial<RedisConfig>): Redis | null {\n  try {\n    // Return existing client if already initialized\n    if (redisClient && clientConfig) {\n      return redisClient;\n    }\n\n    // Get configuration from environment or provided config\n    const url = config?.url || process.env.UPSTASH_REDIS_REST_URL;\n    const token = config?.token || process.env.UPSTASH_REDIS_REST_TOKEN;\n\n    if (!url || !token) {\n      console.warn('[Redis] Upstash credentials not configured - cache disabled');\n      return null;\n    }\n\n    clientConfig = {\n      url,\n      token,\n      enableMonitoring: config?.enableMonitoring ?? true,\n      enableFallback: config?.enableFallback ?? true,\n      timeout: config?.timeout ?? 5000,\n    };\n\n    redisClient = new Redis({\n      url: clientConfig.url,\n      token: clientConfig.token,\n      automaticDeserialization: true,\n    });\n\n    console.log('[Redis] Client initialized successfully');\n    return redisClient;\n  } catch (error) {\n    console.error('[Redis] Initialization failed:', error);\n    cacheStats.errors++;\n    cacheStats.lastError = error instanceof Error ? error.message : 'Unknown error';\n    cacheStats.lastErrorTime = Date.now();\n    return null;\n  }\n}\n\n/**\n * Get Redis client instance\n */\nexport function getRedisClient(): Redis | null {\n  if (!redisClient) {\n    return initializeRedis();\n  }\n  return redisClient;\n}\n\n/**\n * Check if Redis is available\n */\nexport async function isRedisAvailable(): Promise<boolean> {\n  try {\n    const client = getRedisClient();\n    if (!client) return false;\n\n    await client.ping();\n    return true;\n  } catch (error) {\n    console.error('[Redis] Health check failed:', error);\n    return false;\n  }\n}\n\n/**\n * Get value from Redis cache\n */\nexport async function getCached<T>(key: string): Promise<T | null> {\n  try {\n    const client = getRedisClient();\n    if (!client) {\n      cacheStats.misses++;\n      return null;\n    }\n\n    const value = await client.get<T>(key);\n\n    if (value !== null) {\n      cacheStats.hits++;\n      if (clientConfig?.enableMonitoring) {\n        console.log(`[Redis] Cache HIT: ${key}`);\n      }\n    } else {\n      cacheStats.misses++;\n      if (clientConfig?.enableMonitoring) {\n        console.log(`[Redis] Cache MISS: ${key}`);\n      }\n    }\n\n    return value;\n  } catch (error) {\n    console.error(`[Redis] Get error for key ${key}:`, error);\n    cacheStats.errors++;\n    cacheStats.lastError = error instanceof Error ? error.message : 'Unknown error';\n    cacheStats.lastErrorTime = Date.now();\n    return null;\n  }\n}\n\n/**\n * Set value in Redis cache\n */\nexport async function setCached<T>(\n  key: string,\n  value: T,\n  options?: CacheOptions\n): Promise<boolean> {\n  try {\n    const client = getRedisClient();\n    if (!client) return false;\n\n    const setOptions: Record<string, any> = {};\n\n    if (options?.ttl) {\n      setOptions.ex = options.ttl; // Expire in seconds\n    }\n    if (options?.exat) {\n      setOptions.exat = options.exat; // Expire at timestamp\n    }\n    if (options?.nx) {\n      setOptions.nx = true; // Only set if not exists\n    }\n    if (options?.xx) {\n      setOptions.xx = true; // Only set if exists\n    }\n\n    await client.set(key, value, setOptions);\n\n    if (clientConfig?.enableMonitoring) {\n      console.log(`[Redis] Cache SET: ${key} (TTL: ${options?.ttl || 'none'})`);\n    }\n\n    return true;\n  } catch (error) {\n    console.error(`[Redis] Set error for key ${key}:`, error);\n    cacheStats.errors++;\n    cacheStats.lastError = error instanceof Error ? error.message : 'Unknown error';\n    cacheStats.lastErrorTime = Date.now();\n    return false;\n  }\n}\n\n/**\n * Delete value from Redis cache\n */\nexport async function deleteCached(key: string): Promise<boolean> {\n  try {\n    const client = getRedisClient();\n    if (!client) return false;\n\n    await client.del(key);\n\n    if (clientConfig?.enableMonitoring) {\n      console.log(`[Redis] Cache DELETE: ${key}`);\n    }\n\n    return true;\n  } catch (error) {\n    console.error(`[Redis] Delete error for key ${key}:`, error);\n    cacheStats.errors++;\n    return false;\n  }\n}\n\n/**\n * Delete multiple keys matching a pattern\n */\nexport async function deletePattern(pattern: string): Promise<number> {\n  try {\n    const client = getRedisClient();\n    if (!client) return 0;\n\n    // Get all keys matching pattern\n    const keys = await client.keys(pattern);\n\n    if (keys.length === 0) return 0;\n\n    // Delete all matching keys\n    await client.del(...keys);\n\n    if (clientConfig?.enableMonitoring) {\n      console.log(`[Redis] Cache DELETE PATTERN: ${pattern} (${keys.length} keys)`);\n    }\n\n    return keys.length;\n  } catch (error) {\n    console.error(`[Redis] Delete pattern error for ${pattern}:`, error);\n    cacheStats.errors++;\n    return 0;\n  }\n}\n\n/**\n * Check if key exists in cache\n */\nexport async function existsCached(key: string): Promise<boolean> {\n  try {\n    const client = getRedisClient();\n    if (!client) return false;\n\n    const exists = await client.exists(key);\n    return exists === 1;\n  } catch (error) {\n    console.error(`[Redis] Exists error for key ${key}:`, error);\n    cacheStats.errors++;\n    return false;\n  }\n}\n\n/**\n * Set expiration time on a key\n */\nexport async function expire(key: string, seconds: number): Promise<boolean> {\n  try {\n    const client = getRedisClient();\n    if (!client) return false;\n\n    await client.expire(key, seconds);\n    return true;\n  } catch (error) {\n    console.error(`[Redis] Expire error for key ${key}:`, error);\n    cacheStats.errors++;\n    return false;\n  }\n}\n\n/**\n * Get time to live for a key\n */\nexport async function ttl(key: string): Promise<number> {\n  try {\n    const client = getRedisClient();\n    if (!client) return -1;\n\n    const ttlSeconds = await client.ttl(key);\n    return ttlSeconds;\n  } catch (error) {\n    console.error(`[Redis] TTL error for key ${key}:`, error);\n    cacheStats.errors++;\n    return -1;\n  }\n}\n\n/**\n * Increment value (atomic operation)\n */\nexport async function increment(key: string, amount: number = 1): Promise<number> {\n  try {\n    const client = getRedisClient();\n    if (!client) return 0;\n\n    const newValue = await client.incrby(key, amount);\n    return newValue;\n  } catch (error) {\n    console.error(`[Redis] Increment error for key ${key}:`, error);\n    cacheStats.errors++;\n    return 0;\n  }\n}\n\n/**\n * Decrement value (atomic operation)\n */\nexport async function decrement(key: string, amount: number = 1): Promise<number> {\n  try {\n    const client = getRedisClient();\n    if (!client) return 0;\n\n    const newValue = await client.decrby(key, amount);\n    return newValue;\n  } catch (error) {\n    console.error(`[Redis] Decrement error for key ${key}:`, error);\n    cacheStats.errors++;\n    return 0;\n  }\n}\n\n/**\n * Set multiple key-value pairs\n */\nexport async function mset(data: Record<string, any>): Promise<boolean> {\n  try {\n    const client = getRedisClient();\n    if (!client) return false;\n\n    await client.mset(data);\n    return true;\n  } catch (error) {\n    console.error('[Redis] MSET error:', error);\n    cacheStats.errors++;\n    return false;\n  }\n}\n\n/**\n * Get multiple values\n */\nexport async function mget<T>(keys: string[]): Promise<(T | null)[]> {\n  try {\n    const client = getRedisClient();\n    if (!client) return keys.map(() => null);\n\n    const values = await client.mget<T[]>(...keys);\n    return values;\n  } catch (error) {\n    console.error('[Redis] MGET error:', error);\n    cacheStats.errors++;\n    return keys.map(() => null);\n  }\n}\n\n/**\n * Flush all cache (DANGER: use with caution)\n */\nexport async function flushAll(): Promise<boolean> {\n  try {\n    const client = getRedisClient();\n    if (!client) return false;\n\n    await client.flushall();\n    console.warn('[Redis] All cache flushed - this affects all data!');\n    return true;\n  } catch (error) {\n    console.error('[Redis] Flush all error:', error);\n    cacheStats.errors++;\n    return false;\n  }\n}\n\n/**\n * Get cache statistics\n */\nexport function getCacheStats(): CacheStats {\n  return { ...cacheStats };\n}\n\n/**\n * Reset cache statistics\n */\nexport function resetCacheStats(): void {\n  cacheStats = {\n    hits: 0,\n    misses: 0,\n    errors: 0,\n  };\n}\n\n/**\n * Get cache hit rate\n */\nexport function getCacheHitRate(): number {\n  const total = cacheStats.hits + cacheStats.misses;\n  if (total === 0) return 0;\n  return (cacheStats.hits / total) * 100;\n}\n\n/**\n * Close Redis connection\n */\nexport async function closeRedis(): Promise<void> {\n  try {\n    // Upstash REST API doesn't require explicit connection closure\n    redisClient = null;\n    clientConfig = null;\n    console.log('[Redis] Client closed');\n  } catch (error) {\n    console.error('[Redis] Close error:', error);\n  }\n}\n\n/**\n * Generate cache key with tenant isolation\n */\nexport function generateCacheKey(\n  tenant: string,\n  resource: string,\n  id?: string,\n  version: string = 'v1'\n): string {\n  const parts = [tenant, resource];\n  if (id) parts.push(id);\n  parts.push(version);\n  return parts.join(':');\n}\n\n/**\n * Parse cache key into components\n */\nexport function parseCacheKey(key: string): {\n  tenant: string;\n  resource: string;\n  id?: string;\n  version: string;\n} {\n  const parts = key.split(':');\n  return {\n    tenant: parts[0],\n    resource: parts[1],\n    id: parts[2] !== 'v1' && parts[2] !== 'v2' ? parts[2] : undefined,\n    version: parts[parts.length - 1],\n  };\n}\n\n// Export types\nexport type { Redis };\n"],"names":["closeRedis","decrement","deleteCached","deletePattern","existsCached","expire","flushAll","generateCacheKey","getCacheHitRate","getCacheStats","getCached","getRedisClient","increment","initializeRedis","isRedisAvailable","mget","mset","parseCacheKey","resetCacheStats","setCached","ttl","redisClient","clientConfig","cacheStats","hits","misses","errors","config","url","process","env","UPSTASH_REDIS_REST_URL","token","UPSTASH_REDIS_REST_TOKEN","console","warn","enableMonitoring","enableFallback","timeout","Redis","automaticDeserialization","log","error","lastError","Error","message","lastErrorTime","Date","now","client","ping","key","value","get","options","setOptions","ex","exat","nx","xx","set","del","pattern","keys","length","exists","seconds","ttlSeconds","amount","newValue","incrby","decrby","data","map","values","flushall","total","tenant","resource","id","version","parts","push","join","split","undefined"],"mappings":"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"}