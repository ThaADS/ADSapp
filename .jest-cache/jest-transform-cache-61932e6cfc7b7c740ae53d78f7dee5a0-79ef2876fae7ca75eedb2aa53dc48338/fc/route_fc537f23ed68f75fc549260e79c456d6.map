{"version":3,"names":["DELETE","cov_2pt33bmwia","f","s","GET","POST","request","supabase","_server1","createClient","data","user","error","authError","auth","getUser","b","_server","NextResponse","json","code","status","body","catch","sessionTokenToRevoke","sessionToken","cookies","get","value","sessionManager","_manager","getSessionManager","revoked","revokeSession","id","response","success","message","currentSessionToken","_session","clearSessionCookie","console","process","env","NODE_ENV","Sentry","Promise","resolve","then","_interop_require_wildcard","require","captureException","tags","endpoint","sentryError"],"sources":["C:\\Ai Projecten\\ADSapp\\src\\app\\api\\auth\\session\\revoke\\route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport { getSessionManager } from '@/lib/session/manager';\nimport { clearSessionCookie } from '@/lib/middleware/session';\nimport { createClient } from '@/lib/supabase/server';\n\n/**\n * Session Revocation API Route\n *\n * DELETE /api/auth/session/revoke\n *\n * Revokes a specific session by token.\n * Used for:\n * - User logout from current device\n * - Revoking session from another device\n * - Security events requiring specific session termination\n *\n * Request Body:\n * ```json\n * {\n *   \"sessionToken\": \"token_to_revoke\" // Optional, defaults to current session\n * }\n * ```\n *\n * Security:\n * - Validates user authentication\n * - Only allows users to revoke their own sessions\n * - Audit logs revocation event\n *\n * @returns Revocation result\n */\nexport async function DELETE(request: NextRequest) {\n  try {\n    // Get user ID from Supabase auth\n    const supabase = await createClient();\n    const { data: { user }, error: authError } = await supabase.auth.getUser();\n\n    if (authError || !user) {\n      return NextResponse.json(\n        {\n          error: 'User not authenticated',\n          code: 'UNAUTHORIZED'\n        },\n        { status: 401 }\n      );\n    }\n\n    // Parse request body\n    const body = await request.json().catch(() => ({}));\n    const sessionTokenToRevoke = body.sessionToken ||\n                                 request.cookies.get('adsapp_session')?.value;\n\n    if (!sessionTokenToRevoke) {\n      return NextResponse.json(\n        {\n          error: 'No session token provided',\n          code: 'NO_SESSION_TOKEN'\n        },\n        { status: 400 }\n      );\n    }\n\n    // Revoke session\n    const sessionManager = getSessionManager();\n    const revoked = await sessionManager.revokeSession(\n      user.id,\n      sessionTokenToRevoke\n    );\n\n    if (!revoked) {\n      return NextResponse.json(\n        {\n          error: 'Session not found or already revoked',\n          code: 'SESSION_NOT_FOUND'\n        },\n        { status: 404 }\n      );\n    }\n\n    // Create response\n    const response = NextResponse.json(\n      {\n        success: true,\n        message: 'Session revoked successfully'\n      },\n      { status: 200 }\n    );\n\n    // Clear session cookie if revoking current session\n    const currentSessionToken = request.cookies.get('adsapp_session')?.value;\n    if (sessionTokenToRevoke === currentSessionToken) {\n      clearSessionCookie(response);\n    }\n\n    return response;\n  } catch (error) {\n    console.error('[SessionRevoke] Error:', error);\n\n    // Log error to monitoring\n    if (process.env.NODE_ENV === 'production') {\n      try {\n        const Sentry = await import('@sentry/nextjs');\n        Sentry.captureException(error, {\n          tags: {\n            endpoint: 'session-revoke'\n          }\n        });\n      } catch (sentryError) {\n        console.error('[SessionRevoke] Failed to log error:', sentryError);\n      }\n    }\n\n    return NextResponse.json(\n      {\n        error: 'Internal server error',\n        code: 'INTERNAL_ERROR'\n      },\n      { status: 500 }\n    );\n  }\n}\n\n/**\n * POST method (alternative to DELETE for client compatibility)\n */\nexport async function POST(request: NextRequest) {\n  return DELETE(request);\n}\n\n/**\n * GET method not allowed\n */\nexport async function GET() {\n  return NextResponse.json(\n    {\n      error: 'Method not allowed',\n      code: 'METHOD_NOT_ALLOWED'\n    },\n    { status: 405 }\n  );\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}