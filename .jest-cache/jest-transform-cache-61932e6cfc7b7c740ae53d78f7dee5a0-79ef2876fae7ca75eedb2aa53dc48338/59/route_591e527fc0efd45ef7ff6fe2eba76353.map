{"version":3,"names":["cov_phx4g0xu5","path","hash","global","Function","gcv","coverageData","statementMap","start","line","column","end","fnMap","name","decl","loc","branchMap","type","locations","undefined","s","f","b","inputSourceMap","version","sources","sourcesContent","names","mappings","_coverageSchema","coverage","actualCoverage","POST","request","supabase","_server1","createClient","data","user","error","authError","auth","getUser","_server","NextResponse","json","status","profile","profileError","from","select","eq","id","single","body","amount","currency","purpose","relatedSubscriptionId","relatedInvoiceId","metadata","returnUrl","validPurposes","includes","userAgent","headers","get","ipAddress","split","paymentIntentManager","_paymentintentmanager","PaymentIntentManager","result","createPaymentIntentWithSCA","organizationId","organization_id","process","env","NEXT_PUBLIC_APP_URL","clientSecret","success","paymentIntent","paymentIntentId","authenticationRequired","nextAction","errorCode","err","console","message"],"sources":["C:\\Ai Projecten\\ADSapp\\src\\app\\api\\billing\\payment-intent\\create\\route.ts"],"sourcesContent":["/**\n * Payment Intent Create API (S-002)\n * ===================================\n * Create payment intent with 3D Secure authentication for subscription payments.\n *\n * POST /api/billing/payment-intent/create - Create new payment intent\n *\n * Security: Authenticated users only\n * Compliance: PCI DSS, PSD2 SCA requirements\n */\n\nimport { NextRequest, NextResponse } from 'next/server';\nimport { createClient } from '@/lib/supabase/server';\nimport { PaymentIntentManager } from '@/lib/billing/payment-intent-manager';\n\nexport async function POST(request: NextRequest) {\n  try {\n    const supabase = await createClient();\n\n    // 1. Authenticate user\n    const { data: { user }, error: authError } = await supabase.auth.getUser();\n    if (authError || !user) {\n      return NextResponse.json(\n        { error: 'Unauthorized' },\n        { status: 401 }\n      );\n    }\n\n    // 2. Get user's organization\n    const { data: profile, error: profileError } = await supabase\n      .from('profiles')\n      .select('organization_id')\n      .eq('id', user.id)\n      .single();\n\n    if (profileError || !profile) {\n      return NextResponse.json(\n        { error: 'User profile not found' },\n        { status: 404 }\n      );\n    }\n\n    // 3. Parse and validate request body\n    const body = await request.json();\n\n    const {\n      amount,\n      currency = 'USD',\n      purpose = 'subscription_payment',\n      relatedSubscriptionId,\n      relatedInvoiceId,\n      metadata = {},\n      returnUrl,\n    } = body;\n\n    // Validate required fields\n    if (!amount || amount <= 0) {\n      return NextResponse.json(\n        { error: 'Valid amount is required' },\n        { status: 400 }\n      );\n    }\n\n    // Validate purpose\n    const validPurposes = [\n      'subscription_payment',\n      'subscription_upgrade',\n      'additional_charge',\n      'invoice_payment',\n      'setup_payment_method',\n    ];\n    if (!validPurposes.includes(purpose)) {\n      return NextResponse.json(\n        { error: 'Invalid purpose' },\n        { status: 400 }\n      );\n    }\n\n    // 4. Extract user agent and IP address\n    const userAgent = request.headers.get('user-agent') || undefined;\n    const ipAddress = request.headers.get('x-forwarded-for')?.split(',')[0] ||\n                      request.headers.get('x-real-ip') ||\n                      undefined;\n\n    // 5. Create payment intent\n    const paymentIntentManager = new PaymentIntentManager();\n\n    const result = await paymentIntentManager.createPaymentIntentWithSCA({\n      organizationId: profile.organization_id,\n      amount,\n      currency,\n      purpose,\n      relatedSubscriptionId,\n      relatedInvoiceId,\n      metadata,\n      returnUrl: returnUrl || `${process.env.NEXT_PUBLIC_APP_URL}/dashboard/settings/billing`,\n      userAgent,\n      ipAddress,\n    });\n\n    // 6. Return result\n    if (result.clientSecret) {\n      return NextResponse.json({\n        success: true,\n        paymentIntent: {\n          id: result.paymentIntentId,\n          clientSecret: result.clientSecret,\n          status: result.status,\n          authenticationRequired: result.authenticationRequired,\n          nextAction: result.nextAction,\n        },\n      }, { status: 201 });\n    } else {\n      return NextResponse.json({\n        success: false,\n        error: result.error,\n        errorCode: result.errorCode,\n      }, { status: 400 });\n    }\n  } catch (error) {\n    const err = error as Error;\n    console.error('Payment intent creation API error:', err);\n\n    return NextResponse.json(\n      {\n        error: 'Internal server error',\n        message: err.message,\n      },\n      { status: 500 }\n    );\n  }\n}\n"],"mappings":"AAAA;;;;;;;;;GASC;;AAAA;AAAA,SAAAA,cAAA;EAAA,IAAAC,IAAA;EAAA,IAAAC,IAAA;EAAA,IAAAC,MAAA,OAAAC,QAAA;EAAA,IAAAC,GAAA;EAAA,IAAAC,YAAA;IAAAL,IAAA;IAAAM,YAAA;MAAA;QAAAC,KAAA;UAAAC,IAAA;UAAAC,MAAA;QAAA;QAAAC,GAAA;UAAAF,IAAA;UAAAC,MAAA;QAAA;MAAA;MAAA;QAAAF,KAAA;UAAAC,IAAA;UAAAC,MAAA;QAAA;QAAAC,GAAA;UAAAF,IAAA;UAAAC,MAAA;QAAA;MAAA;MAAA;QAAAF,KAAA;UAAAC,IAAA;UAAAC,MAAA;QAAA;QAAAC,GAAA;UAAAF,IAAA;UAAAC,MAAA;QAAA;MAAA;MAAA;QAAAF,KAAA;UAAAC,IAAA;UAAAC,MAAA;QAAA;QAAAC,GAAA;UAAAF,IAAA;UAAAC,MAAA;QAAA;MAAA;MAAA;QAAAF,KAAA;UAAAC,IAAA;UAAAC,MAAA;QAAA;QAAAC,GAAA;UAAAF,IAAA;UAAAC,MAAA;QAAA;MAAA;MAAA;QAAAF,KAAA;UAAAC,IAAA;UAAAC,MAAA;QAAA;QAAAC,GAAA;UAAAF,IAAA;UAAAC,MAAA;QAAA;MAAA;MAAA;QAAAF,KAAA;UAAAC,IAAA;UAAAC,MAAA;QAAA;QAAAC,GAAA;UAAAF,IAAA;UAAAC,MAAA;QAAA;MAAA;MAAA;QAAAF,KAAA;UAAAC,IAAA;UAAAC,MAAA;QAAA;QAAAC,GAAA;UAAAF,IAAA;UAAAC,MAAA;QAAA;MAAA;MAAA;QAAAF,KAAA;UAAAC,IAAA;UAAAC,MAAA;QAAA;QAAAC,GAAA;UAAAF,IAAA;UAAAC,MAAA;QAAA;MAAA;MAAA;QAAAF,KAAA;UAAAC,IAAA;UAAAC,MAAA;QAAA;QAAAC,GAAA;UAAAF,IAAA;UAAAC,MAAA;QAAA;MAAA;MAAA;QAAAF,KAAA;UAAAC,IAAA;UAAAC,MAAA;QAAA;QAAAC,GAAA;UAAAF,IAAA;UAAAC,MAAA;QAAA;MAAA;MAAA;QAAAF,KAAA;UAAAC,IAAA;UAAAC,MAAA;QAAA;QAAAC,GAAA;UAAAF,IAAA;UAAAC,MAAA;QAAA;MAAA;MAAA;QAAAF,KAAA;UAAAC,IAAA;UAAAC,MAAA;QAAA;QAAAC,GAAA;UAAAF,IAAA;UAAAC,MAAA;QAAA;MAAA;MAAA;QAAAF,KAAA;UAAAC,IAAA;UAAAC,MAAA;QAAA;QAAAC,GAAA;UAAAF,IAAA;UAAAC,MAAA;QAAA;MAAA;MAAA;QAAAF,KAAA;UAAAC,IAAA;UAAAC,MAAA;QAAA;QAAAC,GAAA;UAAAF,IAAA;UAAAC,MAAA;QAAA;MAAA;MAAA;QAAAF,KAAA;UAAAC,IAAA;UAAAC,MAAA;QAAA;QAAAC,GAAA;UAAAF,IAAA;UAAAC,MAAA;QAAA;MAAA;MAAA;QAAAF,KAAA;UAAAC,IAAA;UAAAC,MAAA;QAAA;QAAAC,GAAA;UAAAF,IAAA;UAAAC,MAAA;QAAA;MAAA;MAAA;QAAAF,KAAA;UAAAC,IAAA;UAAAC,MAAA;QAAA;QAAAC,GAAA;UAAAF,IAAA;UAAAC,MAAA;QAAA;MAAA;MAAA;QAAAF,KAAA;UAAAC,IAAA;UAAAC,MAAA;QAAA;QAAAC,GAAA;UAAAF,IAAA;UAAAC,MAAA;QAAA;MAAA;MAAA;QAAAF,KAAA;UAAAC,IAAA;UAAAC,MAAA;QAAA;QAAAC,GAAA;UAAAF,IAAA;UAAAC,MAAA;QAAA;MAAA;MAAA;QAAAF,KAAA;UAAAC,IAAA;UAAAC,MAAA;QAAA;QAAAC,GAAA;UAAAF,IAAA;UAAAC,MAAA;QAAA;MAAA;MAAA;QAAAF,KAAA;UAAAC,IAAA;UAAAC,MAAA;QAAA;QAAAC,GAAA;UAAAF,IAAA;UAAAC,MAAA;QAAA;MAAA;MAAA;QAAAF,KAAA;UAAAC,IAAA;UAAAC,MAAA;QAAA;QAAAC,GAAA;UAAAF,IAAA;UAAAC,MAAA;QAAA;MAAA;MAAA;QAAAF,KAAA;UAAAC,IAAA;UAAAC,MAAA;QAAA;QAAAC,GAAA;UAAAF,IAAA;UAAAC,MAAA;QAAA;MAAA;MAAA;QAAAF,KAAA;UAAAC,IAAA;UAAAC,MAAA;QAAA;QAAAC,GAAA;UAAAF,IAAA;UAAAC,MAAA;QAAA;MAAA;MAAA;QAAAF,KAAA;UAAAC,IAAA;UAAAC,MAAA;QAAA;QAAAC,GAAA;UAAAF,IAAA;UAAAC,MAAA;QAAA;MAAA;MAAA;QAAAF,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","ignoreList":[]}