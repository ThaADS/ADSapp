{"version":3,"names":["ApiException","cov_2jbamw6pq1","f","s","createErrorResponse","createSuccessResponse","createTenantScopedQuery","getTenantContextFromHeaders","getUserOrganization","rateLimit","requireAuthenticatedUser","validateOrganizationAccess","validatePagination","validateRequest","validateResourceOwnership","validateSortOrder","Error","constructor","message","statusCode","b","code","name","error","_server","NextResponse","json","status","console","data","success","request","schema","contentType","headers","get","includes","body","user","_auth","getUser","userId","supabase","_server1","createClient","profile","from","select","eq","single","organization_id","rateLimitStore","Map","options","key","keyGenerator","ip","now","Date","windowStart","windowMs","k","v","entries","resetTime","delete","current","set","count","max","searchParams","URL","url","page","Math","parseInt","limit","min","offset","allowedFields","sortBy","sortOrder","join","ascending","organizationId","userRole","userEmail","isSuperAdmin","requestOrgId","userOrgId","tableName","resourceOrgId"],"sources":["C:\\Ai Projecten\\ADSapp\\src\\lib\\api-utils.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server'\nimport { createClient } from '@/lib/supabase/server'\nimport { getUser } from '@/lib/auth'\n\nexport interface ApiError {\n  message: string\n  code: string\n  statusCode: number\n}\n\nexport class ApiException extends Error {\n  public statusCode: number\n  public code: string\n\n  constructor(message: string, statusCode: number = 500, code: string = 'INTERNAL_ERROR') {\n    super(message)\n    this.statusCode = statusCode\n    this.code = code\n    this.name = 'ApiException'\n  }\n}\n\nexport function createErrorResponse(error: unknown): NextResponse {\n  if (error instanceof ApiException) {\n    return NextResponse.json(\n      {\n        error: error.message,\n        code: error.code\n      },\n      { status: error.statusCode }\n    )\n  }\n\n  if (error instanceof Error) {\n    console.error('API Error:', error)\n    return NextResponse.json(\n      {\n        error: 'Internal server error',\n        code: 'INTERNAL_ERROR'\n      },\n      { status: 500 }\n    )\n  }\n\n  return NextResponse.json(\n    {\n      error: 'Unknown error occurred',\n      code: 'UNKNOWN_ERROR'\n    },\n    { status: 500 }\n  )\n}\n\nexport function createSuccessResponse(data: any, statusCode: number = 200): NextResponse {\n  return NextResponse.json({\n    success: true,\n    data\n  }, { status: statusCode })\n}\n\nexport async function validateRequest(request: NextRequest, schema?: any): Promise<any> {\n  const contentType = request.headers.get('content-type')\n\n  if (contentType?.includes('application/json')) {\n    try {\n      const body = await request.json()\n\n      if (schema) {\n        // Add validation logic here if needed\n        // Could integrate with Zod or similar validation library\n      }\n\n      return body\n    } catch (error) {\n      throw new ApiException('Invalid JSON in request body', 400, 'INVALID_JSON')\n    }\n  }\n\n  return null\n}\n\nexport async function requireAuthenticatedUser() {\n  const user = await getUser()\n\n  if (!user) {\n    throw new ApiException('Authentication required', 401, 'UNAUTHORIZED')\n  }\n\n  return user\n}\n\nexport async function getUserOrganization(userId: string) {\n  const supabase = await createClient()\n\n  const { data: profile, error } = await supabase\n    .from('profiles')\n    .select('organization_id, organization:organizations(*)')\n    .eq('id', userId)\n    .single()\n\n  if (error || !profile?.organization_id) {\n    throw new ApiException('No organization found', 404, 'NO_ORGANIZATION')\n  }\n\n  return profile\n}\n\nexport interface RateLimitOptions {\n  windowMs: number // Time window in milliseconds\n  max: number // Maximum requests per window\n  keyGenerator?: (request: NextRequest) => string\n}\n\n// Simple in-memory rate limiter (for production, use Redis)\nconst rateLimitStore = new Map<string, { count: number; resetTime: number }>()\n\nexport function rateLimit(options: RateLimitOptions) {\n  return async (request: NextRequest) => {\n    const key = options.keyGenerator\n      ? options.keyGenerator(request)\n      : request.ip || 'anonymous'\n\n    const now = Date.now()\n    const windowStart = now - options.windowMs\n\n    // Clean up old entries\n    for (const [k, v] of rateLimitStore.entries()) {\n      if (v.resetTime < now) {\n        rateLimitStore.delete(k)\n      }\n    }\n\n    const current = rateLimitStore.get(key)\n\n    if (!current || current.resetTime < now) {\n      rateLimitStore.set(key, {\n        count: 1,\n        resetTime: now + options.windowMs\n      })\n      return true\n    }\n\n    if (current.count >= options.max) {\n      throw new ApiException(\n        'Too many requests',\n        429,\n        'RATE_LIMIT_EXCEEDED'\n      )\n    }\n\n    current.count++\n    return true\n  }\n}\n\nexport function validatePagination(request: NextRequest) {\n  const { searchParams } = new URL(request.url)\n\n  const page = Math.max(1, parseInt(searchParams.get('page') || '1'))\n  const limit = Math.min(100, Math.max(1, parseInt(searchParams.get('limit') || '20')))\n  const offset = (page - 1) * limit\n\n  return { page, limit, offset }\n}\n\nexport function validateSortOrder(request: NextRequest, allowedFields: string[]) {\n  const { searchParams } = new URL(request.url)\n\n  const sortBy = searchParams.get('sortBy') || 'created_at'\n  const sortOrder = searchParams.get('sortOrder') || 'desc'\n\n  if (!allowedFields.includes(sortBy)) {\n    throw new ApiException(\n      `Invalid sort field. Allowed: ${allowedFields.join(', ')}`,\n      400,\n      'INVALID_SORT_FIELD'\n    )\n  }\n\n  if (!['asc', 'desc'].includes(sortOrder)) {\n    throw new ApiException(\n      'Invalid sort order. Must be \"asc\" or \"desc\"',\n      400,\n      'INVALID_SORT_ORDER'\n    )\n  }\n\n  return { sortBy, sortOrder, ascending: sortOrder === 'asc' }\n}\n\n/**\n * Get tenant context from request headers (set by tenant validation middleware)\n *\n * @param request - NextRequest object with tenant context headers\n * @returns Object containing user and organization information\n *\n * @example\n * ```typescript\n * import { getTenantContextFromHeaders } from '@/lib/api-utils';\n *\n * export async function GET(request: NextRequest) {\n *   const { userId, organizationId } = getTenantContextFromHeaders(request);\n *\n *   // Use in database queries\n *   const { data } = await supabase\n *     .from('contacts')\n *     .select('*')\n *     .eq('organization_id', organizationId);\n * }\n * ```\n */\nexport function getTenantContextFromHeaders(request: NextRequest): {\n  userId: string;\n  organizationId: string;\n  userRole: string;\n  userEmail: string;\n  isSuperAdmin: boolean;\n} {\n  return {\n    userId: request.headers.get('x-user-id') || '',\n    organizationId: request.headers.get('x-organization-id') || '',\n    userRole: request.headers.get('x-user-role') || 'agent',\n    userEmail: request.headers.get('x-user-email') || '',\n    isSuperAdmin: request.headers.get('x-is-super-admin') === 'true'\n  };\n}\n\n/**\n * Validate that a requested organization ID matches the user's organization\n * Provides double-check validation after middleware\n *\n * @param requestOrgId - Organization ID from request (query param, body, etc.)\n * @param userOrgId - User's organization ID from tenant context\n * @returns boolean indicating if access is allowed\n *\n * @example\n * ```typescript\n * import { validateOrganizationAccess, getTenantContextFromHeaders } from '@/lib/api-utils';\n *\n * export async function POST(request: NextRequest) {\n *   const { organizationId: userOrgId } = getTenantContextFromHeaders(request);\n *   const body = await request.json();\n *\n *   if (!validateOrganizationAccess(body.organization_id, userOrgId)) {\n *     return NextResponse.json({ error: 'Access denied' }, { status: 403 });\n *   }\n * }\n * ```\n */\nexport async function validateOrganizationAccess(\n  requestOrgId: string | null | undefined,\n  userOrgId: string\n): Promise<boolean> {\n  // If no specific organization requested, allow (will use user's org)\n  if (!requestOrgId) return true;\n\n  // Check if requested organization matches user's organization\n  return requestOrgId === userOrgId;\n}\n\n/**\n * Create a Supabase query builder that automatically scopes to user's organization\n *\n * @param supabase - Supabase client instance\n * @param tableName - Name of the table to query\n * @param organizationId - Organization ID to scope the query to\n * @returns Supabase query builder with organization filter applied\n *\n * @example\n * ```typescript\n * import { createTenantScopedQuery, getTenantContextFromHeaders } from '@/lib/api-utils';\n *\n * export async function GET(request: NextRequest) {\n *   const supabase = await createClient();\n *   const { organizationId } = getTenantContextFromHeaders(request);\n *\n *   // Automatically filters by organization_id\n *   const { data } = await createTenantScopedQuery(supabase, 'contacts', organizationId)\n *     .select('*')\n *     .eq('is_blocked', false);\n * }\n * ```\n */\nexport function createTenantScopedQuery(\n  supabase: any,\n  tableName: string,\n  organizationId: string\n) {\n  return supabase.from(tableName).select('*').eq('organization_id', organizationId);\n}\n\n/**\n * Validate that a resource belongs to the user's organization\n * Use for additional security checks after fetching a resource\n *\n * @param resourceOrgId - Organization ID of the fetched resource\n * @param userOrgId - User's organization ID from tenant context\n * @param isSuperAdmin - Whether the user is a super admin (bypasses check)\n * @returns boolean indicating if access is allowed\n * @throws ApiException if access is denied\n *\n * @example\n * ```typescript\n * import { validateResourceOwnership, getTenantContextFromHeaders } from '@/lib/api-utils';\n *\n * export async function DELETE(request: NextRequest, { params }: { params: { id: string } }) {\n *   const { organizationId, isSuperAdmin } = getTenantContextFromHeaders(request);\n *   const contact = await getContact(params.id);\n *\n *   validateResourceOwnership(contact.organization_id, organizationId, isSuperAdmin);\n *\n *   // Proceed with deletion\n * }\n * ```\n */\nexport function validateResourceOwnership(\n  resourceOrgId: string,\n  userOrgId: string,\n  isSuperAdmin: boolean = false\n): void {\n  // Super admins can access all resources\n  if (isSuperAdmin) return;\n\n  // Check if resource belongs to user's organization\n  if (resourceOrgId !== userOrgId) {\n    throw new ApiException(\n      'Access denied: Resource does not belong to your organization',\n      403,\n      'FORBIDDEN'\n    );\n  }\n}"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}