{"version":3,"names":["GET","cov_r2pt7jqbw","f","s","PATCH","POST","request","searchParams","URL","url","resolved","get","severity","type","supabase","_server1","createClient","data","user","auth","getUser","b","_server","NextResponse","json","error","status","profile","from","select","eq","id","single","includes","role","alerts","_alerts","alertManager","getAlerts","undefined","filter","alert","sort","a","Date","timestamp","getTime","page","parseInt","limit","offset","paginatedAlerts","slice","pagination","total","length","totalPages","Math","ceil","console","title","success","alertId","resolveAlert"],"sources":["C:\\Ai Projecten\\ADSapp\\src\\app\\api\\alerts\\route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server'\nimport { createClient } from '@/lib/supabase/server'\nimport { alertManager } from '@/lib/monitoring/alerts'\n\nexport async function GET(request: NextRequest) {\n  try {\n    const { searchParams } = new URL(request.url)\n    const resolved = searchParams.get('resolved')\n    const severity = searchParams.get('severity')\n    const type = searchParams.get('type')\n\n    // Get user context\n    const supabase = await createClient()\n    const { data: { user } } = await supabase.auth.getUser()\n\n    if (!user) {\n      return NextResponse.json(\n        { error: 'Unauthorized' },\n        { status: 401 }\n      )\n    }\n\n    // Check if user has admin access\n    const { data: profile } = await supabase\n      .from('profiles')\n      .select('role')\n      .eq('id', user.id)\n      .single()\n\n    if (!profile || !['admin', 'super_admin'].includes(profile.role)) {\n      return NextResponse.json(\n        { error: 'Insufficient permissions' },\n        { status: 403 }\n      )\n    }\n\n    let alerts = alertManager.getAlerts(\n      resolved === 'true' ? true : resolved === 'false' ? false : undefined\n    )\n\n    // Filter by severity\n    if (severity) {\n      alerts = alerts.filter(alert => alert.severity === severity)\n    }\n\n    // Filter by type\n    if (type) {\n      alerts = alerts.filter(alert => alert.type === type)\n    }\n\n    // Sort by timestamp (newest first)\n    alerts.sort((a, b) => new Date(b.timestamp).getTime() - new Date(a.timestamp).getTime())\n\n    // Pagination\n    const page = parseInt(searchParams.get('page') || '1')\n    const limit = parseInt(searchParams.get('limit') || '50')\n    const offset = (page - 1) * limit\n\n    const paginatedAlerts = alerts.slice(offset, offset + limit)\n\n    return NextResponse.json({\n      alerts: paginatedAlerts,\n      pagination: {\n        page,\n        limit,\n        total: alerts.length,\n        totalPages: Math.ceil(alerts.length / limit)\n      }\n    })\n\n  } catch (error) {\n    console.error('Alerts API error:', error)\n    return NextResponse.json(\n      { error: 'Failed to fetch alerts' },\n      { status: 500 }\n    )\n  }\n}\n\nexport async function POST(request: NextRequest) {\n  try {\n    const alert = await request.json()\n\n    // Validate alert data\n    if (!alert.type || !alert.severity || !alert.title) {\n      return NextResponse.json(\n        { error: 'Missing required fields' },\n        { status: 400 }\n      )\n    }\n\n    // TODO: Phase 3 - Create alerts table migration\n    // Store alert in database when alerts table exists\n    // const supabase = await createClient()\n    // const { error } = await supabase\n    //   .from('alerts')\n    //   .insert({\n    //     ...alert,\n    //     timestamp: new Date().toISOString(),\n    //     resolved: false\n    //   })\n\n    // For now, just use in-memory storage via alertManager\n    // alertManager.addAlert(alert)\n\n    return NextResponse.json({ success: true })\n\n  } catch (error) {\n    console.error('Alert storage error:', error)\n    return NextResponse.json(\n      { error: 'Failed to store alert' },\n      { status: 500 }\n    )\n  }\n}\n\nexport async function PATCH(request: NextRequest) {\n  try {\n    const { searchParams } = new URL(request.url)\n    const alertId = searchParams.get('id')\n    const { resolved } = await request.json()\n\n    if (!alertId) {\n      return NextResponse.json(\n        { error: 'Alert ID is required' },\n        { status: 400 }\n      )\n    }\n\n    // Get user context\n    const supabase = await createClient()\n    const { data: { user } } = await supabase.auth.getUser()\n\n    if (!user) {\n      return NextResponse.json(\n        { error: 'Unauthorized' },\n        { status: 401 }\n      )\n    }\n\n    // Update alert\n    if (resolved !== undefined) {\n      alertManager.resolveAlert(alertId)\n\n      // TODO: Phase 3 - Create alerts table migration\n      // Update in database when alerts table exists\n      // const { error } = await supabase\n      //   .from('alerts')\n      //   .update({\n      //     resolved,\n      //     resolved_at: resolved ? new Date().toISOString() : null,\n      //     resolved_by: user.id\n      //   })\n      //   .eq('id', alertId)\n      //\n      // if (error) {\n      //   throw error\n      // }\n    }\n\n    return NextResponse.json({ success: true })\n\n  } catch (error) {\n    console.error('Alert update error:', error)\n    return NextResponse.json(\n      { error: 'Failed to update alert' },\n      { status: 500 }\n    )\n  }\n}"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}