{"version":3,"names":["DELETE","cov_2kctmxfcke","f","s","GET","PATCH","request","params","user","_apiutils","requireAuthenticatedUser","id","profile","getUserOrganization","mediaStorage","_storage","MediaStorageService","file","getFile","organization_id","b","_server","NextResponse","json","error","status","createSuccessResponse","console","createErrorResponse","deleteFile","deleted","body","metadata","supabase","_server1","createClient","data","updatedFile","from","update","updated_at","Date","toISOString","eq","select","single"],"sources":["C:\\Ai Projecten\\ADSapp\\src\\app\\api\\media\\[id]\\route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server'\nimport { requireAuthenticatedUser, getUserOrganization, createErrorResponse, createSuccessResponse } from '@/lib/api-utils'\nimport { MediaStorageService } from '@/lib/media/storage'\nimport { createClient } from '@/lib/supabase/server'\n\nexport async function GET(\n  request: NextRequest,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  try {\n    // Authenticate user\n    const user = await requireAuthenticatedUser()\n    const { id } = await params;\n    const profile = await getUserOrganization(user.id)\n\n    const mediaStorage = new MediaStorageService()\n    const file = await mediaStorage.getFile(id, profile.organization_id)\n\n    if (!file) {\n      return NextResponse.json(\n        { error: 'File not found' },\n        { status: 404 }\n      )\n    }\n\n    return createSuccessResponse({ file })\n\n  } catch (error) {\n    console.error('Media get error:', error)\n    return createErrorResponse(error)\n  }\n}\n\nexport async function DELETE(\n  request: NextRequest,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  try {\n    // Authenticate user\n    const user = await requireAuthenticatedUser()\n    const { id } = await params;\n    const profile = await getUserOrganization(user.id)\n\n    const mediaStorage = new MediaStorageService()\n    await mediaStorage.deleteFile(id, profile.organization_id)\n\n    return createSuccessResponse({ deleted: true })\n\n  } catch (error) {\n    console.error('Media delete error:', error)\n    return createErrorResponse(error)\n  }\n}\n\nexport async function PATCH(\n  request: NextRequest,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  try {\n    // Authenticate user\n    const user = await requireAuthenticatedUser()\n    const { id } = await params;\n    const profile = await getUserOrganization(user.id)\n\n    const body = await request.json()\n    const { metadata } = body\n\n    if (!metadata) {\n      return NextResponse.json(\n        { error: 'Metadata is required' },\n        { status: 400 }\n      )\n    }\n\n    // Update file metadata\n    const mediaStorage = new MediaStorageService()\n    const file = await mediaStorage.getFile(id, profile.organization_id)\n\n    if (!file) {\n      return NextResponse.json(\n        { error: 'File not found' },\n        { status: 404 }\n      )\n    }\n\n    // Update metadata in database\n    const supabase = await createClient()\n    const { data: updatedFile, error } = await supabase\n      .from('media_files')\n      .update({\n        metadata: { ...file.metadata, ...metadata },\n        updated_at: new Date().toISOString()\n      })\n      .eq('id', id)\n      .eq('organization_id', profile.organization_id)\n      .select()\n      .single()\n\n    if (error) {\n      throw error\n    }\n\n    return createSuccessResponse({ file: updatedFile })\n\n  } catch (error) {\n    console.error('Media update error:', error)\n    return createErrorResponse(error)\n  }\n}"],"mappings":"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","ignoreList":[]}