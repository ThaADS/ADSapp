{"version":3,"sources":["C:\\Ai Projecten\\ADSapp\\tests\\unit\\mfa.test.ts"],"sourcesContent":["/**\n * MFA Service Unit Tests\n *\n * Tests MFA functionality including:\n * - Secret generation and QR code creation\n * - TOTP token verification\n * - Backup code generation and validation\n * - MFA enablement and disablement\n */\n\nimport { describe, it, expect, jest, beforeEach } from '@jest/globals';\nimport {\n  generateMFAEnrollment,\n  verifyAndEnableMFA,\n  verifyMFAToken,\n  disableMFA,\n  getMFAStatus,\n  regenerateBackupCodes,\n  isMFARequired,\n  isValidMFATokenFormat,\n} from '@/lib/auth/mfa';\n\n// Mock Supabase client\njest.mock('@/lib/supabase/server', () => ({\n  createClient: jest.fn(() => ({\n    auth: {\n      getUser: jest.fn(),\n      signInWithPassword: jest.fn(),\n    },\n    from: jest.fn(() => ({\n      select: jest.fn(() => ({\n        eq: jest.fn(() => ({\n          single: jest.fn(),\n        })),\n      })),\n      update: jest.fn(() => ({\n        eq: jest.fn(),\n      })),\n      insert: jest.fn(),\n    })),\n  })),\n}));\n\n// Mock otplib\njest.mock('otplib', () => ({\n  authenticator: {\n    options: {},\n    generateSecret: jest.fn(() => 'TESTSECRETKEY123456'),\n    keyuri: jest.fn((email, app, secret) => `otpauth://totp/${app}:${email}?secret=${secret}`),\n    verify: jest.fn(() => true),\n  },\n}));\n\n// Mock qrcode\njest.mock('qrcode', () => ({\n  toDataURL: jest.fn(() => Promise.resolve('data:image/png;base64,mockQRCode')),\n}));\n\ndescribe('MFA Service', () => {\n  beforeEach(() => {\n    jest.clearAllMocks();\n  });\n\n  describe('generateMFAEnrollment', () => {\n    it('should generate MFA enrollment data with QR code and backup codes', async () => {\n      const mockUserId = 'user-123';\n      const { createClient } = await import('@/lib/supabase/server');\n      const mockSupabase = await createClient();\n\n      (mockSupabase.from as jest.Mock).mockReturnValue({\n        select: jest.fn(() => ({\n          eq: jest.fn(() => ({\n            single: jest.fn(() => ({\n              data: { email: 'test@example.com', full_name: 'Test User' },\n              error: null,\n            })),\n          })),\n        })),\n        update: jest.fn(() => ({\n          eq: jest.fn(() => ({ error: null })),\n        })),\n      });\n\n      const result = await generateMFAEnrollment(mockUserId);\n\n      expect(result).toHaveProperty('secret');\n      expect(result).toHaveProperty('qrCode');\n      expect(result).toHaveProperty('backupCodes');\n      expect(result.secret).toBe('TESTSECRETKEY123456');\n      expect(result.qrCode).toBe('data:image/png;base64,mockQRCode');\n      expect(result.backupCodes).toHaveLength(10);\n      expect(result.backupCodes[0]).toMatch(/^[A-Z0-9]{4}-[A-Z0-9]{4}$/);\n    });\n\n    it('should throw error if user profile not found', async () => {\n      const mockUserId = 'invalid-user';\n      const { createClient } = await import('@/lib/supabase/server');\n      const mockSupabase = await createClient();\n\n      (mockSupabase.from as jest.Mock).mockReturnValue({\n        select: jest.fn(() => ({\n          eq: jest.fn(() => ({\n            single: jest.fn(() => ({\n              data: null,\n              error: new Error('User not found'),\n            })),\n          })),\n        })),\n      });\n\n      await expect(generateMFAEnrollment(mockUserId)).rejects.toThrow('User profile not found');\n    });\n  });\n\n  describe('verifyAndEnableMFA', () => {\n    it('should verify valid TOTP token and enable MFA', async () => {\n      const mockUserId = 'user-123';\n      const mockToken = '123456';\n      const { createClient } = await import('@/lib/supabase/server');\n      const mockSupabase = await createClient();\n\n      (mockSupabase.from as jest.Mock).mockReturnValue({\n        select: jest.fn(() => ({\n          eq: jest.fn(() => ({\n            single: jest.fn(() => ({\n              data: { mfa_secret: 'TESTSECRET', mfa_enabled: false },\n              error: null,\n            })),\n          })),\n        })),\n        update: jest.fn(() => ({\n          eq: jest.fn(() => ({ error: null })),\n        })),\n      });\n\n      const result = await verifyAndEnableMFA(mockUserId, mockToken);\n\n      expect(result.valid).toBe(true);\n      expect(result.error).toBeUndefined();\n    });\n\n    it('should reject invalid TOTP token', async () => {\n      const mockUserId = 'user-123';\n      const mockToken = '000000';\n      const { authenticator } = await import('otplib');\n\n      (authenticator.verify as jest.Mock).mockReturnValueOnce(false);\n\n      const { createClient } = await import('@/lib/supabase/server');\n      const mockSupabase = await createClient();\n\n      (mockSupabase.from as jest.Mock).mockReturnValue({\n        select: jest.fn(() => ({\n          eq: jest.fn(() => ({\n            single: jest.fn(() => ({\n              data: { mfa_secret: 'TESTSECRET', mfa_enabled: false },\n              error: null,\n            })),\n          })),\n        })),\n      });\n\n      const result = await verifyAndEnableMFA(mockUserId, mockToken);\n\n      expect(result.valid).toBe(false);\n      expect(result.error).toBe('Invalid verification code');\n    });\n\n    it('should reject if MFA not enrolled', async () => {\n      const mockUserId = 'user-123';\n      const mockToken = '123456';\n      const { createClient } = await import('@/lib/supabase/server');\n      const mockSupabase = await createClient();\n\n      (mockSupabase.from as jest.Mock).mockReturnValue({\n        select: jest.fn(() => ({\n          eq: jest.fn(() => ({\n            single: jest.fn(() => ({\n              data: { mfa_secret: null, mfa_enabled: false },\n              error: null,\n            })),\n          })),\n        })),\n      });\n\n      const result = await verifyAndEnableMFA(mockUserId, mockToken);\n\n      expect(result.valid).toBe(false);\n      expect(result.error).toBe('MFA not enrolled. Start enrollment first.');\n    });\n  });\n\n  describe('isValidMFATokenFormat', () => {\n    it('should validate 6-digit TOTP codes', () => {\n      expect(isValidMFATokenFormat('123456')).toBe(true);\n      expect(isValidMFATokenFormat('000000')).toBe(true);\n      expect(isValidMFATokenFormat('999999')).toBe(true);\n    });\n\n    it('should validate backup code format', () => {\n      expect(isValidMFATokenFormat('ABCD-1234')).toBe(true);\n      expect(isValidMFATokenFormat('XY89-PQRS')).toBe(true);\n    });\n\n    it('should reject invalid formats', () => {\n      expect(isValidMFATokenFormat('12345')).toBe(false); // Too short\n      expect(isValidMFATokenFormat('1234567')).toBe(false); // Too long\n      expect(isValidMFATokenFormat('abcdef')).toBe(false); // Letters in TOTP\n      expect(isValidMFATokenFormat('ABCD-123')).toBe(false); // Invalid backup code\n      expect(isValidMFATokenFormat('')).toBe(false); // Empty\n    });\n  });\n\n  describe('getMFAStatus', () => {\n    it('should return MFA status for user', async () => {\n      const mockUserId = 'user-123';\n      const { createClient } = await import('@/lib/supabase/server');\n      const mockSupabase = await createClient();\n\n      (mockSupabase.from as jest.Mock).mockReturnValue({\n        select: jest.fn(() => ({\n          eq: jest.fn(() => ({\n            single: jest.fn(() => ({\n              data: {\n                mfa_enabled: true,\n                mfa_enrolled_at: '2025-01-15T10:00:00Z',\n                mfa_backup_codes: ['hash1', 'hash2', 'hash3'],\n              },\n              error: null,\n            })),\n          })),\n        })),\n      });\n\n      const status = await getMFAStatus(mockUserId);\n\n      expect(status.enabled).toBe(true);\n      expect(status.enrolledAt).toBe('2025-01-15T10:00:00Z');\n      expect(status.backupCodesRemaining).toBe(3);\n    });\n\n    it('should return disabled status for user without MFA', async () => {\n      const mockUserId = 'user-123';\n      const { createClient } = await import('@/lib/supabase/server');\n      const mockSupabase = await createClient();\n\n      (mockSupabase.from as jest.Mock).mockReturnValue({\n        select: jest.fn(() => ({\n          eq: jest.fn(() => ({\n            single: jest.fn(() => ({\n              data: {\n                mfa_enabled: false,\n                mfa_enrolled_at: null,\n                mfa_backup_codes: null,\n              },\n              error: null,\n            })),\n          })),\n        })),\n      });\n\n      const status = await getMFAStatus(mockUserId);\n\n      expect(status.enabled).toBe(false);\n      expect(status.enrolledAt).toBeNull();\n      expect(status.backupCodesRemaining).toBe(0);\n    });\n  });\n\n  describe('isMFARequired', () => {\n    it('should return true if MFA is enabled', async () => {\n      const mockUserId = 'user-123';\n      const { createClient } = await import('@/lib/supabase/server');\n      const mockSupabase = await createClient();\n\n      (mockSupabase.from as jest.Mock).mockReturnValue({\n        select: jest.fn(() => ({\n          eq: jest.fn(() => ({\n            single: jest.fn(() => ({\n              data: { mfa_enabled: true },\n              error: null,\n            })),\n          })),\n        })),\n      });\n\n      const required = await isMFARequired(mockUserId);\n\n      expect(required).toBe(true);\n    });\n\n    it('should return false if MFA is not enabled', async () => {\n      const mockUserId = 'user-123';\n      const { createClient } = await import('@/lib/supabase/server');\n      const mockSupabase = await createClient();\n\n      (mockSupabase.from as jest.Mock).mockReturnValue({\n        select: jest.fn(() => ({\n          eq: jest.fn(() => ({\n            single: jest.fn(() => ({\n              data: { mfa_enabled: false },\n              error: null,\n            })),\n          })),\n        })),\n      });\n\n      const required = await isMFARequired(mockUserId);\n\n      expect(required).toBe(false);\n    });\n  });\n});\n"],"names":["jest","mock","createClient","fn","auth","getUser","signInWithPassword","from","select","eq","single","update","insert","authenticator","options","generateSecret","keyuri","email","app","secret","verify","toDataURL","Promise","resolve","describe","beforeEach","clearAllMocks","it","mockUserId","mockSupabase","mockReturnValue","data","full_name","error","result","generateMFAEnrollment","expect","toHaveProperty","toBe","qrCode","backupCodes","toHaveLength","toMatch","Error","rejects","toThrow","mockToken","mfa_secret","mfa_enabled","verifyAndEnableMFA","valid","toBeUndefined","mockReturnValueOnce","isValidMFATokenFormat","mfa_enrolled_at","mfa_backup_codes","status","getMFAStatus","enabled","enrolledAt","backupCodesRemaining","toBeNull","required","isMFARequired"],"mappings":"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"}