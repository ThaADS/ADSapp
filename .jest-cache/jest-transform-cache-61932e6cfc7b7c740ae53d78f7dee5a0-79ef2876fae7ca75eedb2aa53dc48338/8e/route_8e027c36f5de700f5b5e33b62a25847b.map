{"version":3,"names":["cov_56aexvvz1","actualCoverage","s","GET","req","f","supabase","_server1","createClient","data","user","error","userError","auth","getUser","b","_server","NextResponse","json","status","profile","from","select","eq","id","single","organization_id","organization","stripe_customer_id","invoices","_server2","stripe","list","customer","limit","formattedInvoices","map","invoice","amount","amount_paid","currency","created","hosted_invoice_url","invoice_pdf","number","description","lines","console"],"sources":["C:\\Ai Projecten\\ADSapp\\src\\app\\api\\billing\\invoices\\route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server'\nimport { createClient } from '@/lib/supabase/server'\nimport { stripe } from '@/lib/stripe/server'\n\nexport async function GET(req: NextRequest) {\n  try {\n    const supabase = createClient()\n\n    const { data: { user }, error: userError } = await supabase.auth.getUser()\n    if (userError || !user) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })\n    }\n\n    const { data: profile } = await supabase\n      .from('profiles')\n      .select('organization_id')\n      .eq('id', user.id)\n      .single()\n\n    if (!profile?.organization_id) {\n      return NextResponse.json({ error: 'No organization found' }, { status: 404 })\n    }\n\n    const { data: organization } = await supabase\n      .from('organizations')\n      .select('stripe_customer_id')\n      .eq('id', profile.organization_id)\n      .single()\n\n    if (!organization?.stripe_customer_id) {\n      return NextResponse.json({ invoices: [] })\n    }\n\n    // Fetch invoices from Stripe\n    const invoices = await stripe.invoices.list({\n      customer: organization.stripe_customer_id,\n      limit: 100,\n      status: 'paid'\n    })\n\n    const formattedInvoices = invoices.data.map(invoice => ({\n      id: invoice.id,\n      amount: invoice.amount_paid,\n      currency: invoice.currency,\n      status: invoice.status,\n      created: invoice.created,\n      hosted_invoice_url: invoice.hosted_invoice_url,\n      invoice_pdf: invoice.invoice_pdf,\n      number: invoice.number,\n      description: invoice.lines.data[0]?.description || 'Subscription'\n    }))\n\n    return NextResponse.json({ invoices: formattedInvoices })\n  } catch (error) {\n    console.error('Error fetching invoices:', error)\n    return NextResponse.json(\n      { error: 'Internal server error' },\n      { status: 500 }\n    )\n  }\n}"],"mappings":"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","ignoreList":[]}