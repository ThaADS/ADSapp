5ee576ba97aa38a2827f51a406f6a2a9
"use strict";

/* istanbul ignore next */
function cov_1yp53m24wd() {
  var path = "C:\\Ai Projecten\\ADSapp\\src\\app\\api\\jobs\\bulk-message\\route.ts";
  var hash = "b547202016e20c434e5b042293b353858d91fe12";
  var global = new Function("return this")();
  var gcv = "__coverage__";
  var coverageData = {
    path: "C:\\Ai Projecten\\ADSapp\\src\\app\\api\\jobs\\bulk-message\\route.ts",
    statementMap: {
      "0": {
        start: {
          line: 2,
          column: 0
        },
        end: {
          line: 4,
          column: 3
        }
      },
      "1": {
        start: {
          line: 5,
          column: 0
        },
        end: {
          line: 10,
          column: 3
        }
      },
      "2": {
        start: {
          line: 8,
          column: 8
        },
        end: {
          line: 8,
          column: 20
        }
      },
      "3": {
        start: {
          line: 11,
          column: 16
        },
        end: {
          line: 11,
          column: 38
        }
      },
      "4": {
        start: {
          line: 12,
          column: 17
        },
        end: {
          line: 12,
          column: 59
        }
      },
      "5": {
        start: {
          line: 13,
          column: 22
        },
        end: {
          line: 13,
          column: 68
        }
      },
      "6": {
        start: {
          line: 14,
          column: 20
        },
        end: {
          line: 14,
          column: 64
        }
      },
      "7": {
        start: {
          line: 16,
          column: 4
        },
        end: {
          line: 113,
          column: 5
        }
      },
      "8": {
        start: {
          line: 17,
          column: 25
        },
        end: {
          line: 17,
          column: 59
        }
      },
      "9": {
        start: {
          line: 19,
          column: 53
        },
        end: {
          line: 19,
          column: 82
        }
      },
      "10": {
        start: {
          line: 20,
          column: 8
        },
        end: {
          line: 26,
          column: 9
        }
      },
      "11": {
        start: {
          line: 21,
          column: 12
        },
        end: {
          line: 25,
          column: 15
        }
      },
      "12": {
        start: {
          line: 28,
          column: 34
        },
        end: {
          line: 28,
          column: 124
        }
      },
      "13": {
        start: {
          line: 29,
          column: 8
        },
        end: {
          line: 35,
          column: 9
        }
      },
      "14": {
        start: {
          line: 30,
          column: 12
        },
        end: {
          line: 34,
          column: 15
        }
      },
      "15": {
        start: {
          line: 37,
          column: 8
        },
        end: {
          line: 47,
          column: 9
        }
      },
      "16": {
        start: {
          line: 42,
          column: 12
        },
        end: {
          line: 46,
          column: 15
        }
      },
      "17": {
        start: {
          line: 49,
          column: 21
        },
        end: {
          line: 49,
          column: 41
        }
      },
      "18": {
        start: {
          line: 50,
          column: 82
        },
        end: {
          line: 50,
          column: 86
        }
      },
      "19": {
        start: {
          line: 52,
          column: 8
        },
        end: {
          line: 58,
          column: 9
        }
      },
      "20": {
        start: {
          line: 53,
          column: 12
        },
        end: {
          line: 57,
          column: 15
        }
      },
      "21": {
        start: {
          line: 59,
          column: 8
        },
        end: {
          line: 65,
          column: 9
        }
      },
      "22": {
        start: {
          line: 60,
          column: 12
        },
        end: {
          line: 64,
          column: 15
        }
      },
      "23": {
        start: {
          line: 67,
          column: 57
        },
        end: {
          line: 67,
          column: 197
        }
      },
      "24": {
        start: {
          line: 68,
          column: 8
        },
        end: {
          line: 74,
          column: 9
        }
      },
      "25": {
        start: {
          line: 69,
          column: 12
        },
        end: {
          line: 73,
          column: 15
        }
      },
      "26": {
        start: {
          line: 76,
          column: 24
        },
        end: {
          line: 92,
          column: 9
        }
      },
      "27": {
        start: {
          line: 79,
          column: 47
        },
        end: {
          line: 84,
          column: 17
        }
      },
      "28": {
        start: {
          line: 94,
          column: 29
        },
        end: {
          line: 94,
          column: 65
        }
      },
      "29": {
        start: {
          line: 95,
          column: 22
        },
        end: {
          line: 97,
          column: 10
        }
      },
      "30": {
        start: {
          line: 98,
          column: 8
        },
        end: {
          line: 104,
          column: 11
        }
      },
      "31": {
        start: {
          line: 106,
          column: 8
        },
        end: {
          line: 106,
          column: 64
        }
      },
      "32": {
        start: {
          line: 107,
          column: 8
        },
        end: {
          line: 112,
          column: 11
        }
      }
    },
    fnMap: {
      "0": {
        name: "(anonymous_0)",
        decl: {
          start: {
            line: 7,
            column: 9
          },
          end: {
            line: 7,
            column: 10
          }
        },
        loc: {
          start: {
            line: 7,
            column: 20
          },
          end: {
            line: 9,
            column: 5
          }
        },
        line: 7
      },
      "1": {
        name: "POST",
        decl: {
          start: {
            line: 15,
            column: 15
          },
          end: {
            line: 15,
            column: 19
          }
        },
        loc: {
          start: {
            line: 15,
            column: 29
          },
          end: {
            line: 114,
            column: 1
          }
        },
        line: 15
      },
      "2": {
        name: "(anonymous_2)",
        decl: {
          start: {
            line: 79,
            column: 35
          },
          end: {
            line: 79,
            column: 36
          }
        },
        loc: {
          start: {
            line: 79,
            column: 47
          },
          end: {
            line: 84,
            column: 17
          }
        },
        line: 79
      }
    },
    branchMap: {
      "0": {
        loc: {
          start: {
            line: 20,
            column: 8
          },
          end: {
            line: 26,
            column: 9
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 20,
            column: 8
          },
          end: {
            line: 26,
            column: 9
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 20
      },
      "1": {
        loc: {
          start: {
            line: 20,
            column: 12
          },
          end: {
            line: 20,
            column: 30
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 20,
            column: 12
          },
          end: {
            line: 20,
            column: 21
          }
        }, {
          start: {
            line: 20,
            column: 25
          },
          end: {
            line: 20,
            column: 30
          }
        }],
        line: 20
      },
      "2": {
        loc: {
          start: {
            line: 29,
            column: 8
          },
          end: {
            line: 35,
            column: 9
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 29,
            column: 8
          },
          end: {
            line: 35,
            column: 9
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 29
      },
      "3": {
        loc: {
          start: {
            line: 37,
            column: 8
          },
          end: {
            line: 47,
            column: 9
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 37,
            column: 8
          },
          end: {
            line: 47,
            column: 9
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 37
      },
      "4": {
        loc: {
          start: {
            line: 52,
            column: 8
          },
          end: {
            line: 58,
            column: 9
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 52,
            column: 8
          },
          end: {
            line: 58,
            column: 9
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 52
      },
      "5": {
        loc: {
          start: {
            line: 52,
            column: 12
          },
          end: {
            line: 52,
            column: 80
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 52,
            column: 12
          },
          end: {
            line: 52,
            column: 23
          }
        }, {
          start: {
            line: 52,
            column: 27
          },
          end: {
            line: 52,
            column: 53
          }
        }, {
          start: {
            line: 52,
            column: 57
          },
          end: {
            line: 52,
            column: 80
          }
        }],
        line: 52
      },
      "6": {
        loc: {
          start: {
            line: 59,
            column: 8
          },
          end: {
            line: 65,
            column: 9
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 59,
            column: 8
          },
          end: {
            line: 65,
            column: 9
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 59
      },
      "7": {
        loc: {
          start: {
            line: 59,
            column: 12
          },
          end: {
            line: 59,
            column: 65
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 59,
            column: 12
          },
          end: {
            line: 59,
            column: 27
          }
        }, {
          start: {
            line: 59,
            column: 31
          },
          end: {
            line: 59,
            column: 65
          }
        }],
        line: 59
      },
      "8": {
        loc: {
          start: {
            line: 68,
            column: 8
          },
          end: {
            line: 74,
            column: 9
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 68,
            column: 8
          },
          end: {
            line: 74,
            column: 9
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 68
      },
      "9": {
        loc: {
          start: {
            line: 68,
            column: 12
          },
          end: {
            line: 68,
            column: 63
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 68,
            column: 12
          },
          end: {
            line: 68,
            column: 25
          }
        }, {
          start: {
            line: 68,
            column: 29
          },
          end: {
            line: 68,
            column: 38
          }
        }, {
          start: {
            line: 68,
            column: 42
          },
          end: {
            line: 68,
            column: 63
          }
        }],
        line: 68
      },
      "10": {
        loc: {
          start: {
            line: 83,
            column: 31
          },
          end: {
            line: 83,
            column: 58
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 83,
            column: 31
          },
          end: {
            line: 83,
            column: 52
          }
        }, {
          start: {
            line: 83,
            column: 56
          },
          end: {
            line: 83,
            column: 58
          }
        }],
        line: 83
      },
      "11": {
        loc: {
          start: {
            line: 86,
            column: 25
          },
          end: {
            line: 86,
            column: 46
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 86,
            column: 25
          },
          end: {
            line: 86,
            column: 36
          }
        }, {
          start: {
            line: 86,
            column: 40
          },
          end: {
            line: 86,
            column: 46
          }
        }],
        line: 86
      },
      "12": {
        loc: {
          start: {
            line: 87,
            column: 24
          },
          end: {
            line: 87,
            column: 47
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 87,
            column: 24
          },
          end: {
            line: 87,
            column: 34
          }
        }, {
          start: {
            line: 87,
            column: 38
          },
          end: {
            line: 87,
            column: 47
          }
        }],
        line: 87
      },
      "13": {
        loc: {
          start: {
            line: 96,
            column: 22
          },
          end: {
            line: 96,
            column: 66
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 96,
            column: 22
          },
          end: {
            line: 96,
            column: 30
          }
        }, {
          start: {
            line: 96,
            column: 34
          },
          end: {
            line: 96,
            column: 66
          }
        }],
        line: 96
      },
      "14": {
        loc: {
          start: {
            line: 109,
            column: 21
          },
          end: {
            line: 109,
            column: 77
          }
        },
        type: "cond-expr",
        locations: [{
          start: {
            line: 109,
            column: 46
          },
          end: {
            line: 109,
            column: 59
          }
        }, {
          start: {
            line: 109,
            column: 62
          },
          end: {
            line: 109,
            column: 77
          }
        }],
        line: 109
      }
    },
    s: {
      "0": 0,
      "1": 0,
      "2": 0,
      "3": 0,
      "4": 0,
      "5": 0,
      "6": 0,
      "7": 0,
      "8": 0,
      "9": 0,
      "10": 0,
      "11": 0,
      "12": 0,
      "13": 0,
      "14": 0,
      "15": 0,
      "16": 0,
      "17": 0,
      "18": 0,
      "19": 0,
      "20": 0,
      "21": 0,
      "22": 0,
      "23": 0,
      "24": 0,
      "25": 0,
      "26": 0,
      "27": 0,
      "28": 0,
      "29": 0,
      "30": 0,
      "31": 0,
      "32": 0
    },
    f: {
      "0": 0,
      "1": 0,
      "2": 0
    },
    b: {
      "0": [0, 0],
      "1": [0, 0],
      "2": [0, 0],
      "3": [0, 0],
      "4": [0, 0],
      "5": [0, 0, 0],
      "6": [0, 0],
      "7": [0, 0],
      "8": [0, 0],
      "9": [0, 0, 0],
      "10": [0, 0],
      "11": [0, 0],
      "12": [0, 0],
      "13": [0, 0],
      "14": [0, 0]
    },
    inputSourceMap: {
      version: 3,
      sources: ["C:\\Ai Projecten\\ADSapp\\src\\app\\api\\jobs\\bulk-message\\route.ts"],
      sourcesContent: ["import { NextRequest, NextResponse } from 'next/server';\nimport { createClient } from '@/lib/supabase/server';\nimport { getQueueManager } from '@/lib/queue/queue-manager';\nimport { QueueName, JobPriority } from '@/lib/queue/bull-config';\nimport { BulkMessageJobData } from '@/lib/queue/processors/bulk-message-processor';\n\n/**\n * POST /api/jobs/bulk-message\n * Queue a bulk message sending job\n */\nexport async function POST(request: NextRequest) {\n  try {\n    const supabase = await createClient();\n\n    // Get authenticated user\n    const {\n      data: { user },\n      error: authError\n    } = await supabase.auth.getUser();\n\n    if (authError || !user) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    // Get user's organization\n    const { data: profile } = await supabase\n      .from('profiles')\n      .select('organization_id, role')\n      .eq('id', user.id)\n      .single();\n\n    if (!profile?.organization_id) {\n      return NextResponse.json(\n        { error: 'No organization found' },\n        { status: 400 }\n      );\n    }\n\n    // Check permissions (only agents and above can send bulk messages)\n    if (!['owner', 'admin', 'agent'].includes(profile.role)) {\n      return NextResponse.json(\n        { error: 'Insufficient permissions' },\n        { status: 403 }\n      );\n    }\n\n    // Parse request body\n    const body = await request.json();\n    const { contactIds, messageContent, messageType, templateId, priority } =\n      body;\n\n    // Validate required fields\n    if (!contactIds || !Array.isArray(contactIds) || contactIds.length === 0) {\n      return NextResponse.json(\n        { error: 'contactIds is required and must be a non-empty array' },\n        { status: 400 }\n      );\n    }\n\n    if (!messageContent || typeof messageContent !== 'string') {\n      return NextResponse.json(\n        { error: 'messageContent is required and must be a string' },\n        { status: 400 }\n      );\n    }\n\n    // Fetch contacts from database\n    const { data: contacts, error: contactsError } = await supabase\n      .from('contacts')\n      .select('id, phone, name, custom_fields')\n      .eq('organization_id', profile.organization_id)\n      .in('id', contactIds);\n\n    if (contactsError || !contacts || contacts.length === 0) {\n      return NextResponse.json(\n        { error: 'No valid contacts found' },\n        { status: 400 }\n      );\n    }\n\n    // Prepare job data\n    const jobData: BulkMessageJobData = {\n      organizationId: profile.organization_id,\n      userId: user.id,\n      contacts: contacts.map((contact) => ({\n        id: contact.id,\n        phone: contact.phone,\n        name: contact.name,\n        variables: contact.custom_fields || {}\n      })),\n      messageContent,\n      messageType: messageType || 'text',\n      templateId: templateId || undefined,\n      metadata: {\n        requestedBy: user.email,\n        requestedAt: new Date().toISOString()\n      }\n    };\n\n    // Get queue manager and add job\n    const queueManager = getQueueManager();\n    const jobId = await queueManager.addJob(\n      QueueName.BULK_MESSAGE,\n      'send-bulk-message',\n      jobData,\n      {\n        priority: priority || JobPriority.CRITICAL\n      }\n    );\n\n    return NextResponse.json(\n      {\n        success: true,\n        jobId,\n        message: `Bulk message job queued for ${contacts.length} contacts`\n      },\n      { status: 202 }\n    );\n  } catch (error) {\n    console.error('Error queuing bulk message job:', error);\n    return NextResponse.json(\n      {\n        error: 'Failed to queue bulk message job',\n        details: error instanceof Error ? error.message : 'Unknown error'\n      },\n      { status: 500 }\n    );\n  }\n}\n"],
      names: ["POST", "request", "supabase", "createClient", "data", "user", "error", "authError", "auth", "getUser", "NextResponse", "json", "status", "profile", "from", "select", "eq", "id", "single", "organization_id", "includes", "role", "body", "contactIds", "messageContent", "messageType", "templateId", "priority", "Array", "isArray", "length", "contacts", "contactsError", "in", "jobData", "organizationId", "userId", "map", "contact", "phone", "name", "variables", "custom_fields", "undefined", "metadata", "requestedBy", "email", "requestedAt", "Date", "toISOString", "queueManager", "getQueueManager", "jobId", "addJob", "QueueName", "BULK_MESSAGE", "JobPriority", "CRITICAL", "success", "message", "console", "details", "Error"],
      mappings: "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"
    },
    _coverageSchema: "1a1c01bbd47fc00a2c39e90264f33305004495a9",
    hash: "b547202016e20c434e5b042293b353858d91fe12"
  };
  var coverage = global[gcv] || (global[gcv] = {});
  if (!coverage[path] || coverage[path].hash !== hash) {
    coverage[path] = coverageData;
  }
  var actualCoverage = coverage[path];
  {
    // @ts-ignore
    cov_1yp53m24wd = function () {
      return actualCoverage;
    };
  }
  return actualCoverage;
}
cov_1yp53m24wd();
cov_1yp53m24wd().s[0]++;
Object.defineProperty(exports, "__esModule", {
  value: true
});
/* istanbul ignore next */
cov_1yp53m24wd().s[1]++;
Object.defineProperty(exports, "POST", {
  enumerable: true,
  get: function () {
    /* istanbul ignore next */
    cov_1yp53m24wd().f[0]++;
    cov_1yp53m24wd().s[2]++;
    return POST;
  }
});
const _server =
/* istanbul ignore next */
(cov_1yp53m24wd().s[3]++, require("next/server"));
const _server1 =
/* istanbul ignore next */
(cov_1yp53m24wd().s[4]++, require("../../../../lib/supabase/server"));
const _queuemanager =
/* istanbul ignore next */
(cov_1yp53m24wd().s[5]++, require("../../../../lib/queue/queue-manager"));
const _bullconfig =
/* istanbul ignore next */
(cov_1yp53m24wd().s[6]++, require("../../../../lib/queue/bull-config"));
async function POST(request) {
  /* istanbul ignore next */
  cov_1yp53m24wd().f[1]++;
  cov_1yp53m24wd().s[7]++;
  try {
    const supabase =
    /* istanbul ignore next */
    (cov_1yp53m24wd().s[8]++, await (0, _server1.createClient)());
    // Get authenticated user
    const {
      data: {
        user
      },
      error: authError
    } =
    /* istanbul ignore next */
    (cov_1yp53m24wd().s[9]++, await supabase.auth.getUser());
    /* istanbul ignore next */
    cov_1yp53m24wd().s[10]++;
    if (
    /* istanbul ignore next */
    (cov_1yp53m24wd().b[1][0]++, authError) ||
    /* istanbul ignore next */
    (cov_1yp53m24wd().b[1][1]++, !user)) {
      /* istanbul ignore next */
      cov_1yp53m24wd().b[0][0]++;
      cov_1yp53m24wd().s[11]++;
      return _server.NextResponse.json({
        error: 'Unauthorized'
      }, {
        status: 401
      });
    } else
    /* istanbul ignore next */
    {
      cov_1yp53m24wd().b[0][1]++;
    }
    // Get user's organization
    const {
      data: profile
    } =
    /* istanbul ignore next */
    (cov_1yp53m24wd().s[12]++, await supabase.from('profiles').select('organization_id, role').eq('id', user.id).single());
    /* istanbul ignore next */
    cov_1yp53m24wd().s[13]++;
    if (!profile?.organization_id) {
      /* istanbul ignore next */
      cov_1yp53m24wd().b[2][0]++;
      cov_1yp53m24wd().s[14]++;
      return _server.NextResponse.json({
        error: 'No organization found'
      }, {
        status: 400
      });
    } else
    /* istanbul ignore next */
    {
      cov_1yp53m24wd().b[2][1]++;
    }
    // Check permissions (only agents and above can send bulk messages)
    cov_1yp53m24wd().s[15]++;
    if (!['owner', 'admin', 'agent'].includes(profile.role)) {
      /* istanbul ignore next */
      cov_1yp53m24wd().b[3][0]++;
      cov_1yp53m24wd().s[16]++;
      return _server.NextResponse.json({
        error: 'Insufficient permissions'
      }, {
        status: 403
      });
    } else
    /* istanbul ignore next */
    {
      cov_1yp53m24wd().b[3][1]++;
    }
    // Parse request body
    const body =
    /* istanbul ignore next */
    (cov_1yp53m24wd().s[17]++, await request.json());
    const {
      contactIds,
      messageContent,
      messageType,
      templateId,
      priority
    } =
    /* istanbul ignore next */
    (cov_1yp53m24wd().s[18]++, body);
    // Validate required fields
    /* istanbul ignore next */
    cov_1yp53m24wd().s[19]++;
    if (
    /* istanbul ignore next */
    (cov_1yp53m24wd().b[5][0]++, !contactIds) ||
    /* istanbul ignore next */
    (cov_1yp53m24wd().b[5][1]++, !Array.isArray(contactIds)) ||
    /* istanbul ignore next */
    (cov_1yp53m24wd().b[5][2]++, contactIds.length === 0)) {
      /* istanbul ignore next */
      cov_1yp53m24wd().b[4][0]++;
      cov_1yp53m24wd().s[20]++;
      return _server.NextResponse.json({
        error: 'contactIds is required and must be a non-empty array'
      }, {
        status: 400
      });
    } else
    /* istanbul ignore next */
    {
      cov_1yp53m24wd().b[4][1]++;
    }
    cov_1yp53m24wd().s[21]++;
    if (
    /* istanbul ignore next */
    (cov_1yp53m24wd().b[7][0]++, !messageContent) ||
    /* istanbul ignore next */
    (cov_1yp53m24wd().b[7][1]++, typeof messageContent !== 'string')) {
      /* istanbul ignore next */
      cov_1yp53m24wd().b[6][0]++;
      cov_1yp53m24wd().s[22]++;
      return _server.NextResponse.json({
        error: 'messageContent is required and must be a string'
      }, {
        status: 400
      });
    } else
    /* istanbul ignore next */
    {
      cov_1yp53m24wd().b[6][1]++;
    }
    // Fetch contacts from database
    const {
      data: contacts,
      error: contactsError
    } =
    /* istanbul ignore next */
    (cov_1yp53m24wd().s[23]++, await supabase.from('contacts').select('id, phone, name, custom_fields').eq('organization_id', profile.organization_id).in('id', contactIds));
    /* istanbul ignore next */
    cov_1yp53m24wd().s[24]++;
    if (
    /* istanbul ignore next */
    (cov_1yp53m24wd().b[9][0]++, contactsError) ||
    /* istanbul ignore next */
    (cov_1yp53m24wd().b[9][1]++, !contacts) ||
    /* istanbul ignore next */
    (cov_1yp53m24wd().b[9][2]++, contacts.length === 0)) {
      /* istanbul ignore next */
      cov_1yp53m24wd().b[8][0]++;
      cov_1yp53m24wd().s[25]++;
      return _server.NextResponse.json({
        error: 'No valid contacts found'
      }, {
        status: 400
      });
    } else
    /* istanbul ignore next */
    {
      cov_1yp53m24wd().b[8][1]++;
    }
    // Prepare job data
    const jobData =
    /* istanbul ignore next */
    (cov_1yp53m24wd().s[26]++, {
      organizationId: profile.organization_id,
      userId: user.id,
      contacts: contacts.map(contact => {
        /* istanbul ignore next */
        cov_1yp53m24wd().f[2]++;
        cov_1yp53m24wd().s[27]++;
        return {
          id: contact.id,
          phone: contact.phone,
          name: contact.name,
          variables:
          /* istanbul ignore next */
          (cov_1yp53m24wd().b[10][0]++, contact.custom_fields) ||
          /* istanbul ignore next */
          (cov_1yp53m24wd().b[10][1]++, {})
        };
      }),
      messageContent,
      messageType:
      /* istanbul ignore next */
      (cov_1yp53m24wd().b[11][0]++, messageType) ||
      /* istanbul ignore next */
      (cov_1yp53m24wd().b[11][1]++, 'text'),
      templateId:
      /* istanbul ignore next */
      (cov_1yp53m24wd().b[12][0]++, templateId) ||
      /* istanbul ignore next */
      (cov_1yp53m24wd().b[12][1]++, undefined),
      metadata: {
        requestedBy: user.email,
        requestedAt: new Date().toISOString()
      }
    });
    // Get queue manager and add job
    const queueManager =
    /* istanbul ignore next */
    (cov_1yp53m24wd().s[28]++, (0, _queuemanager.getQueueManager)());
    const jobId =
    /* istanbul ignore next */
    (cov_1yp53m24wd().s[29]++, await queueManager.addJob(_bullconfig.QueueName.BULK_MESSAGE, 'send-bulk-message', jobData, {
      priority:
      /* istanbul ignore next */
      (cov_1yp53m24wd().b[13][0]++, priority) ||
      /* istanbul ignore next */
      (cov_1yp53m24wd().b[13][1]++, _bullconfig.JobPriority.CRITICAL)
    }));
    /* istanbul ignore next */
    cov_1yp53m24wd().s[30]++;
    return _server.NextResponse.json({
      success: true,
      jobId,
      message: `Bulk message job queued for ${contacts.length} contacts`
    }, {
      status: 202
    });
  } catch (error) {
    /* istanbul ignore next */
    cov_1yp53m24wd().s[31]++;
    console.error('Error queuing bulk message job:', error);
    /* istanbul ignore next */
    cov_1yp53m24wd().s[32]++;
    return _server.NextResponse.json({
      error: 'Failed to queue bulk message job',
      details: error instanceof Error ?
      /* istanbul ignore next */
      (cov_1yp53m24wd().b[14][0]++, error.message) :
      /* istanbul ignore next */
      (cov_1yp53m24wd().b[14][1]++, 'Unknown error')
    }, {
      status: 500
    });
  }
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJjb3ZfMXlwNTNtMjR3ZCIsImFjdHVhbENvdmVyYWdlIiwicyIsIlBPU1QiLCJyZXF1ZXN0IiwiZiIsInN1cGFiYXNlIiwiX3NlcnZlcjEiLCJjcmVhdGVDbGllbnQiLCJkYXRhIiwidXNlciIsImVycm9yIiwiYXV0aEVycm9yIiwiYXV0aCIsImdldFVzZXIiLCJiIiwiX3NlcnZlciIsIk5leHRSZXNwb25zZSIsImpzb24iLCJzdGF0dXMiLCJwcm9maWxlIiwiZnJvbSIsInNlbGVjdCIsImVxIiwiaWQiLCJzaW5nbGUiLCJvcmdhbml6YXRpb25faWQiLCJpbmNsdWRlcyIsInJvbGUiLCJib2R5IiwiY29udGFjdElkcyIsIm1lc3NhZ2VDb250ZW50IiwibWVzc2FnZVR5cGUiLCJ0ZW1wbGF0ZUlkIiwicHJpb3JpdHkiLCJBcnJheSIsImlzQXJyYXkiLCJsZW5ndGgiLCJjb250YWN0cyIsImNvbnRhY3RzRXJyb3IiLCJpbiIsImpvYkRhdGEiLCJvcmdhbml6YXRpb25JZCIsInVzZXJJZCIsIm1hcCIsImNvbnRhY3QiLCJwaG9uZSIsIm5hbWUiLCJ2YXJpYWJsZXMiLCJjdXN0b21fZmllbGRzIiwidW5kZWZpbmVkIiwibWV0YWRhdGEiLCJyZXF1ZXN0ZWRCeSIsImVtYWlsIiwicmVxdWVzdGVkQXQiLCJEYXRlIiwidG9JU09TdHJpbmciLCJxdWV1ZU1hbmFnZXIiLCJfcXVldWVtYW5hZ2VyIiwiZ2V0UXVldWVNYW5hZ2VyIiwiam9iSWQiLCJhZGRKb2IiLCJfYnVsbGNvbmZpZyIsIlF1ZXVlTmFtZSIsIkJVTEtfTUVTU0FHRSIsIkpvYlByaW9yaXR5IiwiQ1JJVElDQUwiLCJzdWNjZXNzIiwibWVzc2FnZSIsImNvbnNvbGUiLCJkZXRhaWxzIiwiRXJyb3IiXSwic291cmNlcyI6WyJDOlxcQWkgUHJvamVjdGVuXFxBRFNhcHBcXHNyY1xcYXBwXFxhcGlcXGpvYnNcXGJ1bGstbWVzc2FnZVxccm91dGUudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTmV4dFJlcXVlc3QsIE5leHRSZXNwb25zZSB9IGZyb20gJ25leHQvc2VydmVyJztcbmltcG9ydCB7IGNyZWF0ZUNsaWVudCB9IGZyb20gJ0AvbGliL3N1cGFiYXNlL3NlcnZlcic7XG5pbXBvcnQgeyBnZXRRdWV1ZU1hbmFnZXIgfSBmcm9tICdAL2xpYi9xdWV1ZS9xdWV1ZS1tYW5hZ2VyJztcbmltcG9ydCB7IFF1ZXVlTmFtZSwgSm9iUHJpb3JpdHkgfSBmcm9tICdAL2xpYi9xdWV1ZS9idWxsLWNvbmZpZyc7XG5pbXBvcnQgeyBCdWxrTWVzc2FnZUpvYkRhdGEgfSBmcm9tICdAL2xpYi9xdWV1ZS9wcm9jZXNzb3JzL2J1bGstbWVzc2FnZS1wcm9jZXNzb3InO1xuXG4vKipcbiAqIFBPU1QgL2FwaS9qb2JzL2J1bGstbWVzc2FnZVxuICogUXVldWUgYSBidWxrIG1lc3NhZ2Ugc2VuZGluZyBqb2JcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIFBPU1QocmVxdWVzdDogTmV4dFJlcXVlc3QpIHtcbiAgdHJ5IHtcbiAgICBjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xuXG4gICAgLy8gR2V0IGF1dGhlbnRpY2F0ZWQgdXNlclxuICAgIGNvbnN0IHtcbiAgICAgIGRhdGE6IHsgdXNlciB9LFxuICAgICAgZXJyb3I6IGF1dGhFcnJvclxuICAgIH0gPSBhd2FpdCBzdXBhYmFzZS5hdXRoLmdldFVzZXIoKTtcblxuICAgIGlmIChhdXRoRXJyb3IgfHwgIXVzZXIpIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IGVycm9yOiAnVW5hdXRob3JpemVkJyB9LCB7IHN0YXR1czogNDAxIH0pO1xuICAgIH1cblxuICAgIC8vIEdldCB1c2VyJ3Mgb3JnYW5pemF0aW9uXG4gICAgY29uc3QgeyBkYXRhOiBwcm9maWxlIH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgICAgLmZyb20oJ3Byb2ZpbGVzJylcbiAgICAgIC5zZWxlY3QoJ29yZ2FuaXphdGlvbl9pZCwgcm9sZScpXG4gICAgICAuZXEoJ2lkJywgdXNlci5pZClcbiAgICAgIC5zaW5nbGUoKTtcblxuICAgIGlmICghcHJvZmlsZT8ub3JnYW5pemF0aW9uX2lkKSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHsgZXJyb3I6ICdObyBvcmdhbml6YXRpb24gZm91bmQnIH0sXG4gICAgICAgIHsgc3RhdHVzOiA0MDAgfVxuICAgICAgKTtcbiAgICB9XG5cbiAgICAvLyBDaGVjayBwZXJtaXNzaW9ucyAob25seSBhZ2VudHMgYW5kIGFib3ZlIGNhbiBzZW5kIGJ1bGsgbWVzc2FnZXMpXG4gICAgaWYgKCFbJ293bmVyJywgJ2FkbWluJywgJ2FnZW50J10uaW5jbHVkZXMocHJvZmlsZS5yb2xlKSkge1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICB7IGVycm9yOiAnSW5zdWZmaWNpZW50IHBlcm1pc3Npb25zJyB9LFxuICAgICAgICB7IHN0YXR1czogNDAzIH1cbiAgICAgICk7XG4gICAgfVxuXG4gICAgLy8gUGFyc2UgcmVxdWVzdCBib2R5XG4gICAgY29uc3QgYm9keSA9IGF3YWl0IHJlcXVlc3QuanNvbigpO1xuICAgIGNvbnN0IHsgY29udGFjdElkcywgbWVzc2FnZUNvbnRlbnQsIG1lc3NhZ2VUeXBlLCB0ZW1wbGF0ZUlkLCBwcmlvcml0eSB9ID1cbiAgICAgIGJvZHk7XG5cbiAgICAvLyBWYWxpZGF0ZSByZXF1aXJlZCBmaWVsZHNcbiAgICBpZiAoIWNvbnRhY3RJZHMgfHwgIUFycmF5LmlzQXJyYXkoY29udGFjdElkcykgfHwgY29udGFjdElkcy5sZW5ndGggPT09IDApIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAgeyBlcnJvcjogJ2NvbnRhY3RJZHMgaXMgcmVxdWlyZWQgYW5kIG11c3QgYmUgYSBub24tZW1wdHkgYXJyYXknIH0sXG4gICAgICAgIHsgc3RhdHVzOiA0MDAgfVxuICAgICAgKTtcbiAgICB9XG5cbiAgICBpZiAoIW1lc3NhZ2VDb250ZW50IHx8IHR5cGVvZiBtZXNzYWdlQ29udGVudCAhPT0gJ3N0cmluZycpIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAgeyBlcnJvcjogJ21lc3NhZ2VDb250ZW50IGlzIHJlcXVpcmVkIGFuZCBtdXN0IGJlIGEgc3RyaW5nJyB9LFxuICAgICAgICB7IHN0YXR1czogNDAwIH1cbiAgICAgICk7XG4gICAgfVxuXG4gICAgLy8gRmV0Y2ggY29udGFjdHMgZnJvbSBkYXRhYmFzZVxuICAgIGNvbnN0IHsgZGF0YTogY29udGFjdHMsIGVycm9yOiBjb250YWN0c0Vycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgICAgLmZyb20oJ2NvbnRhY3RzJylcbiAgICAgIC5zZWxlY3QoJ2lkLCBwaG9uZSwgbmFtZSwgY3VzdG9tX2ZpZWxkcycpXG4gICAgICAuZXEoJ29yZ2FuaXphdGlvbl9pZCcsIHByb2ZpbGUub3JnYW5pemF0aW9uX2lkKVxuICAgICAgLmluKCdpZCcsIGNvbnRhY3RJZHMpO1xuXG4gICAgaWYgKGNvbnRhY3RzRXJyb3IgfHwgIWNvbnRhY3RzIHx8IGNvbnRhY3RzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICB7IGVycm9yOiAnTm8gdmFsaWQgY29udGFjdHMgZm91bmQnIH0sXG4gICAgICAgIHsgc3RhdHVzOiA0MDAgfVxuICAgICAgKTtcbiAgICB9XG5cbiAgICAvLyBQcmVwYXJlIGpvYiBkYXRhXG4gICAgY29uc3Qgam9iRGF0YTogQnVsa01lc3NhZ2VKb2JEYXRhID0ge1xuICAgICAgb3JnYW5pemF0aW9uSWQ6IHByb2ZpbGUub3JnYW5pemF0aW9uX2lkLFxuICAgICAgdXNlcklkOiB1c2VyLmlkLFxuICAgICAgY29udGFjdHM6IGNvbnRhY3RzLm1hcCgoY29udGFjdCkgPT4gKHtcbiAgICAgICAgaWQ6IGNvbnRhY3QuaWQsXG4gICAgICAgIHBob25lOiBjb250YWN0LnBob25lLFxuICAgICAgICBuYW1lOiBjb250YWN0Lm5hbWUsXG4gICAgICAgIHZhcmlhYmxlczogY29udGFjdC5jdXN0b21fZmllbGRzIHx8IHt9XG4gICAgICB9KSksXG4gICAgICBtZXNzYWdlQ29udGVudCxcbiAgICAgIG1lc3NhZ2VUeXBlOiBtZXNzYWdlVHlwZSB8fCAndGV4dCcsXG4gICAgICB0ZW1wbGF0ZUlkOiB0ZW1wbGF0ZUlkIHx8IHVuZGVmaW5lZCxcbiAgICAgIG1ldGFkYXRhOiB7XG4gICAgICAgIHJlcXVlc3RlZEJ5OiB1c2VyLmVtYWlsLFxuICAgICAgICByZXF1ZXN0ZWRBdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpXG4gICAgICB9XG4gICAgfTtcblxuICAgIC8vIEdldCBxdWV1ZSBtYW5hZ2VyIGFuZCBhZGQgam9iXG4gICAgY29uc3QgcXVldWVNYW5hZ2VyID0gZ2V0UXVldWVNYW5hZ2VyKCk7XG4gICAgY29uc3Qgam9iSWQgPSBhd2FpdCBxdWV1ZU1hbmFnZXIuYWRkSm9iKFxuICAgICAgUXVldWVOYW1lLkJVTEtfTUVTU0FHRSxcbiAgICAgICdzZW5kLWJ1bGstbWVzc2FnZScsXG4gICAgICBqb2JEYXRhLFxuICAgICAge1xuICAgICAgICBwcmlvcml0eTogcHJpb3JpdHkgfHwgSm9iUHJpb3JpdHkuQ1JJVElDQUxcbiAgICAgIH1cbiAgICApO1xuXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAge1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBqb2JJZCxcbiAgICAgICAgbWVzc2FnZTogYEJ1bGsgbWVzc2FnZSBqb2IgcXVldWVkIGZvciAke2NvbnRhY3RzLmxlbmd0aH0gY29udGFjdHNgXG4gICAgICB9LFxuICAgICAgeyBzdGF0dXM6IDIwMiB9XG4gICAgKTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBxdWV1aW5nIGJ1bGsgbWVzc2FnZSBqb2I6JywgZXJyb3IpO1xuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgIHtcbiAgICAgICAgZXJyb3I6ICdGYWlsZWQgdG8gcXVldWUgYnVsayBtZXNzYWdlIGpvYicsXG4gICAgICAgIGRldGFpbHM6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ1Vua25vd24gZXJyb3InXG4gICAgICB9LFxuICAgICAgeyBzdGF0dXM6IDUwMCB9XG4gICAgKTtcbiAgfVxufVxuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7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