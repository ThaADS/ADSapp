{"version":3,"sources":["C:\\Ai Projecten\\ADSapp\\tests\\unit\\auth\\authentication.test.ts"],"sourcesContent":["/**\n * Authentication Tests\n *\n * Comprehensive tests for user authentication including login validation,\n * credential verification, and MFA token validation.\n *\n * @module tests/unit/auth/authentication\n */\n\nimport { createClient } from '@/lib/supabase/server';\nimport {\n  verifyMFAToken,\n  verifyAndEnableMFA,\n  getMFAStatus,\n  isValidMFATokenFormat,\n} from '@/lib/auth/mfa';\n\n// Mock Supabase client\njest.mock('@/lib/supabase/server');\njest.mock('otplib', () => ({\n  authenticator: {\n    verify: jest.fn(),\n    options: {},\n  },\n}));\n\ndescribe('Authentication', () => {\n  const mockCreateClient = createClient as jest.MockedFunction<typeof createClient>;\n\n  beforeEach(() => {\n    jest.clearAllMocks();\n  });\n\n  describe('Test 6: User Login with Valid Credentials', () => {\n    it('should successfully authenticate user with correct email and password', async () => {\n      // Arrange\n      const mockUser = {\n        id: 'user-valid-login',\n        email: 'valid@example.com',\n        user_metadata: {\n          full_name: 'Valid User',\n        },\n      };\n\n      const mockSession = {\n        user: mockUser,\n        access_token: 'mock-access-token-123',\n        refresh_token: 'mock-refresh-token-456',\n        expires_at: Date.now() + 3600000,\n      };\n\n      const mockSupabaseClient = {\n        auth: {\n          signInWithPassword: jest.fn().mockResolvedValue({\n            data: { session: mockSession, user: mockUser },\n            error: null,\n          }),\n          getSession: jest.fn().mockResolvedValue({\n            data: { session: mockSession },\n            error: null,\n          }),\n        },\n      };\n\n      mockCreateClient.mockResolvedValue(mockSupabaseClient as any);\n\n      // Act\n      const { data, error } = await mockSupabaseClient.auth.signInWithPassword({\n        email: 'valid@example.com',\n        password: 'SecurePassword123!',\n      });\n\n      // Assert\n      expect(error).toBeNull();\n      expect(data.user).toBeDefined();\n      expect(data.user.id).toBe('user-valid-login');\n      expect(data.user.email).toBe('valid@example.com');\n      expect(data.session).toBeDefined();\n      expect(data.session.access_token).toBe('mock-access-token-123');\n      expect(mockSupabaseClient.auth.signInWithPassword).toHaveBeenCalledWith({\n        email: 'valid@example.com',\n        password: 'SecurePassword123!',\n      });\n    });\n\n    it('should return user profile data after successful authentication', async () => {\n      // Arrange\n      const mockUser = {\n        id: 'user-profile-test',\n        email: 'profile@example.com',\n        user_metadata: {\n          full_name: 'Profile User',\n        },\n      };\n\n      const mockProfile = {\n        id: 'user-profile-test',\n        email: 'profile@example.com',\n        full_name: 'Profile User',\n        organization_id: 'org-123',\n        role: 'admin',\n        permissions: {\n          can_manage_users: true,\n          can_view_analytics: true,\n        },\n        last_seen: new Date().toISOString(),\n      };\n\n      const mockSupabaseClient = {\n        auth: {\n          signInWithPassword: jest.fn().mockResolvedValue({\n            data: { user: mockUser },\n            error: null,\n          }),\n        },\n        from: jest.fn(() => ({\n          select: jest.fn().mockReturnThis(),\n          eq: jest.fn().mockReturnThis(),\n          single: jest.fn().mockResolvedValue({\n            data: mockProfile,\n            error: null,\n          }),\n        })),\n      };\n\n      mockCreateClient.mockResolvedValue(mockSupabaseClient as any);\n\n      // Act\n      const { data: authData, error: authError } = await mockSupabaseClient.auth.signInWithPassword({\n        email: 'profile@example.com',\n        password: 'Password123!',\n      });\n\n      const { data: profileData } = await mockSupabaseClient\n        .from('profiles')\n        .select('*')\n        .eq('id', authData.user.id)\n        .single();\n\n      // Assert\n      expect(authError).toBeNull();\n      expect(profileData).toBeDefined();\n      expect(profileData.id).toBe('user-profile-test');\n      expect(profileData.role).toBe('admin');\n      expect(profileData.organization_id).toBe('org-123');\n      expect(profileData.permissions.can_manage_users).toBe(true);\n    });\n\n    it('should create session with proper expiration time', async () => {\n      // Arrange\n      const now = Date.now();\n      const expiresAt = now + 3600000; // 1 hour\n\n      const mockSession = {\n        user: { id: 'user-session', email: 'session@example.com' },\n        access_token: 'token-123',\n        refresh_token: 'refresh-456',\n        expires_at: expiresAt,\n      };\n\n      const mockSupabaseClient = {\n        auth: {\n          signInWithPassword: jest.fn().mockResolvedValue({\n            data: { session: mockSession },\n            error: null,\n          }),\n        },\n      };\n\n      mockCreateClient.mockResolvedValue(mockSupabaseClient as any);\n\n      // Act\n      const { data } = await mockSupabaseClient.auth.signInWithPassword({\n        email: 'session@example.com',\n        password: 'Password123!',\n      });\n\n      // Assert\n      expect(data.session).toBeDefined();\n      expect(data.session.expires_at).toBeGreaterThan(now);\n      expect(data.session.expires_at).toBeLessThanOrEqual(expiresAt + 1000);\n      expect(data.session.access_token).toBeDefined();\n      expect(data.session.refresh_token).toBeDefined();\n    });\n  });\n\n  describe('Test 7: User Login with Invalid Credentials', () => {\n    it('should reject authentication with incorrect password', async () => {\n      // Arrange\n      const mockSupabaseClient = {\n        auth: {\n          signInWithPassword: jest.fn().mockResolvedValue({\n            data: { session: null, user: null },\n            error: {\n              message: 'Invalid login credentials',\n              status: 400,\n              name: 'AuthApiError',\n            },\n          }),\n        },\n      };\n\n      mockCreateClient.mockResolvedValue(mockSupabaseClient as any);\n\n      // Act\n      const { data, error } = await mockSupabaseClient.auth.signInWithPassword({\n        email: 'valid@example.com',\n        password: 'WrongPassword123!',\n      });\n\n      // Assert\n      expect(error).toBeDefined();\n      expect(error.message).toBe('Invalid login credentials');\n      expect(error.status).toBe(400);\n      expect(data.session).toBeNull();\n      expect(data.user).toBeNull();\n    });\n\n    it('should reject authentication with non-existent email', async () => {\n      // Arrange\n      const mockSupabaseClient = {\n        auth: {\n          signInWithPassword: jest.fn().mockResolvedValue({\n            data: { session: null, user: null },\n            error: {\n              message: 'Invalid login credentials',\n              status: 400,\n              name: 'AuthApiError',\n            },\n          }),\n        },\n      };\n\n      mockCreateClient.mockResolvedValue(mockSupabaseClient as any);\n\n      // Act\n      const { data, error } = await mockSupabaseClient.auth.signInWithPassword({\n        email: 'nonexistent@example.com',\n        password: 'AnyPassword123!',\n      });\n\n      // Assert\n      expect(error).toBeDefined();\n      expect(error.message).toBe('Invalid login credentials');\n      expect(data.session).toBeNull();\n      expect(data.user).toBeNull();\n    });\n\n    it('should reject authentication with malformed email', async () => {\n      // Arrange\n      const mockSupabaseClient = {\n        auth: {\n          signInWithPassword: jest.fn().mockResolvedValue({\n            data: { session: null, user: null },\n            error: {\n              message: 'Invalid email format',\n              status: 422,\n              name: 'ValidationError',\n            },\n          }),\n        },\n      };\n\n      mockCreateClient.mockResolvedValue(mockSupabaseClient as any);\n\n      // Act\n      const { data, error } = await mockSupabaseClient.auth.signInWithPassword({\n        email: 'not-an-email',\n        password: 'Password123!',\n      });\n\n      // Assert\n      expect(error).toBeDefined();\n      expect(error.message).toContain('email');\n      expect(data.session).toBeNull();\n    });\n\n    it('should reject authentication with empty credentials', async () => {\n      // Arrange\n      const mockSupabaseClient = {\n        auth: {\n          signInWithPassword: jest.fn().mockResolvedValue({\n            data: { session: null, user: null },\n            error: {\n              message: 'Email and password are required',\n              status: 422,\n              name: 'ValidationError',\n            },\n          }),\n        },\n      };\n\n      mockCreateClient.mockResolvedValue(mockSupabaseClient as any);\n\n      // Act\n      const { data, error } = await mockSupabaseClient.auth.signInWithPassword({\n        email: '',\n        password: '',\n      });\n\n      // Assert\n      expect(error).toBeDefined();\n      expect(error.message).toContain('required');\n      expect(data.session).toBeNull();\n    });\n\n    it('should handle rate limiting for too many failed attempts', async () => {\n      // Arrange\n      const mockSupabaseClient = {\n        auth: {\n          signInWithPassword: jest.fn().mockResolvedValue({\n            data: { session: null, user: null },\n            error: {\n              message: 'Too many requests. Please try again later.',\n              status: 429,\n              name: 'RateLimitError',\n            },\n          }),\n        },\n      };\n\n      mockCreateClient.mockResolvedValue(mockSupabaseClient as any);\n\n      // Act\n      const { data, error } = await mockSupabaseClient.auth.signInWithPassword({\n        email: 'user@example.com',\n        password: 'WrongPassword',\n      });\n\n      // Assert\n      expect(error).toBeDefined();\n      expect(error.status).toBe(429);\n      expect(error.message).toContain('Too many requests');\n      expect(data.session).toBeNull();\n    });\n  });\n\n  describe('Test 8: MFA Token Verification', () => {\n    it('should successfully verify valid TOTP token', async () => {\n      // Arrange\n      const userId = 'user-mfa-enabled';\n      const validToken = '123456';\n\n      const mockProfile = {\n        id: userId,\n        mfa_enabled: true,\n        mfa_secret: 'JBSWY3DPEHPK3PXP',\n        mfa_backup_codes: [],\n      };\n\n      const mockSupabaseClient = {\n        from: jest.fn(() => ({\n          select: jest.fn().mockReturnThis(),\n          eq: jest.fn().mockReturnThis(),\n          single: jest.fn().mockResolvedValue({\n            data: mockProfile,\n            error: null,\n          }),\n        })),\n      };\n\n      mockCreateClient.mockResolvedValue(mockSupabaseClient as any);\n\n      // Mock authenticator.verify to return true\n      const { authenticator } = await import('otplib');\n      (authenticator.verify as jest.Mock).mockReturnValue(true);\n\n      // Act\n      const result = await verifyMFAToken(userId, validToken);\n\n      // Assert\n      expect(result.valid).toBe(true);\n      expect(result.error).toBeUndefined();\n      expect(authenticator.verify).toHaveBeenCalledWith({\n        token: validToken,\n        secret: mockProfile.mfa_secret,\n      });\n    });\n\n    it('should reject invalid TOTP token', async () => {\n      // Arrange\n      const userId = 'user-mfa-invalid';\n      const invalidToken = '000000';\n\n      const mockProfile = {\n        id: userId,\n        mfa_enabled: true,\n        mfa_secret: 'JBSWY3DPEHPK3PXP',\n        mfa_backup_codes: [],\n      };\n\n      const mockSupabaseClient = {\n        from: jest.fn(() => ({\n          select: jest.fn().mockReturnThis(),\n          eq: jest.fn().mockReturnThis(),\n          single: jest.fn().mockResolvedValue({\n            data: mockProfile,\n            error: null,\n          }),\n        })),\n      };\n\n      mockCreateClient.mockResolvedValue(mockSupabaseClient as any);\n\n      // Mock authenticator.verify to return false\n      const { authenticator } = await import('otplib');\n      (authenticator.verify as jest.Mock).mockReturnValue(false);\n\n      // Act\n      const result = await verifyMFAToken(userId, invalidToken);\n\n      // Assert\n      expect(result.valid).toBe(false);\n      expect(result.error).toBe('Invalid verification code');\n    });\n\n    it('should reject MFA verification when MFA is not enabled', async () => {\n      // Arrange\n      const userId = 'user-mfa-not-enabled';\n      const token = '123456';\n\n      const mockProfile = {\n        id: userId,\n        mfa_enabled: false,\n        mfa_secret: null,\n        mfa_backup_codes: [],\n      };\n\n      const mockSupabaseClient = {\n        from: jest.fn(() => ({\n          select: jest.fn().mockReturnThis(),\n          eq: jest.fn().mockReturnThis(),\n          single: jest.fn().mockResolvedValue({\n            data: mockProfile,\n            error: null,\n          }),\n        })),\n      };\n\n      mockCreateClient.mockResolvedValue(mockSupabaseClient as any);\n\n      // Act\n      const result = await verifyMFAToken(userId, token);\n\n      // Assert\n      expect(result.valid).toBe(false);\n      expect(result.error).toBe('MFA not enabled');\n    });\n\n    it('should validate TOTP token format (6 digits)', () => {\n      // Arrange & Act & Assert\n      expect(isValidMFATokenFormat('123456')).toBe(true);\n      expect(isValidMFATokenFormat('000000')).toBe(true);\n      expect(isValidMFATokenFormat('999999')).toBe(true);\n      expect(isValidMFATokenFormat('12345')).toBe(false); // Too short\n      expect(isValidMFATokenFormat('1234567')).toBe(false); // Too long\n      expect(isValidMFATokenFormat('12345a')).toBe(false); // Contains letter\n      expect(isValidMFATokenFormat('')).toBe(false); // Empty\n    });\n\n    it('should validate backup code format (XXXX-XXXX)', () => {\n      // Arrange & Act & Assert\n      expect(isValidMFATokenFormat('ABCD-1234')).toBe(true);\n      expect(isValidMFATokenFormat('AB23-XY89')).toBe(true);\n      expect(isValidMFATokenFormat('abcd-1234')).toBe(false); // Lowercase not allowed\n      expect(isValidMFATokenFormat('ABCD1234')).toBe(false); // Missing hyphen\n      expect(isValidMFATokenFormat('ABC-1234')).toBe(false); // Too short\n      expect(isValidMFATokenFormat('ABCDE-1234')).toBe(false); // Too long\n    });\n\n    it('should get correct MFA status for user', async () => {\n      // Arrange\n      const userId = 'user-mfa-status';\n\n      const mockProfile = {\n        id: userId,\n        mfa_enabled: true,\n        mfa_enrolled_at: '2024-01-15T10:30:00Z',\n        mfa_backup_codes: ['code1', 'code2', 'code3', 'code4', 'code5'],\n      };\n\n      const mockSupabaseClient = {\n        from: jest.fn(() => ({\n          select: jest.fn().mockReturnThis(),\n          eq: jest.fn().mockReturnThis(),\n          single: jest.fn().mockResolvedValue({\n            data: mockProfile,\n            error: null,\n          }),\n        })),\n      };\n\n      mockCreateClient.mockResolvedValue(mockSupabaseClient as any);\n\n      // Act\n      const status = await getMFAStatus(userId);\n\n      // Assert\n      expect(status.enabled).toBe(true);\n      expect(status.enrolledAt).toBe('2024-01-15T10:30:00Z');\n      expect(status.backupCodesRemaining).toBe(5);\n    });\n\n    it('should return default status when user not found', async () => {\n      // Arrange\n      const userId = 'non-existent-user';\n\n      const mockSupabaseClient = {\n        from: jest.fn(() => ({\n          select: jest.fn().mockReturnThis(),\n          eq: jest.fn().mockReturnThis(),\n          single: jest.fn().mockResolvedValue({\n            data: null,\n            error: { message: 'User not found' },\n          }),\n        })),\n      };\n\n      mockCreateClient.mockResolvedValue(mockSupabaseClient as any);\n\n      // Act\n      const status = await getMFAStatus(userId);\n\n      // Assert\n      expect(status.enabled).toBe(false);\n      expect(status.enrolledAt).toBeNull();\n      expect(status.backupCodesRemaining).toBe(0);\n    });\n  });\n});\n"],"names":["jest","mock","authenticator","verify","fn","options","describe","mockCreateClient","createClient","beforeEach","clearAllMocks","it","mockUser","id","email","user_metadata","full_name","mockSession","user","access_token","refresh_token","expires_at","Date","now","mockSupabaseClient","auth","signInWithPassword","mockResolvedValue","data","session","error","getSession","password","expect","toBeNull","toBeDefined","toBe","toHaveBeenCalledWith","mockProfile","organization_id","role","permissions","can_manage_users","can_view_analytics","last_seen","toISOString","from","select","mockReturnThis","eq","single","authData","authError","profileData","expiresAt","toBeGreaterThan","toBeLessThanOrEqual","message","status","name","toContain","userId","validToken","mfa_enabled","mfa_secret","mfa_backup_codes","mockReturnValue","result","verifyMFAToken","valid","toBeUndefined","token","secret","invalidToken","isValidMFATokenFormat","mfa_enrolled_at","getMFAStatus","enabled","enrolledAt","backupCodesRemaining"],"mappings":"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"}