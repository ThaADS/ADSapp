{"version":3,"names":["DELETE","cov_1hs6db0mq1","f","s","GET","POST","request","supabase","_server1","createClient","data","user","error","authError","auth","getUser","b","_server","NextResponse","json","code","status","body","catch","reason","validReasons","includes","sessionManager","_manager","getSessionManager","count","revokeAllUserSessions","id","response","success","message","_session","clearSessionCookie","console","process","env","NODE_ENV","Sentry","Promise","resolve","then","_interop_require_wildcard","require","captureException","tags","endpoint","sentryError"],"sources":["C:\\Ai Projecten\\ADSapp\\src\\app\\api\\auth\\session\\revoke-all\\route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport { getSessionManager } from '@/lib/session/manager';\nimport { clearSessionCookie } from '@/lib/middleware/session';\nimport { createClient } from '@/lib/supabase/server';\n\n/**\n * Revoke All Sessions API Route\n *\n * DELETE /api/auth/session/revoke-all\n *\n * Revokes all sessions for the authenticated user.\n * Used for:\n * - Password changes\n * - Account security events\n * - Manual user action to logout from all devices\n * - Account compromise response\n *\n * Request Body:\n * ```json\n * {\n *   \"reason\": \"password_changed\" | \"security_event\" | \"user_action\" | \"account_compromise\"\n * }\n * ```\n *\n * Security:\n * - Requires user authentication\n * - Revokes all sessions including current\n * - Audit logs with reason\n * - Forces re-authentication\n *\n * @returns Revocation result with count\n */\nexport async function DELETE(request: NextRequest) {\n  try {\n    // Get user ID from Supabase auth\n    const supabase = await createClient();\n    const { data: { user }, error: authError } = await supabase.auth.getUser();\n\n    if (authError || !user) {\n      return NextResponse.json(\n        {\n          error: 'User not authenticated',\n          code: 'UNAUTHORIZED'\n        },\n        { status: 401 }\n      );\n    }\n\n    // Parse request body\n    const body = await request.json().catch(() => ({}));\n    const reason = body.reason || 'user_action';\n\n    // Validate reason\n    const validReasons = [\n      'password_changed',\n      'security_event',\n      'user_action',\n      'account_compromise'\n    ];\n\n    if (!validReasons.includes(reason)) {\n      return NextResponse.json(\n        {\n          error: 'Invalid reason provided',\n          code: 'INVALID_REASON',\n          validReasons\n        },\n        { status: 400 }\n      );\n    }\n\n    // Revoke all sessions\n    const sessionManager = getSessionManager();\n    const count = await sessionManager.revokeAllUserSessions(user.id, reason);\n\n    // Create response\n    const response = NextResponse.json(\n      {\n        success: true,\n        message: `Revoked ${count} session(s)`,\n        count,\n        reason\n      },\n      { status: 200 }\n    );\n\n    // Clear session cookie\n    clearSessionCookie(response);\n\n    return response;\n  } catch (error) {\n    console.error('[SessionRevokeAll] Error:', error);\n\n    // Log error to monitoring\n    if (process.env.NODE_ENV === 'production') {\n      try {\n        const Sentry = await import('@sentry/nextjs');\n        Sentry.captureException(error, {\n          tags: {\n            endpoint: 'session-revoke-all'\n          }\n        });\n      } catch (sentryError) {\n        console.error('[SessionRevokeAll] Failed to log error:', sentryError);\n      }\n    }\n\n    return NextResponse.json(\n      {\n        error: 'Internal server error',\n        code: 'INTERNAL_ERROR'\n      },\n      { status: 500 }\n    );\n  }\n}\n\n/**\n * POST method (alternative to DELETE for client compatibility)\n */\nexport async function POST(request: NextRequest) {\n  return DELETE(request);\n}\n\n/**\n * GET method not allowed\n */\nexport async function GET() {\n  return NextResponse.json(\n    {\n      error: 'Method not allowed',\n      code: 'METHOD_NOT_ALLOWED'\n    },\n    { status: 405 }\n  );\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}