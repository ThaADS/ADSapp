{"version":3,"sources":["C:\\Ai Projecten\\ADSapp\\tests\\unit\\kms-client.test.ts"],"sourcesContent":["/**\n * KMS Client Unit Tests\n *\n * Tests for AWS KMS integration and encryption key management\n */\n\nimport { KMSClient, getKMSClient, resetKMSClient } from '@/lib/security/kms-client';\nimport { KeyManagementError } from '@/lib/crypto/types';\n\n// Mock AWS SDK\njest.mock('@aws-sdk/client-kms', () => ({\n  KMSClient: jest.fn().mockImplementation(() => ({\n    send: jest.fn(),\n    destroy: jest.fn(),\n  })),\n  GenerateDataKeyCommand: jest.fn(),\n  DecryptCommand: jest.fn(),\n  EncryptCommand: jest.fn(),\n  DescribeKeyCommand: jest.fn(),\n  KMSServiceException: class KMSServiceException extends Error {\n    constructor(message: string) {\n      super(message);\n      this.name = 'KMSServiceException';\n    }\n  },\n}));\n\njest.mock('@aws-sdk/credential-providers', () => ({\n  fromEnv: jest.fn(() => ({\n    accessKeyId: 'test-access-key',\n    secretAccessKey: 'test-secret-key',\n  })),\n}));\n\ndescribe('KMSClient', () => {\n  let kmsClient: KMSClient;\n\n  beforeEach(() => {\n    // Set environment variables\n    process.env.AWS_REGION = 'us-east-1';\n    process.env.AWS_KMS_KEY_ID = '12345678-1234-1234-1234-123456789012';\n    process.env.AWS_ACCESS_KEY_ID = 'test-access-key';\n    process.env.AWS_SECRET_ACCESS_KEY = 'test-secret-key';\n\n    resetKMSClient();\n  });\n\n  afterEach(() => {\n    jest.clearAllMocks();\n    resetKMSClient();\n  });\n\n  describe('Configuration', () => {\n    it('should load configuration from environment variables', () => {\n      expect(() => new KMSClient()).not.toThrow();\n    });\n\n    it('should accept custom configuration', () => {\n      const config = {\n        region: 'us-west-2',\n        keyId: 'custom-key-id',\n        maxRetries: 5,\n      };\n\n      expect(() => new KMSClient(config)).not.toThrow();\n    });\n\n    it('should throw error if AWS_KMS_KEY_ID is missing', () => {\n      delete process.env.AWS_KMS_KEY_ID;\n\n      expect(() => new KMSClient()).toThrow(KeyManagementError);\n      expect(() => new KMSClient()).toThrow('AWS_KMS_KEY_ID is required');\n    });\n\n    it('should validate key ID format', () => {\n      process.env.AWS_KMS_KEY_ID = 'invalid-key-format';\n\n      expect(() => new KMSClient()).toThrow(KeyManagementError);\n      expect(() => new KMSClient()).toThrow('Invalid KMS Key ID format');\n    });\n\n    it('should accept ARN format key ID', () => {\n      process.env.AWS_KMS_KEY_ID =\n        'arn:aws:kms:us-east-1:123456789012:key/12345678-1234-1234-1234-123456789012';\n\n      expect(() => new KMSClient()).not.toThrow();\n    });\n\n    it('should accept alias format key ID', () => {\n      process.env.AWS_KMS_KEY_ID = 'alias/my-key';\n\n      expect(() => new KMSClient()).not.toThrow();\n    });\n  });\n\n  describe('generateDataKey', () => {\n    it('should generate a data key for a tenant', async () => {\n      const mockSend = jest.fn().mockResolvedValue({\n        CiphertextBlob: Buffer.from('encrypted-key'),\n        Plaintext: Buffer.from('a'.repeat(32)), // 32 bytes for AES-256\n        KeyId: process.env.AWS_KMS_KEY_ID,\n      });\n\n      const { KMSClient: MockKMSClient } = require('@aws-sdk/client-kms');\n      MockKMSClient.mockImplementation(() => ({\n        send: mockSend,\n        destroy: jest.fn(),\n      }));\n\n      kmsClient = new KMSClient();\n      const result = await kmsClient.generateDataKey('tenant-123');\n\n      expect(result).toHaveProperty('ciphertext');\n      expect(result).toHaveProperty('plaintext');\n      expect(result).toHaveProperty('keyId');\n      expect(result.plaintext).toBeInstanceOf(Buffer);\n      expect(result.plaintext.length).toBe(32);\n      expect(mockSend).toHaveBeenCalledTimes(1);\n    });\n\n    it('should include encryption context with tenant ID', async () => {\n      const mockSend = jest.fn().mockResolvedValue({\n        CiphertextBlob: Buffer.from('encrypted-key'),\n        Plaintext: Buffer.from('a'.repeat(32)),\n        KeyId: process.env.AWS_KMS_KEY_ID,\n      });\n\n      const { KMSClient: MockKMSClient } = require('@aws-sdk/client-kms');\n      MockKMSClient.mockImplementation(() => ({\n        send: mockSend,\n        destroy: jest.fn(),\n      }));\n\n      kmsClient = new KMSClient();\n      await kmsClient.generateDataKey('tenant-123');\n\n      const callArgs = mockSend.mock.calls[0][0];\n      expect(callArgs.input.EncryptionContext).toHaveProperty('TenantId', 'tenant-123');\n    });\n\n    it('should cache the generated key', async () => {\n      const mockSend = jest.fn().mockResolvedValue({\n        CiphertextBlob: Buffer.from('encrypted-key'),\n        Plaintext: Buffer.from('a'.repeat(32)),\n        KeyId: process.env.AWS_KMS_KEY_ID,\n      });\n\n      const { KMSClient: MockKMSClient } = require('@aws-sdk/client-kms');\n      MockKMSClient.mockImplementation(() => ({\n        send: mockSend,\n        destroy: jest.fn(),\n      }));\n\n      kmsClient = new KMSClient();\n      await kmsClient.generateDataKey('tenant-123');\n\n      // Call decryptDataKey to verify cache\n      await kmsClient.decryptDataKey('encrypted-key', 'tenant-123');\n\n      // Should only call generateDataKey once, decrypt should use cache\n      expect(mockSend).toHaveBeenCalledTimes(1);\n    });\n\n    it('should handle KMS errors gracefully', async () => {\n      const mockSend = jest.fn().mockRejectedValue(\n        new Error('KMS service unavailable')\n      );\n\n      const { KMSClient: MockKMSClient } = require('@aws-sdk/client-kms');\n      MockKMSClient.mockImplementation(() => ({\n        send: mockSend,\n        destroy: jest.fn(),\n      }));\n\n      kmsClient = new KMSClient();\n\n      await expect(kmsClient.generateDataKey('tenant-123')).rejects.toThrow(\n        KeyManagementError\n      );\n    });\n  });\n\n  describe('decryptDataKey', () => {\n    it('should decrypt a data key', async () => {\n      const mockSend = jest.fn().mockResolvedValue({\n        Plaintext: Buffer.from('b'.repeat(32)),\n        KeyId: process.env.AWS_KMS_KEY_ID,\n      });\n\n      const { KMSClient: MockKMSClient } = require('@aws-sdk/client-kms');\n      MockKMSClient.mockImplementation(() => ({\n        send: mockSend,\n        destroy: jest.fn(),\n      }));\n\n      kmsClient = new KMSClient();\n      const result = await kmsClient.decryptDataKey(\n        Buffer.from('encrypted-key').toString('base64'),\n        'tenant-123'\n      );\n\n      expect(result).toHaveProperty('plaintext');\n      expect(result).toHaveProperty('keyId');\n      expect(result.plaintext).toBeInstanceOf(Buffer);\n      expect(result.plaintext.length).toBe(32);\n      expect(mockSend).toHaveBeenCalledTimes(1);\n    });\n\n    it('should return cached key if available', async () => {\n      const mockSend = jest.fn().mockResolvedValue({\n        Plaintext: Buffer.from('c'.repeat(32)),\n        KeyId: process.env.AWS_KMS_KEY_ID,\n      });\n\n      const { KMSClient: MockKMSClient } = require('@aws-sdk/client-kms');\n      MockKMSClient.mockImplementation(() => ({\n        send: mockSend,\n        destroy: jest.fn(),\n      }));\n\n      kmsClient = new KMSClient();\n\n      // First call - should hit KMS\n      await kmsClient.decryptDataKey('encrypted-key', 'tenant-123');\n\n      // Second call - should use cache\n      await kmsClient.decryptDataKey('encrypted-key', 'tenant-123');\n\n      expect(mockSend).toHaveBeenCalledTimes(1); // Only one KMS call\n    });\n\n    it('should include encryption context for tenant validation', async () => {\n      const mockSend = jest.fn().mockResolvedValue({\n        Plaintext: Buffer.from('d'.repeat(32)),\n        KeyId: process.env.AWS_KMS_KEY_ID,\n      });\n\n      const { KMSClient: MockKMSClient } = require('@aws-sdk/client-kms');\n      MockKMSClient.mockImplementation(() => ({\n        send: mockSend,\n        destroy: jest.fn(),\n      }));\n\n      kmsClient = new KMSClient();\n      await kmsClient.decryptDataKey('encrypted-key', 'tenant-456');\n\n      const callArgs = mockSend.mock.calls[0][0];\n      expect(callArgs.input.EncryptionContext).toHaveProperty('TenantId', 'tenant-456');\n    });\n  });\n\n  describe('Cache Management', () => {\n    it('should clear cache for specific tenant', async () => {\n      const mockSend = jest.fn().mockResolvedValue({\n        Plaintext: Buffer.from('e'.repeat(32)),\n        KeyId: process.env.AWS_KMS_KEY_ID,\n      });\n\n      const { KMSClient: MockKMSClient } = require('@aws-sdk/client-kms');\n      MockKMSClient.mockImplementation(() => ({\n        send: mockSend,\n        destroy: jest.fn(),\n      }));\n\n      kmsClient = new KMSClient();\n\n      // Cache a key\n      await kmsClient.decryptDataKey('encrypted-key', 'tenant-123');\n\n      // Clear cache\n      kmsClient.clearCache('tenant-123');\n\n      // Should call KMS again\n      await kmsClient.decryptDataKey('encrypted-key', 'tenant-123');\n\n      expect(mockSend).toHaveBeenCalledTimes(2);\n    });\n\n    it('should clear all caches when no tenant specified', async () => {\n      const mockSend = jest.fn().mockResolvedValue({\n        Plaintext: Buffer.from('f'.repeat(32)),\n        KeyId: process.env.AWS_KMS_KEY_ID,\n      });\n\n      const { KMSClient: MockKMSClient } = require('@aws-sdk/client-kms');\n      MockKMSClient.mockImplementation(() => ({\n        send: mockSend,\n        destroy: jest.fn(),\n      }));\n\n      kmsClient = new KMSClient();\n\n      // Cache keys for multiple tenants\n      await kmsClient.decryptDataKey('encrypted-key-1', 'tenant-1');\n      await kmsClient.decryptDataKey('encrypted-key-2', 'tenant-2');\n\n      // Clear all caches\n      kmsClient.clearCache();\n\n      // Should call KMS again for both\n      await kmsClient.decryptDataKey('encrypted-key-1', 'tenant-1');\n      await kmsClient.decryptDataKey('encrypted-key-2', 'tenant-2');\n\n      expect(mockSend).toHaveBeenCalledTimes(4); // 2 initial + 2 after clear\n    });\n  });\n\n  describe('Statistics', () => {\n    it('should track operation statistics', async () => {\n      const mockSend = jest.fn().mockResolvedValue({\n        Plaintext: Buffer.from('g'.repeat(32)),\n        KeyId: process.env.AWS_KMS_KEY_ID,\n      });\n\n      const { KMSClient: MockKMSClient } = require('@aws-sdk/client-kms');\n      MockKMSClient.mockImplementation(() => ({\n        send: mockSend,\n        destroy: jest.fn(),\n      }));\n\n      kmsClient = new KMSClient();\n\n      await kmsClient.decryptDataKey('encrypted-key', 'tenant-123');\n\n      const stats = kmsClient.getStats();\n\n      expect(stats.totalOperations).toBe(1);\n      expect(stats.successful).toBe(1);\n      expect(stats.failed).toBe(0);\n    });\n\n    it('should reset statistics', async () => {\n      const mockSend = jest.fn().mockResolvedValue({\n        Plaintext: Buffer.from('h'.repeat(32)),\n        KeyId: process.env.AWS_KMS_KEY_ID,\n      });\n\n      const { KMSClient: MockKMSClient } = require('@aws-sdk/client-kms');\n      MockKMSClient.mockImplementation(() => ({\n        send: mockSend,\n        destroy: jest.fn(),\n      }));\n\n      kmsClient = new KMSClient();\n\n      await kmsClient.decryptDataKey('encrypted-key', 'tenant-123');\n\n      kmsClient.resetStats();\n\n      const stats = kmsClient.getStats();\n\n      expect(stats.totalOperations).toBe(0);\n      expect(stats.successful).toBe(0);\n    });\n  });\n\n  describe('Connection Test', () => {\n    it('should test KMS connectivity successfully', async () => {\n      const mockSend = jest.fn().mockResolvedValue({\n        KeyMetadata: {\n          KeyId: process.env.AWS_KMS_KEY_ID,\n          Arn: `arn:aws:kms:us-east-1:123456789012:key/${process.env.AWS_KMS_KEY_ID}`,\n          KeyState: 'Enabled',\n          CreationDate: new Date(),\n        },\n      });\n\n      const { KMSClient: MockKMSClient } = require('@aws-sdk/client-kms');\n      MockKMSClient.mockImplementation(() => ({\n        send: mockSend,\n        destroy: jest.fn(),\n      }));\n\n      kmsClient = new KMSClient();\n      const result = await kmsClient.testConnection();\n\n      expect(result).toBe(true);\n    });\n\n    it('should return false on connection failure', async () => {\n      const mockSend = jest.fn().mockRejectedValue(new Error('Connection failed'));\n\n      const { KMSClient: MockKMSClient } = require('@aws-sdk/client-kms');\n      MockKMSClient.mockImplementation(() => ({\n        send: mockSend,\n        destroy: jest.fn(),\n      }));\n\n      kmsClient = new KMSClient();\n      const result = await kmsClient.testConnection();\n\n      expect(result).toBe(false);\n    });\n  });\n\n  describe('Singleton', () => {\n    it('should return same instance for getKMSClient', () => {\n      const instance1 = getKMSClient();\n      const instance2 = getKMSClient();\n\n      expect(instance1).toBe(instance2);\n    });\n\n    it('should create new instance after reset', () => {\n      const instance1 = getKMSClient();\n\n      resetKMSClient();\n\n      const instance2 = getKMSClient();\n\n      expect(instance1).not.toBe(instance2);\n    });\n  });\n});\n"],"names":["jest","mock","KMSClient","fn","mockImplementation","send","destroy","GenerateDataKeyCommand","DecryptCommand","EncryptCommand","DescribeKeyCommand","KMSServiceException","Error","message","name","fromEnv","accessKeyId","secretAccessKey","describe","kmsClient","beforeEach","process","env","AWS_REGION","AWS_KMS_KEY_ID","AWS_ACCESS_KEY_ID","AWS_SECRET_ACCESS_KEY","resetKMSClient","afterEach","clearAllMocks","it","expect","not","toThrow","config","region","keyId","maxRetries","KeyManagementError","mockSend","mockResolvedValue","CiphertextBlob","Buffer","from","Plaintext","repeat","KeyId","MockKMSClient","require","result","generateDataKey","toHaveProperty","plaintext","toBeInstanceOf","length","toBe","toHaveBeenCalledTimes","callArgs","calls","input","EncryptionContext","decryptDataKey","mockRejectedValue","rejects","toString","clearCache","stats","getStats","totalOperations","successful","failed","resetStats","KeyMetadata","Arn","KeyState","CreationDate","Date","testConnection","instance1","getKMSClient","instance2"],"mappings":"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"}