{"version":3,"sources":["C:\\Ai Projecten\\ADSapp\\tests\\integration\\api\\auth.test.ts"],"sourcesContent":["/**\n * Authentication API Integration Tests\n *\n * Tests for /api/auth/* endpoints including signin, signup,\n * password reset, and multi-factor authentication.\n */\n\nimport { describe, it, expect, beforeEach, jest } from '@jest/globals'\nimport { NextRequest } from 'next/server'\nimport {\n  createMockRequest,\n  createAuthenticatedRequest,\n  parseResponse,\n  expectErrorResponse,\n  expectSuccessResponse,\n} from '../../utils/api-test-helpers'\nimport {\n  createMockUser,\n  createMockOrganization,\n  createMockSupabaseClient,\n} from '../../utils/test-helpers'\n\n// Mock Next.js and Supabase\njest.mock('@/lib/supabase/server')\njest.mock('next/server')\n\ndescribe('POST /api/auth/signin', () => {\n  let mockSupabase: any\n\n  beforeEach(() => {\n    mockSupabase = createMockSupabaseClient()\n    jest.clearAllMocks()\n  })\n\n  it('should authenticate valid user and return session', async () => {\n    const mockUser = createMockUser()\n    const mockOrg = createMockOrganization({ id: mockUser.organization_id })\n\n    mockSupabase.auth.signInWithPassword = jest.fn().mockResolvedValue({\n      data: {\n        user: { id: mockUser.id, email: mockUser.email },\n        session: { access_token: 'mock-token', refresh_token: 'mock-refresh' },\n      },\n      error: null,\n    })\n\n    mockSupabase.from = jest.fn().mockReturnValue({\n      select: jest.fn().mockReturnThis(),\n      eq: jest.fn().mockReturnThis(),\n      single: jest.fn().mockResolvedValue({\n        data: { ...mockUser, organization: mockOrg },\n        error: null,\n      }),\n    })\n\n    const request = createMockRequest('POST', '/api/auth/signin', {\n      email: mockUser.email,\n      password: 'validpassword123',\n    })\n\n    // Simulate API route handler\n    const response = await simulateSignIn(request, mockSupabase)\n    const { status, data } = await parseResponse(response)\n\n    expect(status).toBe(200)\n    expect(data).toHaveProperty('user')\n    expect(data).toHaveProperty('session')\n    expect(data.user.email).toBe(mockUser.email)\n    expect(data.session.access_token).toBe('mock-token')\n  })\n\n  it('should reject invalid credentials', async () => {\n    mockSupabase.auth.signInWithPassword = jest.fn().mockResolvedValue({\n      data: { user: null, session: null },\n      error: { message: 'Invalid login credentials' },\n    })\n\n    const request = createMockRequest('POST', '/api/auth/signin', {\n      email: 'wrong@example.com',\n      password: 'wrongpassword',\n    })\n\n    const response = await simulateSignIn(request, mockSupabase)\n    const { status, data } = await parseResponse(response)\n\n    expect(status).toBe(401)\n    expectErrorResponse(data, 401, 'Invalid login credentials')\n  })\n\n  it('should validate email format', async () => {\n    const request = createMockRequest('POST', '/api/auth/signin', {\n      email: 'invalid-email',\n      password: 'password123',\n    })\n\n    const response = await simulateSignIn(request, mockSupabase)\n    const { status, data } = await parseResponse(response)\n\n    expect(status).toBe(400)\n    expectErrorResponse(data, 400, 'Invalid email format')\n  })\n\n  it('should require password field', async () => {\n    const request = createMockRequest('POST', '/api/auth/signin', {\n      email: 'test@example.com',\n    })\n\n    const response = await simulateSignIn(request, mockSupabase)\n    const { status, data } = await parseResponse(response)\n\n    expect(status).toBe(400)\n    expectErrorResponse(data, 400, 'Password is required')\n  })\n})\n\ndescribe('POST /api/auth/signup', () => {\n  let mockSupabase: any\n\n  beforeEach(() => {\n    mockSupabase = createMockSupabaseClient()\n    jest.clearAllMocks()\n  })\n\n  it('should create new user with organization', async () => {\n    const newUser = {\n      email: 'newuser@example.com',\n      password: 'SecurePass123!',\n      full_name: 'New User',\n      organization_name: 'New Organization',\n    }\n\n    mockSupabase.auth.signUp = jest.fn().mockResolvedValue({\n      data: {\n        user: { id: 'new-user-id', email: newUser.email },\n        session: { access_token: 'new-token' },\n      },\n      error: null,\n    })\n\n    mockSupabase.from = jest.fn().mockReturnValue({\n      insert: jest.fn().mockReturnThis(),\n      select: jest.fn().mockReturnThis(),\n      single: jest.fn().mockResolvedValue({\n        data: { id: 'new-org-id', name: newUser.organization_name },\n        error: null,\n      }),\n    })\n\n    const request = createMockRequest('POST', '/api/auth/signup', newUser)\n\n    const response = await simulateSignUp(request, mockSupabase)\n    const { status, data } = await parseResponse(response)\n\n    expect(status).toBe(201)\n    expect(data).toHaveProperty('user')\n    expect(data).toHaveProperty('organization')\n    expect(data.user.email).toBe(newUser.email)\n    expect(data.organization.name).toBe(newUser.organization_name)\n  })\n\n  it('should reject duplicate email', async () => {\n    mockSupabase.auth.signUp = jest.fn().mockResolvedValue({\n      data: { user: null, session: null },\n      error: { message: 'User already registered' },\n    })\n\n    const request = createMockRequest('POST', '/api/auth/signup', {\n      email: 'existing@example.com',\n      password: 'password123',\n      full_name: 'Duplicate User',\n      organization_name: 'Test Org',\n    })\n\n    const response = await simulateSignUp(request, mockSupabase)\n    const { status, data } = await parseResponse(response)\n\n    expect(status).toBe(409)\n    expectErrorResponse(data, 409, 'already registered')\n  })\n\n  it('should validate password strength', async () => {\n    const request = createMockRequest('POST', '/api/auth/signup', {\n      email: 'test@example.com',\n      password: 'weak',\n      full_name: 'Test User',\n      organization_name: 'Test Org',\n    })\n\n    const response = await simulateSignUp(request, mockSupabase)\n    const { status, data } = await parseResponse(response)\n\n    expect(status).toBe(400)\n    expectErrorResponse(data, 400, 'Password must be at least 8 characters')\n  })\n\n  it('should require organization name', async () => {\n    const request = createMockRequest('POST', '/api/auth/signup', {\n      email: 'test@example.com',\n      password: 'SecurePass123!',\n      full_name: 'Test User',\n    })\n\n    const response = await simulateSignUp(request, mockSupabase)\n    const { status, data } = await parseResponse(response)\n\n    expect(status).toBe(400)\n    expectErrorResponse(data, 400, 'Organization name is required')\n  })\n})\n\ndescribe('POST /api/auth/forgot-password', () => {\n  let mockSupabase: any\n\n  beforeEach(() => {\n    mockSupabase = createMockSupabaseClient()\n    jest.clearAllMocks()\n  })\n\n  it('should send password reset email for valid email', async () => {\n    mockSupabase.auth.resetPasswordForEmail = jest.fn().mockResolvedValue({\n      data: {},\n      error: null,\n    })\n\n    const request = createMockRequest('POST', '/api/auth/forgot-password', {\n      email: 'user@example.com',\n    })\n\n    const response = await simulateForgotPassword(request, mockSupabase)\n    const { status, data } = await parseResponse(response)\n\n    expect(status).toBe(200)\n    expect(data.message).toContain('Password reset email sent')\n    expect(mockSupabase.auth.resetPasswordForEmail).toHaveBeenCalledWith('user@example.com', expect.any(Object))\n  })\n\n  it('should return success even for non-existent email (security)', async () => {\n    mockSupabase.auth.resetPasswordForEmail = jest.fn().mockResolvedValue({\n      data: {},\n      error: null,\n    })\n\n    const request = createMockRequest('POST', '/api/auth/forgot-password', {\n      email: 'nonexistent@example.com',\n    })\n\n    const response = await simulateForgotPassword(request, mockSupabase)\n    const { status, data } = await parseResponse(response)\n\n    // Should return success to prevent email enumeration\n    expect(status).toBe(200)\n    expect(data.message).toContain('Password reset email sent')\n  })\n})\n\ndescribe('POST /api/auth/reset-password', () => {\n  let mockSupabase: any\n\n  beforeEach(() => {\n    mockSupabase = createMockSupabaseClient()\n    jest.clearAllMocks()\n  })\n\n  it('should reset password with valid token', async () => {\n    mockSupabase.auth.updateUser = jest.fn().mockResolvedValue({\n      data: { user: { id: 'user-id' } },\n      error: null,\n    })\n\n    const request = createMockRequest('POST', '/api/auth/reset-password', {\n      token: 'valid-reset-token',\n      password: 'NewSecurePass123!',\n    })\n\n    const response = await simulateResetPassword(request, mockSupabase)\n    const { status, data } = await parseResponse(response)\n\n    expect(status).toBe(200)\n    expect(data.message).toContain('Password updated successfully')\n  })\n\n  it('should reject expired or invalid token', async () => {\n    mockSupabase.auth.updateUser = jest.fn().mockResolvedValue({\n      data: { user: null },\n      error: { message: 'Invalid or expired token' },\n    })\n\n    const request = createMockRequest('POST', '/api/auth/reset-password', {\n      token: 'expired-token',\n      password: 'NewSecurePass123!',\n    })\n\n    const response = await simulateResetPassword(request, mockSupabase)\n    const { status, data } = await parseResponse(response)\n\n    expect(status).toBe(400)\n    expectErrorResponse(data, 400, 'Invalid or expired token')\n  })\n})\n\n// =============================================================================\n// Helper Functions to Simulate API Route Handlers\n// =============================================================================\n\nasync function simulateSignIn(request: NextRequest, supabase: any): Promise<any> {\n  try {\n    const body = await request.json()\n    const { email, password } = body\n\n    // Validation\n    if (!email || !password) {\n      return new Response(JSON.stringify({ error: 'Email and password are required' }), {\n        status: 400,\n        headers: { 'Content-Type': 'application/json' },\n      })\n    }\n\n    const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/\n    if (!emailRegex.test(email)) {\n      return new Response(JSON.stringify({ error: 'Invalid email format' }), {\n        status: 400,\n        headers: { 'Content-Type': 'application/json' },\n      })\n    }\n\n    if (!password) {\n      return new Response(JSON.stringify({ error: 'Password is required' }), {\n        status: 400,\n        headers: { 'Content-Type': 'application/json' },\n      })\n    }\n\n    // Attempt sign in\n    const { data, error } = await supabase.auth.signInWithPassword({ email, password })\n\n    if (error || !data.session) {\n      return new Response(JSON.stringify({ error: 'Invalid login credentials' }), {\n        status: 401,\n        headers: { 'Content-Type': 'application/json' },\n      })\n    }\n\n    // Get user profile\n    const { data: profile } = await supabase\n      .from('profiles')\n      .select('*, organization:organizations(*)')\n      .eq('id', data.user.id)\n      .single()\n\n    return new Response(\n      JSON.stringify({\n        user: { ...data.user, ...profile },\n        session: data.session,\n      }),\n      {\n        status: 200,\n        headers: { 'Content-Type': 'application/json' },\n      }\n    )\n  } catch (error: any) {\n    return new Response(JSON.stringify({ error: error.message }), {\n      status: 500,\n      headers: { 'Content-Type': 'application/json' },\n    })\n  }\n}\n\nasync function simulateSignUp(request: NextRequest, supabase: any): Promise<any> {\n  try {\n    const body = await request.json()\n    const { email, password, full_name, organization_name } = body\n\n    // Validation\n    if (!email || !password || !full_name || !organization_name) {\n      let errorMsg = 'Missing required fields: '\n      if (!email) errorMsg += 'email '\n      if (!password) errorMsg += 'password '\n      if (!full_name) errorMsg += 'full_name '\n      if (!organization_name) errorMsg += 'Organization name is required'\n\n      return new Response(JSON.stringify({ error: errorMsg }), {\n        status: 400,\n        headers: { 'Content-Type': 'application/json' },\n      })\n    }\n\n    if (password.length < 8) {\n      return new Response(JSON.stringify({ error: 'Password must be at least 8 characters' }), {\n        status: 400,\n        headers: { 'Content-Type': 'application/json' },\n      })\n    }\n\n    // Attempt sign up\n    const { data, error } = await supabase.auth.signUp({ email, password })\n\n    if (error) {\n      const status = error.message.includes('already registered') ? 409 : 400\n      return new Response(JSON.stringify({ error: error.message }), {\n        status,\n        headers: { 'Content-Type': 'application/json' },\n      })\n    }\n\n    // Create organization\n    const { data: org } = await supabase\n      .from('organizations')\n      .insert({ name: organization_name })\n      .select()\n      .single()\n\n    return new Response(\n      JSON.stringify({\n        user: data.user,\n        organization: org,\n        session: data.session,\n      }),\n      {\n        status: 201,\n        headers: { 'Content-Type': 'application/json' },\n      }\n    )\n  } catch (error: any) {\n    return new Response(JSON.stringify({ error: error.message }), {\n      status: 500,\n      headers: { 'Content-Type': 'application/json' },\n    })\n  }\n}\n\nasync function simulateForgotPassword(request: NextRequest, supabase: any): Promise<any> {\n  try {\n    const body = await request.json()\n    const { email } = body\n\n    if (!email) {\n      return new Response(JSON.stringify({ error: 'Email is required' }), {\n        status: 400,\n        headers: { 'Content-Type': 'application/json' },\n      })\n    }\n\n    await supabase.auth.resetPasswordForEmail(email, {\n      redirectTo: `${process.env.NEXT_PUBLIC_APP_URL}/auth/reset-password`,\n    })\n\n    // Always return success (security best practice)\n    return new Response(\n      JSON.stringify({ message: 'Password reset email sent if account exists' }),\n      {\n        status: 200,\n        headers: { 'Content-Type': 'application/json' },\n      }\n    )\n  } catch (error: any) {\n    return new Response(JSON.stringify({ error: error.message }), {\n      status: 500,\n      headers: { 'Content-Type': 'application/json' },\n    })\n  }\n}\n\nasync function simulateResetPassword(request: NextRequest, supabase: any): Promise<any> {\n  try {\n    const body = await request.json()\n    const { token, password } = body\n\n    if (!token || !password) {\n      return new Response(JSON.stringify({ error: 'Token and password are required' }), {\n        status: 400,\n        headers: { 'Content-Type': 'application/json' },\n      })\n    }\n\n    const { data, error } = await supabase.auth.updateUser({ password })\n\n    if (error) {\n      return new Response(JSON.stringify({ error: error.message }), {\n        status: 400,\n        headers: { 'Content-Type': 'application/json' },\n      })\n    }\n\n    return new Response(\n      JSON.stringify({ message: 'Password updated successfully' }),\n      {\n        status: 200,\n        headers: { 'Content-Type': 'application/json' },\n      }\n    )\n  } catch (error: any) {\n    return new Response(JSON.stringify({ error: error.message }), {\n      status: 500,\n      headers: { 'Content-Type': 'application/json' },\n    })\n  }\n}\n"],"names":["jest","mock","describe","mockSupabase","beforeEach","createMockSupabaseClient","clearAllMocks","it","mockUser","createMockUser","mockOrg","createMockOrganization","id","organization_id","auth","signInWithPassword","fn","mockResolvedValue","data","user","email","session","access_token","refresh_token","error","from","mockReturnValue","select","mockReturnThis","eq","single","organization","request","createMockRequest","password","response","simulateSignIn","status","parseResponse","expect","toBe","toHaveProperty","message","expectErrorResponse","newUser","full_name","organization_name","signUp","insert","name","simulateSignUp","resetPasswordForEmail","simulateForgotPassword","toContain","toHaveBeenCalledWith","any","Object","updateUser","token","simulateResetPassword","supabase","body","json","Response","JSON","stringify","headers","emailRegex","test","profile","errorMsg","length","includes","org","redirectTo","process","env","NEXT_PUBLIC_APP_URL"],"mappings":"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"}