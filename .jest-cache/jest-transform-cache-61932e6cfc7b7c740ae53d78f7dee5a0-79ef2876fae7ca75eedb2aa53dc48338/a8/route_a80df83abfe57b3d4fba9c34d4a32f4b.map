{"version":3,"names":["DELETE","cov_y22wa01ct","f","s","GET","POST","PUT","request","supabase","_server1","createClient","data","user","error","authError","auth","getUser","b","_server","NextResponse","json","code","status","currentSessionToken","cookies","get","value","sessionManager","_manager","getSessionManager","sessions","getUserSessions","id","formattedSessions","map","session","sessionToken","deviceInfo","userAgent","maskUserAgent","ip","maskIpAddress","platform","createdAt","lastActivity","expiresAt","isCurrent","sort","a","Date","getTime","maxSessions","Number","process","env","MAX_CONCURRENT_SESSIONS","success","totalSessions","length","console","NODE_ENV","Sentry","Promise","resolve","then","_interop_require_wildcard","require","captureException","tags","endpoint","sentryError","browserMatch","match","osMatch","browser","os","includes","parts","split"],"sources":["C:\\Ai Projecten\\ADSapp\\src\\app\\api\\auth\\session\\list\\route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport { getSessionManager } from '@/lib/session/manager';\nimport { createClient } from '@/lib/supabase/server';\n\n/**\n * List Active Sessions API Route\n *\n * GET /api/auth/session/list\n *\n * Returns all active sessions for the authenticated user.\n * Provides session management interface showing:\n * - Current session (marked)\n * - Other active sessions with device info\n * - Session creation and last activity times\n * - Ability to identify and revoke specific sessions\n *\n * Response:\n * ```json\n * {\n *   \"sessions\": [\n *     {\n *       \"sessionToken\": \"token123\",\n *       \"deviceInfo\": {\n *         \"userAgent\": \"Mozilla/5.0...\",\n *         \"ip\": \"192.168.1.1\",\n *         \"platform\": \"web\"\n *       },\n *       \"createdAt\": \"2025-10-14T10:00:00Z\",\n *       \"lastActivity\": \"2025-10-14T10:30:00Z\",\n *       \"expiresAt\": \"2025-10-14T11:00:00Z\",\n *       \"isCurrent\": true\n *     }\n *   ],\n *   \"totalSessions\": 3,\n *   \"maxSessions\": 5\n * }\n * ```\n *\n * Security:\n * - Requires user authentication\n * - Only shows user's own sessions\n * - Masks sensitive device information\n * - Identifies current session\n *\n * @returns List of active sessions\n */\nexport async function GET(request: NextRequest) {\n  try {\n    // Get user ID from Supabase auth\n    const supabase = await createClient();\n    const { data: { user }, error: authError } = await supabase.auth.getUser();\n\n    if (authError || !user) {\n      return NextResponse.json(\n        {\n          error: 'User not authenticated',\n          code: 'UNAUTHORIZED'\n        },\n        { status: 401 }\n      );\n    }\n\n    // Get current session token\n    const currentSessionToken = request.cookies.get('adsapp_session')?.value;\n\n    // Get all user sessions\n    const sessionManager = getSessionManager();\n    const sessions = await sessionManager.getUserSessions(user.id);\n\n    // Format sessions for response\n    const formattedSessions = sessions.map(session => ({\n      sessionToken: session.sessionToken,\n      deviceInfo: {\n        // Mask full user agent, show only browser/platform\n        userAgent: maskUserAgent(session.deviceInfo.userAgent),\n        // Mask IP address (show only first two octets)\n        ip: maskIpAddress(session.deviceInfo.ip),\n        platform: session.deviceInfo.platform || 'unknown'\n      },\n      createdAt: session.createdAt,\n      lastActivity: session.lastActivity,\n      expiresAt: session.expiresAt,\n      isCurrent: session.sessionToken === currentSessionToken\n    }));\n\n    // Sort sessions by last activity (most recent first)\n    formattedSessions.sort((a, b) =>\n      new Date(b.lastActivity).getTime() - new Date(a.lastActivity).getTime()\n    );\n\n    // Get max concurrent sessions from config\n    const maxSessions = Number(process.env.MAX_CONCURRENT_SESSIONS) || 5;\n\n    return NextResponse.json(\n      {\n        success: true,\n        sessions: formattedSessions,\n        totalSessions: sessions.length,\n        maxSessions\n      },\n      { status: 200 }\n    );\n  } catch (error) {\n    console.error('[SessionList] Error:', error);\n\n    // Log error to monitoring\n    if (process.env.NODE_ENV === 'production') {\n      try {\n        const Sentry = await import('@sentry/nextjs');\n        Sentry.captureException(error, {\n          tags: {\n            endpoint: 'session-list'\n          }\n        });\n      } catch (sentryError) {\n        console.error('[SessionList] Failed to log error:', sentryError);\n      }\n    }\n\n    return NextResponse.json(\n      {\n        error: 'Internal server error',\n        code: 'INTERNAL_ERROR'\n      },\n      { status: 500 }\n    );\n  }\n}\n\n/**\n * POST/PUT/DELETE methods not allowed\n */\nexport async function POST() {\n  return NextResponse.json(\n    {\n      error: 'Method not allowed',\n      code: 'METHOD_NOT_ALLOWED'\n    },\n    { status: 405 }\n  );\n}\n\nexport async function PUT() {\n  return POST();\n}\n\nexport async function DELETE() {\n  return POST();\n}\n\n/**\n * Mask user agent to show only essential information\n *\n * @param userAgent - Full user agent string\n * @returns Masked user agent\n */\nfunction maskUserAgent(userAgent: string): string {\n  // Extract browser and OS info\n  const browserMatch = userAgent.match(/(Chrome|Firefox|Safari|Edge|Opera)\\/[\\d.]+/);\n  const osMatch = userAgent.match(/(Windows|Mac OS|Linux|Android|iOS)[\\s\\w.]*/);\n\n  const browser = browserMatch ? browserMatch[0] : 'Unknown Browser';\n  const os = osMatch ? osMatch[0] : 'Unknown OS';\n\n  return `${browser} on ${os}`;\n}\n\n/**\n * Mask IP address to show only network prefix\n *\n * @param ip - Full IP address\n * @returns Masked IP address\n */\nfunction maskIpAddress(ip: string): string {\n  if (ip === 'unknown') {\n    return 'unknown';\n  }\n\n  // For IPv4, show only first two octets\n  if (ip.includes('.')) {\n    const parts = ip.split('.');\n    return `${parts[0]}.${parts[1]}.*.*`;\n  }\n\n  // For IPv6, show only first segment\n  if (ip.includes(':')) {\n    const parts = ip.split(':');\n    return `${parts[0]}:****`;\n  }\n\n  return 'unknown';\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;MAkJsBA,OAAA;IAAA;IAAAC,aAAA,GAAAC,CAAA;IAAAD,aAAA,GAAAE,CAAA;WAAAH,MAAA;;MApGAI,IAAA;IAAA;IAAAH,aAAA,GAAAC,CAAA;IAAAD,aAAA,GAAAE,CAAA;WAAAC,GAAA;;MAsFAC,KAAA;IAAA;IAAAJ,aAAA,GAAAC,CAAA;IAAAD,aAAA,GAAAE,CAAA;WAAAE,IAAA;;MAUAC,IAAA;IAAA;IAAAL,aAAA,GAAAC,CAAA;IAAAD,aAAA,GAAAE,CAAA;WAAAG,GAAA;;;;;iCA9IoB;;;iCACR;;;kCACL;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA4CtB,eAAeF,IAAIG,OAAoB;EAAA;EAAAN,aAAA,GAAAC,CAAA;EAAAD,aAAA,GAAAE,CAAA;EAC5C,IAAI;IACF;IACA,MAAMK,QAAA;IAAA;IAAA,CAAAP,aAAA,GAAAE,CAAA,QAAW,MAAM,IAAAM,QAAA,CAAAC,YAAY;IACnC,MAAM;MAAEC,IAAA,EAAM;QAAEC;MAAI,CAAE;MAAEC,KAAA,EAAOC;IAAS,CAAE;IAAA;IAAA,CAAAb,aAAA,GAAAE,CAAA,QAAG,MAAMK,QAAA,CAASO,IAAI,CAACC,OAAO;IAAA;IAAAf,aAAA,GAAAE,CAAA;IAExE;IAAI;IAAA,CAAAF,aAAA,GAAAgB,CAAA,WAAAH,SAAA;IAAA;IAAA,CAAAb,aAAA,GAAAgB,CAAA,WAAa,CAACL,IAAA,GAAM;MAAA;MAAAX,aAAA,GAAAgB,CAAA;MAAAhB,aAAA,GAAAE,CAAA;MACtB,OAAOe,OAAA,CAAAC,YAAY,CAACC,IAAI,CACtB;QACEP,KAAA,EAAO;QACPQ,IAAA,EAAM;MACR,GACA;QAAEC,MAAA,EAAQ;MAAI;IAElB;IAAA;IAAA;MAAArB,aAAA,GAAAgB,CAAA;IAAA;IAEA;IACA,MAAMM,mBAAA;IAAA;IAAA,CAAAtB,aAAA,GAAAE,CAAA,QAAsBI,OAAA,CAAQiB,OAAO,CAACC,GAAG,CAAC,mBAAmBC,KAAA;IAEnE;IACA,MAAMC,cAAA;IAAA;IAAA,CAAA1B,aAAA,GAAAE,CAAA,QAAiB,IAAAyB,QAAA,CAAAC,iBAAiB;IACxC,MAAMC,QAAA;IAAA;IAAA,CAAA7B,aAAA,GAAAE,CAAA,QAAW,MAAMwB,cAAA,CAAeI,eAAe,CAACnB,IAAA,CAAKoB,EAAE;IAE7D;IACA,MAAMC,iBAAA;IAAA;IAAA,CAAAhC,aAAA,GAAAE,CAAA,QAAoB2B,QAAA,CAASI,GAAG,CAACC,OAAA,IAAY;MAAA;MAAAlC,aAAA,GAAAC,CAAA;MAAAD,aAAA,GAAAE,CAAA;MAAA;QACjDiC,YAAA,EAAcD,OAAA,CAAQC,YAAY;QAClCC,UAAA,EAAY;UACV;UACAC,SAAA,EAAWC,aAAA,CAAcJ,OAAA,CAAQE,UAAU,CAACC,SAAS;UACrD;UACAE,EAAA,EAAIC,aAAA,CAAcN,OAAA,CAAQE,UAAU,CAACG,EAAE;UACvCE,QAAA;UAAU;UAAA,CAAAzC,aAAA,GAAAgB,CAAA,WAAAkB,OAAA,CAAQE,UAAU,CAACK,QAAQ;UAAA;UAAA,CAAAzC,aAAA,GAAAgB,CAAA,WAAI;QAC3C;QACA0B,SAAA,EAAWR,OAAA,CAAQQ,SAAS;QAC5BC,YAAA,EAAcT,OAAA,CAAQS,YAAY;QAClCC,SAAA,EAAWV,OAAA,CAAQU,SAAS;QAC5BC,SAAA,EAAWX,OAAA,CAAQC,YAAY,KAAKb;MACtC;IAAA;IAEA;IAAA;IAAAtB,aAAA,GAAAE,CAAA;IACA8B,iBAAA,CAAkBc,IAAI,CAAC,CAACC,CAAA,EAAG/B,CAAA,KACzB;MAAA;MAAAhB,aAAA,GAAAC,CAAA;MAAAD,aAAA,GAAAE,CAAA;MAAA,WAAI8C,IAAA,CAAKhC,CAAA,CAAE2B,YAAY,EAAEM,OAAO,KAAK,IAAID,IAAA,CAAKD,CAAA,CAAEJ,YAAY,EAAEM,OAAO;IAAA;IAGvE;IACA,MAAMC,WAAA;IAAA;IAAA,CAAAlD,aAAA,GAAAE,CAAA;IAAc;IAAA,CAAAF,aAAA,GAAAgB,CAAA,WAAAmC,MAAA,CAAOC,OAAA,CAAQC,GAAG,CAACC,uBAAuB;IAAA;IAAA,CAAAtD,aAAA,GAAAgB,CAAA,WAAK;IAAA;IAAAhB,aAAA,GAAAE,CAAA;IAEnE,OAAOe,OAAA,CAAAC,YAAY,CAACC,IAAI,CACtB;MACEoC,OAAA,EAAS;MACT1B,QAAA,EAAUG,iBAAA;MACVwB,aAAA,EAAe3B,QAAA,CAAS4B,MAAM;MAC9BP;IACF,GACA;MAAE7B,MAAA,EAAQ;IAAI;EAElB,EAAE,OAAOT,KAAA,EAAO;IAAA;IAAAZ,aAAA,GAAAE,CAAA;IACdwD,OAAA,CAAQ9C,KAAK,CAAC,wBAAwBA,KAAA;IAEtC;IAAA;IAAAZ,aAAA,GAAAE,CAAA;IACA,IAAIkD,OAAA,CAAQC,GAAG,CAACM,QAAQ,KAAK,cAAc;MAAA;MAAA3D,aAAA,GAAAgB,CAAA;MAAAhB,aAAA,GAAAE,CAAA;MACzC,IAAI;QACF,MAAM0D,MAAA;QAAA;QAAA,CAAA5D,aAAA,GAAAE,CAAA,QAAS,MAAM2D,OAAA,CAAAC,OAAA,GAAAC,IAAA;UAAA;UAAA/D,aAAA,GAAAC,CAAA;UAAAD,aAAA,GAAAE,CAAA;UAAA,oBAAA8D,yBAAA,CAAAC,OAAA,CAAO;QAAA;QAAA;QAAAjE,aAAA,GAAAE,CAAA;QAC5B0D,MAAA,CAAOM,gBAAgB,CAACtD,KAAA,EAAO;UAC7BuD,IAAA,EAAM;YACJC,QAAA,EAAU;UACZ;QACF;MACF,EAAE,OAAOC,WAAA,EAAa;QAAA;QAAArE,aAAA,GAAAE,CAAA;QACpBwD,OAAA,CAAQ9C,KAAK,CAAC,sCAAsCyD,WAAA;MACtD;IACF;IAAA;IAAA;MAAArE,aAAA,GAAAgB,CAAA;IAAA;IAAAhB,aAAA,GAAAE,CAAA;IAEA,OAAOe,OAAA,CAAAC,YAAY,CAACC,IAAI,CACtB;MACEP,KAAA,EAAO;MACPQ,IAAA,EAAM;IACR,GACA;MAAEC,MAAA,EAAQ;IAAI;EAElB;AACF;AAKO,eAAejB,KAAA;EAAA;EAAAJ,aAAA,GAAAC,CAAA;EAAAD,aAAA,GAAAE,CAAA;EACpB,OAAOe,OAAA,CAAAC,YAAY,CAACC,IAAI,CACtB;IACEP,KAAA,EAAO;IACPQ,IAAA,EAAM;EACR,GACA;IAAEC,MAAA,EAAQ;EAAI;AAElB;AAEO,eAAehB,IAAA;EAAA;EAAAL,aAAA,GAAAC,CAAA;EAAAD,aAAA,GAAAE,CAAA;EACpB,OAAOE,IAAA;AACT;AAEO,eAAeL,OAAA;EAAA;EAAAC,aAAA,GAAAC,CAAA;EAAAD,aAAA,GAAAE,CAAA;EACpB,OAAOE,IAAA;AACT;AAEA;;;;;;AAMA,SAASkC,cAAcD,SAAiB;EAAA;EAAArC,aAAA,GAAAC,CAAA;EACtC;EACA,MAAMqE,YAAA;EAAA;EAAA,CAAAtE,aAAA,GAAAE,CAAA,QAAemC,SAAA,CAAUkC,KAAK,CAAC;EACrC,MAAMC,OAAA;EAAA;EAAA,CAAAxE,aAAA,GAAAE,CAAA,QAAUmC,SAAA,CAAUkC,KAAK,CAAC;EAEhC,MAAME,OAAA;EAAA;EAAA,CAAAzE,aAAA,GAAAE,CAAA,QAAUoE,YAAA;EAAA;EAAA,CAAAtE,aAAA,GAAAgB,CAAA,WAAesD,YAAY,CAAC,EAAE;EAAA;EAAA,CAAAtE,aAAA,GAAAgB,CAAA,WAAG;EACjD,MAAM0D,EAAA;EAAA;EAAA,CAAA1E,aAAA,GAAAE,CAAA,QAAKsE,OAAA;EAAA;EAAA,CAAAxE,aAAA,GAAAgB,CAAA,WAAUwD,OAAO,CAAC,EAAE;EAAA;EAAA,CAAAxE,aAAA,GAAAgB,CAAA,WAAG;EAAA;EAAAhB,aAAA,GAAAE,CAAA;EAElC,OAAO,GAAGuE,OAAA,OAAcC,EAAA,EAAI;AAC9B;AAEA;;;;;;AAMA,SAASlC,cAAcD,EAAU;EAAA;EAAAvC,aAAA,GAAAC,CAAA;EAAAD,aAAA,GAAAE,CAAA;EAC/B,IAAIqC,EAAA,KAAO,WAAW;IAAA;IAAAvC,aAAA,GAAAgB,CAAA;IAAAhB,aAAA,GAAAE,CAAA;IACpB,OAAO;EACT;EAAA;EAAA;IAAAF,aAAA,GAAAgB,CAAA;EAAA;EAEA;EAAAhB,aAAA,GAAAE,CAAA;EACA,IAAIqC,EAAA,CAAGoC,QAAQ,CAAC,MAAM;IAAA;IAAA3E,aAAA,GAAAgB,CAAA;IACpB,MAAM4D,KAAA;IAAA;IAAA,CAAA5E,aAAA,GAAAE,CAAA,QAAQqC,EAAA,CAAGsC,KAAK,CAAC;IAAA;IAAA7E,aAAA,GAAAE,CAAA;IACvB,OAAO,GAAG0E,KAAK,CAAC,EAAE,IAAIA,KAAK,CAAC,EAAE,MAAM;EACtC;EAAA;EAAA;IAAA5E,aAAA,GAAAgB,CAAA;EAAA;EAEA;EAAAhB,aAAA,GAAAE,CAAA;EACA,IAAIqC,EAAA,CAAGoC,QAAQ,CAAC,MAAM;IAAA;IAAA3E,aAAA,GAAAgB,CAAA;IACpB,MAAM4D,KAAA;IAAA;IAAA,CAAA5E,aAAA,GAAAE,CAAA,QAAQqC,EAAA,CAAGsC,KAAK,CAAC;IAAA;IAAA7E,aAAA,GAAAE,CAAA;IACvB,OAAO,GAAG0E,KAAK,CAAC,EAAE,OAAO;EAC3B;EAAA;EAAA;IAAA5E,aAAA,GAAAgB,CAAA;EAAA;EAAAhB,aAAA,GAAAE,CAAA;EAEA,OAAO;AACT","ignoreList":[]}