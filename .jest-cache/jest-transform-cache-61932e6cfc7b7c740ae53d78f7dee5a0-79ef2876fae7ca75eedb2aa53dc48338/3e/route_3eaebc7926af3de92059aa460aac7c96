d0dda711611f3813d3861c01bfdf4c36
"use strict";

/* istanbul ignore next */
function cov_1npnbm7azz() {
  var path = "C:\\Ai Projecten\\ADSapp\\src\\app\\api\\conversations\\[id]\\messages\\route.ts";
  var hash = "ca0646af4a0ad57c39681a243cfd0bf754776397";
  var global = new Function("return this")();
  var gcv = "__coverage__";
  var coverageData = {
    path: "C:\\Ai Projecten\\ADSapp\\src\\app\\api\\conversations\\[id]\\messages\\route.ts",
    statementMap: {
      "0": {
        start: {
          line: 2,
          column: 0
        },
        end: {
          line: 4,
          column: 3
        }
      },
      "1": {
        start: {
          line: 6,
          column: 4
        },
        end: {
          line: 9,
          column: 7
        }
      },
      "2": {
        start: {
          line: 6,
          column: 24
        },
        end: {
          line: 9,
          column: 7
        }
      },
      "3": {
        start: {
          line: 11,
          column: 0
        },
        end: {
          line: 21,
          column: 3
        }
      },
      "4": {
        start: {
          line: 13,
          column: 8
        },
        end: {
          line: 13,
          column: 19
        }
      },
      "5": {
        start: {
          line: 16,
          column: 8
        },
        end: {
          line: 16,
          column: 21
        }
      },
      "6": {
        start: {
          line: 19,
          column: 8
        },
        end: {
          line: 19,
          column: 20
        }
      },
      "7": {
        start: {
          line: 22,
          column: 16
        },
        end: {
          line: 22,
          column: 38
        }
      },
      "8": {
        start: {
          line: 23,
          column: 17
        },
        end: {
          line: 23,
          column: 62
        }
      },
      "9": {
        start: {
          line: 24,
          column: 17
        },
        end: {
          line: 24,
          column: 63
        }
      },
      "10": {
        start: {
          line: 25,
          column: 20
        },
        end: {
          line: 25,
          column: 60
        }
      },
      "11": {
        start: {
          line: 28,
          column: 31
        },
        end: {
          line: 28,
          column: 84
        }
      },
      "12": {
        start: {
          line: 29,
          column: 4
        },
        end: {
          line: 29,
          column: 54
        }
      },
      "13": {
        start: {
          line: 29,
          column: 28
        },
        end: {
          line: 29,
          column: 54
        }
      },
      "14": {
        start: {
          line: 30,
          column: 4
        },
        end: {
          line: 66,
          column: 5
        }
      },
      "15": {
        start: {
          line: 32,
          column: 35
        },
        end: {
          line: 32,
          column: 77
        }
      },
      "16": {
        start: {
          line: 33,
          column: 25
        },
        end: {
          line: 33,
          column: 59
        }
      },
      "17": {
        start: {
          line: 34,
          column: 39
        },
        end: {
          line: 34,
          column: 51
        }
      },
      "18": {
        start: {
          line: 36,
          column: 39
        },
        end: {
          line: 36,
          column: 159
        }
      },
      "19": {
        start: {
          line: 37,
          column: 8
        },
        end: {
          line: 43,
          column: 9
        }
      },
      "20": {
        start: {
          line: 38,
          column: 12
        },
        end: {
          line: 42,
          column: 15
        }
      },
      "21": {
        start: {
          line: 45,
          column: 42
        },
        end: {
          line: 47,
          column: 10
        }
      },
      "22": {
        start: {
          line: 48,
          column: 8
        },
        end: {
          line: 55,
          column: 9
        }
      },
      "23": {
        start: {
          line: 49,
          column: 12
        },
        end: {
          line: 49,
          column: 52
        }
      },
      "24": {
        start: {
          line: 50,
          column: 12
        },
        end: {
          line: 54,
          column: 15
        }
      },
      "25": {
        start: {
          line: 56,
          column: 8
        },
        end: {
          line: 58,
          column: 11
        }
      },
      "26": {
        start: {
          line: 60,
          column: 8
        },
        end: {
          line: 60,
          column: 43
        }
      },
      "27": {
        start: {
          line: 61,
          column: 8
        },
        end: {
          line: 65,
          column: 11
        }
      },
      "28": {
        start: {
          line: 70,
          column: 31
        },
        end: {
          line: 70,
          column: 84
        }
      },
      "29": {
        start: {
          line: 71,
          column: 4
        },
        end: {
          line: 71,
          column: 54
        }
      },
      "30": {
        start: {
          line: 71,
          column: 28
        },
        end: {
          line: 71,
          column: 54
        }
      },
      "31": {
        start: {
          line: 72,
          column: 4
        },
        end: {
          line: 119,
          column: 5
        }
      },
      "32": {
        start: {
          line: 74,
          column: 43
        },
        end: {
          line: 74,
          column: 85
        }
      },
      "33": {
        start: {
          line: 75,
          column: 25
        },
        end: {
          line: 75,
          column: 59
        }
      },
      "34": {
        start: {
          line: 76,
          column: 39
        },
        end: {
          line: 76,
          column: 51
        }
      },
      "35": {
        start: {
          line: 77,
          column: 21
        },
        end: {
          line: 77,
          column: 41
        }
      },
      "36": {
        start: {
          line: 78,
          column: 43
        },
        end: {
          line: 78,
          column: 47
        }
      },
      "37": {
        start: {
          line: 79,
          column: 8
        },
        end: {
          line: 85,
          column: 9
        }
      },
      "38": {
        start: {
          line: 80,
          column: 12
        },
        end: {
          line: 84,
          column: 15
        }
      },
      "39": {
        start: {
          line: 87,
          column: 39
        },
        end: {
          line: 87,
          column: 159
        }
      },
      "40": {
        start: {
          line: 88,
          column: 8
        },
        end: {
          line: 94,
          column: 9
        }
      },
      "41": {
        start: {
          line: 89,
          column: 12
        },
        end: {
          line: 93,
          column: 15
        }
      },
      "42": {
        start: {
          line: 96,
          column: 32
        },
        end: {
          line: 96,
          column: 101
        }
      },
      "43": {
        start: {
          line: 97,
          column: 24
        },
        end: {
          line: 97,
          column: 96
        }
      },
      "44": {
        start: {
          line: 99,
          column: 44
        },
        end: {
          line: 99,
          column: 157
        }
      },
      "45": {
        start: {
          line: 100,
          column: 8
        },
        end: {
          line: 104,
          column: 11
        }
      },
      "46": {
        start: {
          line: 106,
          column: 8
        },
        end: {
          line: 106,
          column: 43
        }
      },
      "47": {
        start: {
          line: 107,
          column: 8
        },
        end: {
          line: 113,
          column: 9
        }
      },
      "48": {
        start: {
          line: 108,
          column: 12
        },
        end: {
          line: 112,
          column: 15
        }
      },
      "49": {
        start: {
          line: 114,
          column: 8
        },
        end: {
          line: 118,
          column: 11
        }
      },
      "50": {
        start: {
          line: 123,
          column: 31
        },
        end: {
          line: 123,
          column: 84
        }
      },
      "51": {
        start: {
          line: 124,
          column: 4
        },
        end: {
          line: 124,
          column: 54
        }
      },
      "52": {
        start: {
          line: 124,
          column: 28
        },
        end: {
          line: 124,
          column: 54
        }
      },
      "53": {
        start: {
          line: 125,
          column: 4
        },
        end: {
          line: 161,
          column: 5
        }
      },
      "54": {
        start: {
          line: 127,
          column: 35
        },
        end: {
          line: 127,
          column: 77
        }
      },
      "55": {
        start: {
          line: 128,
          column: 25
        },
        end: {
          line: 128,
          column: 59
        }
      },
      "56": {
        start: {
          line: 129,
          column: 39
        },
        end: {
          line: 129,
          column: 51
        }
      },
      "57": {
        start: {
          line: 130,
          column: 21
        },
        end: {
          line: 130,
          column: 41
        }
      },
      "58": {
        start: {
          line: 131,
          column: 38
        },
        end: {
          line: 131,
          column: 42
        }
      },
      "59": {
        start: {
          line: 132,
          column: 8
        },
        end: {
          line: 138,
          column: 9
        }
      },
      "60": {
        start: {
          line: 133,
          column: 12
        },
        end: {
          line: 137,
          column: 15
        }
      },
      "61": {
        start: {
          line: 140,
          column: 39
        },
        end: {
          line: 140,
          column: 159
        }
      },
      "62": {
        start: {
          line: 141,
          column: 8
        },
        end: {
          line: 147,
          column: 9
        }
      },
      "63": {
        start: {
          line: 142,
          column: 12
        },
        end: {
          line: 146,
          column: 15
        }
      },
      "64": {
        start: {
          line: 149,
          column: 32
        },
        end: {
          line: 149,
          column: 101
        }
      },
      "65": {
        start: {
          line: 150,
          column: 8
        },
        end: {
          line: 150,
          column: 59
        }
      },
      "66": {
        start: {
          line: 151,
          column: 8
        },
        end: {
          line: 153,
          column: 11
        }
      },
      "67": {
        start: {
          line: 155,
          column: 8
        },
        end: {
          line: 155,
          column: 43
        }
      },
      "68": {
        start: {
          line: 156,
          column: 8
        },
        end: {
          line: 160,
          column: 11
        }
      }
    },
    fnMap: {
      "0": {
        name: "_export",
        decl: {
          start: {
            line: 5,
            column: 9
          },
          end: {
            line: 5,
            column: 16
          }
        },
        loc: {
          start: {
            line: 5,
            column: 30
          },
          end: {
            line: 10,
            column: 1
          }
        },
        line: 5
      },
      "1": {
        name: "(anonymous_1)",
        decl: {
          start: {
            line: 12,
            column: 4
          },
          end: {
            line: 12,
            column: 5
          }
        },
        loc: {
          start: {
            line: 12,
            column: 15
          },
          end: {
            line: 14,
            column: 5
          }
        },
        line: 12
      },
      "2": {
        name: "(anonymous_2)",
        decl: {
          start: {
            line: 15,
            column: 4
          },
          end: {
            line: 15,
            column: 5
          }
        },
        loc: {
          start: {
            line: 15,
            column: 17
          },
          end: {
            line: 17,
            column: 5
          }
        },
        line: 15
      },
      "3": {
        name: "(anonymous_3)",
        decl: {
          start: {
            line: 18,
            column: 4
          },
          end: {
            line: 18,
            column: 5
          }
        },
        loc: {
          start: {
            line: 18,
            column: 16
          },
          end: {
            line: 20,
            column: 5
          }
        },
        line: 18
      },
      "4": {
        name: "GET",
        decl: {
          start: {
            line: 26,
            column: 15
          },
          end: {
            line: 26,
            column: 18
          }
        },
        loc: {
          start: {
            line: 26,
            column: 40
          },
          end: {
            line: 67,
            column: 1
          }
        },
        line: 26
      },
      "5": {
        name: "POST",
        decl: {
          start: {
            line: 68,
            column: 15
          },
          end: {
            line: 68,
            column: 19
          }
        },
        loc: {
          start: {
            line: 68,
            column: 41
          },
          end: {
            line: 120,
            column: 1
          }
        },
        line: 68
      },
      "6": {
        name: "PATCH",
        decl: {
          start: {
            line: 121,
            column: 15
          },
          end: {
            line: 121,
            column: 20
          }
        },
        loc: {
          start: {
            line: 121,
            column: 42
          },
          end: {
            line: 162,
            column: 1
          }
        },
        line: 121
      }
    },
    branchMap: {
      "0": {
        loc: {
          start: {
            line: 29,
            column: 4
          },
          end: {
            line: 29,
            column: 54
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 29,
            column: 4
          },
          end: {
            line: 29,
            column: 54
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 29
      },
      "1": {
        loc: {
          start: {
            line: 37,
            column: 8
          },
          end: {
            line: 43,
            column: 9
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 37,
            column: 8
          },
          end: {
            line: 43,
            column: 9
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 37
      },
      "2": {
        loc: {
          start: {
            line: 48,
            column: 8
          },
          end: {
            line: 55,
            column: 9
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 48,
            column: 8
          },
          end: {
            line: 55,
            column: 9
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 48
      },
      "3": {
        loc: {
          start: {
            line: 71,
            column: 4
          },
          end: {
            line: 71,
            column: 54
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 71,
            column: 4
          },
          end: {
            line: 71,
            column: 54
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 71
      },
      "4": {
        loc: {
          start: {
            line: 78,
            column: 25
          },
          end: {
            line: 78,
            column: 38
          }
        },
        type: "default-arg",
        locations: [{
          start: {
            line: 78,
            column: 32
          },
          end: {
            line: 78,
            column: 38
          }
        }],
        line: 78
      },
      "5": {
        loc: {
          start: {
            line: 79,
            column: 8
          },
          end: {
            line: 85,
            column: 9
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 79,
            column: 8
          },
          end: {
            line: 85,
            column: 9
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 79
      },
      "6": {
        loc: {
          start: {
            line: 88,
            column: 8
          },
          end: {
            line: 94,
            column: 9
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 88,
            column: 8
          },
          end: {
            line: 94,
            column: 9
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 88
      },
      "7": {
        loc: {
          start: {
            line: 107,
            column: 8
          },
          end: {
            line: 113,
            column: 9
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 107,
            column: 8
          },
          end: {
            line: 113,
            column: 9
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 107
      },
      "8": {
        loc: {
          start: {
            line: 107,
            column: 12
          },
          end: {
            line: 107,
            column: 72
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 107,
            column: 12
          },
          end: {
            line: 107,
            column: 34
          }
        }, {
          start: {
            line: 107,
            column: 38
          },
          end: {
            line: 107,
            column: 72
          }
        }],
        line: 107
      },
      "9": {
        loc: {
          start: {
            line: 124,
            column: 4
          },
          end: {
            line: 124,
            column: 54
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 124,
            column: 4
          },
          end: {
            line: 124,
            column: 54
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 124
      },
      "10": {
        loc: {
          start: {
            line: 132,
            column: 8
          },
          end: {
            line: 138,
            column: 9
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 132,
            column: 8
          },
          end: {
            line: 138,
            column: 9
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 132
      },
      "11": {
        loc: {
          start: {
            line: 132,
            column: 12
          },
          end: {
            line: 132,
            column: 48
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 132,
            column: 12
          },
          end: {
            line: 132,
            column: 34
          }
        }, {
          start: {
            line: 132,
            column: 38
          },
          end: {
            line: 132,
            column: 48
          }
        }],
        line: 132
      },
      "12": {
        loc: {
          start: {
            line: 141,
            column: 8
          },
          end: {
            line: 147,
            column: 9
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 141,
            column: 8
          },
          end: {
            line: 147,
            column: 9
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 141
      }
    },
    s: {
      "0": 0,
      "1": 0,
      "2": 0,
      "3": 0,
      "4": 0,
      "5": 0,
      "6": 0,
      "7": 0,
      "8": 0,
      "9": 0,
      "10": 0,
      "11": 0,
      "12": 0,
      "13": 0,
      "14": 0,
      "15": 0,
      "16": 0,
      "17": 0,
      "18": 0,
      "19": 0,
      "20": 0,
      "21": 0,
      "22": 0,
      "23": 0,
      "24": 0,
      "25": 0,
      "26": 0,
      "27": 0,
      "28": 0,
      "29": 0,
      "30": 0,
      "31": 0,
      "32": 0,
      "33": 0,
      "34": 0,
      "35": 0,
      "36": 0,
      "37": 0,
      "38": 0,
      "39": 0,
      "40": 0,
      "41": 0,
      "42": 0,
      "43": 0,
      "44": 0,
      "45": 0,
      "46": 0,
      "47": 0,
      "48": 0,
      "49": 0,
      "50": 0,
      "51": 0,
      "52": 0,
      "53": 0,
      "54": 0,
      "55": 0,
      "56": 0,
      "57": 0,
      "58": 0,
      "59": 0,
      "60": 0,
      "61": 0,
      "62": 0,
      "63": 0,
      "64": 0,
      "65": 0,
      "66": 0,
      "67": 0,
      "68": 0
    },
    f: {
      "0": 0,
      "1": 0,
      "2": 0,
      "3": 0,
      "4": 0,
      "5": 0,
      "6": 0
    },
    b: {
      "0": [0, 0],
      "1": [0, 0],
      "2": [0, 0],
      "3": [0, 0],
      "4": [0],
      "5": [0, 0],
      "6": [0, 0],
      "7": [0, 0],
      "8": [0, 0],
      "9": [0, 0],
      "10": [0, 0],
      "11": [0, 0],
      "12": [0, 0]
    },
    inputSourceMap: {
      version: 3,
      sources: ["C:\\Ai Projecten\\ADSapp\\src\\app\\api\\conversations\\[id]\\messages\\route.ts"],
      sourcesContent: ["import { NextRequest, NextResponse } from 'next/server'\nimport { createClient } from '@/lib/supabase/server'\nimport { requireAuth } from '@/lib/auth'\nimport { WhatsAppService } from '@/lib/whatsapp/service'\nimport { standardApiMiddleware, getTenantContext } from '@/lib/middleware'\n\nexport async function GET(\n  request: NextRequest,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  // Apply standard API middleware (tenant validation + standard rate limiting)\n  const middlewareResponse = await standardApiMiddleware(request);\n  if (middlewareResponse) return middlewareResponse;\n\n  try {\n    // Get tenant context from middleware (already validated)\n    const { organizationId } = getTenantContext(request);\n    const supabase = await createClient();\n    const { id: conversationId } = await params;\n\n    // Verify conversation belongs to user's organization\n    const { data: conversation } = await supabase\n      .from('conversations')\n      .select('*')\n      .eq('id', conversationId)\n      .eq('organization_id', organizationId)\n      .single();\n\n    if (!conversation) {\n      return NextResponse.json({ error: 'Conversation not found' }, { status: 404 })\n    }\n\n    // Get messages for this conversation\n    const { data: messages, error } = await supabase\n      .from('messages')\n      .select('*, sender:profiles(full_name, avatar_url)')\n      .eq('conversation_id', conversationId)\n      .order('created_at', { ascending: true })\n\n    if (error) {\n      console.error('Database error:', error)\n      return NextResponse.json({ error: 'Failed to fetch messages' }, { status: 500 })\n    }\n\n    return NextResponse.json({ messages })\n  } catch (error) {\n    console.error('API error:', error)\n    return NextResponse.json({ error: 'Internal server error' }, { status: 500 })\n  }\n}\n\nexport async function POST(\n  request: NextRequest,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  // Apply standard API middleware (tenant validation + strict rate limiting)\n  const middlewareResponse = await standardApiMiddleware(request);\n  if (middlewareResponse) return middlewareResponse;\n\n  try {\n    // Get tenant context from middleware (already validated)\n    const { organizationId, userId } = getTenantContext(request);\n    const supabase = await createClient();\n    const { id: conversationId } = await params;\n\n    const body = await request.json()\n    const { content, type = 'text' } = body\n\n    if (!content) {\n      return NextResponse.json({ error: 'Content is required' }, { status: 400 })\n    }\n\n    // Verify conversation belongs to user's organization\n    const { data: conversation } = await supabase\n      .from('conversations')\n      .select('*')\n      .eq('id', conversationId)\n      .eq('organization_id', organizationId)\n      .single();\n\n    if (!conversation) {\n      return NextResponse.json({ error: 'Conversation not found' }, { status: 404 })\n    }\n\n    // Send message via WhatsApp\n    const whatsappService = await WhatsAppService.createFromOrganization(organizationId)\n    const message = await whatsappService.sendMessage(\n      conversationId,\n      content,\n      userId,\n      type\n    )\n\n    // Return the created message\n    const { data: messageWithSender } = await supabase\n      .from('messages')\n      .select('*, sender:profiles(full_name, avatar_url)')\n      .eq('id', message.id)\n      .single()\n\n    return NextResponse.json({ message: messageWithSender }, { status: 201 })\n  } catch (error) {\n    console.error('API error:', error)\n\n    if (error instanceof Error && error.message.includes('WhatsApp')) {\n      return NextResponse.json({ error: error.message }, { status: 400 })\n    }\n\n    return NextResponse.json({ error: 'Internal server error' }, { status: 500 })\n  }\n}\n\nexport async function PATCH(\n  request: NextRequest,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  // Apply standard API middleware (tenant validation + standard rate limiting)\n  const middlewareResponse = await standardApiMiddleware(request);\n  if (middlewareResponse) return middlewareResponse;\n\n  try {\n    // Get tenant context from middleware (already validated)\n    const { organizationId } = getTenantContext(request);\n    const supabase = await createClient();\n    const { id: conversationId } = await params;\n\n    const body = await request.json()\n    const { action, messageId } = body\n\n    if (action !== 'mark_read' || !messageId) {\n      return NextResponse.json({ error: 'Invalid action or missing messageId' }, { status: 400 })\n    }\n\n    // Verify conversation belongs to user's organization\n    const { data: conversation } = await supabase\n      .from('conversations')\n      .select('*')\n      .eq('id', conversationId)\n      .eq('organization_id', organizationId)\n      .single();\n\n    if (!conversation) {\n      return NextResponse.json({ error: 'Conversation not found' }, { status: 404 })\n    }\n\n    // Mark message as read via WhatsApp\n    const whatsappService = await WhatsAppService.createFromOrganization(organizationId)\n    await whatsappService.markMessageAsRead(messageId)\n\n    return NextResponse.json({ success: true })\n  } catch (error) {\n    console.error('API error:', error)\n    return NextResponse.json({ error: 'Internal server error' }, { status: 500 })\n  }\n}"],
      names: ["GET", "PATCH", "POST", "request", "params", "middlewareResponse", "standardApiMiddleware", "organizationId", "getTenantContext", "supabase", "createClient", "id", "conversationId", "data", "conversation", "from", "select", "eq", "single", "NextResponse", "json", "error", "status", "messages", "order", "ascending", "console", "userId", "body", "content", "type", "whatsappService", "WhatsAppService", "createFromOrganization", "message", "sendMessage", "messageWithSender", "Error", "includes", "action", "messageId", "markMessageAsRead", "success"],
      mappings: "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"
    },
    _coverageSchema: "1a1c01bbd47fc00a2c39e90264f33305004495a9",
    hash: "ca0646af4a0ad57c39681a243cfd0bf754776397"
  };
  var coverage = global[gcv] || (global[gcv] = {});
  if (!coverage[path] || coverage[path].hash !== hash) {
    coverage[path] = coverageData;
  }
  var actualCoverage = coverage[path];
  {
    // @ts-ignore
    cov_1npnbm7azz = function () {
      return actualCoverage;
    };
  }
  return actualCoverage;
}
cov_1npnbm7azz();
cov_1npnbm7azz().s[0]++;
Object.defineProperty(exports, "__esModule", {
  value: true
});
function _export(target, all) {
  /* istanbul ignore next */
  cov_1npnbm7azz().f[0]++;
  cov_1npnbm7azz().s[1]++;
  for (var name in all) {
    /* istanbul ignore next */
    cov_1npnbm7azz().s[2]++;
    Object.defineProperty(target, name, {
      enumerable: true,
      get: Object.getOwnPropertyDescriptor(all, name).get
    });
  }
}
/* istanbul ignore next */
cov_1npnbm7azz().s[3]++;
_export(exports, {
  get GET() {
    /* istanbul ignore next */
    cov_1npnbm7azz().f[1]++;
    cov_1npnbm7azz().s[4]++;
    return GET;
  },
  get PATCH() {
    /* istanbul ignore next */
    cov_1npnbm7azz().f[2]++;
    cov_1npnbm7azz().s[5]++;
    return PATCH;
  },
  get POST() {
    /* istanbul ignore next */
    cov_1npnbm7azz().f[3]++;
    cov_1npnbm7azz().s[6]++;
    return POST;
  }
});
const _server =
/* istanbul ignore next */
(cov_1npnbm7azz().s[7]++, require("next/server"));
const _server1 =
/* istanbul ignore next */
(cov_1npnbm7azz().s[8]++, require("../../../../../lib/supabase/server"));
const _service =
/* istanbul ignore next */
(cov_1npnbm7azz().s[9]++, require("../../../../../lib/whatsapp/service"));
const _middleware =
/* istanbul ignore next */
(cov_1npnbm7azz().s[10]++, require("../../../../../lib/middleware"));
async function GET(request, {
  params
}) {
  /* istanbul ignore next */
  cov_1npnbm7azz().f[4]++;
  // Apply standard API middleware (tenant validation + standard rate limiting)
  const middlewareResponse =
  /* istanbul ignore next */
  (cov_1npnbm7azz().s[11]++, await (0, _middleware.standardApiMiddleware)(request));
  /* istanbul ignore next */
  cov_1npnbm7azz().s[12]++;
  if (middlewareResponse) {
    /* istanbul ignore next */
    cov_1npnbm7azz().b[0][0]++;
    cov_1npnbm7azz().s[13]++;
    return middlewareResponse;
  } else
  /* istanbul ignore next */
  {
    cov_1npnbm7azz().b[0][1]++;
  }
  cov_1npnbm7azz().s[14]++;
  try {
    // Get tenant context from middleware (already validated)
    const {
      organizationId
    } =
    /* istanbul ignore next */
    (cov_1npnbm7azz().s[15]++, (0, _middleware.getTenantContext)(request));
    const supabase =
    /* istanbul ignore next */
    (cov_1npnbm7azz().s[16]++, await (0, _server1.createClient)());
    const {
      id: conversationId
    } =
    /* istanbul ignore next */
    (cov_1npnbm7azz().s[17]++, await params);
    // Verify conversation belongs to user's organization
    const {
      data: conversation
    } =
    /* istanbul ignore next */
    (cov_1npnbm7azz().s[18]++, await supabase.from('conversations').select('*').eq('id', conversationId).eq('organization_id', organizationId).single());
    /* istanbul ignore next */
    cov_1npnbm7azz().s[19]++;
    if (!conversation) {
      /* istanbul ignore next */
      cov_1npnbm7azz().b[1][0]++;
      cov_1npnbm7azz().s[20]++;
      return _server.NextResponse.json({
        error: 'Conversation not found'
      }, {
        status: 404
      });
    } else
    /* istanbul ignore next */
    {
      cov_1npnbm7azz().b[1][1]++;
    }
    // Get messages for this conversation
    const {
      data: messages,
      error
    } =
    /* istanbul ignore next */
    (cov_1npnbm7azz().s[21]++, await supabase.from('messages').select('*, sender:profiles(full_name, avatar_url)').eq('conversation_id', conversationId).order('created_at', {
      ascending: true
    }));
    /* istanbul ignore next */
    cov_1npnbm7azz().s[22]++;
    if (error) {
      /* istanbul ignore next */
      cov_1npnbm7azz().b[2][0]++;
      cov_1npnbm7azz().s[23]++;
      console.error('Database error:', error);
      /* istanbul ignore next */
      cov_1npnbm7azz().s[24]++;
      return _server.NextResponse.json({
        error: 'Failed to fetch messages'
      }, {
        status: 500
      });
    } else
    /* istanbul ignore next */
    {
      cov_1npnbm7azz().b[2][1]++;
    }
    cov_1npnbm7azz().s[25]++;
    return _server.NextResponse.json({
      messages
    });
  } catch (error) {
    /* istanbul ignore next */
    cov_1npnbm7azz().s[26]++;
    console.error('API error:', error);
    /* istanbul ignore next */
    cov_1npnbm7azz().s[27]++;
    return _server.NextResponse.json({
      error: 'Internal server error'
    }, {
      status: 500
    });
  }
}
async function POST(request, {
  params
}) {
  /* istanbul ignore next */
  cov_1npnbm7azz().f[5]++;
  // Apply standard API middleware (tenant validation + strict rate limiting)
  const middlewareResponse =
  /* istanbul ignore next */
  (cov_1npnbm7azz().s[28]++, await (0, _middleware.standardApiMiddleware)(request));
  /* istanbul ignore next */
  cov_1npnbm7azz().s[29]++;
  if (middlewareResponse) {
    /* istanbul ignore next */
    cov_1npnbm7azz().b[3][0]++;
    cov_1npnbm7azz().s[30]++;
    return middlewareResponse;
  } else
  /* istanbul ignore next */
  {
    cov_1npnbm7azz().b[3][1]++;
  }
  cov_1npnbm7azz().s[31]++;
  try {
    // Get tenant context from middleware (already validated)
    const {
      organizationId,
      userId
    } =
    /* istanbul ignore next */
    (cov_1npnbm7azz().s[32]++, (0, _middleware.getTenantContext)(request));
    const supabase =
    /* istanbul ignore next */
    (cov_1npnbm7azz().s[33]++, await (0, _server1.createClient)());
    const {
      id: conversationId
    } =
    /* istanbul ignore next */
    (cov_1npnbm7azz().s[34]++, await params);
    const body =
    /* istanbul ignore next */
    (cov_1npnbm7azz().s[35]++, await request.json());
    const {
      content,
      type =
      /* istanbul ignore next */
      (cov_1npnbm7azz().b[4][0]++, 'text')
    } =
    /* istanbul ignore next */
    (cov_1npnbm7azz().s[36]++, body);
    /* istanbul ignore next */
    cov_1npnbm7azz().s[37]++;
    if (!content) {
      /* istanbul ignore next */
      cov_1npnbm7azz().b[5][0]++;
      cov_1npnbm7azz().s[38]++;
      return _server.NextResponse.json({
        error: 'Content is required'
      }, {
        status: 400
      });
    } else
    /* istanbul ignore next */
    {
      cov_1npnbm7azz().b[5][1]++;
    }
    // Verify conversation belongs to user's organization
    const {
      data: conversation
    } =
    /* istanbul ignore next */
    (cov_1npnbm7azz().s[39]++, await supabase.from('conversations').select('*').eq('id', conversationId).eq('organization_id', organizationId).single());
    /* istanbul ignore next */
    cov_1npnbm7azz().s[40]++;
    if (!conversation) {
      /* istanbul ignore next */
      cov_1npnbm7azz().b[6][0]++;
      cov_1npnbm7azz().s[41]++;
      return _server.NextResponse.json({
        error: 'Conversation not found'
      }, {
        status: 404
      });
    } else
    /* istanbul ignore next */
    {
      cov_1npnbm7azz().b[6][1]++;
    }
    // Send message via WhatsApp
    const whatsappService =
    /* istanbul ignore next */
    (cov_1npnbm7azz().s[42]++, await _service.WhatsAppService.createFromOrganization(organizationId));
    const message =
    /* istanbul ignore next */
    (cov_1npnbm7azz().s[43]++, await whatsappService.sendMessage(conversationId, content, userId, type));
    // Return the created message
    const {
      data: messageWithSender
    } =
    /* istanbul ignore next */
    (cov_1npnbm7azz().s[44]++, await supabase.from('messages').select('*, sender:profiles(full_name, avatar_url)').eq('id', message.id).single());
    /* istanbul ignore next */
    cov_1npnbm7azz().s[45]++;
    return _server.NextResponse.json({
      message: messageWithSender
    }, {
      status: 201
    });
  } catch (error) {
    /* istanbul ignore next */
    cov_1npnbm7azz().s[46]++;
    console.error('API error:', error);
    /* istanbul ignore next */
    cov_1npnbm7azz().s[47]++;
    if (
    /* istanbul ignore next */
    (cov_1npnbm7azz().b[8][0]++, error instanceof Error) &&
    /* istanbul ignore next */
    (cov_1npnbm7azz().b[8][1]++, error.message.includes('WhatsApp'))) {
      /* istanbul ignore next */
      cov_1npnbm7azz().b[7][0]++;
      cov_1npnbm7azz().s[48]++;
      return _server.NextResponse.json({
        error: error.message
      }, {
        status: 400
      });
    } else
    /* istanbul ignore next */
    {
      cov_1npnbm7azz().b[7][1]++;
    }
    cov_1npnbm7azz().s[49]++;
    return _server.NextResponse.json({
      error: 'Internal server error'
    }, {
      status: 500
    });
  }
}
async function PATCH(request, {
  params
}) {
  /* istanbul ignore next */
  cov_1npnbm7azz().f[6]++;
  // Apply standard API middleware (tenant validation + standard rate limiting)
  const middlewareResponse =
  /* istanbul ignore next */
  (cov_1npnbm7azz().s[50]++, await (0, _middleware.standardApiMiddleware)(request));
  /* istanbul ignore next */
  cov_1npnbm7azz().s[51]++;
  if (middlewareResponse) {
    /* istanbul ignore next */
    cov_1npnbm7azz().b[9][0]++;
    cov_1npnbm7azz().s[52]++;
    return middlewareResponse;
  } else
  /* istanbul ignore next */
  {
    cov_1npnbm7azz().b[9][1]++;
  }
  cov_1npnbm7azz().s[53]++;
  try {
    // Get tenant context from middleware (already validated)
    const {
      organizationId
    } =
    /* istanbul ignore next */
    (cov_1npnbm7azz().s[54]++, (0, _middleware.getTenantContext)(request));
    const supabase =
    /* istanbul ignore next */
    (cov_1npnbm7azz().s[55]++, await (0, _server1.createClient)());
    const {
      id: conversationId
    } =
    /* istanbul ignore next */
    (cov_1npnbm7azz().s[56]++, await params);
    const body =
    /* istanbul ignore next */
    (cov_1npnbm7azz().s[57]++, await request.json());
    const {
      action,
      messageId
    } =
    /* istanbul ignore next */
    (cov_1npnbm7azz().s[58]++, body);
    /* istanbul ignore next */
    cov_1npnbm7azz().s[59]++;
    if (
    /* istanbul ignore next */
    (cov_1npnbm7azz().b[11][0]++, action !== 'mark_read') ||
    /* istanbul ignore next */
    (cov_1npnbm7azz().b[11][1]++, !messageId)) {
      /* istanbul ignore next */
      cov_1npnbm7azz().b[10][0]++;
      cov_1npnbm7azz().s[60]++;
      return _server.NextResponse.json({
        error: 'Invalid action or missing messageId'
      }, {
        status: 400
      });
    } else
    /* istanbul ignore next */
    {
      cov_1npnbm7azz().b[10][1]++;
    }
    // Verify conversation belongs to user's organization
    const {
      data: conversation
    } =
    /* istanbul ignore next */
    (cov_1npnbm7azz().s[61]++, await supabase.from('conversations').select('*').eq('id', conversationId).eq('organization_id', organizationId).single());
    /* istanbul ignore next */
    cov_1npnbm7azz().s[62]++;
    if (!conversation) {
      /* istanbul ignore next */
      cov_1npnbm7azz().b[12][0]++;
      cov_1npnbm7azz().s[63]++;
      return _server.NextResponse.json({
        error: 'Conversation not found'
      }, {
        status: 404
      });
    } else
    /* istanbul ignore next */
    {
      cov_1npnbm7azz().b[12][1]++;
    }
    // Mark message as read via WhatsApp
    const whatsappService =
    /* istanbul ignore next */
    (cov_1npnbm7azz().s[64]++, await _service.WhatsAppService.createFromOrganization(organizationId));
    /* istanbul ignore next */
    cov_1npnbm7azz().s[65]++;
    await whatsappService.markMessageAsRead(messageId);
    /* istanbul ignore next */
    cov_1npnbm7azz().s[66]++;
    return _server.NextResponse.json({
      success: true
    });
  } catch (error) {
    /* istanbul ignore next */
    cov_1npnbm7azz().s[67]++;
    console.error('API error:', error);
    /* istanbul ignore next */
    cov_1npnbm7azz().s[68]++;
    return _server.NextResponse.json({
      error: 'Internal server error'
    }, {
      status: 500
    });
  }
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJHRVQiLCJjb3ZfMW5wbmJtN2F6eiIsImYiLCJzIiwiUEFUQ0giLCJQT1NUIiwicmVxdWVzdCIsInBhcmFtcyIsIm1pZGRsZXdhcmVSZXNwb25zZSIsIl9taWRkbGV3YXJlIiwic3RhbmRhcmRBcGlNaWRkbGV3YXJlIiwiYiIsIm9yZ2FuaXphdGlvbklkIiwiZ2V0VGVuYW50Q29udGV4dCIsInN1cGFiYXNlIiwiX3NlcnZlcjEiLCJjcmVhdGVDbGllbnQiLCJpZCIsImNvbnZlcnNhdGlvbklkIiwiZGF0YSIsImNvbnZlcnNhdGlvbiIsImZyb20iLCJzZWxlY3QiLCJlcSIsInNpbmdsZSIsIl9zZXJ2ZXIiLCJOZXh0UmVzcG9uc2UiLCJqc29uIiwiZXJyb3IiLCJzdGF0dXMiLCJtZXNzYWdlcyIsIm9yZGVyIiwiYXNjZW5kaW5nIiwiY29uc29sZSIsInVzZXJJZCIsImJvZHkiLCJjb250ZW50IiwidHlwZSIsIndoYXRzYXBwU2VydmljZSIsIl9zZXJ2aWNlIiwiV2hhdHNBcHBTZXJ2aWNlIiwiY3JlYXRlRnJvbU9yZ2FuaXphdGlvbiIsIm1lc3NhZ2UiLCJzZW5kTWVzc2FnZSIsIm1lc3NhZ2VXaXRoU2VuZGVyIiwiRXJyb3IiLCJpbmNsdWRlcyIsImFjdGlvbiIsIm1lc3NhZ2VJZCIsIm1hcmtNZXNzYWdlQXNSZWFkIiwic3VjY2VzcyJdLCJzb3VyY2VzIjpbIkM6XFxBaSBQcm9qZWN0ZW5cXEFEU2FwcFxcc3JjXFxhcHBcXGFwaVxcY29udmVyc2F0aW9uc1xcW2lkXVxcbWVzc2FnZXNcXHJvdXRlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE5leHRSZXF1ZXN0LCBOZXh0UmVzcG9uc2UgfSBmcm9tICduZXh0L3NlcnZlcidcbmltcG9ydCB7IGNyZWF0ZUNsaWVudCB9IGZyb20gJ0AvbGliL3N1cGFiYXNlL3NlcnZlcidcbmltcG9ydCB7IHJlcXVpcmVBdXRoIH0gZnJvbSAnQC9saWIvYXV0aCdcbmltcG9ydCB7IFdoYXRzQXBwU2VydmljZSB9IGZyb20gJ0AvbGliL3doYXRzYXBwL3NlcnZpY2UnXG5pbXBvcnQgeyBzdGFuZGFyZEFwaU1pZGRsZXdhcmUsIGdldFRlbmFudENvbnRleHQgfSBmcm9tICdAL2xpYi9taWRkbGV3YXJlJ1xuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gR0VUKFxuICByZXF1ZXN0OiBOZXh0UmVxdWVzdCxcbiAgeyBwYXJhbXMgfTogeyBwYXJhbXM6IFByb21pc2U8eyBpZDogc3RyaW5nIH0+IH1cbikge1xuICAvLyBBcHBseSBzdGFuZGFyZCBBUEkgbWlkZGxld2FyZSAodGVuYW50IHZhbGlkYXRpb24gKyBzdGFuZGFyZCByYXRlIGxpbWl0aW5nKVxuICBjb25zdCBtaWRkbGV3YXJlUmVzcG9uc2UgPSBhd2FpdCBzdGFuZGFyZEFwaU1pZGRsZXdhcmUocmVxdWVzdCk7XG4gIGlmIChtaWRkbGV3YXJlUmVzcG9uc2UpIHJldHVybiBtaWRkbGV3YXJlUmVzcG9uc2U7XG5cbiAgdHJ5IHtcbiAgICAvLyBHZXQgdGVuYW50IGNvbnRleHQgZnJvbSBtaWRkbGV3YXJlIChhbHJlYWR5IHZhbGlkYXRlZClcbiAgICBjb25zdCB7IG9yZ2FuaXphdGlvbklkIH0gPSBnZXRUZW5hbnRDb250ZXh0KHJlcXVlc3QpO1xuICAgIGNvbnN0IHN1cGFiYXNlID0gYXdhaXQgY3JlYXRlQ2xpZW50KCk7XG4gICAgY29uc3QgeyBpZDogY29udmVyc2F0aW9uSWQgfSA9IGF3YWl0IHBhcmFtcztcblxuICAgIC8vIFZlcmlmeSBjb252ZXJzYXRpb24gYmVsb25ncyB0byB1c2VyJ3Mgb3JnYW5pemF0aW9uXG4gICAgY29uc3QgeyBkYXRhOiBjb252ZXJzYXRpb24gfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgICAuZnJvbSgnY29udmVyc2F0aW9ucycpXG4gICAgICAuc2VsZWN0KCcqJylcbiAgICAgIC5lcSgnaWQnLCBjb252ZXJzYXRpb25JZClcbiAgICAgIC5lcSgnb3JnYW5pemF0aW9uX2lkJywgb3JnYW5pemF0aW9uSWQpXG4gICAgICAuc2luZ2xlKCk7XG5cbiAgICBpZiAoIWNvbnZlcnNhdGlvbikge1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgZXJyb3I6ICdDb252ZXJzYXRpb24gbm90IGZvdW5kJyB9LCB7IHN0YXR1czogNDA0IH0pXG4gICAgfVxuXG4gICAgLy8gR2V0IG1lc3NhZ2VzIGZvciB0aGlzIGNvbnZlcnNhdGlvblxuICAgIGNvbnN0IHsgZGF0YTogbWVzc2FnZXMsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgICAgLmZyb20oJ21lc3NhZ2VzJylcbiAgICAgIC5zZWxlY3QoJyosIHNlbmRlcjpwcm9maWxlcyhmdWxsX25hbWUsIGF2YXRhcl91cmwpJylcbiAgICAgIC5lcSgnY29udmVyc2F0aW9uX2lkJywgY29udmVyc2F0aW9uSWQpXG4gICAgICAub3JkZXIoJ2NyZWF0ZWRfYXQnLCB7IGFzY2VuZGluZzogdHJ1ZSB9KVxuXG4gICAgaWYgKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdEYXRhYmFzZSBlcnJvcjonLCBlcnJvcilcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IGVycm9yOiAnRmFpbGVkIHRvIGZldGNoIG1lc3NhZ2VzJyB9LCB7IHN0YXR1czogNTAwIH0pXG4gICAgfVxuXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgbWVzc2FnZXMgfSlcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdBUEkgZXJyb3I6JywgZXJyb3IpXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgZXJyb3I6ICdJbnRlcm5hbCBzZXJ2ZXIgZXJyb3InIH0sIHsgc3RhdHVzOiA1MDAgfSlcbiAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gUE9TVChcbiAgcmVxdWVzdDogTmV4dFJlcXVlc3QsXG4gIHsgcGFyYW1zIH06IHsgcGFyYW1zOiBQcm9taXNlPHsgaWQ6IHN0cmluZyB9PiB9XG4pIHtcbiAgLy8gQXBwbHkgc3RhbmRhcmQgQVBJIG1pZGRsZXdhcmUgKHRlbmFudCB2YWxpZGF0aW9uICsgc3RyaWN0IHJhdGUgbGltaXRpbmcpXG4gIGNvbnN0IG1pZGRsZXdhcmVSZXNwb25zZSA9IGF3YWl0IHN0YW5kYXJkQXBpTWlkZGxld2FyZShyZXF1ZXN0KTtcbiAgaWYgKG1pZGRsZXdhcmVSZXNwb25zZSkgcmV0dXJuIG1pZGRsZXdhcmVSZXNwb25zZTtcblxuICB0cnkge1xuICAgIC8vIEdldCB0ZW5hbnQgY29udGV4dCBmcm9tIG1pZGRsZXdhcmUgKGFscmVhZHkgdmFsaWRhdGVkKVxuICAgIGNvbnN0IHsgb3JnYW5pemF0aW9uSWQsIHVzZXJJZCB9ID0gZ2V0VGVuYW50Q29udGV4dChyZXF1ZXN0KTtcbiAgICBjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xuICAgIGNvbnN0IHsgaWQ6IGNvbnZlcnNhdGlvbklkIH0gPSBhd2FpdCBwYXJhbXM7XG5cbiAgICBjb25zdCBib2R5ID0gYXdhaXQgcmVxdWVzdC5qc29uKClcbiAgICBjb25zdCB7IGNvbnRlbnQsIHR5cGUgPSAndGV4dCcgfSA9IGJvZHlcblxuICAgIGlmICghY29udGVudCkge1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgZXJyb3I6ICdDb250ZW50IGlzIHJlcXVpcmVkJyB9LCB7IHN0YXR1czogNDAwIH0pXG4gICAgfVxuXG4gICAgLy8gVmVyaWZ5IGNvbnZlcnNhdGlvbiBiZWxvbmdzIHRvIHVzZXIncyBvcmdhbml6YXRpb25cbiAgICBjb25zdCB7IGRhdGE6IGNvbnZlcnNhdGlvbiB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAgIC5mcm9tKCdjb252ZXJzYXRpb25zJylcbiAgICAgIC5zZWxlY3QoJyonKVxuICAgICAgLmVxKCdpZCcsIGNvbnZlcnNhdGlvbklkKVxuICAgICAgLmVxKCdvcmdhbml6YXRpb25faWQnLCBvcmdhbml6YXRpb25JZClcbiAgICAgIC5zaW5nbGUoKTtcblxuICAgIGlmICghY29udmVyc2F0aW9uKSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBlcnJvcjogJ0NvbnZlcnNhdGlvbiBub3QgZm91bmQnIH0sIHsgc3RhdHVzOiA0MDQgfSlcbiAgICB9XG5cbiAgICAvLyBTZW5kIG1lc3NhZ2UgdmlhIFdoYXRzQXBwXG4gICAgY29uc3Qgd2hhdHNhcHBTZXJ2aWNlID0gYXdhaXQgV2hhdHNBcHBTZXJ2aWNlLmNyZWF0ZUZyb21Pcmdhbml6YXRpb24ob3JnYW5pemF0aW9uSWQpXG4gICAgY29uc3QgbWVzc2FnZSA9IGF3YWl0IHdoYXRzYXBwU2VydmljZS5zZW5kTWVzc2FnZShcbiAgICAgIGNvbnZlcnNhdGlvbklkLFxuICAgICAgY29udGVudCxcbiAgICAgIHVzZXJJZCxcbiAgICAgIHR5cGVcbiAgICApXG5cbiAgICAvLyBSZXR1cm4gdGhlIGNyZWF0ZWQgbWVzc2FnZVxuICAgIGNvbnN0IHsgZGF0YTogbWVzc2FnZVdpdGhTZW5kZXIgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgICAuZnJvbSgnbWVzc2FnZXMnKVxuICAgICAgLnNlbGVjdCgnKiwgc2VuZGVyOnByb2ZpbGVzKGZ1bGxfbmFtZSwgYXZhdGFyX3VybCknKVxuICAgICAgLmVxKCdpZCcsIG1lc3NhZ2UuaWQpXG4gICAgICAuc2luZ2xlKClcblxuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IG1lc3NhZ2U6IG1lc3NhZ2VXaXRoU2VuZGVyIH0sIHsgc3RhdHVzOiAyMDEgfSlcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdBUEkgZXJyb3I6JywgZXJyb3IpXG5cbiAgICBpZiAoZXJyb3IgaW5zdGFuY2VvZiBFcnJvciAmJiBlcnJvci5tZXNzYWdlLmluY2x1ZGVzKCdXaGF0c0FwcCcpKSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBlcnJvcjogZXJyb3IubWVzc2FnZSB9LCB7IHN0YXR1czogNDAwIH0pXG4gICAgfVxuXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgZXJyb3I6ICdJbnRlcm5hbCBzZXJ2ZXIgZXJyb3InIH0sIHsgc3RhdHVzOiA1MDAgfSlcbiAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gUEFUQ0goXG4gIHJlcXVlc3Q6IE5leHRSZXF1ZXN0LFxuICB7IHBhcmFtcyB9OiB7IHBhcmFtczogUHJvbWlzZTx7IGlkOiBzdHJpbmcgfT4gfVxuKSB7XG4gIC8vIEFwcGx5IHN0YW5kYXJkIEFQSSBtaWRkbGV3YXJlICh0ZW5hbnQgdmFsaWRhdGlvbiArIHN0YW5kYXJkIHJhdGUgbGltaXRpbmcpXG4gIGNvbnN0IG1pZGRsZXdhcmVSZXNwb25zZSA9IGF3YWl0IHN0YW5kYXJkQXBpTWlkZGxld2FyZShyZXF1ZXN0KTtcbiAgaWYgKG1pZGRsZXdhcmVSZXNwb25zZSkgcmV0dXJuIG1pZGRsZXdhcmVSZXNwb25zZTtcblxuICB0cnkge1xuICAgIC8vIEdldCB0ZW5hbnQgY29udGV4dCBmcm9tIG1pZGRsZXdhcmUgKGFscmVhZHkgdmFsaWRhdGVkKVxuICAgIGNvbnN0IHsgb3JnYW5pemF0aW9uSWQgfSA9IGdldFRlbmFudENvbnRleHQocmVxdWVzdCk7XG4gICAgY29uc3Qgc3VwYWJhc2UgPSBhd2FpdCBjcmVhdGVDbGllbnQoKTtcbiAgICBjb25zdCB7IGlkOiBjb252ZXJzYXRpb25JZCB9ID0gYXdhaXQgcGFyYW1zO1xuXG4gICAgY29uc3QgYm9keSA9IGF3YWl0IHJlcXVlc3QuanNvbigpXG4gICAgY29uc3QgeyBhY3Rpb24sIG1lc3NhZ2VJZCB9ID0gYm9keVxuXG4gICAgaWYgKGFjdGlvbiAhPT0gJ21hcmtfcmVhZCcgfHwgIW1lc3NhZ2VJZCkge1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgZXJyb3I6ICdJbnZhbGlkIGFjdGlvbiBvciBtaXNzaW5nIG1lc3NhZ2VJZCcgfSwgeyBzdGF0dXM6IDQwMCB9KVxuICAgIH1cblxuICAgIC8vIFZlcmlmeSBjb252ZXJzYXRpb24gYmVsb25ncyB0byB1c2VyJ3Mgb3JnYW5pemF0aW9uXG4gICAgY29uc3QgeyBkYXRhOiBjb252ZXJzYXRpb24gfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgICAuZnJvbSgnY29udmVyc2F0aW9ucycpXG4gICAgICAuc2VsZWN0KCcqJylcbiAgICAgIC5lcSgnaWQnLCBjb252ZXJzYXRpb25JZClcbiAgICAgIC5lcSgnb3JnYW5pemF0aW9uX2lkJywgb3JnYW5pemF0aW9uSWQpXG4gICAgICAuc2luZ2xlKCk7XG5cbiAgICBpZiAoIWNvbnZlcnNhdGlvbikge1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgZXJyb3I6ICdDb252ZXJzYXRpb24gbm90IGZvdW5kJyB9LCB7IHN0YXR1czogNDA0IH0pXG4gICAgfVxuXG4gICAgLy8gTWFyayBtZXNzYWdlIGFzIHJlYWQgdmlhIFdoYXRzQXBwXG4gICAgY29uc3Qgd2hhdHNhcHBTZXJ2aWNlID0gYXdhaXQgV2hhdHNBcHBTZXJ2aWNlLmNyZWF0ZUZyb21Pcmdhbml6YXRpb24ob3JnYW5pemF0aW9uSWQpXG4gICAgYXdhaXQgd2hhdHNhcHBTZXJ2aWNlLm1hcmtNZXNzYWdlQXNSZWFkKG1lc3NhZ2VJZClcblxuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IHN1Y2Nlc3M6IHRydWUgfSlcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdBUEkgZXJyb3I6JywgZXJyb3IpXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgZXJyb3I6ICdJbnRlcm5hbCBzZXJ2ZXIgZXJyb3InIH0sIHsgc3RhdHVzOiA1MDAgfSlcbiAgfVxufSJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7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