{"version":3,"names":["BillingDashboard","organization","profile","usage","plans","cov_gha84t1m","f","isLoading","setIsLoading","s","_react","useState","addToast","_toast","useToast","handleUpgrade","planId","response","fetch","method","headers","body","JSON","stringify","ok","b","url","json","window","location","href","error","Error","console","type","title","message","handleManageBilling","currentPlan","subscription_tier","starter","isActive","subscription_status","isPastDue","isCancelled","_jsxruntime","jsxs","className","jsx","name","description","price","interval","stripe_customer_id","onClick","disabled","viewBox","fill","fillRule","d","clipRule","_usagemetrics","UsageMetrics","plan","_pricingplans","PricingPlans","onUpgrade","_billinghistory","BillingHistory","organizationId","id"],"sources":["C:\\Ai Projecten\\ADSapp\\src\\components\\billing\\billing-dashboard.tsx"],"sourcesContent":["'use client'\n\nimport { useState } from 'react'\nimport { PricingPlans } from './pricing-plans'\nimport { UsageMetrics } from './usage-metrics'\nimport { BillingHistory } from './billing-history'\nimport { useToast } from '@/components/ui/toast'\nimport type { Organization, Profile } from '@/types'\n\ninterface BillingDashboardProps {\n  organization: Organization\n  profile: Profile\n  usage: any\n  plans: any\n}\n\nexport function BillingDashboard({ organization, profile, usage, plans }: BillingDashboardProps) {\n  const [isLoading, setIsLoading] = useState(false)\n  const { addToast } = useToast()\n\n  const handleUpgrade = async (planId: string) => {\n    setIsLoading(true)\n    try {\n      const response = await fetch('/api/billing/checkout', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({ planId }),\n      })\n\n      if (response.ok) {\n        const { url } = await response.json()\n        window.location.href = url\n      } else {\n        const error = await response.json()\n        throw new Error(error.error || 'Failed to create checkout session')\n      }\n    } catch (error) {\n      console.error('Upgrade error:', error)\n      addToast({\n        type: 'error',\n        title: 'Upgrade Failed',\n        message: 'Unable to process upgrade. Please try again.'\n      })\n    } finally {\n      setIsLoading(false)\n    }\n  }\n\n  const handleManageBilling = async () => {\n    setIsLoading(true)\n    try {\n      const response = await fetch('/api/billing/portal', {\n        method: 'POST',\n      })\n\n      if (response.ok) {\n        const { url } = await response.json()\n        window.location.href = url\n      } else {\n        const error = await response.json()\n        throw new Error(error.error || 'Failed to access billing portal')\n      }\n    } catch (error) {\n      console.error('Portal error:', error)\n      addToast({\n        type: 'error',\n        title: 'Portal Access Failed',\n        message: 'Unable to access billing portal. Please try again.'\n      })\n    } finally {\n      setIsLoading(false)\n    }\n  }\n\n  const currentPlan = plans[organization.subscription_tier] || plans.starter\n  const isActive = organization.subscription_status === 'active'\n  const isPastDue = organization.subscription_status === 'past_due'\n  const isCancelled = organization.subscription_status === 'cancelled'\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Current Subscription Status */}\n      <div className=\"bg-white shadow rounded-lg\">\n        <div className=\"px-6 py-4 border-b border-gray-200\">\n          <h2 className=\"text-lg font-medium text-gray-900\">Current Subscription</h2>\n        </div>\n        <div className=\"p-6\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <h3 className=\"text-xl font-semibold text-gray-900\">{currentPlan.name}</h3>\n              <p className=\"text-gray-600\">{currentPlan.description}</p>\n              <p className=\"text-2xl font-bold text-gray-900 mt-2\">\n                ${currentPlan.price}\n                <span className=\"text-sm text-gray-500 font-normal\">/{currentPlan.interval}</span>\n              </p>\n            </div>\n            <div className=\"text-right\">\n              <span\n                className={`inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ${\n                  isActive\n                    ? 'bg-green-100 text-green-800'\n                    : isPastDue\n                    ? 'bg-yellow-100 text-yellow-800'\n                    : isCancelled\n                    ? 'bg-red-100 text-red-800'\n                    : 'bg-gray-100 text-gray-800'\n                }`}\n              >\n                {organization.subscription_status || 'trial'}\n              </span>\n              {organization.stripe_customer_id && (\n                <button\n                  onClick={handleManageBilling}\n                  disabled={isLoading}\n                  className=\"mt-4 px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-green-500 disabled:opacity-50\"\n                >\n                  {isLoading ? 'Loading...' : 'Manage Billing'}\n                </button>\n              )}\n            </div>\n          </div>\n\n          {isPastDue && (\n            <div className=\"mt-4 p-4 bg-yellow-50 border border-yellow-200 rounded-md\">\n              <div className=\"flex\">\n                <div className=\"flex-shrink-0\">\n                  <svg className=\"h-5 w-5 text-yellow-400\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n                    <path fillRule=\"evenodd\" d=\"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z\" clipRule=\"evenodd\" />\n                  </svg>\n                </div>\n                <div className=\"ml-3\">\n                  <h3 className=\"text-sm font-medium text-yellow-800\">Payment Issue</h3>\n                  <p className=\"mt-1 text-sm text-yellow-700\">\n                    Your payment method failed. Please update your billing information to continue using the service.\n                  </p>\n                </div>\n              </div>\n            </div>\n          )}\n        </div>\n      </div>\n\n      {/* Usage Metrics */}\n      {usage && <UsageMetrics usage={usage} plan={currentPlan} />}\n\n      {/* Pricing Plans */}\n      <PricingPlans\n        plans={plans}\n        currentPlan={organization.subscription_tier}\n        onUpgrade={handleUpgrade}\n        isLoading={isLoading}\n      />\n\n      {/* Billing History */}\n      <BillingHistory organizationId={organization.id} />\n    </div>\n  )\n}"],"mappings":"AAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;+BAgBgB;;;;;;WAAAA,gBAAA;;;;;;;;gCAdS;;;gCACI;;;gCACA;;;gCACE;;;gCACN;AAUlB,SAASA,iBAAiB;EAAEC,YAAY;EAAEC,OAAO;EAAEC,KAAK;EAAEC;AAAK,CAAyB;EAAA;EAAAC,YAAA,GAAAC,CAAA;EAC7F,MAAM,CAACC,SAAA,EAAWC,YAAA,CAAa;EAAA;EAAA,CAAAH,YAAA,GAAAI,CAAA,OAAG,IAAAC,MAAA,CAAAC,QAAQ,EAAC;EAC3C,MAAM;IAAEC;EAAQ,CAAE;EAAA;EAAA,CAAAP,YAAA,GAAAI,CAAA,QAAG,IAAAI,MAAA,CAAAC,QAAQ;EAAA;EAAAT,YAAA,GAAAI,CAAA;EAE7B,MAAMM,aAAA,GAAgB,MAAOC,MAAA;IAAA;IAAAX,YAAA,GAAAC,CAAA;IAAAD,YAAA,GAAAI,CAAA;IAC3BD,YAAA,CAAa;IAAA;IAAAH,YAAA,GAAAI,CAAA;IACb,IAAI;MACF,MAAMQ,QAAA;MAAA;MAAA,CAAAZ,YAAA,GAAAI,CAAA,QAAW,MAAMS,KAAA,CAAM,yBAAyB;QACpDC,MAAA,EAAQ;QACRC,OAAA,EAAS;UACP,gBAAgB;QAClB;QACAC,IAAA,EAAMC,IAAA,CAAKC,SAAS,CAAC;UAAEP;QAAO;MAChC;MAAA;MAAAX,YAAA,GAAAI,CAAA;MAEA,IAAIQ,QAAA,CAASO,EAAE,EAAE;QAAA;QAAAnB,YAAA,GAAAoB,CAAA;QACf,MAAM;UAAEC;QAAG,CAAE;QAAA;QAAA,CAAArB,YAAA,GAAAI,CAAA,QAAG,MAAMQ,QAAA,CAASU,IAAI;QAAA;QAAAtB,YAAA,GAAAI,CAAA;QACnCmB,MAAA,CAAOC,QAAQ,CAACC,IAAI,GAAGJ,GAAA;MACzB,OAAO;QAAA;QAAArB,YAAA,GAAAoB,CAAA;QACL,MAAMM,KAAA;QAAA;QAAA,CAAA1B,YAAA,GAAAI,CAAA,QAAQ,MAAMQ,QAAA,CAASU,IAAI;QAAA;QAAAtB,YAAA,GAAAI,CAAA;QACjC,MAAM,IAAIuB,KAAA;QAAM;QAAA,CAAA3B,YAAA,GAAAoB,CAAA,UAAAM,KAAA,CAAMA,KAAK;QAAA;QAAA,CAAA1B,YAAA,GAAAoB,CAAA,UAAI;MACjC;IACF,EAAE,OAAOM,KAAA,EAAO;MAAA;MAAA1B,YAAA,GAAAI,CAAA;MACdwB,OAAA,CAAQF,KAAK,CAAC,kBAAkBA,KAAA;MAAA;MAAA1B,YAAA,GAAAI,CAAA;MAChCG,QAAA,CAAS;QACPsB,IAAA,EAAM;QACNC,KAAA,EAAO;QACPC,OAAA,EAAS;MACX;IACF,UAAU;MAAA;MAAA/B,YAAA,GAAAI,CAAA;MACRD,YAAA,CAAa;IACf;EACF;EAAA;EAAAH,YAAA,GAAAI,CAAA;EAEA,MAAM4B,mBAAA,GAAsB,MAAAA,CAAA;IAAA;IAAAhC,YAAA,GAAAC,CAAA;IAAAD,YAAA,GAAAI,CAAA;IAC1BD,YAAA,CAAa;IAAA;IAAAH,YAAA,GAAAI,CAAA;IACb,IAAI;MACF,MAAMQ,QAAA;MAAA;MAAA,CAAAZ,YAAA,GAAAI,CAAA,QAAW,MAAMS,KAAA,CAAM,uBAAuB;QAClDC,MAAA,EAAQ;MACV;MAAA;MAAAd,YAAA,GAAAI,CAAA;MAEA,IAAIQ,QAAA,CAASO,EAAE,EAAE;QAAA;QAAAnB,YAAA,GAAAoB,CAAA;QACf,MAAM;UAAEC;QAAG,CAAE;QAAA;QAAA,CAAArB,YAAA,GAAAI,CAAA,QAAG,MAAMQ,QAAA,CAASU,IAAI;QAAA;QAAAtB,YAAA,GAAAI,CAAA;QACnCmB,MAAA,CAAOC,QAAQ,CAACC,IAAI,GAAGJ,GAAA;MACzB,OAAO;QAAA;QAAArB,YAAA,GAAAoB,CAAA;QACL,MAAMM,KAAA;QAAA;QAAA,CAAA1B,YAAA,GAAAI,CAAA,QAAQ,MAAMQ,QAAA,CAASU,IAAI;QAAA;QAAAtB,YAAA,GAAAI,CAAA;QACjC,MAAM,IAAIuB,KAAA;QAAM;QAAA,CAAA3B,YAAA,GAAAoB,CAAA,UAAAM,KAAA,CAAMA,KAAK;QAAA;QAAA,CAAA1B,YAAA,GAAAoB,CAAA,UAAI;MACjC;IACF,EAAE,OAAOM,KAAA,EAAO;MAAA;MAAA1B,YAAA,GAAAI,CAAA;MACdwB,OAAA,CAAQF,KAAK,CAAC,iBAAiBA,KAAA;MAAA;MAAA1B,YAAA,GAAAI,CAAA;MAC/BG,QAAA,CAAS;QACPsB,IAAA,EAAM;QACNC,KAAA,EAAO;QACPC,OAAA,EAAS;MACX;IACF,UAAU;MAAA;MAAA/B,YAAA,GAAAI,CAAA;MACRD,YAAA,CAAa;IACf;EACF;EAEA,MAAM8B,WAAA;EAAA;EAAA,CAAAjC,YAAA,GAAAI,CAAA;EAAc;EAAA,CAAAJ,YAAA,GAAAoB,CAAA,UAAArB,KAAK,CAACH,YAAA,CAAasC,iBAAiB,CAAC;EAAA;EAAA,CAAAlC,YAAA,GAAAoB,CAAA,UAAIrB,KAAA,CAAMoC,OAAO;EAC1E,MAAMC,QAAA;EAAA;EAAA,CAAApC,YAAA,GAAAI,CAAA,QAAWR,YAAA,CAAayC,mBAAmB,KAAK;EACtD,MAAMC,SAAA;EAAA;EAAA,CAAAtC,YAAA,GAAAI,CAAA,QAAYR,YAAA,CAAayC,mBAAmB,KAAK;EACvD,MAAME,WAAA;EAAA;EAAA,CAAAvC,YAAA,GAAAI,CAAA,QAAcR,YAAA,CAAayC,mBAAmB,KAAK;EAAA;EAAArC,YAAA,GAAAI,CAAA;EAEzD,oBACE,IAAAoC,WAAA,CAAAC,IAAA,EAAC;IAAIC,SAAA,EAAU;4BAEb,IAAAF,WAAA,CAAAC,IAAA,EAAC;MAAIC,SAAA,EAAU;8BACb,IAAAF,WAAA,CAAAG,GAAA,EAAC;QAAID,SAAA,EAAU;kBACb,iBAAAF,WAAA,CAAAG,GAAA,EAAC;UAAGD,SAAA,EAAU;oBAAoC;;uBAEpD,IAAAF,WAAA,CAAAC,IAAA,EAAC;QAAIC,SAAA,EAAU;gCACb,IAAAF,WAAA,CAAAC,IAAA,EAAC;UAAIC,SAAA,EAAU;kCACb,IAAAF,WAAA,CAAAC,IAAA,EAAC;oCACC,IAAAD,WAAA,CAAAG,GAAA,EAAC;cAAGD,SAAA,EAAU;wBAAuCT,WAAA,CAAYW;6BACjE,IAAAJ,WAAA,CAAAG,GAAA,EAAC;cAAED,SAAA,EAAU;wBAAiBT,WAAA,CAAYY;6BAC1C,IAAAL,WAAA,CAAAC,IAAA,EAAC;cAAEC,SAAA,EAAU;yBAAwC,KACjDT,WAAA,CAAYa,KAAK,E,aACnB,IAAAN,WAAA,CAAAC,IAAA,EAAC;gBAAKC,SAAA,EAAU;2BAAoC,KAAET,WAAA,CAAYc,QAAQ;;;2BAG9E,IAAAP,WAAA,CAAAC,IAAA,EAAC;YAAIC,SAAA,EAAU;oCACb,IAAAF,WAAA,CAAAG,GAAA,EAAC;cACCD,SAAA,EAAW,uEACTN,QAAA;cAAA;cAAA,CAAApC,YAAA,GAAAoB,CAAA,UACI;cAAA;cAAA,CAAApB,YAAA,GAAAoB,CAAA,UACAkB,SAAA;cAAA;cAAA,CAAAtC,YAAA,GAAAoB,CAAA,UACA;cAAA;cAAA,CAAApB,YAAA,GAAAoB,CAAA,UACAmB,WAAA;cAAA;cAAA,CAAAvC,YAAA,GAAAoB,CAAA,UACA;cAAA;cAAA,CAAApB,YAAA,GAAAoB,CAAA,UACA,gCACJ;;cAED;cAAA,CAAApB,YAAA,GAAAoB,CAAA,UAAAxB,YAAA,CAAayC,mBAAmB;cAAA;cAAA,CAAArC,YAAA,GAAAoB,CAAA,UAAI;;YAEtC;YAAA,CAAApB,YAAA,GAAAoB,CAAA,UAAAxB,YAAA,CAAaoD,kBAAkB;YAAA;YAAA,CAAAhD,YAAA,GAAAoB,CAAA,uBAC9B,IAAAoB,WAAA,CAAAG,GAAA,EAAC;cACCM,OAAA,EAASjB,mBAAA;cACTkB,QAAA,EAAUhD,SAAA;cACVwC,SAAA,EAAU;wBAETxC,SAAA;cAAA;cAAA,CAAAF,YAAA,GAAAoB,CAAA,WAAY;cAAA;cAAA,CAAApB,YAAA,GAAAoB,CAAA,WAAe;;;;QAMnC;QAAA,CAAApB,YAAA,GAAAoB,CAAA,WAAAkB,SAAA;QAAA;QAAA,CAAAtC,YAAA,GAAAoB,CAAA,wBACC,IAAAoB,WAAA,CAAAG,GAAA,EAAC;UAAID,SAAA,EAAU;oBACb,iBAAAF,WAAA,CAAAC,IAAA,EAAC;YAAIC,SAAA,EAAU;oCACb,IAAAF,WAAA,CAAAG,GAAA,EAAC;cAAID,SAAA,EAAU;wBACb,iBAAAF,WAAA,CAAAG,GAAA,EAAC;gBAAID,SAAA,EAAU;gBAA0BS,OAAA,EAAQ;gBAAYC,IAAA,EAAK;0BAChE,iBAAAZ,WAAA,CAAAG,GAAA,EAAC;kBAAKU,QAAA,EAAS;kBAAUC,CAAA,EAAE;kBAAoNC,QAAA,EAAS;;;6BAG5P,IAAAf,WAAA,CAAAC,IAAA,EAAC;cAAIC,SAAA,EAAU;sCACb,IAAAF,WAAA,CAAAG,GAAA,EAAC;gBAAGD,SAAA,EAAU;0BAAsC;+BACpD,IAAAF,WAAA,CAAAG,GAAA,EAAC;gBAAED,SAAA,EAAU;0BAA+B;;;;;;;IAWvD;IAAA,CAAA1C,YAAA,GAAAoB,CAAA,WAAAtB,KAAA;IAAA;IAAA,CAAAE,YAAA,GAAAoB,CAAA,wBAAS,IAAAoB,WAAA,CAAAG,GAAA,EAACa,aAAA,CAAAC,YAAY;MAAC3D,KAAA,EAAOA,KAAA;MAAO4D,IAAA,EAAMzB;sBAG5C,IAAAO,WAAA,CAAAG,GAAA,EAACgB,aAAA,CAAAC,YAAY;MACX7D,KAAA,EAAOA,KAAA;MACPkC,WAAA,EAAarC,YAAA,CAAasC,iBAAiB;MAC3C2B,SAAA,EAAWnD,aAAA;MACXR,SAAA,EAAWA;qBAIb,IAAAsC,WAAA,CAAAG,GAAA,EAACmB,eAAA,CAAAC,cAAc;MAACC,cAAA,EAAgBpE,YAAA,CAAaqE;;;AAGnD","ignoreList":[]}