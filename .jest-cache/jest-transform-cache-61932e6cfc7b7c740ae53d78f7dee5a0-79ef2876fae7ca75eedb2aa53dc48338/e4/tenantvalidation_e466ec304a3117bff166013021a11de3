6fc350cb42bb48283bb60a32e370bd42
"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
function _export(target, all) {
    for(var name in all)Object.defineProperty(target, name, {
        enumerable: true,
        get: Object.getOwnPropertyDescriptor(all, name).get
    });
}
_export(exports, {
    get createTenantScope () {
        return createTenantScope;
    },
    get getTenantContext () {
        return getTenantContext;
    },
    get isSuperAdmin () {
        return isSuperAdmin;
    },
    get validateResourceAccess () {
        return validateResourceAccess;
    },
    get validateTenantAccess () {
        return validateTenantAccess;
    }
});
const _server = require("next/server");
const _server1 = require("../supabase/server");
const _apiutils = require("../api-utils");
function _getRequireWildcardCache(nodeInterop) {
    if (typeof WeakMap !== "function") return null;
    var cacheBabelInterop = new WeakMap();
    var cacheNodeInterop = new WeakMap();
    return (_getRequireWildcardCache = function(nodeInterop) {
        return nodeInterop ? cacheNodeInterop : cacheBabelInterop;
    })(nodeInterop);
}
function _interop_require_wildcard(obj, nodeInterop) {
    if (!nodeInterop && obj && obj.__esModule) {
        return obj;
    }
    if (obj === null || typeof obj !== "object" && typeof obj !== "function") {
        return {
            default: obj
        };
    }
    var cache = _getRequireWildcardCache(nodeInterop);
    if (cache && cache.has(obj)) {
        return cache.get(obj);
    }
    var newObj = {
        __proto__: null
    };
    var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor;
    for(var key in obj){
        if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) {
            var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null;
            if (desc && (desc.get || desc.set)) {
                Object.defineProperty(newObj, key, desc);
            } else {
                newObj[key] = obj[key];
            }
        }
    }
    newObj.default = obj;
    if (cache) {
        cache.set(obj, newObj);
    }
    return newObj;
}
async function validateTenantAccess(request) {
    try {
        const supabase = await (0, _server1.createClient)();
        // 1. Verify user authentication
        const { data: { user }, error: authError } = await supabase.auth.getUser();
        if (authError || !user) {
            return _server.NextResponse.json({
                error: 'Authentication required',
                code: 'UNAUTHORIZED'
            }, {
                status: 401
            });
        }
        // 2. Get user's organization and profile
        const userOrg = await (0, _apiutils.getUserOrganization)(user.id);
        if (!userOrg || !userOrg.organization_id) {
            // Check if user is super admin - they don't need organization
            const { data: profile } = await supabase.from('profiles').select('is_super_admin, role').eq('id', user.id).single();
            if (profile?.is_super_admin) {
                // Super admins bypass organization requirements
                const requestHeaders = new Headers(request.headers);
                requestHeaders.set('x-user-id', user.id);
                requestHeaders.set('x-user-role', 'super_admin');
                requestHeaders.set('x-is-super-admin', 'true');
                requestHeaders.set('x-user-email', user.email || '');
                return _server.NextResponse.next({
                    request: {
                        headers: requestHeaders
                    }
                });
            }
            return _server.NextResponse.json({
                error: 'User not associated with any organization',
                code: 'NO_ORGANIZATION'
            }, {
                status: 403
            });
        }
        // 3. Validate tenant context from request
        // Check for organization ID in headers or query parameters
        const requestedOrgId = request.headers.get('x-organization-id') || request.nextUrl.searchParams.get('organization_id');
        // 4. Cross-tenant access prevention
        if (requestedOrgId && requestedOrgId !== userOrg.organization_id) {
            // Log cross-tenant access attempt for security monitoring
            const securityEvent = {
                userId: user.id,
                userOrg: userOrg.organization_id,
                requestedOrg: requestedOrgId,
                path: request.nextUrl.pathname,
                method: request.method,
                timestamp: new Date().toISOString(),
                ip: getClientIp(request),
                userAgent: request.headers.get('user-agent') || 'unknown'
            };
            // Log to console (in production, send to security monitoring service)
            console.warn('[SECURITY] Cross-tenant access attempt:', securityEvent);
            // Send to Sentry for alerting
            if (process.env.NODE_ENV === 'production') {
                try {
                    const Sentry = await Promise.resolve().then(()=>/*#__PURE__*/ _interop_require_wildcard(require("@sentry/nextjs")));
                    Sentry.captureMessage('Cross-tenant access attempt', {
                        level: 'warning',
                        extra: {
                            userId: securityEvent.userId,
                            userOrg: securityEvent.userOrg,
                            requestedOrg: securityEvent.requestedOrg,
                            path: securityEvent.path,
                            method: securityEvent.method,
                            timestamp: securityEvent.timestamp,
                            ip: securityEvent.ip,
                            userAgent: securityEvent.userAgent
                        }
                    });
                } catch (error) {
                    console.error('Failed to log security event to Sentry:', error);
                }
            }
            return _server.NextResponse.json({
                error: 'Forbidden: Access to this organization denied',
                code: 'FORBIDDEN'
            }, {
                status: 403
            });
        }
        // 5. Attach tenant context to request headers for downstream use
        const requestHeaders = new Headers(request.headers);
        requestHeaders.set('x-user-id', user.id);
        requestHeaders.set('x-organization-id', userOrg.organization_id);
        // Type guard for organization role
        const orgRole = userOrg.organization && typeof userOrg.organization === 'object' && 'role' in userOrg.organization ? String(userOrg.organization.role) : 'agent';
        requestHeaders.set('x-user-role', orgRole);
        requestHeaders.set('x-user-email', user.email || '');
        requestHeaders.set('x-is-super-admin', 'false');
        // Return modified request with tenant context
        return _server.NextResponse.next({
            request: {
                headers: requestHeaders
            }
        });
    } catch (error) {
        console.error('[TENANT_VALIDATION] Error:', error);
        // Log error to monitoring service
        if (process.env.NODE_ENV === 'production') {
            try {
                const Sentry = await Promise.resolve().then(()=>/*#__PURE__*/ _interop_require_wildcard(require("@sentry/nextjs")));
                Sentry.captureException(error, {
                    tags: {
                        middleware: 'tenant-validation'
                    }
                });
            } catch (sentryError) {
                console.error('Failed to log error to Sentry:', sentryError);
            }
        }
        // Return 500 error for unexpected failures
        return _server.NextResponse.json({
            error: 'Internal server error during tenant validation',
            code: 'INTERNAL_ERROR'
        }, {
            status: 500
        });
    }
}
function getTenantContext(request) {
    return {
        userId: request.headers.get('x-user-id') || '',
        organizationId: request.headers.get('x-organization-id') || '',
        userRole: request.headers.get('x-user-role') || 'agent',
        userEmail: request.headers.get('x-user-email') || ''
    };
}
function isSuperAdmin(request) {
    return request.headers.get('x-is-super-admin') === 'true';
}
function validateResourceAccess(resourceOrgId, tenantContext) {
    // Super admins can access all resources
    if (!tenantContext.organizationId && tenantContext.userRole === 'super_admin') {
        return true;
    }
    // Regular users can only access resources in their organization
    return resourceOrgId === tenantContext.organizationId;
}
/**
 * Helper function to get client IP address
 * Handles various proxy headers (Vercel, Cloudflare, etc.)
 *
 * @param request - NextRequest object
 * @returns Client IP address or 'unknown'
 */ function getClientIp(request) {
    const forwarded = request.headers.get('x-forwarded-for');
    const realIp = request.headers.get('x-real-ip');
    const cfConnectingIp = request.headers.get('cf-connecting-ip');
    const vercelIp = request.headers.get('x-vercel-forwarded-for');
    return cfConnectingIp || vercelIp || forwarded?.split(',')[0].trim() || realIp || 'unknown';
}
function createTenantScope(organizationId) {
    return (query)=>query.eq('organization_id', organizationId);
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkM6XFxBaSBQcm9qZWN0ZW5cXEFEU2FwcFxcc3JjXFxsaWJcXG1pZGRsZXdhcmVcXHRlbmFudC12YWxpZGF0aW9uLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE5leHRSZXF1ZXN0LCBOZXh0UmVzcG9uc2UgfSBmcm9tICduZXh0L3NlcnZlcic7XG5pbXBvcnQgeyBjcmVhdGVDbGllbnQgfSBmcm9tICdAL2xpYi9zdXBhYmFzZS9zZXJ2ZXInO1xuaW1wb3J0IHsgZ2V0VXNlck9yZ2FuaXphdGlvbiB9IGZyb20gJ0AvbGliL2FwaS11dGlscyc7XG5cbi8qKlxuICogVGVuYW50IENvbnRleHQgVHlwZSBmb3IgQVBJIHJvdXRlc1xuICogQ29udGFpbnMgYXV0aGVudGljYXRlZCB1c2VyIGFuZCBvcmdhbml6YXRpb24gaW5mb3JtYXRpb25cbiAqL1xuZXhwb3J0IGludGVyZmFjZSBUZW5hbnRDb250ZXh0IHtcbiAgdXNlcklkOiBzdHJpbmc7XG4gIG9yZ2FuaXphdGlvbklkOiBzdHJpbmc7XG4gIHVzZXJSb2xlOiBzdHJpbmc7XG4gIHVzZXJFbWFpbDogc3RyaW5nO1xufVxuXG4vKipcbiAqIFNlY3VyaXR5IEV2ZW50IExvZyBmb3IgY3Jvc3MtdGVuYW50IGFjY2VzcyBhdHRlbXB0c1xuICovXG5pbnRlcmZhY2UgU2VjdXJpdHlFdmVudCB7XG4gIHVzZXJJZDogc3RyaW5nO1xuICB1c2VyT3JnOiBzdHJpbmc7XG4gIHJlcXVlc3RlZE9yZzogc3RyaW5nIHwgbnVsbDtcbiAgcGF0aDogc3RyaW5nO1xuICBtZXRob2Q6IHN0cmluZztcbiAgdGltZXN0YW1wOiBzdHJpbmc7XG4gIGlwOiBzdHJpbmc7XG4gIHVzZXJBZ2VudDogc3RyaW5nO1xufVxuXG4vKipcbiAqIFRlbmFudCBWYWxpZGF0aW9uIE1pZGRsZXdhcmVcbiAqIEVuc3VyZXMgYWxsIEFQSSByZXF1ZXN0cyBhcmUgc2NvcGVkIHRvIHRoZSBhdXRoZW50aWNhdGVkIHVzZXIncyBvcmdhbml6YXRpb25cbiAqXG4gKiBTZWN1cml0eSBGZWF0dXJlczpcbiAqIC0gVmFsaWRhdGVzIHVzZXIgYXV0aGVudGljYXRpb24gdmlhIFN1cGFiYXNlIEpXVFxuICogLSBWZXJpZmllcyB1c2VyLW9yZ2FuaXphdGlvbiByZWxhdGlvbnNoaXBcbiAqIC0gUHJldmVudHMgY3Jvc3MtdGVuYW50IGRhdGEgYWNjZXNzXG4gKiAtIExvZ3Mgc2VjdXJpdHkgZXZlbnRzIGZvciBtb25pdG9yaW5nXG4gKiAtIEF0dGFjaGVzIHRlbmFudCBjb250ZXh0IHRvIHJlcXVlc3QgaGVhZGVyc1xuICpcbiAqIFVzYWdlIGluIEFQSSByb3V0ZXM6XG4gKiBgYGB0eXBlc2NyaXB0XG4gKiBpbXBvcnQgeyB2YWxpZGF0ZVRlbmFudEFjY2VzcywgZ2V0VGVuYW50Q29udGV4dCB9IGZyb20gJ0AvbGliL21pZGRsZXdhcmUvdGVuYW50LXZhbGlkYXRpb24nO1xuICpcbiAqIGV4cG9ydCBhc3luYyBmdW5jdGlvbiBHRVQocmVxdWVzdDogTmV4dFJlcXVlc3QpIHtcbiAqICAgY29uc3QgdmFsaWRhdGlvbiA9IGF3YWl0IHZhbGlkYXRlVGVuYW50QWNjZXNzKHJlcXVlc3QpO1xuICogICBpZiAodmFsaWRhdGlvbikgcmV0dXJuIHZhbGlkYXRpb247IC8vIFJldHVybiBlcnJvciByZXNwb25zZSBpZiB2YWxpZGF0aW9uIGZhaWxzXG4gKlxuICogICBjb25zdCB7IG9yZ2FuaXphdGlvbklkLCB1c2VySWQgfSA9IGdldFRlbmFudENvbnRleHQocmVxdWVzdCk7XG4gKiAgIC8vIFVzZSBvcmdhbml6YXRpb25JZCB0byBzY29wZSBkYXRhYmFzZSBxdWVyaWVzXG4gKiB9XG4gKiBgYGBcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHZhbGlkYXRlVGVuYW50QWNjZXNzKHJlcXVlc3Q6IE5leHRSZXF1ZXN0KTogUHJvbWlzZTxOZXh0UmVzcG9uc2UgfCBudWxsPiB7XG4gIHRyeSB7XG4gICAgY29uc3Qgc3VwYWJhc2UgPSBhd2FpdCBjcmVhdGVDbGllbnQoKTtcblxuICAgIC8vIDEuIFZlcmlmeSB1c2VyIGF1dGhlbnRpY2F0aW9uXG4gICAgY29uc3QgeyBkYXRhOiB7IHVzZXIgfSwgZXJyb3I6IGF1dGhFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2UuYXV0aC5nZXRVc2VyKCk7XG5cbiAgICBpZiAoYXV0aEVycm9yIHx8ICF1c2VyKSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHtcbiAgICAgICAgICBlcnJvcjogJ0F1dGhlbnRpY2F0aW9uIHJlcXVpcmVkJyxcbiAgICAgICAgICBjb2RlOiAnVU5BVVRIT1JJWkVEJ1xuICAgICAgICB9LFxuICAgICAgICB7IHN0YXR1czogNDAxIH1cbiAgICAgICk7XG4gICAgfVxuXG4gICAgLy8gMi4gR2V0IHVzZXIncyBvcmdhbml6YXRpb24gYW5kIHByb2ZpbGVcbiAgICBjb25zdCB1c2VyT3JnID0gYXdhaXQgZ2V0VXNlck9yZ2FuaXphdGlvbih1c2VyLmlkKTtcblxuICAgIGlmICghdXNlck9yZyB8fCAhdXNlck9yZy5vcmdhbml6YXRpb25faWQpIHtcbiAgICAgIC8vIENoZWNrIGlmIHVzZXIgaXMgc3VwZXIgYWRtaW4gLSB0aGV5IGRvbid0IG5lZWQgb3JnYW5pemF0aW9uXG4gICAgICBjb25zdCB7IGRhdGE6IHByb2ZpbGUgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgICAgIC5mcm9tKCdwcm9maWxlcycpXG4gICAgICAgIC5zZWxlY3QoJ2lzX3N1cGVyX2FkbWluLCByb2xlJylcbiAgICAgICAgLmVxKCdpZCcsIHVzZXIuaWQpXG4gICAgICAgIC5zaW5nbGUoKTtcblxuICAgICAgaWYgKHByb2ZpbGU/LmlzX3N1cGVyX2FkbWluKSB7XG4gICAgICAgIC8vIFN1cGVyIGFkbWlucyBieXBhc3Mgb3JnYW5pemF0aW9uIHJlcXVpcmVtZW50c1xuICAgICAgICBjb25zdCByZXF1ZXN0SGVhZGVycyA9IG5ldyBIZWFkZXJzKHJlcXVlc3QuaGVhZGVycyk7XG4gICAgICAgIHJlcXVlc3RIZWFkZXJzLnNldCgneC11c2VyLWlkJywgdXNlci5pZCk7XG4gICAgICAgIHJlcXVlc3RIZWFkZXJzLnNldCgneC11c2VyLXJvbGUnLCAnc3VwZXJfYWRtaW4nKTtcbiAgICAgICAgcmVxdWVzdEhlYWRlcnMuc2V0KCd4LWlzLXN1cGVyLWFkbWluJywgJ3RydWUnKTtcbiAgICAgICAgcmVxdWVzdEhlYWRlcnMuc2V0KCd4LXVzZXItZW1haWwnLCB1c2VyLmVtYWlsIHx8ICcnKTtcblxuICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLm5leHQoe1xuICAgICAgICAgIHJlcXVlc3Q6IHsgaGVhZGVyczogcmVxdWVzdEhlYWRlcnMgfVxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICB7XG4gICAgICAgICAgZXJyb3I6ICdVc2VyIG5vdCBhc3NvY2lhdGVkIHdpdGggYW55IG9yZ2FuaXphdGlvbicsXG4gICAgICAgICAgY29kZTogJ05PX09SR0FOSVpBVElPTidcbiAgICAgICAgfSxcbiAgICAgICAgeyBzdGF0dXM6IDQwMyB9XG4gICAgICApO1xuICAgIH1cblxuICAgIC8vIDMuIFZhbGlkYXRlIHRlbmFudCBjb250ZXh0IGZyb20gcmVxdWVzdFxuICAgIC8vIENoZWNrIGZvciBvcmdhbml6YXRpb24gSUQgaW4gaGVhZGVycyBvciBxdWVyeSBwYXJhbWV0ZXJzXG4gICAgY29uc3QgcmVxdWVzdGVkT3JnSWQgPSByZXF1ZXN0LmhlYWRlcnMuZ2V0KCd4LW9yZ2FuaXphdGlvbi1pZCcpIHx8XG4gICAgICAgICAgICAgICAgICAgICAgICAgIHJlcXVlc3QubmV4dFVybC5zZWFyY2hQYXJhbXMuZ2V0KCdvcmdhbml6YXRpb25faWQnKTtcblxuICAgIC8vIDQuIENyb3NzLXRlbmFudCBhY2Nlc3MgcHJldmVudGlvblxuICAgIGlmIChyZXF1ZXN0ZWRPcmdJZCAmJiByZXF1ZXN0ZWRPcmdJZCAhPT0gdXNlck9yZy5vcmdhbml6YXRpb25faWQpIHtcbiAgICAgIC8vIExvZyBjcm9zcy10ZW5hbnQgYWNjZXNzIGF0dGVtcHQgZm9yIHNlY3VyaXR5IG1vbml0b3JpbmdcbiAgICAgIGNvbnN0IHNlY3VyaXR5RXZlbnQ6IFNlY3VyaXR5RXZlbnQgPSB7XG4gICAgICAgIHVzZXJJZDogdXNlci5pZCxcbiAgICAgICAgdXNlck9yZzogdXNlck9yZy5vcmdhbml6YXRpb25faWQsXG4gICAgICAgIHJlcXVlc3RlZE9yZzogcmVxdWVzdGVkT3JnSWQsXG4gICAgICAgIHBhdGg6IHJlcXVlc3QubmV4dFVybC5wYXRobmFtZSxcbiAgICAgICAgbWV0aG9kOiByZXF1ZXN0Lm1ldGhvZCxcbiAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgICAgIGlwOiBnZXRDbGllbnRJcChyZXF1ZXN0KSxcbiAgICAgICAgdXNlckFnZW50OiByZXF1ZXN0LmhlYWRlcnMuZ2V0KCd1c2VyLWFnZW50JykgfHwgJ3Vua25vd24nXG4gICAgICB9O1xuXG4gICAgICAvLyBMb2cgdG8gY29uc29sZSAoaW4gcHJvZHVjdGlvbiwgc2VuZCB0byBzZWN1cml0eSBtb25pdG9yaW5nIHNlcnZpY2UpXG4gICAgICBjb25zb2xlLndhcm4oJ1tTRUNVUklUWV0gQ3Jvc3MtdGVuYW50IGFjY2VzcyBhdHRlbXB0OicsIHNlY3VyaXR5RXZlbnQpO1xuXG4gICAgICAvLyBTZW5kIHRvIFNlbnRyeSBmb3IgYWxlcnRpbmdcbiAgICAgIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gJ3Byb2R1Y3Rpb24nKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgY29uc3QgU2VudHJ5ID0gYXdhaXQgaW1wb3J0KCdAc2VudHJ5L25leHRqcycpO1xuICAgICAgICAgIFNlbnRyeS5jYXB0dXJlTWVzc2FnZSgnQ3Jvc3MtdGVuYW50IGFjY2VzcyBhdHRlbXB0Jywge1xuICAgICAgICAgICAgbGV2ZWw6ICd3YXJuaW5nJyxcbiAgICAgICAgICAgIGV4dHJhOiB7XG4gICAgICAgICAgICAgIHVzZXJJZDogc2VjdXJpdHlFdmVudC51c2VySWQsXG4gICAgICAgICAgICAgIHVzZXJPcmc6IHNlY3VyaXR5RXZlbnQudXNlck9yZyxcbiAgICAgICAgICAgICAgcmVxdWVzdGVkT3JnOiBzZWN1cml0eUV2ZW50LnJlcXVlc3RlZE9yZyxcbiAgICAgICAgICAgICAgcGF0aDogc2VjdXJpdHlFdmVudC5wYXRoLFxuICAgICAgICAgICAgICBtZXRob2Q6IHNlY3VyaXR5RXZlbnQubWV0aG9kLFxuICAgICAgICAgICAgICB0aW1lc3RhbXA6IHNlY3VyaXR5RXZlbnQudGltZXN0YW1wLFxuICAgICAgICAgICAgICBpcDogc2VjdXJpdHlFdmVudC5pcCxcbiAgICAgICAgICAgICAgdXNlckFnZW50OiBzZWN1cml0eUV2ZW50LnVzZXJBZ2VudFxuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0ZhaWxlZCB0byBsb2cgc2VjdXJpdHkgZXZlbnQgdG8gU2VudHJ5OicsIGVycm9yKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHtcbiAgICAgICAgICBlcnJvcjogJ0ZvcmJpZGRlbjogQWNjZXNzIHRvIHRoaXMgb3JnYW5pemF0aW9uIGRlbmllZCcsXG4gICAgICAgICAgY29kZTogJ0ZPUkJJRERFTidcbiAgICAgICAgfSxcbiAgICAgICAgeyBzdGF0dXM6IDQwMyB9XG4gICAgICApO1xuICAgIH1cblxuICAgIC8vIDUuIEF0dGFjaCB0ZW5hbnQgY29udGV4dCB0byByZXF1ZXN0IGhlYWRlcnMgZm9yIGRvd25zdHJlYW0gdXNlXG4gICAgY29uc3QgcmVxdWVzdEhlYWRlcnMgPSBuZXcgSGVhZGVycyhyZXF1ZXN0LmhlYWRlcnMpO1xuICAgIHJlcXVlc3RIZWFkZXJzLnNldCgneC11c2VyLWlkJywgdXNlci5pZCk7XG4gICAgcmVxdWVzdEhlYWRlcnMuc2V0KCd4LW9yZ2FuaXphdGlvbi1pZCcsIHVzZXJPcmcub3JnYW5pemF0aW9uX2lkKTtcblxuICAgIC8vIFR5cGUgZ3VhcmQgZm9yIG9yZ2FuaXphdGlvbiByb2xlXG4gICAgY29uc3Qgb3JnUm9sZSA9IHVzZXJPcmcub3JnYW5pemF0aW9uICYmXG4gICAgICAgICAgICAgICAgICAgIHR5cGVvZiB1c2VyT3JnLm9yZ2FuaXphdGlvbiA9PT0gJ29iamVjdCcgJiZcbiAgICAgICAgICAgICAgICAgICAgJ3JvbGUnIGluIHVzZXJPcmcub3JnYW5pemF0aW9uXG4gICAgICA/IFN0cmluZyh1c2VyT3JnLm9yZ2FuaXphdGlvbi5yb2xlKVxuICAgICAgOiAnYWdlbnQnO1xuXG4gICAgcmVxdWVzdEhlYWRlcnMuc2V0KCd4LXVzZXItcm9sZScsIG9yZ1JvbGUpO1xuICAgIHJlcXVlc3RIZWFkZXJzLnNldCgneC11c2VyLWVtYWlsJywgdXNlci5lbWFpbCB8fCAnJyk7XG4gICAgcmVxdWVzdEhlYWRlcnMuc2V0KCd4LWlzLXN1cGVyLWFkbWluJywgJ2ZhbHNlJyk7XG5cbiAgICAvLyBSZXR1cm4gbW9kaWZpZWQgcmVxdWVzdCB3aXRoIHRlbmFudCBjb250ZXh0XG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5uZXh0KHtcbiAgICAgIHJlcXVlc3Q6IHsgaGVhZGVyczogcmVxdWVzdEhlYWRlcnMgfVxuICAgIH0pO1xuXG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignW1RFTkFOVF9WQUxJREFUSU9OXSBFcnJvcjonLCBlcnJvcik7XG5cbiAgICAvLyBMb2cgZXJyb3IgdG8gbW9uaXRvcmluZyBzZXJ2aWNlXG4gICAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSAncHJvZHVjdGlvbicpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IFNlbnRyeSA9IGF3YWl0IGltcG9ydCgnQHNlbnRyeS9uZXh0anMnKTtcbiAgICAgICAgU2VudHJ5LmNhcHR1cmVFeGNlcHRpb24oZXJyb3IsIHtcbiAgICAgICAgICB0YWdzOiB7XG4gICAgICAgICAgICBtaWRkbGV3YXJlOiAndGVuYW50LXZhbGlkYXRpb24nXG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH0gY2F0Y2ggKHNlbnRyeUVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ0ZhaWxlZCB0byBsb2cgZXJyb3IgdG8gU2VudHJ5OicsIHNlbnRyeUVycm9yKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBSZXR1cm4gNTAwIGVycm9yIGZvciB1bmV4cGVjdGVkIGZhaWx1cmVzXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAge1xuICAgICAgICBlcnJvcjogJ0ludGVybmFsIHNlcnZlciBlcnJvciBkdXJpbmcgdGVuYW50IHZhbGlkYXRpb24nLFxuICAgICAgICBjb2RlOiAnSU5URVJOQUxfRVJST1InXG4gICAgICB9LFxuICAgICAgeyBzdGF0dXM6IDUwMCB9XG4gICAgKTtcbiAgfVxufVxuXG4vKipcbiAqIEV4dHJhY3QgdGVuYW50IGNvbnRleHQgZnJvbSByZXF1ZXN0IGhlYWRlcnNcbiAqIFVzZSB0aGlzIGluIEFQSSByb3V0ZXMgYWZ0ZXIgdmFsaWRhdGVUZW5hbnRBY2Nlc3MgbWlkZGxld2FyZVxuICpcbiAqIEBwYXJhbSByZXF1ZXN0IC0gTmV4dFJlcXVlc3Qgb2JqZWN0IHdpdGggdGVuYW50IGNvbnRleHQgaGVhZGVyc1xuICogQHJldHVybnMgVGVuYW50Q29udGV4dCBvYmplY3Qgd2l0aCB1c2VyIGFuZCBvcmdhbml6YXRpb24gaW5mb3JtYXRpb25cbiAqXG4gKiBAZXhhbXBsZVxuICogYGBgdHlwZXNjcmlwdFxuICogY29uc3QgeyBvcmdhbml6YXRpb25JZCwgdXNlcklkLCB1c2VyUm9sZSB9ID0gZ2V0VGVuYW50Q29udGV4dChyZXF1ZXN0KTtcbiAqXG4gKiAvLyBVc2Ugb3JnYW5pemF0aW9uSWQgdG8gc2NvcGUgZGF0YWJhc2UgcXVlcmllc1xuICogY29uc3QgeyBkYXRhIH0gPSBhd2FpdCBzdXBhYmFzZVxuICogICAuZnJvbSgnY29udGFjdHMnKVxuICogICAuc2VsZWN0KCcqJylcbiAqICAgLmVxKCdvcmdhbml6YXRpb25faWQnLCBvcmdhbml6YXRpb25JZCk7XG4gKiBgYGBcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdldFRlbmFudENvbnRleHQocmVxdWVzdDogTmV4dFJlcXVlc3QpOiBUZW5hbnRDb250ZXh0IHtcbiAgcmV0dXJuIHtcbiAgICB1c2VySWQ6IHJlcXVlc3QuaGVhZGVycy5nZXQoJ3gtdXNlci1pZCcpIHx8ICcnLFxuICAgIG9yZ2FuaXphdGlvbklkOiByZXF1ZXN0LmhlYWRlcnMuZ2V0KCd4LW9yZ2FuaXphdGlvbi1pZCcpIHx8ICcnLFxuICAgIHVzZXJSb2xlOiByZXF1ZXN0LmhlYWRlcnMuZ2V0KCd4LXVzZXItcm9sZScpIHx8ICdhZ2VudCcsXG4gICAgdXNlckVtYWlsOiByZXF1ZXN0LmhlYWRlcnMuZ2V0KCd4LXVzZXItZW1haWwnKSB8fCAnJ1xuICB9O1xufVxuXG4vKipcbiAqIENoZWNrIGlmIHRoZSBjdXJyZW50IHVzZXIgaXMgYSBzdXBlciBhZG1pblxuICogU3VwZXIgYWRtaW5zIGJ5cGFzcyBvcmdhbml6YXRpb24gcmVxdWlyZW1lbnRzXG4gKlxuICogQHBhcmFtIHJlcXVlc3QgLSBOZXh0UmVxdWVzdCBvYmplY3Qgd2l0aCB0ZW5hbnQgY29udGV4dCBoZWFkZXJzXG4gKiBAcmV0dXJucyBib29sZWFuIGluZGljYXRpbmcgaWYgdXNlciBpcyBzdXBlciBhZG1pblxuICovXG5leHBvcnQgZnVuY3Rpb24gaXNTdXBlckFkbWluKHJlcXVlc3Q6IE5leHRSZXF1ZXN0KTogYm9vbGVhbiB7XG4gIHJldHVybiByZXF1ZXN0LmhlYWRlcnMuZ2V0KCd4LWlzLXN1cGVyLWFkbWluJykgPT09ICd0cnVlJztcbn1cblxuLyoqXG4gKiBWYWxpZGF0ZSB0aGF0IGEgcmVzb3VyY2UgYmVsb25ncyB0byB0aGUgdXNlcidzIG9yZ2FuaXphdGlvblxuICogVXNlIHRoaXMgZm9yIGFkZGl0aW9uYWwgdmFsaWRhdGlvbiBpbiBBUEkgcm91dGVzXG4gKlxuICogQHBhcmFtIHJlc291cmNlT3JnSWQgLSBPcmdhbml6YXRpb24gSUQgb2YgdGhlIHJlc291cmNlIGJlaW5nIGFjY2Vzc2VkXG4gKiBAcGFyYW0gdGVuYW50Q29udGV4dCAtIFRlbmFudCBjb250ZXh0IGZyb20gcmVxdWVzdFxuICogQHJldHVybnMgYm9vbGVhbiBpbmRpY2F0aW5nIGlmIGFjY2VzcyBpcyBhbGxvd2VkXG4gKlxuICogQGV4YW1wbGVcbiAqIGBgYHR5cGVzY3JpcHRcbiAqIGNvbnN0IGNvbnRhY3QgPSBhd2FpdCBnZXRDb250YWN0KGNvbnRhY3RJZCk7XG4gKiBjb25zdCBjb250ZXh0ID0gZ2V0VGVuYW50Q29udGV4dChyZXF1ZXN0KTtcbiAqXG4gKiBpZiAoIXZhbGlkYXRlUmVzb3VyY2VBY2Nlc3MoY29udGFjdC5vcmdhbml6YXRpb25faWQsIGNvbnRleHQpKSB7XG4gKiAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IGVycm9yOiAnQWNjZXNzIGRlbmllZCcgfSwgeyBzdGF0dXM6IDQwMyB9KTtcbiAqIH1cbiAqIGBgYFxuICovXG5leHBvcnQgZnVuY3Rpb24gdmFsaWRhdGVSZXNvdXJjZUFjY2VzcyhcbiAgcmVzb3VyY2VPcmdJZDogc3RyaW5nLFxuICB0ZW5hbnRDb250ZXh0OiBUZW5hbnRDb250ZXh0XG4pOiBib29sZWFuIHtcbiAgLy8gU3VwZXIgYWRtaW5zIGNhbiBhY2Nlc3MgYWxsIHJlc291cmNlc1xuICBpZiAoIXRlbmFudENvbnRleHQub3JnYW5pemF0aW9uSWQgJiYgdGVuYW50Q29udGV4dC51c2VyUm9sZSA9PT0gJ3N1cGVyX2FkbWluJykge1xuICAgIHJldHVybiB0cnVlO1xuICB9XG5cbiAgLy8gUmVndWxhciB1c2VycyBjYW4gb25seSBhY2Nlc3MgcmVzb3VyY2VzIGluIHRoZWlyIG9yZ2FuaXphdGlvblxuICByZXR1cm4gcmVzb3VyY2VPcmdJZCA9PT0gdGVuYW50Q29udGV4dC5vcmdhbml6YXRpb25JZDtcbn1cblxuLyoqXG4gKiBIZWxwZXIgZnVuY3Rpb24gdG8gZ2V0IGNsaWVudCBJUCBhZGRyZXNzXG4gKiBIYW5kbGVzIHZhcmlvdXMgcHJveHkgaGVhZGVycyAoVmVyY2VsLCBDbG91ZGZsYXJlLCBldGMuKVxuICpcbiAqIEBwYXJhbSByZXF1ZXN0IC0gTmV4dFJlcXVlc3Qgb2JqZWN0XG4gKiBAcmV0dXJucyBDbGllbnQgSVAgYWRkcmVzcyBvciAndW5rbm93bidcbiAqL1xuZnVuY3Rpb24gZ2V0Q2xpZW50SXAocmVxdWVzdDogTmV4dFJlcXVlc3QpOiBzdHJpbmcge1xuICBjb25zdCBmb3J3YXJkZWQgPSByZXF1ZXN0LmhlYWRlcnMuZ2V0KCd4LWZvcndhcmRlZC1mb3InKTtcbiAgY29uc3QgcmVhbElwID0gcmVxdWVzdC5oZWFkZXJzLmdldCgneC1yZWFsLWlwJyk7XG4gIGNvbnN0IGNmQ29ubmVjdGluZ0lwID0gcmVxdWVzdC5oZWFkZXJzLmdldCgnY2YtY29ubmVjdGluZy1pcCcpO1xuICBjb25zdCB2ZXJjZWxJcCA9IHJlcXVlc3QuaGVhZGVycy5nZXQoJ3gtdmVyY2VsLWZvcndhcmRlZC1mb3InKTtcblxuICByZXR1cm4gKFxuICAgIGNmQ29ubmVjdGluZ0lwIHx8XG4gICAgdmVyY2VsSXAgfHxcbiAgICBmb3J3YXJkZWQ/LnNwbGl0KCcsJylbMF0udHJpbSgpIHx8XG4gICAgcmVhbElwIHx8XG4gICAgJ3Vua25vd24nXG4gICk7XG59XG5cbi8qKlxuICogU3VwYWJhc2UgUXVlcnkgQnVpbGRlciBJbnRlcmZhY2VcbiAqIE1pbmltYWwgaW50ZXJmYWNlIGZvciB0ZW5hbnQgc2NvcGluZ1xuICovXG5pbnRlcmZhY2UgU3VwYWJhc2VRdWVyeUJ1aWxkZXIge1xuICBlcShjb2x1bW46IHN0cmluZywgdmFsdWU6IHN0cmluZyk6IFN1cGFiYXNlUXVlcnlCdWlsZGVyO1xufVxuXG4vKipcbiAqIENyZWF0ZSBhIHRlbmFudC1hd2FyZSBkYXRhYmFzZSBxdWVyeSBtb2RpZmllclxuICogQXV0b21hdGljYWxseSBhZGRzIG9yZ2FuaXphdGlvbl9pZCBmaWx0ZXIgdG8gcXVlcmllc1xuICpcbiAqIEBwYXJhbSBvcmdhbml6YXRpb25JZCAtIE9yZ2FuaXphdGlvbiBJRCB0byBmaWx0ZXIgYnlcbiAqIEByZXR1cm5zIEZ1bmN0aW9uIHRoYXQgbW9kaWZpZXMgU3VwYWJhc2UgcXVlcnkgYnVpbGRlclxuICpcbiAqIEBleGFtcGxlXG4gKiBgYGB0eXBlc2NyaXB0XG4gKiBjb25zdCBjb250ZXh0ID0gZ2V0VGVuYW50Q29udGV4dChyZXF1ZXN0KTtcbiAqIGNvbnN0IHNjb3BlVG9PcmcgPSBjcmVhdGVUZW5hbnRTY29wZShjb250ZXh0Lm9yZ2FuaXphdGlvbklkKTtcbiAqXG4gKiBjb25zdCB7IGRhdGEgfSA9IGF3YWl0IHN1cGFiYXNlXG4gKiAgIC5mcm9tKCdjb250YWN0cycpXG4gKiAgIC5zZWxlY3QoJyonKVxuICogICAubW9kaWZ5KHNjb3BlVG9PcmcpOyAvLyBBdXRvbWF0aWNhbGx5IGFkZHMgLmVxKCdvcmdhbml6YXRpb25faWQnLCBvcmdhbml6YXRpb25JZClcbiAqIGBgYFxuICovXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlVGVuYW50U2NvcGUob3JnYW5pemF0aW9uSWQ6IHN0cmluZykge1xuICByZXR1cm4gKHF1ZXJ5OiBTdXBhYmFzZVF1ZXJ5QnVpbGRlcikgPT4gcXVlcnkuZXEoJ29yZ2FuaXphdGlvbl9pZCcsIG9yZ2FuaXphdGlvbklkKTtcbn1cbiJdLCJuYW1lcyI6WyJjcmVhdGVUZW5hbnRTY29wZSIsImdldFRlbmFudENvbnRleHQiLCJpc1N1cGVyQWRtaW4iLCJ2YWxpZGF0ZVJlc291cmNlQWNjZXNzIiwidmFsaWRhdGVUZW5hbnRBY2Nlc3MiLCJyZXF1ZXN0Iiwic3VwYWJhc2UiLCJjcmVhdGVDbGllbnQiLCJkYXRhIiwidXNlciIsImVycm9yIiwiYXV0aEVycm9yIiwiYXV0aCIsImdldFVzZXIiLCJOZXh0UmVzcG9uc2UiLCJqc29uIiwiY29kZSIsInN0YXR1cyIsInVzZXJPcmciLCJnZXRVc2VyT3JnYW5pemF0aW9uIiwiaWQiLCJvcmdhbml6YXRpb25faWQiLCJwcm9maWxlIiwiZnJvbSIsInNlbGVjdCIsImVxIiwic2luZ2xlIiwiaXNfc3VwZXJfYWRtaW4iLCJyZXF1ZXN0SGVhZGVycyIsIkhlYWRlcnMiLCJoZWFkZXJzIiwic2V0IiwiZW1haWwiLCJuZXh0IiwicmVxdWVzdGVkT3JnSWQiLCJnZXQiLCJuZXh0VXJsIiwic2VhcmNoUGFyYW1zIiwic2VjdXJpdHlFdmVudCIsInVzZXJJZCIsInJlcXVlc3RlZE9yZyIsInBhdGgiLCJwYXRobmFtZSIsIm1ldGhvZCIsInRpbWVzdGFtcCIsIkRhdGUiLCJ0b0lTT1N0cmluZyIsImlwIiwiZ2V0Q2xpZW50SXAiLCJ1c2VyQWdlbnQiLCJjb25zb2xlIiwid2FybiIsInByb2Nlc3MiLCJlbnYiLCJOT0RFX0VOViIsIlNlbnRyeSIsImNhcHR1cmVNZXNzYWdlIiwibGV2ZWwiLCJleHRyYSIsIm9yZ1JvbGUiLCJvcmdhbml6YXRpb24iLCJTdHJpbmciLCJyb2xlIiwiY2FwdHVyZUV4Y2VwdGlvbiIsInRhZ3MiLCJtaWRkbGV3YXJlIiwic2VudHJ5RXJyb3IiLCJvcmdhbml6YXRpb25JZCIsInVzZXJSb2xlIiwidXNlckVtYWlsIiwicmVzb3VyY2VPcmdJZCIsInRlbmFudENvbnRleHQiLCJmb3J3YXJkZWQiLCJyZWFsSXAiLCJjZkNvbm5lY3RpbmdJcCIsInZlcmNlbElwIiwic3BsaXQiLCJ0cmltIiwicXVlcnkiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O1FBa1VnQkE7ZUFBQUE7O1FBbkdBQztlQUFBQTs7UUFnQkFDO2VBQUFBOztRQXNCQUM7ZUFBQUE7O1FBaE5NQztlQUFBQTs7O3dCQXJEb0I7eUJBQ2I7MEJBQ087Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQW1EN0IsZUFBZUEscUJBQXFCQyxPQUFvQjtJQUM3RCxJQUFJ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