{"version":3,"names":["GET","cov_bi1smkgd7","f","s","POST","request","supabase","_server1","createClient","data","user","auth","getUser","b","_server","NextResponse","json","error","status","profile","from","select","eq","id","single","organization_id","domains","order","ascending","success","console","body","domainManager","_tenantrouting","DomainManager","domain","addCustomDomain","is_primary"],"sources":["C:\\Ai Projecten\\ADSapp\\src\\app\\api\\tenant\\domains\\route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport { createClient } from '@/lib/supabase/server';\nimport { DomainManager, tenantUtils } from '@/middleware/tenant-routing';\n\nexport async function GET(request: NextRequest) {\n  try {\n    const supabase = await createClient();\n    \n    // Get organization ID from auth\n    const { data: { user } } = await supabase.auth.getUser();\n    \n    if (!user) {\n      return NextResponse.json(\n        { error: 'Unauthorized' },\n        { status: 401 }\n      );\n    }\n\n    // Get user's organization\n    const { data: profile } = await supabase\n      .from('profiles')\n      .select('organization_id')\n      .eq('id', user.id)\n      .single();\n\n    if (!profile?.organization_id) {\n      return NextResponse.json(\n        { error: 'No organization found' },\n        { status: 404 }\n      );\n    }\n\n    // Get domains for organization\n    const { data: domains, error } = await supabase\n      .from('tenant_domains')\n      .select('*')\n      .eq('organization_id', profile.organization_id)\n      .order('is_primary', { ascending: false });\n\n    if (error) {\n      throw error;\n    }\n\n    return NextResponse.json({\n      success: true,\n      data: domains || [],\n    });\n  } catch (error) {\n    console.error('Error fetching domains:', error);\n    return NextResponse.json(\n      { error: 'Internal server error' },\n      { status: 500 }\n    );\n  }\n}\n\nexport async function POST(request: NextRequest) {\n  try {\n    const supabase = await createClient();\n    const body = await request.json();\n    \n    // Get organization ID from auth\n    const { data: { user } } = await supabase.auth.getUser();\n    \n    if (!user) {\n      return NextResponse.json(\n        { error: 'Unauthorized' },\n        { status: 401 }\n      );\n    }\n\n    // Get user's organization\n    const { data: profile } = await supabase\n      .from('profiles')\n      .select('organization_id')\n      .eq('id', user.id)\n      .single();\n\n    if (!profile?.organization_id) {\n      return NextResponse.json(\n        { error: 'No organization found' },\n        { status: 404 }\n      );\n    }\n\n    // Create domain manager\n    const domainManager = new DomainManager(supabase);\n    \n    // Add domain\n    const domain = await domainManager.addCustomDomain(\n      profile.organization_id,\n      body.domain,\n      body.is_primary || false\n    );\n\n    return NextResponse.json({\n      success: true,\n      data: domain,\n    });\n  } catch (error) {\n    console.error('Error adding domain:', error);\n    return NextResponse.json(\n      { error: 'Internal server error' },\n      { status: 500 }\n    );\n  }\n}\n"],"mappings":"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","ignoreList":[]}