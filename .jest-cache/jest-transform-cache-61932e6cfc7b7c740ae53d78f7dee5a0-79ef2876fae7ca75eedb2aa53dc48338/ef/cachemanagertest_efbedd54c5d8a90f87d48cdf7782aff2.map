{"version":3,"sources":["C:\\Ai Projecten\\ADSapp\\tests\\unit\\cache\\cache-manager.test.ts"],"sourcesContent":["/**\n * Cache Manager Unit Tests\n *\n * Tests for multi-layer cache manager functionality\n */\n\nimport { CacheManager, getCacheManager, resetCacheManager } from '@/lib/cache/cache-manager';\nimport { resetL1Cache } from '@/lib/cache/l1-cache';\n\n// Mock Redis client\njest.mock('@/lib/cache/redis-client', () => ({\n  getCached: jest.fn(),\n  setCached: jest.fn(),\n  deleteCached: jest.fn(),\n  deletePattern: jest.fn(),\n  isRedisAvailable: jest.fn().mockResolvedValue(true),\n  generateCacheKey: (tenant: string, resource: string, id?: string, version = 'v1') => {\n    const parts = [tenant, resource];\n    if (id) parts.push(id);\n    parts.push(version);\n    return parts.join(':');\n  },\n}));\n\ndescribe('CacheManager', () => {\n  let manager: CacheManager;\n  const testTenant = 'test-tenant';\n  const testResource = 'test-resource';\n  const testData = { id: '123', name: 'Test Data' };\n\n  beforeEach(() => {\n    resetCacheManager();\n    resetL1Cache();\n    manager = getCacheManager({\n      l1Enabled: true,\n      l2Enabled: true,\n      enableMonitoring: false,\n    });\n    jest.clearAllMocks();\n  });\n\n  describe('get', () => {\n    it('should fetch data on cache miss', async () => {\n      const fetchFn = jest.fn().mockResolvedValue(testData);\n\n      const result = await manager.get(testTenant, testResource, undefined, fetchFn);\n\n      expect(result.data).toEqual(testData);\n      expect(result.metadata.source).toBe('l3');\n      expect(fetchFn).toHaveBeenCalledTimes(1);\n    });\n\n    it('should return cached data from L1 on hit', async () => {\n      const fetchFn = jest.fn().mockResolvedValue(testData);\n\n      // First call - cache miss, fetches data\n      await manager.get(testTenant, testResource, undefined, fetchFn);\n\n      // Second call - should hit L1 cache\n      const result = await manager.get(testTenant, testResource, undefined, fetchFn);\n\n      expect(result.data).toEqual(testData);\n      expect(result.metadata.source).toBe('l1');\n      expect(fetchFn).toHaveBeenCalledTimes(1); // Only called once\n    });\n\n    it('should handle fetch function errors', async () => {\n      const fetchFn = jest.fn().mockRejectedValue(new Error('Fetch failed'));\n\n      await expect(\n        manager.get(testTenant, testResource, undefined, fetchFn)\n      ).rejects.toThrow('Fetch failed');\n    });\n\n    it('should respect tenant isolation', async () => {\n      const tenant1Data = { id: '1', value: 'tenant1' };\n      const tenant2Data = { id: '2', value: 'tenant2' };\n\n      const result1 = await manager.get(\n        'tenant-1',\n        testResource,\n        undefined,\n        async () => tenant1Data\n      );\n\n      const result2 = await manager.get(\n        'tenant-2',\n        testResource,\n        undefined,\n        async () => tenant2Data\n      );\n\n      expect(result1.data).toEqual(tenant1Data);\n      expect(result2.data).toEqual(tenant2Data);\n    });\n  });\n\n  describe('set', () => {\n    it('should store data in cache', async () => {\n      await manager.set(testTenant, testResource, undefined, testData);\n\n      // Verify data is cached by fetching it\n      const result = await manager.get(\n        testTenant,\n        testResource,\n        undefined,\n        async () => ({ different: 'data' })\n      );\n\n      expect(result.data).toEqual(testData);\n      expect(result.metadata.source).toBe('l1');\n    });\n\n    it('should handle set errors gracefully', async () => {\n      // Should not throw even if cache fails\n      await expect(\n        manager.set(testTenant, testResource, undefined, testData)\n      ).resolves.not.toThrow();\n    });\n  });\n\n  describe('delete', () => {\n    it('should remove data from cache', async () => {\n      const fetchFn = jest.fn()\n        .mockResolvedValueOnce(testData)\n        .mockResolvedValueOnce({ updated: 'data' });\n\n      // Cache data\n      await manager.get(testTenant, testResource, undefined, fetchFn);\n\n      // Delete from cache\n      await manager.delete(testTenant, testResource);\n\n      // Next call should fetch fresh data\n      const result = await manager.get(testTenant, testResource, undefined, fetchFn);\n\n      expect(result.data).toEqual({ updated: 'data' });\n      expect(fetchFn).toHaveBeenCalledTimes(2);\n    });\n  });\n\n  describe('invalidate', () => {\n    it('should invalidate all keys for tenant and resource', async () => {\n      await manager.set(testTenant, 'resource1', 'id1', testData);\n      await manager.set(testTenant, 'resource1', 'id2', testData);\n      await manager.set(testTenant, 'resource2', 'id1', testData);\n\n      const count = await manager.invalidate(testTenant, 'resource1');\n\n      expect(count).toBeGreaterThan(0);\n    });\n\n    it('should invalidate all keys for tenant when no resource specified', async () => {\n      await manager.set(testTenant, 'resource1', undefined, testData);\n      await manager.set(testTenant, 'resource2', undefined, testData);\n\n      const count = await manager.invalidate(testTenant);\n\n      expect(count).toBeGreaterThan(0);\n    });\n  });\n\n  describe('warm', () => {\n    it('should warm cache with multiple items', async () => {\n      const items = [\n        { id: 'id1', data: { value: 1 } },\n        { id: 'id2', data: { value: 2 } },\n        { id: 'id3', data: { value: 3 } },\n      ];\n\n      await manager.warm(testTenant, testResource, items);\n\n      // Verify all items are cached\n      for (const item of items) {\n        const result = await manager.get(\n          testTenant,\n          testResource,\n          item.id,\n          async () => ({ different: 'data' })\n        );\n        expect(result.data).toEqual(item.data);\n        expect(result.metadata.source).toBe('l1');\n      }\n    });\n  });\n\n  describe('performance tracking', () => {\n    it('should track cache hits and misses', async () => {\n      const fetchFn = jest.fn().mockResolvedValue(testData);\n\n      // Cache miss\n      await manager.get(testTenant, testResource, undefined, fetchFn);\n\n      // Cache hits\n      await manager.get(testTenant, testResource, undefined, fetchFn);\n      await manager.get(testTenant, testResource, undefined, fetchFn);\n\n      const performance = manager.getPerformance();\n\n      expect(performance.totalRequests).toBe(3);\n      expect(performance.l1Hits).toBe(2);\n      expect(performance.l3Hits).toBe(1);\n    });\n\n    it('should calculate hit rates correctly', async () => {\n      const fetchFn = jest.fn().mockResolvedValue(testData);\n\n      // 1 miss\n      await manager.get(testTenant, 'res1', undefined, fetchFn);\n\n      // 4 hits\n      await manager.get(testTenant, 'res1', undefined, fetchFn);\n      await manager.get(testTenant, 'res1', undefined, fetchFn);\n      await manager.get(testTenant, 'res1', undefined, fetchFn);\n      await manager.get(testTenant, 'res1', undefined, fetchFn);\n\n      const performance = manager.getPerformance();\n\n      expect(performance.l1HitRate).toBeCloseTo(80, 0); // 4/5 = 80%\n    });\n\n    it('should track average latency', async () => {\n      const fetchFn = jest.fn().mockResolvedValue(testData);\n\n      await manager.get(testTenant, testResource, undefined, fetchFn);\n      await manager.get(testTenant, testResource, undefined, fetchFn);\n\n      const performance = manager.getPerformance();\n\n      expect(performance.averageLatency).toBeGreaterThanOrEqual(0);\n    });\n  });\n\n  describe('health check', () => {\n    it('should report healthy status when all layers available', async () => {\n      const health = await manager.healthCheck();\n\n      expect(health.l1Available).toBe(true);\n      expect(health.l2Available).toBe(true);\n      expect(health.overall).toBe('healthy');\n    });\n\n    it('should report degraded status when L2 unavailable', async () => {\n      const { isRedisAvailable } = require('@/lib/cache/redis-client');\n      isRedisAvailable.mockResolvedValueOnce(false);\n\n      const health = await manager.healthCheck();\n\n      expect(health.l1Available).toBe(true);\n      expect(health.l2Available).toBe(false);\n      expect(health.overall).toBe('degraded');\n    });\n  });\n\n  describe('configuration', () => {\n    it('should allow runtime configuration updates', () => {\n      const initialConfig = manager.getConfig();\n      expect(initialConfig.l1TTL).toBe(60);\n\n      manager.updateConfig({ l1TTL: 120 });\n\n      const updatedConfig = manager.getConfig();\n      expect(updatedConfig.l1TTL).toBe(120);\n    });\n\n    it('should work with L1 disabled', async () => {\n      const managerNoL1 = getCacheManager({ l1Enabled: false, l2Enabled: true });\n      const fetchFn = jest.fn().mockResolvedValue(testData);\n\n      const result = await managerNoL1.get(testTenant, testResource, undefined, fetchFn);\n\n      expect(result.data).toEqual(testData);\n      // Should skip L1 and go to L2 or L3\n      expect(['l2', 'l3']).toContain(result.metadata.source);\n    });\n\n    it('should work with all layers disabled (database only)', async () => {\n      const managerNoCache = getCacheManager({ l1Enabled: false, l2Enabled: false });\n      const fetchFn = jest.fn().mockResolvedValue(testData);\n\n      const result = await managerNoCache.get(testTenant, testResource, undefined, fetchFn);\n\n      expect(result.data).toEqual(testData);\n      expect(result.metadata.source).toBe('l3');\n      expect(fetchFn).toHaveBeenCalledTimes(1);\n    });\n  });\n\n  describe('error handling', () => {\n    it('should fall back to database on cache errors', async () => {\n      const { getCached: getRedis } = require('@/lib/cache/redis-client');\n      getRedis.mockRejectedValueOnce(new Error('Redis error'));\n\n      const fetchFn = jest.fn().mockResolvedValue(testData);\n      const result = await manager.get(testTenant, testResource, undefined, fetchFn);\n\n      expect(result.data).toEqual(testData);\n      expect(fetchFn).toHaveBeenCalledTimes(1);\n    });\n\n    it('should not crash on invalidation errors', async () => {\n      const { deletePattern } = require('@/lib/cache/redis-client');\n      deletePattern.mockRejectedValueOnce(new Error('Delete error'));\n\n      await expect(\n        manager.invalidate(testTenant, testResource)\n      ).resolves.not.toThrow();\n    });\n  });\n});\n\ndescribe('Helper Functions', () => {\n  beforeEach(() => {\n    resetCacheManager();\n    resetL1Cache();\n    jest.clearAllMocks();\n  });\n\n  describe('getCached', () => {\n    it('should return data from cache manager', async () => {\n      const { getCached } = require('@/lib/cache/cache-manager');\n      const data = await getCached(\n        'tenant',\n        'resource',\n        undefined,\n        async () => ({ test: 'data' })\n      );\n\n      expect(data).toEqual({ test: 'data' });\n    });\n  });\n\n  describe('setCached', () => {\n    it('should set data in cache manager', async () => {\n      const { setCached, getCached } = require('@/lib/cache/cache-manager');\n\n      await setCached('tenant', 'resource', undefined, { test: 'data' });\n\n      const data = await getCached(\n        'tenant',\n        'resource',\n        undefined,\n        async () => ({ different: 'data' })\n      );\n\n      expect(data).toEqual({ test: 'data' });\n    });\n  });\n\n  describe('invalidateCache', () => {\n    it('should invalidate cache entries', async () => {\n      const { invalidateCache } = require('@/lib/cache/cache-manager');\n\n      const count = await invalidateCache('tenant', 'resource');\n\n      expect(count).toBeGreaterThanOrEqual(0);\n    });\n  });\n});\n"],"names":["jest","mock","getCached","fn","setCached","deleteCached","deletePattern","isRedisAvailable","mockResolvedValue","generateCacheKey","tenant","resource","id","version","parts","push","join","describe","manager","testTenant","testResource","testData","name","beforeEach","resetCacheManager","resetL1Cache","getCacheManager","l1Enabled","l2Enabled","enableMonitoring","clearAllMocks","it","fetchFn","result","get","undefined","expect","data","toEqual","metadata","source","toBe","toHaveBeenCalledTimes","mockRejectedValue","Error","rejects","toThrow","tenant1Data","value","tenant2Data","result1","result2","set","different","resolves","not","mockResolvedValueOnce","updated","delete","count","invalidate","toBeGreaterThan","items","warm","item","performance","getPerformance","totalRequests","l1Hits","l3Hits","l1HitRate","toBeCloseTo","averageLatency","toBeGreaterThanOrEqual","health","healthCheck","l1Available","l2Available","overall","require","initialConfig","getConfig","l1TTL","updateConfig","updatedConfig","managerNoL1","toContain","managerNoCache","getRedis","mockRejectedValueOnce","test","invalidateCache"],"mappings":"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"}