{"version":3,"sources":["C:\\Ai Projecten\\ADSapp\\tests\\utils\\api-test-helpers.ts"],"sourcesContent":["/**\n * API Test Helpers\n *\n * Utilities for testing API routes including request mocking,\n * response validation, and authentication helpers.\n */\n\nimport { NextRequest, NextResponse } from 'next/server'\nimport type { Profile } from '@/types/database'\nimport { createMockUser } from './test-helpers'\n\n// =============================================================================\n// Type Definitions\n// =============================================================================\n\nexport interface MockRequestOptions {\n  method?: string\n  url?: string\n  body?: any\n  headers?: Record<string, string>\n  searchParams?: Record<string, string>\n  cookies?: Record<string, string>\n}\n\nexport interface MockAuthenticatedRequestOptions extends MockRequestOptions {\n  user?: Partial<Profile>\n  organizationId?: string\n}\n\nexport interface ApiTestResponse {\n  status: number\n  data: any\n  headers: Headers\n}\n\n// =============================================================================\n// Request Mocking\n// =============================================================================\n\n/**\n * Creates a mock NextRequest object for API testing\n */\nexport function mockApiRequest(options: MockRequestOptions = {}): NextRequest {\n  const {\n    method = 'GET',\n    url = 'http://localhost:3000/api/test',\n    body,\n    headers = {},\n    searchParams = {},\n    cookies = {},\n  } = options\n\n  // Construct URL with search params\n  const urlObj = new URL(url)\n  Object.entries(searchParams).forEach(([key, value]) => {\n    urlObj.searchParams.set(key, value)\n  })\n\n  // Create request init object\n  const init: RequestInit = {\n    method,\n    headers: new Headers({\n      'Content-Type': 'application/json',\n      ...headers,\n    }),\n  }\n\n  // Add body if present\n  if (body) {\n    init.body = JSON.stringify(body)\n  }\n\n  // Create the request\n  const request = new NextRequest(urlObj.toString(), init)\n\n  // Add cookies if present\n  Object.entries(cookies).forEach(([key, value]) => {\n    request.cookies.set(key, value)\n  })\n\n  return request\n}\n\n/**\n * Creates a mock authenticated API request\n */\nexport function createAuthenticatedRequest(\n  options: MockAuthenticatedRequestOptions = {}\n): NextRequest {\n  const user = createMockUser(options.user)\n  const organizationId = options.organizationId || user.organization_id\n\n  // Add authentication headers\n  const headers = {\n    ...options.headers,\n    'x-user-id': user.id,\n    'x-organization-id': organizationId,\n    Authorization: `Bearer mock-jwt-token-${user.id}`,\n  }\n\n  return mockApiRequest({\n    ...options,\n    headers,\n  })\n}\n\n/**\n * Creates a mock unauthenticated API request\n */\nexport function createUnauthenticatedRequest(options: MockRequestOptions = {}): NextRequest {\n  return mockApiRequest(options)\n}\n\n// =============================================================================\n// Response Mocking & Validation\n// =============================================================================\n\n/**\n * Mocks a successful API response\n */\nexport function mockApiResponse(data: any, status = 200): NextResponse {\n  return NextResponse.json(data, { status })\n}\n\n/**\n * Mocks an error API response\n */\nexport function mockErrorResponse(message: string, status = 400): NextResponse {\n  return NextResponse.json({ error: message }, { status })\n}\n\n/**\n * Extracts response data for testing\n */\nexport async function extractResponseData(response: NextResponse): Promise<ApiTestResponse> {\n  const data = await response.json()\n  return {\n    status: response.status,\n    data,\n    headers: response.headers,\n  }\n}\n\n/**\n * Parses response for testing (works with both NextResponse and Response)\n */\nexport async function parseResponse(response: any): Promise<ApiTestResponse> {\n  const text = await response.text()\n  let data: any\n  try {\n    data = JSON.parse(text)\n  } catch {\n    data = text\n  }\n  return {\n    status: response.status,\n    data,\n    headers: response.headers\n  }\n}\n\n/**\n * Validates successful API response\n */\nexport function expectSuccessResponse(response: NextResponse, expectedStatus = 200): void {\n  expect(response.status).toBe(expectedStatus)\n  expect(response.headers.get('content-type')).toContain('application/json')\n}\n\n/**\n * Validates error API response\n */\nexport function expectErrorResponse(\n  response: NextResponse,\n  expectedStatus = 400,\n  errorMessage?: string\n): void {\n  expect(response.status).toBe(expectedStatus)\n  expect(response.headers.get('content-type')).toContain('application/json')\n\n  if (errorMessage) {\n    response.json().then((data) => {\n      expect(data.error).toContain(errorMessage)\n    })\n  }\n}\n\n// =============================================================================\n// Authentication Helpers\n// =============================================================================\n\n/**\n * Creates a mock JWT token for testing\n */\nexport function createMockJwtToken(userId: string, organizationId: string): string {\n  const payload = {\n    sub: userId,\n    org_id: organizationId,\n    role: 'agent',\n    iat: Math.floor(Date.now() / 1000),\n    exp: Math.floor(Date.now() / 1000) + 3600,\n  }\n\n  // In real implementation, this would be signed with a secret\n  const base64Payload = Buffer.from(JSON.stringify(payload)).toString('base64')\n  return `mock.${base64Payload}.signature`\n}\n\n/**\n * Mocks authentication middleware success\n */\nexport function mockAuthMiddlewareSuccess(user: Profile): void {\n  jest.mock('@/lib/api-middleware', () => ({\n    withAuth: (handler: any) => handler,\n    getCurrentUser: jest.fn().mockResolvedValue(user),\n    requireRole: (role: string) => (handler: any) => handler,\n  }))\n}\n\n/**\n * Mocks authentication middleware failure\n */\nexport function mockAuthMiddlewareFailure(error: string = 'Unauthorized'): void {\n  jest.mock('@/lib/api-middleware', () => ({\n    withAuth: () => {\n      throw new Error(error)\n    },\n    getCurrentUser: jest.fn().mockRejectedValue(new Error(error)),\n  }))\n}\n\n// =============================================================================\n// Request Body Validation\n// =============================================================================\n\n/**\n * Validates request body against schema\n */\nexport function validateRequestBody(body: any, requiredFields: string[]): {\n  valid: boolean\n  missingFields: string[]\n} {\n  const missingFields = requiredFields.filter((field) => !(field in body))\n  return {\n    valid: missingFields.length === 0,\n    missingFields,\n  }\n}\n\n/**\n * Creates invalid request bodies for testing validation\n */\nexport function createInvalidRequestBodies(\n  validBody: Record<string, any>\n): Record<string, any>[] {\n  const invalidBodies: Record<string, any>[] = []\n\n  // Missing each required field\n  Object.keys(validBody).forEach((key) => {\n    const body = { ...validBody }\n    delete body[key]\n    invalidBodies.push(body)\n  })\n\n  // Empty strings for string fields\n  Object.entries(validBody).forEach(([key, value]) => {\n    if (typeof value === 'string') {\n      invalidBodies.push({ ...validBody, [key]: '' })\n    }\n  })\n\n  // Invalid types\n  Object.entries(validBody).forEach(([key, value]) => {\n    if (typeof value === 'string') {\n      invalidBodies.push({ ...validBody, [key]: 123 })\n    }\n    if (typeof value === 'number') {\n      invalidBodies.push({ ...validBody, [key]: 'invalid' })\n    }\n  })\n\n  return invalidBodies\n}\n\n// =============================================================================\n// Database Query Mocking\n// =============================================================================\n\n/**\n * Mocks a successful database query\n */\nexport function mockDatabaseQuery<T>(data: T | T[]): {\n  data: T | T[]\n  error: null\n} {\n  return { data, error: null }\n}\n\n/**\n * Mocks a failed database query\n */\nexport function mockDatabaseError(message: string): {\n  data: null\n  error: { message: string; code: string }\n} {\n  return {\n    data: null,\n    error: {\n      message,\n      code: 'PGRST116',\n    },\n  }\n}\n\n/**\n * Mocks tenant isolation check\n */\nexport function mockTenantIsolation(organizationId: string): jest.Mock {\n  return jest.fn().mockImplementation((query) => {\n    return {\n      ...query,\n      eq: jest.fn((field: string, value: string) => {\n        if (field === 'organization_id') {\n          expect(value).toBe(organizationId)\n        }\n        return query\n      }),\n    }\n  })\n}\n\n// =============================================================================\n// Rate Limiting Helpers\n// =============================================================================\n\n/**\n * Simulates rate limit reached\n */\nexport function simulateRateLimit(\n  maxRequests: number = 100\n): { shouldBlock: boolean; remaining: number } {\n  return {\n    shouldBlock: true,\n    remaining: 0,\n  }\n}\n\n/**\n * Simulates rate limit not reached\n */\nexport function simulateRateLimitOk(\n  remaining: number = 95\n): { shouldBlock: boolean; remaining: number } {\n  return {\n    shouldBlock: false,\n    remaining,\n  }\n}\n\n// =============================================================================\n// API Error Helpers\n// =============================================================================\n\nexport const ApiErrors = {\n  Unauthorized: {\n    status: 401,\n    message: 'Unauthorized - Please sign in',\n  },\n  Forbidden: {\n    status: 403,\n    message: 'Forbidden - Insufficient permissions',\n  },\n  NotFound: {\n    status: 404,\n    message: 'Resource not found',\n  },\n  BadRequest: {\n    status: 400,\n    message: 'Bad request - Invalid input',\n  },\n  Conflict: {\n    status: 409,\n    message: 'Conflict - Resource already exists',\n  },\n  InternalServerError: {\n    status: 500,\n    message: 'Internal server error',\n  },\n  TooManyRequests: {\n    status: 429,\n    message: 'Too many requests - Please try again later',\n  },\n}\n\n/**\n * Creates an API error response\n */\nexport function createApiError(\n  errorType: keyof typeof ApiErrors,\n  customMessage?: string\n): NextResponse {\n  const error = ApiErrors[errorType]\n  return NextResponse.json(\n    { error: customMessage || error.message },\n    { status: error.status }\n  )\n}\n\n// =============================================================================\n// Pagination Helpers\n// =============================================================================\n\n/**\n * Creates pagination parameters\n */\nexport function createPaginationParams(page = 1, limit = 20): {\n  page: number\n  limit: number\n  offset: number\n} {\n  return {\n    page,\n    limit,\n    offset: (page - 1) * limit,\n  }\n}\n\n/**\n * Creates a paginated response\n */\nexport function createPaginatedResponse<T>(\n  data: T[],\n  page: number,\n  limit: number,\n  total: number\n): {\n  data: T[]\n  pagination: {\n    page: number\n    limit: number\n    total: number\n    total_pages: number\n    has_next: boolean\n    has_prev: boolean\n  }\n} {\n  return {\n    data,\n    pagination: {\n      page,\n      limit,\n      total,\n      total_pages: Math.ceil(total / limit),\n      has_next: page * limit < total,\n      has_prev: page > 1,\n    },\n  }\n}\n\n// =============================================================================\n// Test Scenarios\n// =============================================================================\n\n/**\n * Common test scenarios for API routes\n */\nexport const ApiTestScenarios = {\n  /**\n   * Test authentication requirement\n   */\n  requiresAuth: async (handler: (req: NextRequest) => Promise<NextResponse>) => {\n    const request = createUnauthenticatedRequest()\n    const response = await handler(request)\n    expectErrorResponse(response, 401)\n  },\n\n  /**\n   * Test tenant isolation\n   */\n  enforcesTenantIsolation: async (\n    handler: (req: NextRequest) => Promise<NextResponse>,\n    organizationId: string\n  ) => {\n    const request = createAuthenticatedRequest({ organizationId })\n    // Handler should only access data from this organization\n    const response = await handler(request)\n    expectSuccessResponse(response)\n  },\n\n  /**\n   * Test input validation\n   */\n  validatesInput: async (\n    handler: (req: NextRequest) => Promise<NextResponse>,\n    validBody: Record<string, any>,\n    requiredFields: string[]\n  ) => {\n    const invalidBodies = createInvalidRequestBodies(validBody)\n\n    for (const body of invalidBodies) {\n      const request = createAuthenticatedRequest({ body, method: 'POST' })\n      const response = await handler(request)\n      expectErrorResponse(response, 400)\n    }\n  },\n\n  /**\n   * Test rate limiting\n   */\n  enforcesRateLimit: async (\n    handler: (req: NextRequest) => Promise<NextResponse>,\n    maxRequests = 100\n  ) => {\n    // Simulate max requests\n    for (let i = 0; i < maxRequests + 1; i++) {\n      const request = createAuthenticatedRequest()\n      const response = await handler(request)\n\n      if (i < maxRequests) {\n        expect(response.status).not.toBe(429)\n      } else {\n        expectErrorResponse(response, 429)\n      }\n    }\n  },\n}\n\n// =============================================================================\n// Export All Helpers\n// =============================================================================\n\n/**\n * Alias for mockApiRequest for backward compatibility\n */\nexport const createMockRequest = mockApiRequest\n\n/**\n * Creates a paginated URL with query parameters\n */\nexport function createPaginatedUrl(\n  baseUrl: string,\n  params: { page?: number; limit?: number; sort?: string; order?: string }\n): string {\n  const url = new URL(baseUrl, 'http://localhost:3000')\n  if (params.page) url.searchParams.set('page', params.page.toString())\n  if (params.limit) url.searchParams.set('limit', params.limit.toString())\n  if (params.sort) url.searchParams.set('sort', params.sort)\n  if (params.order) url.searchParams.set('order', params.order)\n  return url.toString()\n}\n\n/**\n * Validates paginated response structure\n */\nexport function expectPaginatedResponse(data: any): void {\n  expect(data).toHaveProperty('pagination')\n  expect(data.pagination).toHaveProperty('page')\n  expect(data.pagination).toHaveProperty('limit')\n  expect(data.pagination).toHaveProperty('total')\n}\n\nexport default {\n  mockApiRequest,\n  createMockRequest,\n  createAuthenticatedRequest,\n  createUnauthenticatedRequest,\n  mockApiResponse,\n  mockErrorResponse,\n  extractResponseData,\n  parseResponse,\n  expectSuccessResponse,\n  expectErrorResponse,\n  createMockJwtToken,\n  mockAuthMiddlewareSuccess,\n  mockAuthMiddlewareFailure,\n  validateRequestBody,\n  createInvalidRequestBodies,\n  mockDatabaseQuery,\n  mockDatabaseError,\n  mockTenantIsolation,\n  simulateRateLimit,\n  simulateRateLimitOk,\n  ApiErrors,\n  createApiError,\n  createPaginationParams,\n  createPaginatedResponse,\n  ApiTestScenarios,\n}\n"],"names":["ApiErrors","ApiTestScenarios","createApiError","createAuthenticatedRequest","createInvalidRequestBodies","createMockJwtToken","createMockRequest","createPaginatedResponse","createPaginatedUrl","createPaginationParams","createUnauthenticatedRequest","expectErrorResponse","expectPaginatedResponse","expectSuccessResponse","extractResponseData","mockApiRequest","mockApiResponse","mockAuthMiddlewareFailure","mockAuthMiddlewareSuccess","mockDatabaseError","mockDatabaseQuery","mockErrorResponse","mockTenantIsolation","parseResponse","simulateRateLimit","simulateRateLimitOk","validateRequestBody","options","method","url","body","headers","searchParams","cookies","urlObj","URL","Object","entries","forEach","key","value","set","init","Headers","JSON","stringify","request","NextRequest","toString","user","createMockUser","organizationId","organization_id","id","Authorization","data","status","NextResponse","json","message","error","response","text","parse","expectedStatus","expect","toBe","get","toContain","errorMessage","then","userId","payload","sub","org_id","role","iat","Math","floor","Date","now","exp","base64Payload","Buffer","from","jest","mock","withAuth","handler","getCurrentUser","fn","mockResolvedValue","requireRole","Error","mockRejectedValue","requiredFields","missingFields","filter","field","valid","length","validBody","invalidBodies","keys","push","code","mockImplementation","query","eq","maxRequests","shouldBlock","remaining","Unauthorized","Forbidden","NotFound","BadRequest","Conflict","InternalServerError","TooManyRequests","errorType","customMessage","page","limit","offset","total","pagination","total_pages","ceil","has_next","has_prev","requiresAuth","enforcesTenantIsolation","validatesInput","enforcesRateLimit","i","not","baseUrl","params","sort","order","toHaveProperty"],"mappings":"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"}