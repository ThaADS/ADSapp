{"version":3,"sources":["C:\\Ai Projecten\\ADSapp\\src\\lib\\auth.ts"],"sourcesContent":["import { createClient } from '@/lib/supabase/server'\nimport { redirect } from 'next/navigation'\n\nexport async function getUser() {\n  const supabase = await createClient()\n  const {\n    data: { user },\n  } = await supabase.auth.getUser()\n\n  return user\n}\n\nexport async function getUserProfile() {\n  const supabase = await createClient()\n  const user = await getUser()\n\n  if (!user) {\n    return null\n  }\n\n  const { data: profile } = await supabase\n    .from('profiles')\n    .select('*, organization:organizations(*)')\n    .eq('id', user.id)\n    .single()\n\n  return profile\n}\n\nexport async function requireAuth() {\n  const user = await getUser()\n\n  if (!user) {\n    redirect('/auth/signin')\n  }\n\n  return user\n}\n\nexport async function requireOrganization() {\n  const profile = await getUserProfile()\n\n  if (!profile?.organization_id) {\n    // Check if user is super admin - they don't need an organization\n    if (profile?.is_super_admin) {\n      // Super admins should go to admin dashboard instead\n      redirect('/admin')\n    } else {\n      redirect('/onboarding')\n    }\n  }\n\n  return profile\n}\n\nexport async function requireSuperAdminOrOrganization() {\n  const profile = await getUserProfile()\n\n  // If user is super admin, they can access without organization\n  if (profile?.is_super_admin) {\n    return profile\n  }\n\n  // Otherwise, require organization\n  if (!profile?.organization_id) {\n    redirect('/onboarding')\n  }\n\n  return profile\n}\n\nexport async function signOut() {\n  const supabase = await createClient()\n  await supabase.auth.signOut()\n  redirect('/auth/signin')\n}"],"names":["getUser","getUserProfile","requireAuth","requireOrganization","requireSuperAdminOrOrganization","signOut","supabase","createClient","data","user","auth","profile","from","select","eq","id","single","redirect","organization_id","is_super_admin"],"mappings":";;;;;;;;;;;QAGsBA;eAAAA;;QASAC;eAAAA;;QAiBAC;eAAAA;;QAUAC;eAAAA;;QAgBAC;eAAAA;;QAgBAC;eAAAA;;;wBAvEO;4BACJ;AAElB,eAAeL;IACpB,MAAMM,WAAW,MAAMC,IAAAA,oBAAY;IACnC,MAAM,EACJC,MAAM,EAAEC,IAAI,EAAE,EACf,GAAG,MAAMH,SAASI,IAAI,CAACV,OAAO;IAE/B,OAAOS;AACT;AAEO,eAAeR;IACpB,MAAMK,WAAW,MAAMC,IAAAA,oBAAY;IACnC,MAAME,OAAO,MAAMT;IAEnB,IAAI,CAACS,MAAM;QACT,OAAO;IACT;IAEA,MAAM,EAAED,MAAMG,OAAO,EAAE,GAAG,MAAML,SAC7BM,IAAI,CAAC,YACLC,MAAM,CAAC,oCACPC,EAAE,CAAC,MAAML,KAAKM,EAAE,EAChBC,MAAM;IAET,OAAOL;AACT;AAEO,eAAeT;IACpB,MAAMO,OAAO,MAAMT;IAEnB,IAAI,CAACS,MAAM;QACTQ,IAAAA,oBAAQ,EAAC;IACX;IAEA,OAAOR;AACT;AAEO,eAAeN;IACpB,MAAMQ,UAAU,MAAMV;IAEtB,IAAI,CAACU,SAASO,iBAAiB;QAC7B,iEAAiE;QACjE,IAAIP,SAASQ,gBAAgB;YAC3B,oDAAoD;YACpDF,IAAAA,oBAAQ,EAAC;QACX,OAAO;YACLA,IAAAA,oBAAQ,EAAC;QACX;IACF;IAEA,OAAON;AACT;AAEO,eAAeP;IACpB,MAAMO,UAAU,MAAMV;IAEtB,+DAA+D;IAC/D,IAAIU,SAASQ,gBAAgB;QAC3B,OAAOR;IACT;IAEA,kCAAkC;IAClC,IAAI,CAACA,SAASO,iBAAiB;QAC7BD,IAAAA,oBAAQ,EAAC;IACX;IAEA,OAAON;AACT;AAEO,eAAeN;IACpB,MAAMC,WAAW,MAAMC,IAAAA,oBAAY;IACnC,MAAMD,SAASI,IAAI,CAACL,OAAO;IAC3BY,IAAAA,oBAAQ,EAAC;AACX"}