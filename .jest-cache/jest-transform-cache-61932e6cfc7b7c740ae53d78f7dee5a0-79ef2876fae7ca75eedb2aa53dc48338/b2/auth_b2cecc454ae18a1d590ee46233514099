02fea2dcbd4e44531e02b56aa10fd775
"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
function _export(target, all) {
    for(var name in all)Object.defineProperty(target, name, {
        enumerable: true,
        get: Object.getOwnPropertyDescriptor(all, name).get
    });
}
_export(exports, {
    get getUser () {
        return getUser;
    },
    get getUserProfile () {
        return getUserProfile;
    },
    get requireAuth () {
        return requireAuth;
    },
    get requireOrganization () {
        return requireOrganization;
    },
    get requireSuperAdminOrOrganization () {
        return requireSuperAdminOrOrganization;
    },
    get signOut () {
        return signOut;
    }
});
const _server = require("./supabase/server");
const _navigation = require("next/navigation");
async function getUser() {
    const supabase = await (0, _server.createClient)();
    const { data: { user } } = await supabase.auth.getUser();
    return user;
}
async function getUserProfile() {
    const supabase = await (0, _server.createClient)();
    const user = await getUser();
    if (!user) {
        return null;
    }
    const { data: profile } = await supabase.from('profiles').select('*, organization:organizations(*)').eq('id', user.id).single();
    return profile;
}
async function requireAuth() {
    const user = await getUser();
    if (!user) {
        (0, _navigation.redirect)('/auth/signin');
    }
    return user;
}
async function requireOrganization() {
    const profile = await getUserProfile();
    if (!profile?.organization_id) {
        // Check if user is super admin - they don't need an organization
        if (profile?.is_super_admin) {
            // Super admins should go to admin dashboard instead
            (0, _navigation.redirect)('/admin');
        } else {
            (0, _navigation.redirect)('/onboarding');
        }
    }
    return profile;
}
async function requireSuperAdminOrOrganization() {
    const profile = await getUserProfile();
    // If user is super admin, they can access without organization
    if (profile?.is_super_admin) {
        return profile;
    }
    // Otherwise, require organization
    if (!profile?.organization_id) {
        (0, _navigation.redirect)('/onboarding');
    }
    return profile;
}
async function signOut() {
    const supabase = await (0, _server.createClient)();
    await supabase.auth.signOut();
    (0, _navigation.redirect)('/auth/signin');
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkM6XFxBaSBQcm9qZWN0ZW5cXEFEU2FwcFxcc3JjXFxsaWJcXGF1dGgudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgY3JlYXRlQ2xpZW50IH0gZnJvbSAnQC9saWIvc3VwYWJhc2Uvc2VydmVyJ1xuaW1wb3J0IHsgcmVkaXJlY3QgfSBmcm9tICduZXh0L25hdmlnYXRpb24nXG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRVc2VyKCkge1xuICBjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpXG4gIGNvbnN0IHtcbiAgICBkYXRhOiB7IHVzZXIgfSxcbiAgfSA9IGF3YWl0IHN1cGFiYXNlLmF1dGguZ2V0VXNlcigpXG5cbiAgcmV0dXJuIHVzZXJcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldFVzZXJQcm9maWxlKCkge1xuICBjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpXG4gIGNvbnN0IHVzZXIgPSBhd2FpdCBnZXRVc2VyKClcblxuICBpZiAoIXVzZXIpIHtcbiAgICByZXR1cm4gbnVsbFxuICB9XG5cbiAgY29uc3QgeyBkYXRhOiBwcm9maWxlIH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgIC5mcm9tKCdwcm9maWxlcycpXG4gICAgLnNlbGVjdCgnKiwgb3JnYW5pemF0aW9uOm9yZ2FuaXphdGlvbnMoKiknKVxuICAgIC5lcSgnaWQnLCB1c2VyLmlkKVxuICAgIC5zaW5nbGUoKVxuXG4gIHJldHVybiBwcm9maWxlXG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiByZXF1aXJlQXV0aCgpIHtcbiAgY29uc3QgdXNlciA9IGF3YWl0IGdldFVzZXIoKVxuXG4gIGlmICghdXNlcikge1xuICAgIHJlZGlyZWN0KCcvYXV0aC9zaWduaW4nKVxuICB9XG5cbiAgcmV0dXJuIHVzZXJcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHJlcXVpcmVPcmdhbml6YXRpb24oKSB7XG4gIGNvbnN0IHByb2ZpbGUgPSBhd2FpdCBnZXRVc2VyUHJvZmlsZSgpXG5cbiAgaWYgKCFwcm9maWxlPy5vcmdhbml6YXRpb25faWQpIHtcbiAgICAvLyBDaGVjayBpZiB1c2VyIGlzIHN1cGVyIGFkbWluIC0gdGhleSBkb24ndCBuZWVkIGFuIG9yZ2FuaXphdGlvblxuICAgIGlmIChwcm9maWxlPy5pc19zdXBlcl9hZG1pbikge1xuICAgICAgLy8gU3VwZXIgYWRtaW5zIHNob3VsZCBnbyB0byBhZG1pbiBkYXNoYm9hcmQgaW5zdGVhZFxuICAgICAgcmVkaXJlY3QoJy9hZG1pbicpXG4gICAgfSBlbHNlIHtcbiAgICAgIHJlZGlyZWN0KCcvb25ib2FyZGluZycpXG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIHByb2ZpbGVcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHJlcXVpcmVTdXBlckFkbWluT3JPcmdhbml6YXRpb24oKSB7XG4gIGNvbnN0IHByb2ZpbGUgPSBhd2FpdCBnZXRVc2VyUHJvZmlsZSgpXG5cbiAgLy8gSWYgdXNlciBpcyBzdXBlciBhZG1pbiwgdGhleSBjYW4gYWNjZXNzIHdpdGhvdXQgb3JnYW5pemF0aW9uXG4gIGlmIChwcm9maWxlPy5pc19zdXBlcl9hZG1pbikge1xuICAgIHJldHVybiBwcm9maWxlXG4gIH1cblxuICAvLyBPdGhlcndpc2UsIHJlcXVpcmUgb3JnYW5pemF0aW9uXG4gIGlmICghcHJvZmlsZT8ub3JnYW5pemF0aW9uX2lkKSB7XG4gICAgcmVkaXJlY3QoJy9vbmJvYXJkaW5nJylcbiAgfVxuXG4gIHJldHVybiBwcm9maWxlXG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBzaWduT3V0KCkge1xuICBjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpXG4gIGF3YWl0IHN1cGFiYXNlLmF1dGguc2lnbk91dCgpXG4gIHJlZGlyZWN0KCcvYXV0aC9zaWduaW4nKVxufSJdLCJuYW1lcyI6WyJnZXRVc2VyIiwiZ2V0VXNlclByb2ZpbGUiLCJyZXF1aXJlQXV0aCIsInJlcXVpcmVPcmdhbml6YXRpb24iLCJyZXF1aXJlU3VwZXJBZG1pbk9yT3JnYW5pemF0aW9uIiwic2lnbk91dCIsInN1cGFiYXNlIiwiY3JlYXRlQ2xpZW50IiwiZGF0YSIsInVzZXIiLCJhdXRoIiwicHJvZmlsZSIsImZyb20iLCJzZWxlY3QiLCJlcSIsImlkIiwic2luZ2xlIiwicmVkaXJlY3QiLCJvcmdhbml6YXRpb25faWQiLCJpc19zdXBlcl9hZG1pbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7UUFHc0JBO2VBQUFBOztRQVNBQztlQUFBQTs7UUFpQkFDO2VBQUFBOztRQVVBQztlQUFBQTs7UUFnQkFDO2VBQUFBOztRQWdCQUM7ZUFBQUE7Ozt3QkF2RU87NEJBQ0o7QUFFbEIsZUFBZUw7SUFDcEIsTUFBTU0sV0FBVyxNQUFNQyxJQUFBQSxvQkFBWTtJQUNuQyxNQUFNLEVBQ0pDLE1BQU0sRUFBRUMsSUFBSSxFQUFFLEVBQ2YsR0FBRyxNQUFNSCxTQUFTSSxJQUFJLENBQUNWLE9BQU87SUFFL0IsT0FBT1M7QUFDVDtBQUVPLGVBQWVSO0lBQ3BCLE1BQU1LLFdBQVcsTUFBTUMsSUFBQUEsb0JBQVk7SUFDbkMsTUFBTUUsT0FBTyxNQUFNVDtJQUVuQixJQUFJLENBQUNTLE1BQU07UUFDVCxPQUFPO0lBQ1Q7SUFFQSxNQUFNLEVBQUVELE1BQU1HLE9BQU8sRUFBRSxHQUFHLE1BQU1MLFNBQzdCTSxJQUFJLENBQUMsWUFDTEMsTUFBTSxDQUFDLG9DQUNQQyxFQUFFLENBQUMsTUFBTUwsS0FBS00sRUFBRSxFQUNoQkMsTUFBTTtJQUVULE9BQU9MO0FBQ1Q7QUFFTyxlQUFlVDtJQUNwQixNQUFNTyxPQUFPLE1BQU1UO0lBRW5CLElBQUksQ0FBQ1MsTUFBTTtRQUNUUSxJQUFBQSxvQkFBUSxFQUFDO0lBQ1g7SUFFQSxPQUFPUjtBQUNUO0FBRU8sZUFBZU47SUFDcEIsTUFBTVEsVUFBVSxNQUFNVjtJQUV0QixJQUFJLENBQUNVLFNBQVNPLGlCQUFpQjtRQUM3QixpRUFBaUU7UUFDakUsSUFBSVAsU0FBU1EsZ0JBQWdCO1lBQzNCLG9EQUFvRDtZQUNwREYsSUFBQUEsb0JBQVEsRUFBQztRQUNYLE9BQU87WUFDTEEsSUFBQUEsb0JBQVEsRUFBQztRQUNYO0lBQ0Y7SUFFQSxPQUFPTjtBQUNUO0FBRU8sZUFBZVA7SUFDcEIsTUFBTU8sVUFBVSxNQUFNVjtJQUV0QiwrREFBK0Q7SUFDL0QsSUFBSVUsU0FBU1EsZ0JBQWdCO1FBQzNCLE9BQU9SO0lBQ1Q7SUFFQSxrQ0FBa0M7SUFDbEMsSUFBSSxDQUFDQSxTQUFTTyxpQkFBaUI7UUFDN0JELElBQUFBLG9CQUFRLEVBQUM7SUFDWDtJQUVBLE9BQU9OO0FBQ1Q7QUFFTyxlQUFlTjtJQUNwQixNQUFNQyxXQUFXLE1BQU1DLElBQUFBLG9CQUFZO0lBQ25DLE1BQU1ELFNBQVNJLElBQUksQ0FBQ0wsT0FBTztJQUMzQlksSUFBQUEsb0JBQVEsRUFBQztBQUNYIn0=