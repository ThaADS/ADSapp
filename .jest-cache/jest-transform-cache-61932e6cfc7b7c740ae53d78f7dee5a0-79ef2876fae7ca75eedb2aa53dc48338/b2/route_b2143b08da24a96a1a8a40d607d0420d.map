{"version":3,"names":["cov_23tv2mvr4j","actualCoverage","s","GET","request","f","user","_auth","requireAuth","supabase","_server1","createClient","data","profile","from","select","eq","id","single","organization_id","b","_server","NextResponse","json","error","status","usage","_server2","StripeService","checkUsageLimits","console"],"sources":["C:\\Ai Projecten\\ADSapp\\src\\app\\api\\billing\\usage\\route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server'\nimport { requireAuth } from '@/lib/auth'\nimport { createClient } from '@/lib/supabase/server'\nimport { StripeService } from '@/lib/stripe/server'\n\nexport async function GET(request: NextRequest) {\n  try {\n    const user = await requireAuth()\n    const supabase = await createClient()\n\n    // Get user's organization\n    const { data: profile } = await supabase\n      .from('profiles')\n      .select('organization_id')\n      .eq('id', user.id)\n      .single()\n\n    if (!profile?.organization_id) {\n      return NextResponse.json({ error: 'Organization not found' }, { status: 404 })\n    }\n\n    // Get usage limits and current usage\n    const usage = await StripeService.checkUsageLimits(profile.organization_id)\n\n    if (!usage) {\n      return NextResponse.json({ error: 'Failed to get usage data' }, { status: 500 })\n    }\n\n    return NextResponse.json({ usage })\n  } catch (error) {\n    console.error('Usage API error:', error)\n    return NextResponse.json(\n      { error: 'Failed to get usage data' },\n      { status: 500 }\n    )\n  }\n}"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;IAMM;IAAAA,cAAA,YAAAA,CAAA;MAAA,OAAAC,cAAA;IAAA;EAAA;EAAA,OAAAA,cAAA;AAAA;AAAAD,cAAA;AAAAA,cAAA,GAAAE,CAAA;;;;;;+BADgB;;;;;;WAAAC,GAAA;;;;;kCALoB;;;kCACd;;;kCACC;;;kCACC;AAEvB,eAAeA,IAAIC,OAAoB;EAAA;EAAAJ,cAAA,GAAAK,CAAA;EAAAL,cAAA,GAAAE,CAAA;EAC5C,IAAI;IACF,MAAMI,IAAA;IAAA;IAAA,CAAAN,cAAA,GAAAE,CAAA,OAAO,MAAM,IAAAK,KAAA,CAAAC,WAAW;IAC9B,MAAMC,QAAA;IAAA;IAAA,CAAAT,cAAA,GAAAE,CAAA,OAAW,MAAM,IAAAQ,QAAA,CAAAC,YAAY;IAEnC;IACA,MAAM;MAAEC,IAAA,EAAMC;IAAO,CAAE;IAAA;IAAA,CAAAb,cAAA,GAAAE,CAAA,QAAG,MAAMO,QAAA,CAC7BK,IAAI,CAAC,YACLC,MAAM,CAAC,mBACPC,EAAE,CAAC,MAAMV,IAAA,CAAKW,EAAE,EAChBC,MAAM;IAAA;IAAAlB,cAAA,GAAAE,CAAA;IAET,IAAI,CAACW,OAAA,EAASM,eAAA,EAAiB;MAAA;MAAAnB,cAAA,GAAAoB,CAAA;MAAApB,cAAA,GAAAE,CAAA;MAC7B,OAAOmB,OAAA,CAAAC,YAAY,CAACC,IAAI,CAAC;QAAEC,KAAA,EAAO;MAAyB,GAAG;QAAEC,MAAA,EAAQ;MAAI;IAC9E;IAAA;IAAA;MAAAzB,cAAA,GAAAoB,CAAA;IAAA;IAEA;IACA,MAAMM,KAAA;IAAA;IAAA,CAAA1B,cAAA,GAAAE,CAAA,QAAQ,MAAMyB,QAAA,CAAAC,aAAa,CAACC,gBAAgB,CAAChB,OAAA,CAAQM,eAAe;IAAA;IAAAnB,cAAA,GAAAE,CAAA;IAE1E,IAAI,CAACwB,KAAA,EAAO;MAAA;MAAA1B,cAAA,GAAAoB,CAAA;MAAApB,cAAA,GAAAE,CAAA;MACV,OAAOmB,OAAA,CAAAC,YAAY,CAACC,IAAI,CAAC;QAAEC,KAAA,EAAO;MAA2B,GAAG;QAAEC,MAAA,EAAQ;MAAI;IAChF;IAAA;IAAA;MAAAzB,cAAA,GAAAoB,CAAA;IAAA;IAAApB,cAAA,GAAAE,CAAA;IAEA,OAAOmB,OAAA,CAAAC,YAAY,CAACC,IAAI,CAAC;MAAEG;IAAM;EACnC,EAAE,OAAOF,KAAA,EAAO;IAAA;IAAAxB,cAAA,GAAAE,CAAA;IACd4B,OAAA,CAAQN,KAAK,CAAC,oBAAoBA,KAAA;IAAA;IAAAxB,cAAA,GAAAE,CAAA;IAClC,OAAOmB,OAAA,CAAAC,YAAY,CAACC,IAAI,CACtB;MAAEC,KAAA,EAAO;IAA2B,GACpC;MAAEC,MAAA,EAAQ;IAAI;EAElB;AACF","ignoreList":[]}