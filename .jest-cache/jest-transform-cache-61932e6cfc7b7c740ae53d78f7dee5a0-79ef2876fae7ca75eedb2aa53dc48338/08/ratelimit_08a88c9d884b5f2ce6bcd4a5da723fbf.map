{"version":3,"names":["RedisRateLimiter","cov_131dfn3xiw","f","s","combineRateLimiters","createIpRateLimiter","createOrgRateLimiter","createRateLimiter","createUserRateLimiter","rateLimitConfigs","rateLimitStore","Map","setInterval","now","Date","key","entry","entries","resetTime","b","delete","config","rateLimitMiddleware","request","keyGenerator","getDefaultKey","record","get","set","count","windowMs","response","_server","NextResponse","next","addRateLimitHeaders","maxRequests","retryAfter","Math","ceil","json","error","message","code","status","headers","toString","ip","getClientIp","userAgent","slice","forwarded","realIp","cfConnectingIp","vercelIp","split","trim","limit","remaining","standard","strict","relaxed","auth","passwordReset","ddos","userId","orgId","constructor","redisClient","redis","isRateLimited","windowStart","floor","windowEnd","redisKey","pipeline","incr","pexpire","results","exec","limited","console","createMiddleware","result","limiters","limiter"],"sources":["C:\\Ai Projecten\\ADSapp\\src\\lib\\middleware\\rate-limit.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\n\n/**\n * Rate Limit Configuration Options\n */\nexport interface RateLimitConfig {\n  windowMs: number; // Time window in milliseconds\n  maxRequests: number; // Maximum requests allowed in window\n  keyGenerator?: (req: NextRequest) => string; // Custom key generator for rate limiting\n  message?: string; // Custom error message\n  skipSuccessfulRequests?: boolean; // Don't count successful requests\n  skipFailedRequests?: boolean; // Don't count failed requests\n}\n\n/**\n * Rate Limit Store Entry\n */\ninterface RateLimitEntry {\n  count: number;\n  resetTime: number;\n}\n\n/**\n * In-Memory Rate Limit Store\n * NOTE: In production, replace with Redis for distributed rate limiting\n */\nconst rateLimitStore = new Map<string, RateLimitEntry>();\n\n/**\n * Cleanup expired entries every 5 minutes\n */\nsetInterval(() => {\n  const now = Date.now();\n  for (const [key, entry] of rateLimitStore.entries()) {\n    if (entry.resetTime < now) {\n      rateLimitStore.delete(key);\n    }\n  }\n}, 5 * 60 * 1000);\n\n/**\n * Create a rate limiting middleware function\n *\n * @param config - Rate limit configuration\n * @returns Middleware function that returns NextResponse on limit exceeded, null otherwise\n *\n * @example\n * ```typescript\n * const rateLimit = createRateLimiter({\n *   windowMs: 60000, // 1 minute\n *   maxRequests: 100 // 100 requests per minute\n * });\n *\n * export async function GET(request: NextRequest) {\n *   const limitResponse = await rateLimit(request);\n *   if (limitResponse) return limitResponse;\n *\n *   // Continue with normal request handling\n * }\n * ```\n */\nexport function createRateLimiter(config: RateLimitConfig) {\n  return async function rateLimitMiddleware(\n    request: NextRequest\n  ): Promise<NextResponse | null> {\n    // Generate rate limit key\n    const key = config.keyGenerator\n      ? config.keyGenerator(request)\n      : getDefaultKey(request);\n\n    const now = Date.now();\n    const record = rateLimitStore.get(key);\n\n    // Create new record if doesn't exist or expired\n    if (!record || record.resetTime < now) {\n      rateLimitStore.set(key, {\n        count: 1,\n        resetTime: now + config.windowMs\n      });\n\n      // Add rate limit headers to response\n      const response = NextResponse.next();\n      addRateLimitHeaders(response, config.maxRequests, config.maxRequests - 1, now + config.windowMs);\n      return null;\n    }\n\n    // Check if limit exceeded\n    if (record.count >= config.maxRequests) {\n      const retryAfter = Math.ceil((record.resetTime - now) / 1000);\n\n      return NextResponse.json(\n        {\n          error: config.message || 'Too many requests',\n          code: 'RATE_LIMIT_EXCEEDED',\n          retryAfter\n        },\n        {\n          status: 429,\n          headers: {\n            'X-RateLimit-Limit': config.maxRequests.toString(),\n            'X-RateLimit-Remaining': '0',\n            'X-RateLimit-Reset': Math.ceil(record.resetTime / 1000).toString(),\n            'Retry-After': retryAfter.toString()\n          }\n        }\n      );\n    }\n\n    // Increment counter\n    record.count++;\n    rateLimitStore.set(key, record);\n\n    // Add rate limit headers\n    const response = NextResponse.next();\n    addRateLimitHeaders(\n      response,\n      config.maxRequests,\n      config.maxRequests - record.count,\n      record.resetTime\n    );\n\n    return null;\n  };\n}\n\n/**\n * Generate default rate limit key from request\n * Uses IP address and user agent for uniqueness\n */\nfunction getDefaultKey(request: NextRequest): string {\n  const ip = getClientIp(request);\n  const userAgent = request.headers.get('user-agent') || 'unknown';\n\n  // Combine IP and first 50 chars of user agent\n  return `${ip}:${userAgent.slice(0, 50)}`;\n}\n\n/**\n * Get client IP address from request\n * Handles various proxy headers\n */\nfunction getClientIp(request: NextRequest): string {\n  const forwarded = request.headers.get('x-forwarded-for');\n  const realIp = request.headers.get('x-real-ip');\n  const cfConnectingIp = request.headers.get('cf-connecting-ip');\n  const vercelIp = request.headers.get('x-vercel-forwarded-for');\n\n  return (\n    cfConnectingIp ||\n    vercelIp ||\n    forwarded?.split(',')[0].trim() ||\n    realIp ||\n    'unknown'\n  );\n}\n\n/**\n * Add rate limit headers to response\n */\nfunction addRateLimitHeaders(\n  response: NextResponse,\n  limit: number,\n  remaining: number,\n  resetTime: number\n): void {\n  response.headers.set('X-RateLimit-Limit', limit.toString());\n  response.headers.set('X-RateLimit-Remaining', remaining.toString());\n  response.headers.set('X-RateLimit-Reset', Math.ceil(resetTime / 1000).toString());\n}\n\n/**\n * Predefined rate limit configurations for common use cases\n */\nexport const rateLimitConfigs = {\n  // Standard API rate limit - 100 requests per minute\n  standard: {\n    windowMs: 60000,\n    maxRequests: 100,\n    message: 'Too many requests, please try again later'\n  } as RateLimitConfig,\n\n  // Strict rate limit for sensitive operations - 30 requests per minute\n  strict: {\n    windowMs: 60000,\n    maxRequests: 30,\n    message: 'Rate limit exceeded for this operation'\n  } as RateLimitConfig,\n\n  // Relaxed rate limit for read operations - 300 requests per minute\n  relaxed: {\n    windowMs: 60000,\n    maxRequests: 300,\n    message: 'Too many requests'\n  } as RateLimitConfig,\n\n  // Authentication rate limit - 5 attempts per 15 minutes\n  auth: {\n    windowMs: 15 * 60000,\n    maxRequests: 5,\n    message: 'Too many authentication attempts, please try again later'\n  } as RateLimitConfig,\n\n  // Password reset rate limit - 3 attempts per hour\n  passwordReset: {\n    windowMs: 60 * 60000,\n    maxRequests: 3,\n    message: 'Too many password reset attempts, please try again later'\n  } as RateLimitConfig,\n\n  // DDoS protection - 100 requests per second\n  ddos: {\n    windowMs: 1000,\n    maxRequests: 100,\n    message: 'Request rate too high, possible DDoS attack detected'\n  } as RateLimitConfig\n};\n\n/**\n * Create IP-based rate limiter\n * Rate limits based on IP address only\n */\nexport function createIpRateLimiter(config: Omit<RateLimitConfig, 'keyGenerator'>) {\n  return createRateLimiter({\n    ...config,\n    keyGenerator: (request: NextRequest) => getClientIp(request)\n  });\n}\n\n/**\n * Create user-based rate limiter\n * Rate limits based on authenticated user ID\n */\nexport function createUserRateLimiter(config: Omit<RateLimitConfig, 'keyGenerator'>) {\n  return createRateLimiter({\n    ...config,\n    keyGenerator: (request: NextRequest) => {\n      const userId = request.headers.get('x-user-id');\n      if (userId) {\n        return `user:${userId}`;\n      }\n      // Fallback to IP if user not authenticated\n      return getClientIp(request);\n    }\n  });\n}\n\n/**\n * Create organization-based rate limiter\n * Rate limits based on organization ID\n */\nexport function createOrgRateLimiter(config: Omit<RateLimitConfig, 'keyGenerator'>) {\n  return createRateLimiter({\n    ...config,\n    keyGenerator: (request: NextRequest) => {\n      const orgId = request.headers.get('x-organization-id');\n      if (orgId) {\n        return `org:${orgId}`;\n      }\n      // Fallback to IP if organization not available\n      return getClientIp(request);\n    }\n  });\n}\n\n/**\n * Redis Client Interface\n * Compatible with ioredis and node-redis\n */\ninterface RedisClient {\n  pipeline(): {\n    incr(key: string): unknown;\n    pexpire(key: string, milliseconds: number): unknown;\n    exec(): Promise<Array<[Error | null, unknown]>>;\n  };\n}\n\n/**\n * Redis-Ready Rate Limiter Class\n * Drop-in replacement for production use with Redis\n *\n * Usage with Redis:\n * ```typescript\n * import Redis from 'ioredis';\n * const redis = new Redis(process.env.REDIS_URL);\n * const rateLimiter = new RedisRateLimiter(redis);\n * ```\n */\nexport class RedisRateLimiter {\n  private redis: RedisClient;\n\n  constructor(redisClient: RedisClient) {\n    this.redis = redisClient;\n  }\n\n  /**\n   * Check if request is rate limited\n   * Uses Redis for distributed rate limiting\n   */\n  async isRateLimited(\n    key: string,\n    config: RateLimitConfig\n  ): Promise<{\n    limited: boolean;\n    remaining: number;\n    resetTime: number;\n  }> {\n    const now = Date.now();\n    const windowStart = Math.floor(now / config.windowMs) * config.windowMs;\n    const windowEnd = windowStart + config.windowMs;\n    const redisKey = `rate_limit:${key}:${windowStart}`;\n\n    try {\n      // Use Redis pipeline for atomic operations\n      const pipeline = this.redis.pipeline();\n      pipeline.incr(redisKey);\n      pipeline.pexpire(redisKey, config.windowMs);\n\n      const results = await pipeline.exec();\n      const count = results[0][1] as number;\n\n      if (count > config.maxRequests) {\n        return {\n          limited: true,\n          remaining: 0,\n          resetTime: windowEnd\n        };\n      }\n\n      return {\n        limited: false,\n        remaining: config.maxRequests - count,\n        resetTime: windowEnd\n      };\n    } catch (error) {\n      console.error('Redis rate limiting error:', error);\n\n      // Fallback to allowing request if Redis is unavailable\n      // Better to allow traffic than block legitimate users\n      return {\n        limited: false,\n        remaining: config.maxRequests,\n        resetTime: windowEnd\n      };\n    }\n  }\n\n  /**\n   * Create a rate limiter middleware using Redis backend\n   */\n  createMiddleware(config: RateLimitConfig) {\n    return async (request: NextRequest): Promise<NextResponse | null> => {\n      const key = config.keyGenerator\n        ? config.keyGenerator(request)\n        : getDefaultKey(request);\n\n      const result = await this.isRateLimited(key, config);\n\n      if (result.limited) {\n        const retryAfter = Math.ceil((result.resetTime - Date.now()) / 1000);\n\n        return NextResponse.json(\n          {\n            error: config.message || 'Too many requests',\n            code: 'RATE_LIMIT_EXCEEDED',\n            retryAfter\n          },\n          {\n            status: 429,\n            headers: {\n              'X-RateLimit-Limit': config.maxRequests.toString(),\n              'X-RateLimit-Remaining': '0',\n              'X-RateLimit-Reset': Math.ceil(result.resetTime / 1000).toString(),\n              'Retry-After': retryAfter.toString()\n            }\n          }\n        );\n      }\n\n      const response = NextResponse.next();\n      addRateLimitHeaders(\n        response,\n        config.maxRequests,\n        result.remaining,\n        result.resetTime\n      );\n\n      return null;\n    };\n  }\n}\n\n/**\n * Helper function to combine multiple rate limiters\n * Useful for applying different rate limits to the same endpoint\n *\n * @example\n * ```typescript\n * const combinedLimit = combineRateLimiters([\n *   createIpRateLimiter(rateLimitConfigs.standard),\n *   createUserRateLimiter(rateLimitConfigs.strict)\n * ]);\n * ```\n */\nexport function combineRateLimiters(\n  limiters: Array<(req: NextRequest) => Promise<NextResponse | null>>\n) {\n  return async (request: NextRequest): Promise<NextResponse | null> => {\n    for (const limiter of limiters) {\n      const result = await limiter(request);\n      if (result) return result; // Return first rate limit error\n    }\n    return null; // All checks passed\n  };\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}