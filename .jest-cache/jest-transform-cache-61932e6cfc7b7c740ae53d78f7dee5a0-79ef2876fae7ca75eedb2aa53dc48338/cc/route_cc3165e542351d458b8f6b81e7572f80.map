{"version":3,"names":["DELETE","cov_1lluoe8snc","f","s","PUT","request","params","middlewareResponse","_middleware","strictApiMiddleware","b","organizationId","getTenantContext","expiryMonth","expiryYear","metadata","json","id","paymentMethodManager","_paymentmethods","PaymentMethodManager","updatePaymentMethod","_server","NextResponse","success","error","console","Error","message","status","detachPaymentMethod"],"sources":["C:\\Ai Projecten\\ADSapp\\src\\app\\api\\billing\\payment-methods\\[id]\\route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server'\nimport { createClient } from '@/lib/supabase/server'\nimport { PaymentMethodManager } from '@/lib/billing/payment-methods'\nimport { strictApiMiddleware, getTenantContext } from '@/lib/middleware'\n\nexport async function PUT(\n  request: NextRequest,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  // Apply strict API middleware (tenant validation + strict rate limiting)\n  const middlewareResponse = await strictApiMiddleware(request);\n  if (middlewareResponse) return middlewareResponse;\n\n  try {\n    // Get tenant context from middleware (already validated)\n    const { organizationId } = getTenantContext(request);\n    const { expiryMonth, expiryYear, metadata } = await request.json();\n    const { id } = await params;\n\n    const paymentMethodManager = new PaymentMethodManager();\n    await paymentMethodManager.updatePaymentMethod(organizationId, id, {\n      expiryMonth,\n      expiryYear,\n      metadata,\n    });\n\n    return NextResponse.json({ success: true })\n  } catch (error) {\n    console.error('Update payment method API error:', error)\n    return NextResponse.json(\n      { error: error instanceof Error ? error.message : 'Internal server error' },\n      { status: 500 }\n    )\n  }\n}\n\nexport async function DELETE(\n  request: NextRequest,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  // Apply strict API middleware (tenant validation + strict rate limiting)\n  const middlewareResponse = await strictApiMiddleware(request);\n  if (middlewareResponse) return middlewareResponse;\n\n  try {\n    // Get tenant context from middleware (already validated)\n    const { organizationId } = getTenantContext(request);\n    const { id } = await params;\n\n    const paymentMethodManager = new PaymentMethodManager();\n    await paymentMethodManager.detachPaymentMethod(organizationId, id);\n\n    return NextResponse.json({ success: true })\n  } catch (error) {\n    console.error('Delete payment method API error:', error)\n    return NextResponse.json(\n      { error: error instanceof Error ? error.message : 'Internal server error' },\n      { status: 500 }\n    )\n  }\n}"],"mappings":"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","ignoreList":[]}