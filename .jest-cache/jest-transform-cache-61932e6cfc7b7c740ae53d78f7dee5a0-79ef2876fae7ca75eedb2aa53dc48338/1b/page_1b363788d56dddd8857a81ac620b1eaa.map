{"version":3,"names":["cov_9u7sb1bzn","actualCoverage","s","InboxPage","f","profile","_auth","requireOrganization","supabase","_server","createClient","data","conversations","from","select","eq","organization_id","order","ascending","conversationsWithUnread","b","map","conv","unread_count","messages","filter","msg","sender_type","is_read","length","last_message","sort","a","Date","created_at","getTime","_jsxruntime","jsx","className","_inboxlayout","InboxLayout"],"sources":["C:\\Ai Projecten\\ADSapp\\src\\app\\dashboard\\inbox\\page.tsx"],"sourcesContent":["import { requireOrganization } from '@/lib/auth'\nimport { createClient } from '@/lib/supabase/server'\nimport { InboxLayout } from '@/components/inbox/inbox-layout'\n\nexport default async function InboxPage() {\n  const profile = await requireOrganization()\n  const supabase = await createClient()\n\n  // Fetch conversations with contact details and unread counts\n  const { data: conversations } = await supabase\n    .from('conversations')\n    .select(`\n      *,\n      contact:contacts(*),\n      assigned_agent:profiles(full_name, avatar_url),\n      messages!inner(\n        id,\n        content,\n        sender_type,\n        is_read,\n        created_at\n      )\n    `)\n    .eq('organization_id', profile.organization_id)\n    .order('last_message_at', { ascending: false })\n\n  // Transform conversations with unread counts\n  const conversationsWithUnread = conversations?.map(conv => ({\n    ...conv,\n    unread_count: conv.messages?.filter((msg: any) =>\n      msg.sender_type === 'contact' && !msg.is_read\n    ).length || 0,\n    last_message: conv.messages?.sort((a: any, b: any) =>\n      new Date(b.created_at).getTime() - new Date(a.created_at).getTime()\n    )[0]\n  })) || []\n\n  return (\n    <div className=\"h-[calc(100vh-4rem)]\">\n      <InboxLayout\n        conversations={conversationsWithUnread}\n        profile={profile}\n      />\n    </div>\n  )\n}"],"mappings":"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","ignoreList":[]}