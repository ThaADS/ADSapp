{"version":3,"names":["DELETE","cov_225sqyur1x","f","s","GET","PATCH","request","params","user","_apiutils","requireAuthenticatedUser","profile","getUserOrganization","id","queue","_queue","BulkOperationQueue","operation","getOperation","organization_id","b","_server","NextResponse","json","error","status","createSuccessResponse","console","createErrorResponse","body","action","includes","cancelOperation","message","role","supabase","_server1","createClient","from","delete","eq"],"sources":["C:\\Ai Projecten\\ADSapp\\src\\app\\api\\bulk\\operations\\[id]\\route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server'\nimport { requireAuthenticatedUser, getUserOrganization, createErrorResponse, createSuccessResponse } from '@/lib/api-utils'\nimport { BulkOperationQueue } from '@/lib/bulk-operations/queue'\nimport { createClient } from '@/lib/supabase/server'\n\nexport async function GET(\n  request: NextRequest,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  try {\n    // Authenticate user\n    const user = await requireAuthenticatedUser()\n    const profile = await getUserOrganization(user.id)\n    const { id } = await params;\n\n    const queue = new BulkOperationQueue()\n    const operation = await queue.getOperation(id, profile.organization_id)\n\n    if (!operation) {\n      return NextResponse.json(\n        { error: 'Operation not found' },\n        { status: 404 }\n      )\n    }\n\n    return createSuccessResponse(operation)\n\n  } catch (error) {\n    console.error('Get bulk operation error:', error)\n    return createErrorResponse(error)\n  }\n}\n\nexport async function PATCH(\n  request: NextRequest,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  try {\n    // Authenticate user\n    const user = await requireAuthenticatedUser()\n    const profile = await getUserOrganization(user.id)\n    const { id } = await params;\n\n    const body = await request.json()\n    const { action } = body\n\n    if (action !== 'cancel') {\n      return NextResponse.json(\n        { error: 'Only cancel action is supported' },\n        { status: 400 }\n      )\n    }\n\n    const queue = new BulkOperationQueue()\n\n    // Check if operation exists and belongs to organization\n    const operation = await queue.getOperation(id, profile.organization_id)\n    if (!operation) {\n      return NextResponse.json(\n        { error: 'Operation not found' },\n        { status: 404 }\n      )\n    }\n\n    // Check if operation can be cancelled\n    if (!['queued', 'processing'].includes(operation.status)) {\n      return NextResponse.json(\n        { error: 'Operation cannot be cancelled in current status' },\n        { status: 400 }\n      )\n    }\n\n    await queue.cancelOperation(id, profile.organization_id)\n\n    return createSuccessResponse({\n      id: id,\n      status: 'cancelled',\n      message: 'Operation cancelled successfully'\n    })\n\n  } catch (error) {\n    console.error('Cancel bulk operation error:', error)\n    return createErrorResponse(error)\n  }\n}\n\nexport async function DELETE(\n  request: NextRequest,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  try {\n    // Authenticate user\n    const user = await requireAuthenticatedUser()\n    const profile = await getUserOrganization(user.id)\n    const { id } = await params;\n\n    // Check if user has admin privileges\n    if (profile.role !== 'admin' && profile.role !== 'owner') {\n      return NextResponse.json(\n        { error: 'Insufficient privileges' },\n        { status: 403 }\n      )\n    }\n\n    const queue = new BulkOperationQueue()\n\n    // Check if operation exists and belongs to organization\n    const operation = await queue.getOperation(id, profile.organization_id)\n    if (!operation) {\n      return NextResponse.json(\n        { error: 'Operation not found' },\n        { status: 404 }\n      )\n    }\n\n    // Only allow deletion of completed/failed/cancelled operations\n    if (!['completed', 'failed', 'cancelled'].includes(operation.status)) {\n      return NextResponse.json(\n        { error: 'Cannot delete active operation' },\n        { status: 400 }\n      )\n    }\n\n    // Delete the operation record\n    const supabase = await createClient()\n    const { error } = await supabase\n      .from('bulk_operations')\n      .delete()\n      .eq('id', id)\n      .eq('organization_id', profile.organization_id)\n\n    if (error) {\n      throw error\n    }\n\n    return createSuccessResponse({\n      id: id,\n      message: 'Operation deleted successfully'\n    })\n\n  } catch (error) {\n    console.error('Delete bulk operation error:', error)\n    return createErrorResponse(error)\n  }\n}"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;MAsF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","ignoreList":[]}