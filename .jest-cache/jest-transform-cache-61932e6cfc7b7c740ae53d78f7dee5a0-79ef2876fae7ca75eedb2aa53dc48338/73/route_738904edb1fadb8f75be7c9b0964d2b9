a837564dd9d217cc3ec361f819264f06
"use strict";

/* istanbul ignore next */
function cov_2m4sc510y() {
  var path = "C:\\Ai Projecten\\ADSapp\\src\\app\\api\\billing\\subscription\\route.ts";
  var hash = "9d4176b100df229ed9e2bda1d9aa7e7e991b759a";
  var global = new Function("return this")();
  var gcv = "__coverage__";
  var coverageData = {
    path: "C:\\Ai Projecten\\ADSapp\\src\\app\\api\\billing\\subscription\\route.ts",
    statementMap: {
      "0": {
        start: {
          line: 2,
          column: 0
        },
        end: {
          line: 4,
          column: 3
        }
      },
      "1": {
        start: {
          line: 5,
          column: 0
        },
        end: {
          line: 10,
          column: 3
        }
      },
      "2": {
        start: {
          line: 8,
          column: 8
        },
        end: {
          line: 8,
          column: 19
        }
      },
      "3": {
        start: {
          line: 11,
          column: 16
        },
        end: {
          line: 11,
          column: 38
        }
      },
      "4": {
        start: {
          line: 12,
          column: 17
        },
        end: {
          line: 12,
          column: 59
        }
      },
      "5": {
        start: {
          line: 13,
          column: 17
        },
        end: {
          line: 13,
          column: 57
        }
      },
      "6": {
        start: {
          line: 14,
          column: 20
        },
        end: {
          line: 14,
          column: 57
        }
      },
      "7": {
        start: {
          line: 17,
          column: 31
        },
        end: {
          line: 17,
          column: 82
        }
      },
      "8": {
        start: {
          line: 18,
          column: 4
        },
        end: {
          line: 18,
          column: 54
        }
      },
      "9": {
        start: {
          line: 18,
          column: 28
        },
        end: {
          line: 18,
          column: 54
        }
      },
      "10": {
        start: {
          line: 19,
          column: 4
        },
        end: {
          line: 62,
          column: 5
        }
      },
      "11": {
        start: {
          line: 21,
          column: 35
        },
        end: {
          line: 21,
          column: 77
        }
      },
      "12": {
        start: {
          line: 22,
          column: 25
        },
        end: {
          line: 22,
          column: 59
        }
      },
      "13": {
        start: {
          line: 24,
          column: 30
        },
        end: {
          line: 24,
          column: 112
        }
      },
      "14": {
        start: {
          line: 25,
          column: 8
        },
        end: {
          line: 31,
          column: 9
        }
      },
      "15": {
        start: {
          line: 26,
          column: 12
        },
        end: {
          line: 30,
          column: 15
        }
      },
      "16": {
        start: {
          line: 32,
          column: 8
        },
        end: {
          line: 36,
          column: 9
        }
      },
      "17": {
        start: {
          line: 33,
          column: 12
        },
        end: {
          line: 35,
          column: 15
        }
      },
      "18": {
        start: {
          line: 38,
          column: 29
        },
        end: {
          line: 38,
          column: 101
        }
      },
      "19": {
        start: {
          line: 39,
          column: 33
        },
        end: {
          line: 53,
          column: 9
        }
      },
      "20": {
        start: {
          line: 54,
          column: 8
        },
        end: {
          line: 54,
          column: 59
        }
      },
      "21": {
        start: {
          line: 56,
          column: 8
        },
        end: {
          line: 56,
          column: 56
        }
      },
      "22": {
        start: {
          line: 57,
          column: 8
        },
        end: {
          line: 61,
          column: 11
        }
      }
    },
    fnMap: {
      "0": {
        name: "(anonymous_0)",
        decl: {
          start: {
            line: 7,
            column: 9
          },
          end: {
            line: 7,
            column: 10
          }
        },
        loc: {
          start: {
            line: 7,
            column: 20
          },
          end: {
            line: 9,
            column: 5
          }
        },
        line: 7
      },
      "1": {
        name: "GET",
        decl: {
          start: {
            line: 15,
            column: 15
          },
          end: {
            line: 15,
            column: 18
          }
        },
        loc: {
          start: {
            line: 15,
            column: 28
          },
          end: {
            line: 63,
            column: 1
          }
        },
        line: 15
      }
    },
    branchMap: {
      "0": {
        loc: {
          start: {
            line: 18,
            column: 4
          },
          end: {
            line: 18,
            column: 54
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 18,
            column: 4
          },
          end: {
            line: 18,
            column: 54
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 18
      },
      "1": {
        loc: {
          start: {
            line: 25,
            column: 8
          },
          end: {
            line: 31,
            column: 9
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 25,
            column: 8
          },
          end: {
            line: 31,
            column: 9
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 25
      },
      "2": {
        loc: {
          start: {
            line: 32,
            column: 8
          },
          end: {
            line: 36,
            column: 9
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 32,
            column: 8
          },
          end: {
            line: 36,
            column: 9
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 32
      },
      "3": {
        loc: {
          start: {
            line: 44,
            column: 19
          },
          end: {
            line: 44,
            column: 70
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 44,
            column: 19
          },
          end: {
            line: 44,
            column: 65
          }
        }, {
          start: {
            line: 44,
            column: 69
          },
          end: {
            line: 44,
            column: 70
          }
        }],
        line: 44
      },
      "4": {
        loc: {
          start: {
            line: 46,
            column: 22
          },
          end: {
            line: 46,
            column: 87
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 46,
            column: 22
          },
          end: {
            line: 46,
            column: 76
          }
        }, {
          start: {
            line: 46,
            column: 80
          },
          end: {
            line: 46,
            column: 87
          }
        }],
        line: 46
      },
      "5": {
        loc: {
          start: {
            line: 49,
            column: 22
          },
          end: {
            line: 49,
            column: 112
          }
        },
        type: "cond-expr",
        locations: [{
          start: {
            line: 49,
            column: 47
          },
          end: {
            line: 49,
            column: 100
          }
        }, {
          start: {
            line: 49,
            column: 103
          },
          end: {
            line: 49,
            column: 112
          }
        }],
        line: 49
      },
      "6": {
        loc: {
          start: {
            line: 50,
            column: 22
          },
          end: {
            line: 50,
            column: 112
          }
        },
        type: "cond-expr",
        locations: [{
          start: {
            line: 50,
            column: 47
          },
          end: {
            line: 50,
            column: 100
          }
        }, {
          start: {
            line: 50,
            column: 103
          },
          end: {
            line: 50,
            column: 112
          }
        }],
        line: 50
      },
      "7": {
        loc: {
          start: {
            line: 51,
            column: 24
          },
          end: {
            line: 51,
            column: 118
          }
        },
        type: "cond-expr",
        locations: [{
          start: {
            line: 51,
            column: 51
          },
          end: {
            line: 51,
            column: 106
          }
        }, {
          start: {
            line: 51,
            column: 109
          },
          end: {
            line: 51,
            column: 118
          }
        }],
        line: 51
      }
    },
    s: {
      "0": 0,
      "1": 0,
      "2": 0,
      "3": 0,
      "4": 0,
      "5": 0,
      "6": 0,
      "7": 0,
      "8": 0,
      "9": 0,
      "10": 0,
      "11": 0,
      "12": 0,
      "13": 0,
      "14": 0,
      "15": 0,
      "16": 0,
      "17": 0,
      "18": 0,
      "19": 0,
      "20": 0,
      "21": 0,
      "22": 0
    },
    f: {
      "0": 0,
      "1": 0
    },
    b: {
      "0": [0, 0],
      "1": [0, 0],
      "2": [0, 0],
      "3": [0, 0],
      "4": [0, 0],
      "5": [0, 0],
      "6": [0, 0],
      "7": [0, 0]
    },
    inputSourceMap: {
      version: 3,
      sources: ["C:\\Ai Projecten\\ADSapp\\src\\app\\api\\billing\\subscription\\route.ts"],
      sourcesContent: ["import { NextRequest, NextResponse } from 'next/server'\nimport { createClient } from '@/lib/supabase/server'\nimport { stripe } from '@/lib/stripe/server'\nimport { strictApiMiddleware, getTenantContext } from '@/lib/middleware'\n\nexport async function GET(request: NextRequest) {\n  // Apply strict API middleware (tenant validation + strict rate limiting)\n  const middlewareResponse = await strictApiMiddleware(request);\n  if (middlewareResponse) return middlewareResponse;\n\n  try {\n    // Get tenant context from middleware (already validated)\n    const { organizationId } = getTenantContext(request);\n\n    const supabase = await createClient();\n\n    // Get organization subscription data\n    const { data: org } = await supabase\n      .from('organizations')\n      .select('*')\n      .eq('id', organizationId)\n      .single()\n\n    if (!org) {\n      return NextResponse.json(\n        { error: 'Organization not found' },\n        { status: 404 }\n      )\n    }\n\n    if (!org.stripe_subscription_id) {\n      return NextResponse.json({ subscription: null })\n    }\n\n    // Get subscription from Stripe\n    const subscription = await stripe.subscriptions.retrieve(org.stripe_subscription_id)\n\n    const subscriptionData = {\n      id: subscription.id,\n      status: subscription.status,\n      planId: org.subscription_tier,\n      planName: org.subscription_tier,\n      price: subscription.items.data[0]?.price?.unit_amount || 0,\n      currency: subscription.currency,\n      interval: subscription.items.data[0]?.price?.recurring?.interval || 'month',\n      currentPeriodStart: new Date(subscription.current_period_start * 1000).toISOString(),\n      currentPeriodEnd: new Date(subscription.current_period_end * 1000).toISOString(),\n      trialEnd: subscription.trial_end ? new Date(subscription.trial_end * 1000).toISOString() : undefined,\n      cancelAt: subscription.cancel_at ? new Date(subscription.cancel_at * 1000).toISOString() : undefined,\n      canceledAt: subscription.canceled_at ? new Date(subscription.canceled_at * 1000).toISOString() : undefined,\n      createdAt: new Date(subscription.created * 1000).toISOString(),\n    }\n\n    return NextResponse.json(subscriptionData)\n  } catch (error) {\n    console.error('Subscription API error:', error)\n    return NextResponse.json(\n      { error: 'Internal server error' },\n      { status: 500 }\n    )\n  }\n}"],
      names: ["GET", "request", "middlewareResponse", "strictApiMiddleware", "organizationId", "getTenantContext", "supabase", "createClient", "data", "org", "from", "select", "eq", "single", "NextResponse", "json", "error", "status", "stripe_subscription_id", "subscription", "stripe", "subscriptions", "retrieve", "subscriptionData", "id", "planId", "subscription_tier", "planName", "price", "items", "unit_amount", "currency", "interval", "recurring", "currentPeriodStart", "Date", "current_period_start", "toISOString", "currentPeriodEnd", "current_period_end", "trialEnd", "trial_end", "undefined", "cancelAt", "cancel_at", "canceledAt", "canceled_at", "createdAt", "created", "console"],
      mappings: ";;;;+BAKsBA;;;eAAAA;;;wBALoB;yBACb;yBACN;4BAC+B;AAE/C,eAAeA,IAAIC,OAAoB;IAC5C,yEAAyE;IACzE,MAAMC,qBAAqB,MAAMC,IAAAA,+BAAmB,EAACF;IACrD,IAAIC,oBAAoB,OAAOA;IAE/B,IAAI;QACF,yDAAyD;QACzD,MAAM,EAAEE,cAAc,EAAE,GAAGC,IAAAA,4BAAgB,EAACJ;QAE5C,MAAMK,WAAW,MAAMC,IAAAA,qBAAY;QAEnC,qCAAqC;QACrC,MAAM,EAAEC,MAAMC,GAAG,EAAE,GAAG,MAAMH,SACzBI,IAAI,CAAC,iBACLC,MAAM,CAAC,KACPC,EAAE,CAAC,MAAMR,gBACTS,MAAM;QAET,IAAI,CAACJ,KAAK;YACR,OAAOK,oBAAY,CAACC,IAAI,CACtB;gBAAEC,OAAO;YAAyB,GAClC;gBAAEC,QAAQ;YAAI;QAElB;QAEA,IAAI,CAACR,IAAIS,sBAAsB,EAAE;YAC/B,OAAOJ,oBAAY,CAACC,IAAI,CAAC;gBAAEI,cAAc;YAAK;QAChD;QAEA,+BAA+B;QAC/B,MAAMA,eAAe,MAAMC,eAAM,CAACC,aAAa,CAACC,QAAQ,CAACb,IAAIS,sBAAsB;QAEnF,MAAMK,mBAAmB;YACvBC,IAAIL,aAAaK,EAAE;YACnBP,QAAQE,aAAaF,MAAM;YAC3BQ,QAAQhB,IAAIiB,iBAAiB;YAC7BC,UAAUlB,IAAIiB,iBAAiB;YAC/BE,OAAOT,aAAaU,KAAK,CAACrB,IAAI,CAAC,EAAE,EAAEoB,OAAOE,eAAe;YACzDC,UAAUZ,aAAaY,QAAQ;YAC/BC,UAAUb,aAAaU,KAAK,CAACrB,IAAI,CAAC,EAAE,EAAEoB,OAAOK,WAAWD,YAAY;YACpEE,oBAAoB,IAAIC,KAAKhB,aAAaiB,oBAAoB,GAAG,MAAMC,WAAW;YAClFC,kBAAkB,IAAIH,KAAKhB,aAAaoB,kBAAkB,GAAG,MAAMF,WAAW;YAC9EG,UAAUrB,aAAasB,SAAS,GAAG,IAAIN,KAAKhB,aAAasB,SAAS,GAAG,MAAMJ,WAAW,KAAKK;YAC3FC,UAAUxB,aAAayB,SAAS,GAAG,IAAIT,KAAKhB,aAAayB,SAAS,GAAG,MAAMP,WAAW,KAAKK;YAC3FG,YAAY1B,aAAa2B,WAAW,GAAG,IAAIX,KAAKhB,aAAa2B,WAAW,GAAG,MAAMT,WAAW,KAAKK;YACjGK,WAAW,IAAIZ,KAAKhB,aAAa6B,OAAO,GAAG,MAAMX,WAAW;QAC9D;QAEA,OAAOvB,oBAAY,CAACC,IAAI,CAACQ;IAC3B,EAAE,OAAOP,OAAO;QACdiC,QAAQjC,KAAK,CAAC,2BAA2BA;QACzC,OAAOF,oBAAY,CAACC,IAAI,CACtB;YAAEC,OAAO;QAAwB,GACjC;YAAEC,QAAQ;QAAI;IAElB;AACF"
    },
    _coverageSchema: "1a1c01bbd47fc00a2c39e90264f33305004495a9",
    hash: "9d4176b100df229ed9e2bda1d9aa7e7e991b759a"
  };
  var coverage = global[gcv] || (global[gcv] = {});
  if (!coverage[path] || coverage[path].hash !== hash) {
    coverage[path] = coverageData;
  }
  var actualCoverage = coverage[path];
  {
    // @ts-ignore
    cov_2m4sc510y = function () {
      return actualCoverage;
    };
  }
  return actualCoverage;
}
cov_2m4sc510y();
cov_2m4sc510y().s[0]++;
Object.defineProperty(exports, "__esModule", {
  value: true
});
/* istanbul ignore next */
cov_2m4sc510y().s[1]++;
Object.defineProperty(exports, "GET", {
  enumerable: true,
  get: function () {
    /* istanbul ignore next */
    cov_2m4sc510y().f[0]++;
    cov_2m4sc510y().s[2]++;
    return GET;
  }
});
const _server =
/* istanbul ignore next */
(cov_2m4sc510y().s[3]++, require("next/server"));
const _server1 =
/* istanbul ignore next */
(cov_2m4sc510y().s[4]++, require("../../../../lib/supabase/server"));
const _server2 =
/* istanbul ignore next */
(cov_2m4sc510y().s[5]++, require("../../../../lib/stripe/server"));
const _middleware =
/* istanbul ignore next */
(cov_2m4sc510y().s[6]++, require("../../../../lib/middleware"));
async function GET(request) {
  /* istanbul ignore next */
  cov_2m4sc510y().f[1]++;
  // Apply strict API middleware (tenant validation + strict rate limiting)
  const middlewareResponse =
  /* istanbul ignore next */
  (cov_2m4sc510y().s[7]++, await (0, _middleware.strictApiMiddleware)(request));
  /* istanbul ignore next */
  cov_2m4sc510y().s[8]++;
  if (middlewareResponse) {
    /* istanbul ignore next */
    cov_2m4sc510y().b[0][0]++;
    cov_2m4sc510y().s[9]++;
    return middlewareResponse;
  } else
  /* istanbul ignore next */
  {
    cov_2m4sc510y().b[0][1]++;
  }
  cov_2m4sc510y().s[10]++;
  try {
    // Get tenant context from middleware (already validated)
    const {
      organizationId
    } =
    /* istanbul ignore next */
    (cov_2m4sc510y().s[11]++, (0, _middleware.getTenantContext)(request));
    const supabase =
    /* istanbul ignore next */
    (cov_2m4sc510y().s[12]++, await (0, _server1.createClient)());
    // Get organization subscription data
    const {
      data: org
    } =
    /* istanbul ignore next */
    (cov_2m4sc510y().s[13]++, await supabase.from('organizations').select('*').eq('id', organizationId).single());
    /* istanbul ignore next */
    cov_2m4sc510y().s[14]++;
    if (!org) {
      /* istanbul ignore next */
      cov_2m4sc510y().b[1][0]++;
      cov_2m4sc510y().s[15]++;
      return _server.NextResponse.json({
        error: 'Organization not found'
      }, {
        status: 404
      });
    } else
    /* istanbul ignore next */
    {
      cov_2m4sc510y().b[1][1]++;
    }
    cov_2m4sc510y().s[16]++;
    if (!org.stripe_subscription_id) {
      /* istanbul ignore next */
      cov_2m4sc510y().b[2][0]++;
      cov_2m4sc510y().s[17]++;
      return _server.NextResponse.json({
        subscription: null
      });
    } else
    /* istanbul ignore next */
    {
      cov_2m4sc510y().b[2][1]++;
    }
    // Get subscription from Stripe
    const subscription =
    /* istanbul ignore next */
    (cov_2m4sc510y().s[18]++, await _server2.stripe.subscriptions.retrieve(org.stripe_subscription_id));
    const subscriptionData =
    /* istanbul ignore next */
    (cov_2m4sc510y().s[19]++, {
      id: subscription.id,
      status: subscription.status,
      planId: org.subscription_tier,
      planName: org.subscription_tier,
      price:
      /* istanbul ignore next */
      (cov_2m4sc510y().b[3][0]++, subscription.items.data[0]?.price?.unit_amount) ||
      /* istanbul ignore next */
      (cov_2m4sc510y().b[3][1]++, 0),
      currency: subscription.currency,
      interval:
      /* istanbul ignore next */
      (cov_2m4sc510y().b[4][0]++, subscription.items.data[0]?.price?.recurring?.interval) ||
      /* istanbul ignore next */
      (cov_2m4sc510y().b[4][1]++, 'month'),
      currentPeriodStart: new Date(subscription.current_period_start * 1000).toISOString(),
      currentPeriodEnd: new Date(subscription.current_period_end * 1000).toISOString(),
      trialEnd: subscription.trial_end ?
      /* istanbul ignore next */
      (cov_2m4sc510y().b[5][0]++, new Date(subscription.trial_end * 1000).toISOString()) :
      /* istanbul ignore next */
      (cov_2m4sc510y().b[5][1]++, undefined),
      cancelAt: subscription.cancel_at ?
      /* istanbul ignore next */
      (cov_2m4sc510y().b[6][0]++, new Date(subscription.cancel_at * 1000).toISOString()) :
      /* istanbul ignore next */
      (cov_2m4sc510y().b[6][1]++, undefined),
      canceledAt: subscription.canceled_at ?
      /* istanbul ignore next */
      (cov_2m4sc510y().b[7][0]++, new Date(subscription.canceled_at * 1000).toISOString()) :
      /* istanbul ignore next */
      (cov_2m4sc510y().b[7][1]++, undefined),
      createdAt: new Date(subscription.created * 1000).toISOString()
    });
    /* istanbul ignore next */
    cov_2m4sc510y().s[20]++;
    return _server.NextResponse.json(subscriptionData);
  } catch (error) {
    /* istanbul ignore next */
    cov_2m4sc510y().s[21]++;
    console.error('Subscription API error:', error);
    /* istanbul ignore next */
    cov_2m4sc510y().s[22]++;
    return _server.NextResponse.json({
      error: 'Internal server error'
    }, {
      status: 500
    });
  }
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJjb3ZfMm00c2M1MTB5IiwiYWN0dWFsQ292ZXJhZ2UiLCJzIiwiR0VUIiwicmVxdWVzdCIsImYiLCJtaWRkbGV3YXJlUmVzcG9uc2UiLCJfbWlkZGxld2FyZSIsInN0cmljdEFwaU1pZGRsZXdhcmUiLCJiIiwib3JnYW5pemF0aW9uSWQiLCJnZXRUZW5hbnRDb250ZXh0Iiwic3VwYWJhc2UiLCJfc2VydmVyMSIsImNyZWF0ZUNsaWVudCIsImRhdGEiLCJvcmciLCJmcm9tIiwic2VsZWN0IiwiZXEiLCJzaW5nbGUiLCJfc2VydmVyIiwiTmV4dFJlc3BvbnNlIiwianNvbiIsImVycm9yIiwic3RhdHVzIiwic3RyaXBlX3N1YnNjcmlwdGlvbl9pZCIsInN1YnNjcmlwdGlvbiIsIl9zZXJ2ZXIyIiwic3RyaXBlIiwic3Vic2NyaXB0aW9ucyIsInJldHJpZXZlIiwic3Vic2NyaXB0aW9uRGF0YSIsImlkIiwicGxhbklkIiwic3Vic2NyaXB0aW9uX3RpZXIiLCJwbGFuTmFtZSIsInByaWNlIiwiaXRlbXMiLCJ1bml0X2Ftb3VudCIsImN1cnJlbmN5IiwiaW50ZXJ2YWwiLCJyZWN1cnJpbmciLCJjdXJyZW50UGVyaW9kU3RhcnQiLCJEYXRlIiwiY3VycmVudF9wZXJpb2Rfc3RhcnQiLCJ0b0lTT1N0cmluZyIsImN1cnJlbnRQZXJpb2RFbmQiLCJjdXJyZW50X3BlcmlvZF9lbmQiLCJ0cmlhbEVuZCIsInRyaWFsX2VuZCIsInVuZGVmaW5lZCIsImNhbmNlbEF0IiwiY2FuY2VsX2F0IiwiY2FuY2VsZWRBdCIsImNhbmNlbGVkX2F0IiwiY3JlYXRlZEF0IiwiY3JlYXRlZCIsImNvbnNvbGUiXSwic291cmNlcyI6WyJDOlxcQWkgUHJvamVjdGVuXFxBRFNhcHBcXHNyY1xcYXBwXFxhcGlcXGJpbGxpbmdcXHN1YnNjcmlwdGlvblxccm91dGUudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTmV4dFJlcXVlc3QsIE5leHRSZXNwb25zZSB9IGZyb20gJ25leHQvc2VydmVyJ1xuaW1wb3J0IHsgY3JlYXRlQ2xpZW50IH0gZnJvbSAnQC9saWIvc3VwYWJhc2Uvc2VydmVyJ1xuaW1wb3J0IHsgc3RyaXBlIH0gZnJvbSAnQC9saWIvc3RyaXBlL3NlcnZlcidcbmltcG9ydCB7IHN0cmljdEFwaU1pZGRsZXdhcmUsIGdldFRlbmFudENvbnRleHQgfSBmcm9tICdAL2xpYi9taWRkbGV3YXJlJ1xuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gR0VUKHJlcXVlc3Q6IE5leHRSZXF1ZXN0KSB7XG4gIC8vIEFwcGx5IHN0cmljdCBBUEkgbWlkZGxld2FyZSAodGVuYW50IHZhbGlkYXRpb24gKyBzdHJpY3QgcmF0ZSBsaW1pdGluZylcbiAgY29uc3QgbWlkZGxld2FyZVJlc3BvbnNlID0gYXdhaXQgc3RyaWN0QXBpTWlkZGxld2FyZShyZXF1ZXN0KTtcbiAgaWYgKG1pZGRsZXdhcmVSZXNwb25zZSkgcmV0dXJuIG1pZGRsZXdhcmVSZXNwb25zZTtcblxuICB0cnkge1xuICAgIC8vIEdldCB0ZW5hbnQgY29udGV4dCBmcm9tIG1pZGRsZXdhcmUgKGFscmVhZHkgdmFsaWRhdGVkKVxuICAgIGNvbnN0IHsgb3JnYW5pemF0aW9uSWQgfSA9IGdldFRlbmFudENvbnRleHQocmVxdWVzdCk7XG5cbiAgICBjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xuXG4gICAgLy8gR2V0IG9yZ2FuaXphdGlvbiBzdWJzY3JpcHRpb24gZGF0YVxuICAgIGNvbnN0IHsgZGF0YTogb3JnIH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgICAgLmZyb20oJ29yZ2FuaXphdGlvbnMnKVxuICAgICAgLnNlbGVjdCgnKicpXG4gICAgICAuZXEoJ2lkJywgb3JnYW5pemF0aW9uSWQpXG4gICAgICAuc2luZ2xlKClcblxuICAgIGlmICghb3JnKSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHsgZXJyb3I6ICdPcmdhbml6YXRpb24gbm90IGZvdW5kJyB9LFxuICAgICAgICB7IHN0YXR1czogNDA0IH1cbiAgICAgIClcbiAgICB9XG5cbiAgICBpZiAoIW9yZy5zdHJpcGVfc3Vic2NyaXB0aW9uX2lkKSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBzdWJzY3JpcHRpb246IG51bGwgfSlcbiAgICB9XG5cbiAgICAvLyBHZXQgc3Vic2NyaXB0aW9uIGZyb20gU3RyaXBlXG4gICAgY29uc3Qgc3Vic2NyaXB0aW9uID0gYXdhaXQgc3RyaXBlLnN1YnNjcmlwdGlvbnMucmV0cmlldmUob3JnLnN0cmlwZV9zdWJzY3JpcHRpb25faWQpXG5cbiAgICBjb25zdCBzdWJzY3JpcHRpb25EYXRhID0ge1xuICAgICAgaWQ6IHN1YnNjcmlwdGlvbi5pZCxcbiAgICAgIHN0YXR1czogc3Vic2NyaXB0aW9uLnN0YXR1cyxcbiAgICAgIHBsYW5JZDogb3JnLnN1YnNjcmlwdGlvbl90aWVyLFxuICAgICAgcGxhbk5hbWU6IG9yZy5zdWJzY3JpcHRpb25fdGllcixcbiAgICAgIHByaWNlOiBzdWJzY3JpcHRpb24uaXRlbXMuZGF0YVswXT8ucHJpY2U/LnVuaXRfYW1vdW50IHx8IDAsXG4gICAgICBjdXJyZW5jeTogc3Vic2NyaXB0aW9uLmN1cnJlbmN5LFxuICAgICAgaW50ZXJ2YWw6IHN1YnNjcmlwdGlvbi5pdGVtcy5kYXRhWzBdPy5wcmljZT8ucmVjdXJyaW5nPy5pbnRlcnZhbCB8fCAnbW9udGgnLFxuICAgICAgY3VycmVudFBlcmlvZFN0YXJ0OiBuZXcgRGF0ZShzdWJzY3JpcHRpb24uY3VycmVudF9wZXJpb2Rfc3RhcnQgKiAxMDAwKS50b0lTT1N0cmluZygpLFxuICAgICAgY3VycmVudFBlcmlvZEVuZDogbmV3IERhdGUoc3Vic2NyaXB0aW9uLmN1cnJlbnRfcGVyaW9kX2VuZCAqIDEwMDApLnRvSVNPU3RyaW5nKCksXG4gICAgICB0cmlhbEVuZDogc3Vic2NyaXB0aW9uLnRyaWFsX2VuZCA/IG5ldyBEYXRlKHN1YnNjcmlwdGlvbi50cmlhbF9lbmQgKiAxMDAwKS50b0lTT1N0cmluZygpIDogdW5kZWZpbmVkLFxuICAgICAgY2FuY2VsQXQ6IHN1YnNjcmlwdGlvbi5jYW5jZWxfYXQgPyBuZXcgRGF0ZShzdWJzY3JpcHRpb24uY2FuY2VsX2F0ICogMTAwMCkudG9JU09TdHJpbmcoKSA6IHVuZGVmaW5lZCxcbiAgICAgIGNhbmNlbGVkQXQ6IHN1YnNjcmlwdGlvbi5jYW5jZWxlZF9hdCA/IG5ldyBEYXRlKHN1YnNjcmlwdGlvbi5jYW5jZWxlZF9hdCAqIDEwMDApLnRvSVNPU3RyaW5nKCkgOiB1bmRlZmluZWQsXG4gICAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKHN1YnNjcmlwdGlvbi5jcmVhdGVkICogMTAwMCkudG9JU09TdHJpbmcoKSxcbiAgICB9XG5cbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oc3Vic2NyaXB0aW9uRGF0YSlcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdTdWJzY3JpcHRpb24gQVBJIGVycm9yOicsIGVycm9yKVxuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgIHsgZXJyb3I6ICdJbnRlcm5hbCBzZXJ2ZXIgZXJyb3InIH0sXG4gICAgICB7IHN0YXR1czogNTAwIH1cbiAgICApXG4gIH1cbn0iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7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