{"version":3,"names":["cov_2rp3utxwka","actualCoverage","s","GET","request","f","supabase","_server1","createClient","searchParams","URL","url","data","user","error","authError","auth","getUser","b","_server","NextResponse","json","status","profile","from","select","eq","id","single","organization_id","query","get","organizationId","conversations","not","limit","suggestions","Set","forEach","conv","subject","toLowerCase","includes","add","tags","tag","commonSuggestions","suggestion","Array","slice","console"],"sources":["C:\\Ai Projecten\\ADSapp\\src\\app\\api\\search\\suggestions\\route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server'\nimport { createClient } from '@/lib/supabase/server'\n\nexport async function GET(request: NextRequest) {\n  try {\n    const supabase = await createClient()\n    const { searchParams } = new URL(request.url)\n    \n    // Get current user\n    const { data: { user }, error: authError } = await supabase.auth.getUser()\n    if (authError || !user) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })\n    }\n\n    // Get user's organization\n    const { data: profile } = await supabase\n      .from('profiles')\n      .select('organization_id')\n      .eq('id', user.id)\n      .single()\n\n    if (!profile?.organization_id) {\n      return NextResponse.json({ error: 'No organization found' }, { status: 403 })\n    }\n\n    const query = searchParams.get('q') || ''\n    const organizationId = searchParams.get('org')\n\n    if (organizationId !== profile.organization_id) {\n      return NextResponse.json({ error: 'Forbidden' }, { status: 403 })\n    }\n\n    // Get recent search terms and popular tags\n    const { data: conversations } = await supabase\n      .from('conversations')\n      .select('subject, tags')\n      .eq('organization_id', organizationId)\n      .not('subject', 'is', null)\n      .limit(100)\n\n    const suggestions = new Set<string>()\n\n    // Add subjects that match the query\n    conversations?.forEach(conv => {\n      if (conv.subject && conv.subject.toLowerCase().includes(query.toLowerCase())) {\n        suggestions.add(conv.subject)\n      }\n      \n      // Add matching tags\n      conv.tags?.forEach((tag: string) => {\n        if (tag.toLowerCase().includes(query.toLowerCase())) {\n          suggestions.add(tag)\n        }\n      })\n    })\n\n    // Add some common suggestions\n    const commonSuggestions = [\n      'product information',\n      'pricing details',\n      'support request',\n      'order status',\n      'refund request',\n      'technical issue',\n      'billing question',\n      'account setup'\n    ]\n\n    commonSuggestions.forEach(suggestion => {\n      if (suggestion.toLowerCase().includes(query.toLowerCase())) {\n        suggestions.add(suggestion)\n      }\n    })\n\n    return NextResponse.json({\n      suggestions: Array.from(suggestions).slice(0, 5)\n    })\n  } catch (error) {\n    console.error('Suggestions error:', error)\n    return NextResponse.json(\n      { error: 'Internal server error' },\n      { status: 500 }\n    )\n  }\n}\n"],"mappings":"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","ignoreList":[]}