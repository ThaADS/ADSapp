{"version":3,"names":["RedisSessionStore","cov_2ogks4bxlg","f","s","createRedisSessionStore","DEFAULT_CONFIG","sessionTimeoutMinutes","maxConcurrentSessions","constructor","config","redis","_redis","Redis","url","token","getSessionKey","userId","sessionToken","getUserSessionsKey","getOrgSessionKey","organizationId","getSessionTTL","createSession","sessionData","deviceInfo","existingSessions","getUserSessions","length","b","oldestSession","sort","a","Date","createdAt","getTime","deleteSession","now","toISOString","expiresAt","session","lastActivity","isRevoked","sessionKey","ttlSeconds","setex","JSON","stringify","userSessionsKey","sadd","expire","orgSessionKey","getSession","get","parse","updateSessionActivity","updatedSession","revokeSession","revokedSession","del","srem","sessionTokens","smembers","sessionPromises","map","sessions","Promise","all","filter","revokeAllUserSessions","revokePromises","results","r","deleteAllUserSessions","deletePromises","getUserSessionStats","revokedSessions","newestSession","sorted","totalSessions","activeSessions","cleanupExpiredSessions","cleanedCount","validateConfiguration","ping","Error","error","message","getHealthStatus","start","latency","healthy","process","env","UPSTASH_REDIS_REST_URL","UPSTASH_REDIS_REST_TOKEN","fullConfig","Number","SESSION_TIMEOUT_MINUTES","MAX_CONCURRENT_SESSIONS"],"sources":["C:\\Ai Projecten\\ADSapp\\src\\lib\\session\\redis-store.ts"],"sourcesContent":["import { Redis } from '@upstash/redis';\n\n/**\n * Redis Session Store for Enterprise Session Management\n *\n * Provides high-performance, distributed session storage using Upstash Redis.\n * Supports concurrent session management, automatic TTL expiration, and efficient\n * session tracking across multiple application instances.\n *\n * Security Features:\n * - Automatic session expiration with TTL\n * - Atomic operations for concurrent session limits\n * - Device fingerprinting for session tracking\n * - Efficient key-based session lookups\n *\n * Performance:\n * - O(1) lookups for session retrieval\n * - Batch operations for multi-session management\n * - Automatic cleanup via Redis TTL\n * - Optimized for high-throughput scenarios\n *\n * @module redis-store\n */\n\n/**\n * Device information for session tracking\n */\nexport interface DeviceInfo {\n  userAgent: string;\n  ip: string;\n  platform?: string;\n  browser?: string;\n  os?: string;\n}\n\n/**\n * Redis session data structure\n * Stored in Redis with automatic TTL expiration\n */\nexport interface RedisSession {\n  userId: string;\n  organizationId: string;\n  sessionToken: string;\n  deviceInfo: DeviceInfo;\n  createdAt: string;\n  lastActivity: string;\n  expiresAt: string;\n  isRevoked: boolean;\n}\n\n/**\n * Session statistics for monitoring\n */\nexport interface SessionStats {\n  totalSessions: number;\n  activeSessions: number;\n  revokedSessions: number;\n  oldestSession: string | null;\n  newestSession: string | null;\n}\n\n/**\n * Configuration for Redis Session Store\n */\nexport interface RedisStoreConfig {\n  url: string;\n  token: string;\n  sessionTimeoutMinutes: number;\n  maxConcurrentSessions: number;\n}\n\n/**\n * Default configuration values\n */\nconst DEFAULT_CONFIG: Partial<RedisStoreConfig> = {\n  sessionTimeoutMinutes: 30,\n  maxConcurrentSessions: 5\n};\n\n/**\n * Redis Session Store Class\n *\n * Manages session storage and retrieval using Upstash Redis.\n * Implements enterprise-grade session management with concurrent session limits,\n * automatic expiration, and device tracking.\n *\n * @example\n * ```typescript\n * const store = new RedisSessionStore({\n *   url: process.env.UPSTASH_REDIS_REST_URL!,\n *   token: process.env.UPSTASH_REDIS_REST_TOKEN!,\n *   sessionTimeoutMinutes: 30,\n *   maxConcurrentSessions: 5\n * });\n *\n * // Create a new session\n * await store.createSession({\n *   userId: 'user123',\n *   organizationId: 'org456',\n *   sessionToken: 'token789',\n *   deviceInfo: { userAgent: '...', ip: '...' }\n * });\n * ```\n */\nexport class RedisSessionStore {\n  private redis: Redis;\n  private config: RedisStoreConfig;\n\n  /**\n   * Initialize Redis Session Store\n   *\n   * @param config - Redis configuration and session settings\n   * @throws Error if Redis connection cannot be established\n   */\n  constructor(config: RedisStoreConfig) {\n    this.config = {\n      ...DEFAULT_CONFIG,\n      ...config\n    } as RedisStoreConfig;\n\n    this.redis = new Redis({\n      url: this.config.url,\n      token: this.config.token\n    });\n  }\n\n  /**\n   * Generate Redis key for session storage\n   * Format: session:{userId}:{sessionToken}\n   *\n   * @param userId - User ID\n   * @param sessionToken - Session token\n   * @returns Redis key string\n   */\n  private getSessionKey(userId: string, sessionToken: string): string {\n    return `session:${userId}:${sessionToken}`;\n  }\n\n  /**\n   * Generate Redis key for user sessions index\n   * Format: user_sessions:{userId}\n   *\n   * @param userId - User ID\n   * @returns Redis key string for user sessions set\n   */\n  private getUserSessionsKey(userId: string): string {\n    return `user_sessions:${userId}`;\n  }\n\n  /**\n   * Generate Redis key for organization sessions tracking\n   * Format: org_sessions:{organizationId}:{userId}\n   *\n   * @param organizationId - Organization ID\n   * @param userId - User ID\n   * @returns Redis key string for organization sessions\n   */\n  private getOrgSessionKey(organizationId: string, userId: string): string {\n    return `org_sessions:${organizationId}:${userId}`;\n  }\n\n  /**\n   * Calculate session TTL in seconds\n   *\n   * @returns TTL in seconds\n   */\n  private getSessionTTL(): number {\n    return this.config.sessionTimeoutMinutes * 60;\n  }\n\n  /**\n   * Create a new session in Redis\n   *\n   * Implements concurrent session management:\n   * 1. Checks current session count for user\n   * 2. If at limit, removes oldest session (FIFO)\n   * 3. Creates new session with TTL\n   * 4. Updates user sessions index\n   *\n   * @param sessionData - Session data to store\n   * @returns Created session object\n   * @throws Error if session creation fails\n   *\n   * @example\n   * ```typescript\n   * const session = await store.createSession({\n   *   userId: 'user123',\n   *   organizationId: 'org456',\n   *   sessionToken: 'token789',\n   *   deviceInfo: {\n   *     userAgent: 'Mozilla/5.0...',\n   *     ip: '192.168.1.1',\n   *     platform: 'web'\n   *   }\n   * });\n   * ```\n   */\n  async createSession(sessionData: {\n    userId: string;\n    organizationId: string;\n    sessionToken: string;\n    deviceInfo: DeviceInfo;\n  }): Promise<RedisSession> {\n    const { userId, organizationId, sessionToken, deviceInfo } = sessionData;\n\n    // Check concurrent session limit\n    const existingSessions = await this.getUserSessions(userId);\n\n    if (existingSessions.length >= this.config.maxConcurrentSessions) {\n      // Remove oldest session (FIFO eviction)\n      const oldestSession = existingSessions.sort(\n        (a, b) => new Date(a.createdAt).getTime() - new Date(b.createdAt).getTime()\n      )[0];\n\n      await this.deleteSession(userId, oldestSession.sessionToken);\n    }\n\n    // Create session object\n    const now = new Date().toISOString();\n    const expiresAt = new Date(\n      Date.now() + this.config.sessionTimeoutMinutes * 60 * 1000\n    ).toISOString();\n\n    const session: RedisSession = {\n      userId,\n      organizationId,\n      sessionToken,\n      deviceInfo,\n      createdAt: now,\n      lastActivity: now,\n      expiresAt,\n      isRevoked: false\n    };\n\n    // Store session in Redis with TTL\n    const sessionKey = this.getSessionKey(userId, sessionToken);\n    const ttlSeconds = this.getSessionTTL();\n\n    await this.redis.setex(sessionKey, ttlSeconds, JSON.stringify(session));\n\n    // Add to user sessions index\n    const userSessionsKey = this.getUserSessionsKey(userId);\n    await this.redis.sadd(userSessionsKey, sessionToken);\n    await this.redis.expire(userSessionsKey, ttlSeconds);\n\n    // Add to organization tracking\n    const orgSessionKey = this.getOrgSessionKey(organizationId, userId);\n    await this.redis.sadd(orgSessionKey, sessionToken);\n    await this.redis.expire(orgSessionKey, ttlSeconds);\n\n    return session;\n  }\n\n  /**\n   * Get session by user ID and session token\n   *\n   * @param userId - User ID\n   * @param sessionToken - Session token\n   * @returns Session object or null if not found/expired\n   *\n   * @example\n   * ```typescript\n   * const session = await store.getSession('user123', 'token789');\n   * if (session && !session.isRevoked) {\n   *   // Session is valid\n   * }\n   * ```\n   */\n  async getSession(\n    userId: string,\n    sessionToken: string\n  ): Promise<RedisSession | null> {\n    const sessionKey = this.getSessionKey(userId, sessionToken);\n    const sessionData = await this.redis.get<string>(sessionKey);\n\n    if (!sessionData) {\n      return null;\n    }\n\n    const session: RedisSession = JSON.parse(sessionData);\n\n    // Check if session is expired\n    if (new Date(session.expiresAt) < new Date()) {\n      await this.deleteSession(userId, sessionToken);\n      return null;\n    }\n\n    // Check if session is revoked\n    if (session.isRevoked) {\n      return null;\n    }\n\n    return session;\n  }\n\n  /**\n   * Update session last activity timestamp\n   *\n   * Extends session TTL and updates last activity.\n   * Called on every authenticated request to maintain session.\n   *\n   * @param userId - User ID\n   * @param sessionToken - Session token\n   * @returns Updated session or null if not found\n   *\n   * @example\n   * ```typescript\n   * // Called by session middleware on each request\n   * await store.updateSessionActivity('user123', 'token789');\n   * ```\n   */\n  async updateSessionActivity(\n    userId: string,\n    sessionToken: string\n  ): Promise<RedisSession | null> {\n    const session = await this.getSession(userId, sessionToken);\n\n    if (!session) {\n      return null;\n    }\n\n    // Update last activity and expiration\n    const now = new Date().toISOString();\n    const expiresAt = new Date(\n      Date.now() + this.config.sessionTimeoutMinutes * 60 * 1000\n    ).toISOString();\n\n    const updatedSession: RedisSession = {\n      ...session,\n      lastActivity: now,\n      expiresAt\n    };\n\n    // Update in Redis with refreshed TTL\n    const sessionKey = this.getSessionKey(userId, sessionToken);\n    const ttlSeconds = this.getSessionTTL();\n\n    await this.redis.setex(\n      sessionKey,\n      ttlSeconds,\n      JSON.stringify(updatedSession)\n    );\n\n    return updatedSession;\n  }\n\n  /**\n   * Revoke a specific session\n   *\n   * Marks session as revoked without deleting it immediately.\n   * Allows for audit trail and revocation tracking.\n   *\n   * @param userId - User ID\n   * @param sessionToken - Session token to revoke\n   * @returns True if revoked successfully\n   *\n   * @example\n   * ```typescript\n   * // Revoke specific session (e.g., user logs out from one device)\n   * await store.revokeSession('user123', 'token789');\n   * ```\n   */\n  async revokeSession(\n    userId: string,\n    sessionToken: string\n  ): Promise<boolean> {\n    const session = await this.getSession(userId, sessionToken);\n\n    if (!session) {\n      return false;\n    }\n\n    // Mark as revoked\n    const revokedSession: RedisSession = {\n      ...session,\n      isRevoked: true\n    };\n\n    // Update in Redis with short TTL (keep for audit)\n    const sessionKey = this.getSessionKey(userId, sessionToken);\n    await this.redis.setex(sessionKey, 3600, JSON.stringify(revokedSession)); // 1 hour audit trail\n\n    return true;\n  }\n\n  /**\n   * Delete a session permanently\n   *\n   * Removes session from Redis and all indexes.\n   * Used for cleanup and FIFO eviction.\n   *\n   * @param userId - User ID\n   * @param sessionToken - Session token to delete\n   * @returns True if deleted successfully\n   */\n  async deleteSession(userId: string, sessionToken: string): Promise<boolean> {\n    const session = await this.getSession(userId, sessionToken);\n\n    if (!session) {\n      return false;\n    }\n\n    // Delete session\n    const sessionKey = this.getSessionKey(userId, sessionToken);\n    await this.redis.del(sessionKey);\n\n    // Remove from user sessions index\n    const userSessionsKey = this.getUserSessionsKey(userId);\n    await this.redis.srem(userSessionsKey, sessionToken);\n\n    // Remove from organization tracking\n    const orgSessionKey = this.getOrgSessionKey(\n      session.organizationId,\n      userId\n    );\n    await this.redis.srem(orgSessionKey, sessionToken);\n\n    return true;\n  }\n\n  /**\n   * Get all sessions for a user\n   *\n   * Returns all active (non-revoked, non-expired) sessions.\n   * Used for session listing and management.\n   *\n   * @param userId - User ID\n   * @returns Array of active sessions\n   *\n   * @example\n   * ```typescript\n   * const sessions = await store.getUserSessions('user123');\n   * console.log(`User has ${sessions.length} active sessions`);\n   * ```\n   */\n  async getUserSessions(userId: string): Promise<RedisSession[]> {\n    const userSessionsKey = this.getUserSessionsKey(userId);\n    const sessionTokens = await this.redis.smembers<string[]>(userSessionsKey);\n\n    if (!sessionTokens || sessionTokens.length === 0) {\n      return [];\n    }\n\n    // Get all sessions in parallel\n    const sessionPromises = sessionTokens.map(token =>\n      this.getSession(userId, token)\n    );\n\n    const sessions = await Promise.all(sessionPromises);\n\n    // Filter out null values (expired/revoked sessions)\n    return sessions.filter((s): s is RedisSession => s !== null);\n  }\n\n  /**\n   * Revoke all sessions for a user\n   *\n   * Used for security events like password changes, account compromise,\n   * or manual user action.\n   *\n   * @param userId - User ID\n   * @returns Number of sessions revoked\n   *\n   * @example\n   * ```typescript\n   * // User changes password - revoke all sessions\n   * const count = await store.revokeAllUserSessions('user123');\n   * console.log(`Revoked ${count} sessions`);\n   * ```\n   */\n  async revokeAllUserSessions(userId: string): Promise<number> {\n    const sessions = await this.getUserSessions(userId);\n\n    // Revoke all sessions in parallel\n    const revokePromises = sessions.map(session =>\n      this.revokeSession(userId, session.sessionToken)\n    );\n\n    const results = await Promise.all(revokePromises);\n\n    // Count successful revocations\n    return results.filter(r => r).length;\n  }\n\n  /**\n   * Delete all sessions for a user\n   *\n   * Permanently removes all user sessions.\n   * Used for account deletion or administrative actions.\n   *\n   * @param userId - User ID\n   * @returns Number of sessions deleted\n   */\n  async deleteAllUserSessions(userId: string): Promise<number> {\n    const sessions = await this.getUserSessions(userId);\n\n    // Delete all sessions in parallel\n    const deletePromises = sessions.map(session =>\n      this.deleteSession(userId, session.sessionToken)\n    );\n\n    const results = await Promise.all(deletePromises);\n\n    // Count successful deletions\n    return results.filter(r => r).length;\n  }\n\n  /**\n   * Get session statistics for a user\n   *\n   * Provides metrics for monitoring and analytics.\n   *\n   * @param userId - User ID\n   * @returns Session statistics\n   */\n  async getUserSessionStats(userId: string): Promise<SessionStats> {\n    const sessions = await this.getUserSessions(userId);\n    const revokedSessions = sessions.filter(s => s.isRevoked);\n\n    let oldestSession: string | null = null;\n    let newestSession: string | null = null;\n\n    if (sessions.length > 0) {\n      const sorted = sessions.sort(\n        (a, b) => new Date(a.createdAt).getTime() - new Date(b.createdAt).getTime()\n      );\n      oldestSession = sorted[0].createdAt;\n      newestSession = sorted[sorted.length - 1].createdAt;\n    }\n\n    return {\n      totalSessions: sessions.length,\n      activeSessions: sessions.length - revokedSessions.length,\n      revokedSessions: revokedSessions.length,\n      oldestSession,\n      newestSession\n    };\n  }\n\n  /**\n   * Clean up expired sessions manually\n   *\n   * While Redis automatically removes expired keys, this method\n   * provides manual cleanup for index consistency.\n   *\n   * @param userId - User ID\n   * @returns Number of sessions cleaned up\n   */\n  async cleanupExpiredSessions(userId: string): Promise<number> {\n    const userSessionsKey = this.getUserSessionsKey(userId);\n    const sessionTokens = await this.redis.smembers<string[]>(userSessionsKey);\n\n    if (!sessionTokens || sessionTokens.length === 0) {\n      return 0;\n    }\n\n    let cleanedCount = 0;\n\n    for (const token of sessionTokens) {\n      const session = await this.getSession(userId, token);\n      if (!session) {\n        // Session is expired or invalid - remove from index\n        await this.redis.srem(userSessionsKey, token);\n        cleanedCount++;\n      }\n    }\n\n    return cleanedCount;\n  }\n\n  /**\n   * Validate session configuration\n   *\n   * Checks if Redis connection is working and configuration is valid.\n   *\n   * @returns True if configuration is valid\n   * @throws Error if validation fails\n   */\n  async validateConfiguration(): Promise<boolean> {\n    try {\n      // Test Redis connection\n      await this.redis.ping();\n\n      // Validate configuration values\n      if (this.config.sessionTimeoutMinutes < 1) {\n        throw new Error('Session timeout must be at least 1 minute');\n      }\n\n      if (this.config.maxConcurrentSessions < 1) {\n        throw new Error('Max concurrent sessions must be at least 1');\n      }\n\n      return true;\n    } catch (error) {\n      const message = error instanceof Error ? error.message : 'Unknown error';\n      throw new Error(`Redis Session Store validation failed: ${message}`);\n    }\n  }\n\n  /**\n   * Get Redis connection health status\n   *\n   * @returns Health status object\n   */\n  async getHealthStatus(): Promise<{\n    healthy: boolean;\n    latency: number;\n    error?: string;\n  }> {\n    try {\n      const start = Date.now();\n      await this.redis.ping();\n      const latency = Date.now() - start;\n\n      return {\n        healthy: true,\n        latency\n      };\n    } catch (error) {\n      const message = error instanceof Error ? error.message : 'Unknown error';\n      return {\n        healthy: false,\n        latency: -1,\n        error: message\n      };\n    }\n  }\n}\n\n/**\n * Create and configure Redis Session Store\n *\n * Factory function for easy store initialization.\n *\n * @param config - Optional configuration overrides\n * @returns Configured RedisSessionStore instance\n *\n * @example\n * ```typescript\n * const store = createRedisSessionStore({\n *   sessionTimeoutMinutes: 60, // 1 hour\n *   maxConcurrentSessions: 10\n * });\n * ```\n */\nexport function createRedisSessionStore(\n  config?: Partial<RedisStoreConfig>\n): RedisSessionStore {\n  const url = process.env.UPSTASH_REDIS_REST_URL;\n  const token = process.env.UPSTASH_REDIS_REST_TOKEN;\n\n  if (!url || !token) {\n    throw new Error(\n      'Redis configuration missing. Set UPSTASH_REDIS_REST_URL and UPSTASH_REDIS_REST_TOKEN'\n    );\n  }\n\n  const fullConfig: RedisStoreConfig = {\n    url,\n    token,\n    sessionTimeoutMinutes: config?.sessionTimeoutMinutes ??\n      Number(process.env.SESSION_TIMEOUT_MINUTES) ??\n      30,\n    maxConcurrentSessions: config?.maxConcurrentSessions ??\n      Number(process.env.MAX_CONCURRENT_SESSIONS) ??\n      5\n  };\n\n  return new RedisSessionStore(fullConfig);\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}