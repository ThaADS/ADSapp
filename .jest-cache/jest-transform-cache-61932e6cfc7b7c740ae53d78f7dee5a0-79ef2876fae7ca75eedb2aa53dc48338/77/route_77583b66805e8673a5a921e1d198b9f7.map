{"version":3,"names":["GET","cov_63qh0r51t","f","s","POST","request","sessionToken","cookies","get","value","b","_server","NextResponse","json","error","code","status","supabase","_server1","createClient","data","user","authError","auth","getUser","sessionManager","_manager","getSessionManager","result","refreshSession","id","success","session","response","userId","organizationId","lastActivity","expiresAt","_session","setSessionCookie","console","process","env","NODE_ENV","Sentry","Promise","resolve","then","_interop_require_wildcard","require","captureException","tags","endpoint","sentryError"],"sources":["C:\\Ai Projecten\\ADSapp\\src\\app\\api\\auth\\session\\refresh\\route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport { getSessionManager } from '@/lib/session/manager';\nimport { setSessionCookie } from '@/lib/middleware/session';\nimport { createClient } from '@/lib/supabase/server';\n\n/**\n * Session Refresh API Route\n *\n * POST /api/auth/session/refresh\n *\n * Refreshes an existing session, extending the timeout and updating activity.\n * Used by client applications to keep sessions alive during user activity.\n *\n * Security:\n * - Validates existing session\n * - Extends session TTL\n * - Updates last activity timestamp\n * - Returns updated session information\n *\n * @returns Session refresh result\n */\nexport async function POST(request: NextRequest) {\n  try {\n    // Get session token from cookie or request body\n    const sessionToken = request.cookies.get('adsapp_session')?.value;\n\n    if (!sessionToken) {\n      return NextResponse.json(\n        {\n          error: 'No session token provided',\n          code: 'NO_SESSION_TOKEN'\n        },\n        { status: 401 }\n      );\n    }\n\n    // Get user ID from Supabase auth\n    const supabase = await createClient();\n    const { data: { user }, error: authError } = await supabase.auth.getUser();\n\n    if (authError || !user) {\n      return NextResponse.json(\n        {\n          error: 'User not authenticated',\n          code: 'UNAUTHORIZED'\n        },\n        { status: 401 }\n      );\n    }\n\n    // Refresh session\n    const sessionManager = getSessionManager();\n    const result = await sessionManager.refreshSession(user.id, sessionToken);\n\n    if (!result.success) {\n      return NextResponse.json(\n        {\n          error: result.error || 'Failed to refresh session',\n          code: 'REFRESH_FAILED'\n        },\n        { status: 401 }\n      );\n    }\n\n    const session = result.session!;\n\n    // Create response with updated session\n    const response = NextResponse.json(\n      {\n        success: true,\n        session: {\n          userId: session.userId,\n          organizationId: session.organizationId,\n          lastActivity: session.lastActivity,\n          expiresAt: session.expiresAt\n        }\n      },\n      { status: 200 }\n    );\n\n    // Update session cookie\n    setSessionCookie(response, sessionToken);\n\n    return response;\n  } catch (error) {\n    console.error('[SessionRefresh] Error:', error);\n\n    // Log error to monitoring\n    if (process.env.NODE_ENV === 'production') {\n      try {\n        const Sentry = await import('@sentry/nextjs');\n        Sentry.captureException(error, {\n          tags: {\n            endpoint: 'session-refresh'\n          }\n        });\n      } catch (sentryError) {\n        console.error('[SessionRefresh] Failed to log error:', sentryError);\n      }\n    }\n\n    return NextResponse.json(\n      {\n        error: 'Internal server error',\n        code: 'INTERNAL_ERROR'\n      },\n      { status: 500 }\n    );\n  }\n}\n\n/**\n * GET method not allowed\n */\nexport async function GET() {\n  return NextResponse.json(\n    {\n      error: 'Method not allowed',\n      code: 'METHOD_NOT_ALLOWED'\n    },\n    { status: 405 }\n  );\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}