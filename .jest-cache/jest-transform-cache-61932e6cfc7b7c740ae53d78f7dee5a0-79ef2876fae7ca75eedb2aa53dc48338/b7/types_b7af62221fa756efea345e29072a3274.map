{"version":3,"sources":["C:\\Ai Projecten\\ADSapp\\src\\lib\\crypto\\types.ts"],"sourcesContent":["/**\n * Encryption Types and Interfaces\n *\n * Type definitions for the field-level encryption system.\n * Supports AES-256-GCM encryption with versioning for key rotation.\n *\n * @module crypto/types\n */\n\n/**\n * Encrypted field structure with version support for key rotation\n */\nexport interface EncryptedField {\n  /** Base64 encoded: IV + ciphertext + authTag */\n  encrypted: string;\n  /** Version identifier for key rotation (v1, v2, etc.) */\n  version: string;\n  /** Optional algorithm identifier for future flexibility */\n  algorithm?: string;\n}\n\n/**\n * Encryption configuration\n */\nexport interface EncryptionConfig {\n  /** Master encryption key (32 bytes for AES-256) */\n  key: Buffer;\n  /** Current key version */\n  version: string;\n  /** Algorithm to use (default: aes-256-gcm) */\n  algorithm?: string;\n  /** IV length in bytes (default: 12 for GCM) */\n  ivLength?: number;\n  /** Auth tag length in bytes (default: 16 for GCM) */\n  authTagLength?: number;\n}\n\n/**\n * Encryption result with metadata\n */\nexport interface EncryptionResult {\n  /** Encrypted data as base64 string */\n  encrypted: string;\n  /** Key version used */\n  version: string;\n  /** Algorithm used */\n  algorithm: string;\n  /** Initialization vector (base64) */\n  iv: string;\n  /** Authentication tag (base64) */\n  authTag: string;\n}\n\n/**\n * Decryption result\n */\nexport interface DecryptionResult {\n  /** Decrypted plaintext */\n  plaintext: string;\n  /** Key version that was used */\n  version: string;\n  /** Algorithm that was used */\n  algorithm: string;\n}\n\n/**\n * Batch encryption request\n */\nexport interface BatchEncryptRequest {\n  /** Field name */\n  field: string;\n  /** Value to encrypt */\n  value: string | null;\n  /** Record ID for tracking */\n  id: string;\n}\n\n/**\n * Batch encryption result\n */\nexport interface BatchEncryptResult {\n  /** Record ID */\n  id: string;\n  /** Field name */\n  field: string;\n  /** Encrypted value */\n  encrypted: string | null;\n  /** Whether encryption succeeded */\n  success: boolean;\n  /** Error message if failed */\n  error?: string;\n}\n\n/**\n * Batch decryption request\n */\nexport interface BatchDecryptRequest {\n  /** Field name */\n  field: string;\n  /** Encrypted value */\n  encrypted: string | null;\n  /** Record ID for tracking */\n  id: string;\n}\n\n/**\n * Batch decryption result\n */\nexport interface BatchDecryptResult {\n  /** Record ID */\n  id: string;\n  /** Field name */\n  field: string;\n  /** Decrypted value */\n  decrypted: string | null;\n  /** Whether decryption succeeded */\n  success: boolean;\n  /** Error message if failed */\n  error?: string;\n}\n\n/**\n * Encryption audit log entry\n */\nexport interface EncryptionAuditLog {\n  /** Timestamp of operation */\n  timestamp: Date;\n  /** Operation type */\n  operation: 'encrypt' | 'decrypt' | 'batch_encrypt' | 'batch_decrypt';\n  /** Table name */\n  table?: string;\n  /** Field name */\n  field?: string;\n  /** Record ID */\n  recordId?: string;\n  /** Number of records processed (for batch) */\n  recordCount?: number;\n  /** Whether operation succeeded */\n  success: boolean;\n  /** Error message if failed */\n  error?: string;\n  /** User ID who performed operation */\n  userId?: string;\n  /** Organization ID */\n  organizationId?: string;\n}\n\n/**\n * Migration progress tracking\n */\nexport interface MigrationProgress {\n  /** Table being migrated */\n  table: string;\n  /** Total records to migrate */\n  total: number;\n  /** Records processed so far */\n  processed: number;\n  /** Records successfully encrypted */\n  successful: number;\n  /** Records that failed */\n  failed: number;\n  /** Start time */\n  startedAt: Date;\n  /** End time (if completed) */\n  completedAt?: Date;\n  /** Current status */\n  status: 'pending' | 'in_progress' | 'completed' | 'failed';\n  /** Error message if failed */\n  error?: string;\n}\n\n/**\n * Fields that require encryption by table\n */\nexport interface EncryptedFieldsMap {\n  contacts: string[];\n  profiles: string[];\n  api_keys?: string[];\n  whatsapp_credentials?: string[];\n}\n\n/**\n * Default encrypted fields configuration\n */\nexport const ENCRYPTED_FIELDS: EncryptedFieldsMap = {\n  contacts: ['phone_number', 'whatsapp_id'],\n  profiles: ['email'],\n  api_keys: ['key_value', 'secret'],\n  whatsapp_credentials: ['access_token', 'phone_number_id', 'business_account_id'],\n};\n\n/**\n * Encryption constants\n */\nexport const ENCRYPTION_CONSTANTS = {\n  /** AES-256-GCM algorithm identifier */\n  ALGORITHM: 'aes-256-gcm' as const,\n  /** Key size in bytes (256 bits) */\n  KEY_SIZE: 32,\n  /** IV size in bytes (96 bits for GCM) */\n  IV_SIZE: 12,\n  /** Auth tag size in bytes (128 bits) */\n  AUTH_TAG_SIZE: 16,\n  /** Current encryption version */\n  CURRENT_VERSION: 'v1' as const,\n  /** Encoding for storage */\n  ENCODING: 'base64' as const,\n  /** UTF-8 encoding for strings */\n  STRING_ENCODING: 'utf8' as const,\n} as const;\n\n/**\n * Error types for encryption operations\n */\nexport class EncryptionError extends Error {\n  constructor(message: string, public code: string, public details?: unknown) {\n    super(message);\n    this.name = 'EncryptionError';\n  }\n}\n\nexport class DecryptionError extends Error {\n  constructor(message: string, public code: string, public details?: unknown) {\n    super(message);\n    this.name = 'DecryptionError';\n  }\n}\n\nexport class KeyManagementError extends Error {\n  constructor(message: string, public code: string, public details?: unknown) {\n    super(message);\n    this.name = 'KeyManagementError';\n  }\n}\n\n/**\n * Validation result for encrypted data\n */\nexport interface ValidationResult {\n  /** Whether validation passed */\n  valid: boolean;\n  /** Error message if invalid */\n  error?: string;\n  /** Details about the validation */\n  details?: {\n    hasVersion?: boolean;\n    hasEncrypted?: boolean;\n    isBase64?: boolean;\n    hasValidStructure?: boolean;\n  };\n}\n\n/**\n * Type guard to check if value is EncryptedField\n */\nexport function isEncryptedField(value: unknown): value is EncryptedField {\n  return (\n    typeof value === 'object' &&\n    value !== null &&\n    'encrypted' in value &&\n    'version' in value &&\n    typeof (value as EncryptedField).encrypted === 'string' &&\n    typeof (value as EncryptedField).version === 'string'\n  );\n}\n\n/**\n * Type guard to check if value needs encryption\n */\nexport function needsEncryption(value: unknown): value is string {\n  return typeof value === 'string' && value.length > 0;\n}\n"],"names":["DecryptionError","ENCRYPTED_FIELDS","ENCRYPTION_CONSTANTS","EncryptionError","KeyManagementError","isEncryptedField","needsEncryption","contacts","profiles","api_keys","whatsapp_credentials","ALGORITHM","KEY_SIZE","IV_SIZE","AUTH_TAG_SIZE","CURRENT_VERSION","ENCODING","STRING_ENCODING","Error","message","code","details","name","value","encrypted","version","length"],"mappings":"AAAA;;;;;;;CAOC,GAED;;CAEC;;;;;;;;;;;QAkNYA;eAAAA;;QArCAC;eAAAA;;QAUAC;eAAAA;;QAoBAC;eAAAA;;QAcAC;eAAAA;;QA2BGC;eAAAA;;QAcAC;eAAAA;;;AArFT,MAAML,mBAAuC;IAClDM,UAAU;QAAC;QAAgB;KAAc;IACzCC,UAAU;QAAC;KAAQ;IACnBC,UAAU;QAAC;QAAa;KAAS;IACjCC,sBAAsB;QAAC;QAAgB;QAAmB;KAAsB;AAClF;AAKO,MAAMR,uBAAuB;IAClC,qCAAqC,GACrCS,WAAW;IACX,iCAAiC,GACjCC,UAAU;IACV,uCAAuC,GACvCC,SAAS;IACT,sCAAsC,GACtCC,eAAe;IACf,+BAA+B,GAC/BC,iBAAiB;IACjB,yBAAyB,GACzBC,UAAU;IACV,+BAA+B,GAC/BC,iBAAiB;AACnB;AAKO,MAAMd,wBAAwBe;IACnC,YAAYC,OAAe,EAAE,AAAOC,IAAY,EAAE,AAAOC,OAAiB,CAAE;QAC1E,KAAK,CAACF,eAD4BC,OAAAA,WAAqBC,UAAAA;QAEvD,IAAI,CAACC,IAAI,GAAG;IACd;AACF;AAEO,MAAMtB,wBAAwBkB;IACnC,YAAYC,OAAe,EAAE,AAAOC,IAAY,EAAE,AAAOC,OAAiB,CAAE;QAC1E,KAAK,CAACF,eAD4BC,OAAAA,WAAqBC,UAAAA;QAEvD,IAAI,CAACC,IAAI,GAAG;IACd;AACF;AAEO,MAAMlB,2BAA2Bc;IACtC,YAAYC,OAAe,EAAE,AAAOC,IAAY,EAAE,AAAOC,OAAiB,CAAE;QAC1E,KAAK,CAACF,eAD4BC,OAAAA,WAAqBC,UAAAA;QAEvD,IAAI,CAACC,IAAI,GAAG;IACd;AACF;AAsBO,SAASjB,iBAAiBkB,KAAc;IAC7C,OACE,OAAOA,UAAU,YACjBA,UAAU,QACV,eAAeA,SACf,aAAaA,SACb,OAAO,AAACA,MAAyBC,SAAS,KAAK,YAC/C,OAAO,AAACD,MAAyBE,OAAO,KAAK;AAEjD;AAKO,SAASnB,gBAAgBiB,KAAc;IAC5C,OAAO,OAAOA,UAAU,YAAYA,MAAMG,MAAM,GAAG;AACrD"}