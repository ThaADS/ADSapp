{"version":3,"sources":["C:\\Ai Projecten\\ADSapp\\tests\\integration\\api\\contacts.test.ts"],"sourcesContent":["/**\n * Contacts API Integration Tests\n *\n * Tests for /api/contacts endpoints including CRUD operations,\n * search/filtering, and multi-tenant isolation.\n */\n\nimport { describe, it, expect, beforeEach, jest } from '@jest/globals'\nimport { NextRequest } from 'next/server'\nimport {\n  createAuthenticatedRequest,\n  parseResponse,\n  expectErrorResponse,\n  createPaginatedUrl,\n  expectPaginatedResponse,\n} from '../../utils/api-test-helpers'\nimport {\n  createMockUser,\n  createMockContact,\n  createMockSupabaseClient,\n  generateMockContacts,\n} from '../../utils/test-helpers'\n\njest.mock('@/lib/supabase/server')\n\ndescribe('GET /api/contacts', () => {\n  let mockSupabase: any\n  let mockUser: any\n  let mockContacts: any[]\n\n  beforeEach(() => {\n    mockSupabase = createMockSupabaseClient()\n    mockUser = createMockUser()\n    mockContacts = generateMockContacts(15, { organization_id: mockUser.organization_id })\n    jest.clearAllMocks()\n  })\n\n  it('should list contacts with pagination', async () => {\n    mockSupabase.from = jest.fn().mockReturnValue({\n      select: jest.fn().mockReturnThis(),\n      eq: jest.fn().mockReturnThis(),\n      order: jest.fn().mockReturnThis(),\n      range: jest.fn().mockResolvedValue({\n        data: mockContacts.slice(0, 10),\n        error: null,\n        count: 15,\n      }),\n    })\n\n    const url = createPaginatedUrl('/api/contacts', { page: 1, limit: 10 })\n    const request = createAuthenticatedRequest('GET', url, mockUser.id, mockUser.organization_id)\n\n    const response = await simulateGetContacts(request, mockSupabase, mockUser)\n    const { status, data } = await parseResponse(response)\n\n    expect(status).toBe(200)\n    expectPaginatedResponse(data)\n    expect(data.contacts).toHaveLength(10)\n    expect(data.pagination.total).toBe(15)\n    expect(data.pagination.hasMore).toBe(true)\n  })\n\n  it('should filter contacts by search term', async () => {\n    const searchResults = mockContacts.filter(c => c.name.includes('John'))\n\n    mockSupabase.from = jest.fn().mockReturnValue({\n      select: jest.fn().mockReturnThis(),\n      eq: jest.fn().mockReturnThis(),\n      or: jest.fn().mockReturnThis(),\n      order: jest.fn().mockReturnThis(),\n      range: jest.fn().mockResolvedValue({\n        data: searchResults,\n        error: null,\n        count: searchResults.length,\n      }),\n    })\n\n    const url = '/api/contacts?search=John'\n    const request = createAuthenticatedRequest('GET', url, mockUser.id, mockUser.organization_id)\n\n    const response = await simulateGetContacts(request, mockSupabase, mockUser)\n    const { status, data } = await parseResponse(response)\n\n    expect(status).toBe(200)\n    expect(data.filters.search).toBe('John')\n  })\n\n  it('should enforce tenant isolation - cannot see other org contacts', async () => {\n    const otherOrgContact = createMockContact({ organization_id: 'different-org-id' })\n\n    mockSupabase.from = jest.fn().mockReturnValue({\n      select: jest.fn().mockReturnThis(),\n      eq: jest.fn().mockImplementation((field: string, value: string) => {\n        // Verify that organization_id filter is applied\n        expect(field).toBe('organization_id')\n        expect(value).toBe(mockUser.organization_id)\n        return {\n          order: jest.fn().mockReturnThis(),\n          range: jest.fn().mockResolvedValue({\n            data: mockContacts, // Only org's contacts\n            error: null,\n            count: mockContacts.length,\n          }),\n        }\n      }),\n    })\n\n    const request = createAuthenticatedRequest('GET', '/api/contacts', mockUser.id, mockUser.organization_id)\n\n    const response = await simulateGetContacts(request, mockSupabase, mockUser)\n    const { status, data } = await parseResponse(response)\n\n    expect(status).toBe(200)\n    // Verify no contacts from other organizations\n    data.contacts.forEach((contact: any) => {\n      expect(contact.organization_id).toBe(mockUser.organization_id)\n    })\n  })\n\n  it('should filter by tags', async () => {\n    const vipContacts = mockContacts.filter(c => c.tags?.includes('vip'))\n\n    mockSupabase.from = jest.fn().mockReturnValue({\n      select: jest.fn().mockReturnThis(),\n      eq: jest.fn().mockReturnThis(),\n      overlaps: jest.fn().mockReturnThis(),\n      order: jest.fn().mockReturnThis(),\n      range: jest.fn().mockResolvedValue({\n        data: vipContacts,\n        error: null,\n        count: vipContacts.length,\n      }),\n    })\n\n    const url = '/api/contacts?tags=vip'\n    const request = createAuthenticatedRequest('GET', url, mockUser.id, mockUser.organization_id)\n\n    const response = await simulateGetContacts(request, mockSupabase, mockUser)\n    const { status, data } = await parseResponse(response)\n\n    expect(status).toBe(200)\n    expect(data.filters.tags).toContain('vip')\n  })\n})\n\ndescribe('POST /api/contacts', () => {\n  let mockSupabase: any\n  let mockUser: any\n\n  beforeEach(() => {\n    mockSupabase = createMockSupabaseClient()\n    mockUser = createMockUser()\n    jest.clearAllMocks()\n  })\n\n  it('should create new contact with valid data', async () => {\n    const newContactData = {\n      phone_number: '+15551234567',\n      name: 'New Contact',\n      email: 'newcontact@example.com',\n      tags: ['customer'],\n    }\n\n    mockSupabase.from = jest.fn().mockImplementation((table: string) => {\n      if (table === 'contacts') {\n        return {\n          select: jest.fn().mockReturnThis(),\n          eq: jest.fn().mockReturnThis(),\n          single: jest.fn().mockResolvedValue({ data: null, error: null }), // No duplicate\n          insert: jest.fn().mockReturnThis(),\n        }\n      }\n      return {\n        insert: jest.fn().mockReturnThis(),\n        select: jest.fn().mockReturnThis(),\n        single: jest.fn().mockResolvedValue({\n          data: { ...newContactData, id: 'new-contact-id', organization_id: mockUser.organization_id },\n          error: null,\n        }),\n      }\n    })\n\n    const request = createAuthenticatedRequest('POST', '/api/contacts', mockUser.id, mockUser.organization_id, newContactData)\n\n    const response = await simulateCreateContact(request, mockSupabase, mockUser)\n    const { status, data } = await parseResponse(response)\n\n    expect(status).toBe(201)\n    expect(data.phone_number).toBe(newContactData.phone_number)\n    expect(data.organization_id).toBe(mockUser.organization_id)\n  })\n\n  it('should reject duplicate phone number in same organization', async () => {\n    const existingContact = createMockContact({ organization_id: mockUser.organization_id })\n\n    mockSupabase.from = jest.fn().mockReturnValue({\n      select: jest.fn().mockReturnThis(),\n      eq: jest.fn().mockReturnThis(),\n      single: jest.fn().mockResolvedValue({\n        data: existingContact,\n        error: null,\n      }),\n    })\n\n    const request = createAuthenticatedRequest(\n      'POST',\n      '/api/contacts',\n      mockUser.id,\n      mockUser.organization_id,\n      { phone_number: existingContact.phone_number, name: 'Duplicate' }\n    )\n\n    const response = await simulateCreateContact(request, mockSupabase, mockUser)\n    const { status, data } = await parseResponse(response)\n\n    expect(status).toBe(409)\n    expectErrorResponse(data, 409, 'already exists')\n  })\n\n  it('should validate phone number format', async () => {\n    const request = createAuthenticatedRequest(\n      'POST',\n      '/api/contacts',\n      mockUser.id,\n      mockUser.organization_id,\n      { phone_number: 'invalid', name: 'Test' }\n    )\n\n    const response = await simulateCreateContact(request, mockSupabase, mockUser)\n    const { status, data } = await parseResponse(response)\n\n    expect(status).toBe(400)\n    expectErrorResponse(data, 400, 'Invalid phone number format')\n  })\n\n  it('should require phone number field', async () => {\n    const request = createAuthenticatedRequest(\n      'POST',\n      '/api/contacts',\n      mockUser.id,\n      mockUser.organization_id,\n      { name: 'Test Contact' }\n    )\n\n    const response = await simulateCreateContact(request, mockSupabase, mockUser)\n    const { status, data } = await parseResponse(response)\n\n    expect(status).toBe(400)\n    expectErrorResponse(data, 400, 'Phone number is required')\n  })\n})\n\ndescribe('PUT /api/contacts/[id]', () => {\n  let mockSupabase: any\n  let mockUser: any\n  let mockContact: any\n\n  beforeEach(() => {\n    mockSupabase = createMockSupabaseClient()\n    mockUser = createMockUser()\n    mockContact = createMockContact({ organization_id: mockUser.organization_id })\n    jest.clearAllMocks()\n  })\n\n  it('should update contact with valid data', async () => {\n    const updateData = { name: 'Updated Name', tags: ['vip'] }\n\n    mockSupabase.from = jest.fn().mockReturnValue({\n      select: jest.fn().mockReturnThis(),\n      eq: jest.fn().mockReturnThis(),\n      single: jest.fn().mockResolvedValue({ data: mockContact, error: null }),\n      update: jest.fn().mockReturnThis(),\n    })\n\n    const request = createAuthenticatedRequest(\n      'PUT',\n      `/api/contacts/${mockContact.id}`,\n      mockUser.id,\n      mockUser.organization_id,\n      updateData\n    )\n\n    const response = await simulateUpdateContact(request, mockSupabase, mockUser, mockContact.id)\n    const { status, data } = await parseResponse(response)\n\n    expect(status).toBe(200)\n    expect(data.name).toBe(updateData.name)\n  })\n\n  it('should prevent updating contact from different organization', async () => {\n    const otherOrgContact = createMockContact({ organization_id: 'different-org-id' })\n\n    mockSupabase.from = jest.fn().mockReturnValue({\n      select: jest.fn().mockReturnThis(),\n      eq: jest.fn().mockReturnThis(),\n      single: jest.fn().mockResolvedValue({ data: null, error: { code: 'PGRST116' } }),\n    })\n\n    const request = createAuthenticatedRequest(\n      'PUT',\n      `/api/contacts/${otherOrgContact.id}`,\n      mockUser.id,\n      mockUser.organization_id,\n      { name: 'Hacked' }\n    )\n\n    const response = await simulateUpdateContact(request, mockSupabase, mockUser, otherOrgContact.id)\n    const { status, data } = await parseResponse(response)\n\n    expect(status).toBe(404)\n    expectErrorResponse(data, 404, 'not found')\n  })\n})\n\ndescribe('DELETE /api/contacts/[id]', () => {\n  let mockSupabase: any\n  let mockUser: any\n  let mockContact: any\n\n  beforeEach(() => {\n    mockSupabase = createMockSupabaseClient()\n    mockUser = createMockUser()\n    mockContact = createMockContact({ organization_id: mockUser.organization_id })\n    jest.clearAllMocks()\n  })\n\n  it('should soft delete contact', async () => {\n    mockSupabase.from = jest.fn().mockReturnValue({\n      select: jest.fn().mockReturnThis(),\n      eq: jest.fn().mockReturnThis(),\n      single: jest.fn().mockResolvedValue({ data: mockContact, error: null }),\n      update: jest.fn().mockReturnThis(),\n    })\n\n    const request = createAuthenticatedRequest(\n      'DELETE',\n      `/api/contacts/${mockContact.id}`,\n      mockUser.id,\n      mockUser.organization_id\n    )\n\n    const response = await simulateDeleteContact(request, mockSupabase, mockUser, mockContact.id)\n    const { status, data } = await parseResponse(response)\n\n    expect(status).toBe(200)\n    expect(data.message).toContain('deleted')\n  })\n\n  it('should prevent deleting contact from different organization', async () => {\n    const otherOrgContact = createMockContact({ organization_id: 'different-org-id' })\n\n    mockSupabase.from = jest.fn().mockReturnValue({\n      select: jest.fn().mockReturnThis(),\n      eq: jest.fn().mockReturnThis(),\n      single: jest.fn().mockResolvedValue({ data: null, error: { code: 'PGRST116' } }),\n    })\n\n    const request = createAuthenticatedRequest(\n      'DELETE',\n      `/api/contacts/${otherOrgContact.id}`,\n      mockUser.id,\n      mockUser.organization_id\n    )\n\n    const response = await simulateDeleteContact(request, mockSupabase, mockUser, otherOrgContact.id)\n    const { status, data } = await parseResponse(response)\n\n    expect(status).toBe(404)\n    expectErrorResponse(data, 404, 'not found')\n  })\n})\n\n// =============================================================================\n// Helper Functions to Simulate API Route Handlers\n// =============================================================================\n\nasync function simulateGetContacts(request: NextRequest, supabase: any, user: any): Promise<any> {\n  try {\n    const { searchParams } = new URL(request.url)\n    const search = searchParams.get('search')\n    const tags = searchParams.get('tags')?.split(',')\n    const page = parseInt(searchParams.get('page') || '1')\n    const limit = parseInt(searchParams.get('limit') || '20')\n    const offset = (page - 1) * limit\n\n    let query = supabase.from('contacts').select('*', { count: 'exact' }).eq('organization_id', user.organization_id)\n\n    if (search) {\n      query = query.or(`name.ilike.%${search}%,phone_number.ilike.%${search}%`)\n    }\n\n    if (tags && tags.length > 0) {\n      query = query.overlaps('tags', tags)\n    }\n\n    const { data: contacts, error, count } = await query.order('created_at', { ascending: false }).range(offset, offset + limit - 1)\n\n    if (error) throw error\n\n    return new Response(\n      JSON.stringify({\n        contacts,\n        pagination: {\n          page,\n          limit,\n          total: count || 0,\n          hasMore: offset + limit < (count || 0),\n        },\n        filters: { search, tags },\n      }),\n      { status: 200, headers: { 'Content-Type': 'application/json' } }\n    )\n  } catch (error: any) {\n    return new Response(JSON.stringify({ error: error.message }), {\n      status: 500,\n      headers: { 'Content-Type': 'application/json' },\n    })\n  }\n}\n\nasync function simulateCreateContact(request: NextRequest, supabase: any, user: any): Promise<any> {\n  try {\n    const body = await request.json()\n    const { phone_number, name, email, tags } = body\n\n    if (!phone_number) {\n      return new Response(JSON.stringify({ error: 'Phone number is required' }), {\n        status: 400,\n        headers: { 'Content-Type': 'application/json' },\n      })\n    }\n\n    const phoneRegex = /^\\+?[1-9]\\d{1,14}$/\n    if (!phoneRegex.test(phone_number.replace(/[\\s-()]/g, ''))) {\n      return new Response(JSON.stringify({ error: 'Invalid phone number format' }), {\n        status: 400,\n        headers: { 'Content-Type': 'application/json' },\n      })\n    }\n\n    // Check for duplicates\n    const { data: existingContact } = await supabase\n      .from('contacts')\n      .select('id')\n      .eq('organization_id', user.organization_id)\n      .eq('phone_number', phone_number)\n      .single()\n\n    if (existingContact) {\n      return new Response(JSON.stringify({ error: 'Contact with this phone number already exists' }), {\n        status: 409,\n        headers: { 'Content-Type': 'application/json' },\n      })\n    }\n\n    // Create contact\n    const { data: contact, error } = await supabase\n      .from('contacts')\n      .insert({\n        organization_id: user.organization_id,\n        phone_number,\n        name,\n        email,\n        tags,\n      })\n      .select()\n      .single()\n\n    if (error) throw error\n\n    return new Response(JSON.stringify(contact), {\n      status: 201,\n      headers: { 'Content-Type': 'application/json' },\n    })\n  } catch (error: any) {\n    return new Response(JSON.stringify({ error: error.message }), {\n      status: 500,\n      headers: { 'Content-Type': 'application/json' },\n    })\n  }\n}\n\nasync function simulateUpdateContact(request: NextRequest, supabase: any, user: any, contactId: string): Promise<any> {\n  try {\n    const body = await request.json()\n\n    // Check contact exists and belongs to organization\n    const { data: contact, error: fetchError } = await supabase\n      .from('contacts')\n      .select('*')\n      .eq('id', contactId)\n      .eq('organization_id', user.organization_id)\n      .single()\n\n    if (fetchError || !contact) {\n      return new Response(JSON.stringify({ error: 'Contact not found' }), {\n        status: 404,\n        headers: { 'Content-Type': 'application/json' },\n      })\n    }\n\n    // Update contact\n    const { data: updated, error } = await supabase\n      .from('contacts')\n      .update(body)\n      .eq('id', contactId)\n      .eq('organization_id', user.organization_id)\n      .select()\n      .single()\n\n    if (error) throw error\n\n    return new Response(JSON.stringify(updated), {\n      status: 200,\n      headers: { 'Content-Type': 'application/json' },\n    })\n  } catch (error: any) {\n    return new Response(JSON.stringify({ error: error.message }), {\n      status: 500,\n      headers: { 'Content-Type': 'application/json' },\n    })\n  }\n}\n\nasync function simulateDeleteContact(request: NextRequest, supabase: any, user: any, contactId: string): Promise<any> {\n  try {\n    // Check contact exists and belongs to organization\n    const { data: contact, error: fetchError } = await supabase\n      .from('contacts')\n      .select('*')\n      .eq('id', contactId)\n      .eq('organization_id', user.organization_id)\n      .single()\n\n    if (fetchError || !contact) {\n      return new Response(JSON.stringify({ error: 'Contact not found' }), {\n        status: 404,\n        headers: { 'Content-Type': 'application/json' },\n      })\n    }\n\n    // Soft delete\n    const { error } = await supabase\n      .from('contacts')\n      .update({ deleted_at: new Date().toISOString() })\n      .eq('id', contactId)\n      .eq('organization_id', user.organization_id)\n\n    if (error) throw error\n\n    return new Response(JSON.stringify({ message: 'Contact deleted successfully' }), {\n      status: 200,\n      headers: { 'Content-Type': 'application/json' },\n    })\n  } catch (error: any) {\n    return new Response(JSON.stringify({ error: error.message }), {\n      status: 500,\n      headers: { 'Content-Type': 'application/json' },\n    })\n  }\n}\n"],"names":["jest","mock","describe","mockSupabase","mockUser","mockContacts","beforeEach","createMockSupabaseClient","createMockUser","generateMockContacts","organization_id","clearAllMocks","it","from","fn","mockReturnValue","select","mockReturnThis","eq","order","range","mockResolvedValue","data","slice","error","count","url","createPaginatedUrl","page","limit","request","createAuthenticatedRequest","id","response","simulateGetContacts","status","parseResponse","expect","toBe","expectPaginatedResponse","contacts","toHaveLength","pagination","total","hasMore","searchResults","filter","c","name","includes","or","length","filters","search","otherOrgContact","createMockContact","mockImplementation","field","value","forEach","contact","vipContacts","tags","overlaps","toContain","newContactData","phone_number","email","table","single","insert","simulateCreateContact","existingContact","expectErrorResponse","mockContact","updateData","update","simulateUpdateContact","code","simulateDeleteContact","message","supabase","user","searchParams","URL","get","split","parseInt","offset","query","ascending","Response","JSON","stringify","headers","body","json","phoneRegex","test","replace","contactId","fetchError","updated","deleted_at","Date","toISOString"],"mappings":"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"}