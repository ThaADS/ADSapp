49a9106096dbc3778ce072801d8f8d2e
/**
 * Multi-Layer Cache Manager
 *
 * Implements 3-layer caching strategy:
 * - L1: In-memory cache (1 minute TTL) - Hot data
 * - L2: Redis cache (15 minutes TTL) - Shared data
 * - L3: Database (Source of truth) - Persistent data
 *
 * Features:
 * - Automatic cache warming
 * - Smart invalidation
 * - Cache-aside pattern
 * - Write-through option
 * - Tenant isolation
 * - Performance monitoring
 */ "use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
function _export(target, all) {
    for(var name in all)Object.defineProperty(target, name, {
        enumerable: true,
        get: Object.getOwnPropertyDescriptor(all, name).get
    });
}
_export(exports, {
    get CacheManager () {
        return CacheManager;
    },
    get // Export default instance
    default () {
        return _default;
    },
    get deleteCached () {
        return deleteCached;
    },
    get getCacheManager () {
        return getCacheManager;
    },
    get getCached () {
        return getCached;
    },
    get invalidateCache () {
        return invalidateCache;
    },
    get resetCacheManager () {
        return resetCacheManager;
    },
    get setCached () {
        return setCached;
    }
});
const _l1cache = require("./l1-cache");
const _redisclient = require("./redis-client");
class CacheManager {
    constructor(config){
        this.config = {
            l1Enabled: config?.l1Enabled ?? true,
            l2Enabled: config?.l2Enabled ?? true,
            l1TTL: config?.l1TTL || 60,
            l2TTL: config?.l2TTL || 900,
            enableMonitoring: config?.enableMonitoring ?? true,
            writeThrough: config?.writeThrough ?? true,
            warmOnMiss: config?.warmOnMiss ?? true
        };
        this.l1Cache = (0, _l1cache.getL1Cache)();
        this.performance = {
            l1HitRate: 0,
            l2HitRate: 0,
            averageLatency: 0,
            totalRequests: 0,
            l1Hits: 0,
            l2Hits: 0,
            l3Hits: 0
        };
    }
    /**
   * Get cached data with multi-layer fallback
   */ async get(tenant, resource, id, fetchFn) {
        const startTime = Date.now();
        const cacheKey = (0, _redisclient.generateCacheKey)(tenant, resource, id);
        try {
            // L1: Check in-memory cache
            if (this.config.l1Enabled) {
                const l1Data = this.l1Cache.get(cacheKey);
                if (l1Data !== null) {
                    this.recordHit('l1', startTime);
                    return this.wrapEntry(l1Data, tenant, resource, 'l1');
                }
            }
            // L2: Check Redis cache
            if (this.config.l2Enabled) {
                const l2Data = await (0, _redisclient.getCached)(cacheKey);
                if (l2Data !== null) {
                    // Warm L1 cache
                    if (this.config.l1Enabled && this.config.warmOnMiss) {
                        this.l1Cache.set(cacheKey, l2Data, this.config.l1TTL);
                    }
                    this.recordHit('l2', startTime);
                    return this.wrapEntry(l2Data, tenant, resource, 'l2');
                }
            }
            // L3: Fetch from database
            const l3Data = await fetchFn();
            // Store in all cache layers (write-through)
            if (this.config.writeThrough) {
                await this.set(tenant, resource, id, l3Data);
            }
            this.recordHit('l3', startTime);
            return this.wrapEntry(l3Data, tenant, resource, 'l3');
        } catch (error) {
            console.error('[CacheManager] Get error:', error);
            // Fallback to database on cache failure
            const data = await fetchFn();
            this.recordHit('l3', startTime);
            return this.wrapEntry(data, tenant, resource, 'l3');
        }
    }
    /**
   * Set data in cache layers
   */ async set(tenant, resource, id, data) {
        const cacheKey = (0, _redisclient.generateCacheKey)(tenant, resource, id);
        try {
            // L1: Store in memory
            if (this.config.l1Enabled) {
                this.l1Cache.set(cacheKey, data, this.config.l1TTL);
            }
            // L2: Store in Redis
            if (this.config.l2Enabled) {
                await (0, _redisclient.setCached)(cacheKey, data, {
                    ttl: this.config.l2TTL
                });
            }
            if (this.config.enableMonitoring) {
                console.log(`[CacheManager] SET: ${cacheKey}`);
            }
        } catch (error) {
            console.error('[CacheManager] Set error:', error);
        // Non-critical error - cache set failure shouldn't break the app
        }
    }
    /**
   * Delete data from all cache layers
   */ async delete(tenant, resource, id) {
        const cacheKey = (0, _redisclient.generateCacheKey)(tenant, resource, id);
        try {
            // L1: Delete from memory
            if (this.config.l1Enabled) {
                this.l1Cache.delete(cacheKey);
            }
            // L2: Delete from Redis
            if (this.config.l2Enabled) {
                await (0, _redisclient.deleteCached)(cacheKey);
            }
            if (this.config.enableMonitoring) {
                console.log(`[CacheManager] DELETE: ${cacheKey}`);
            }
        } catch (error) {
            console.error('[CacheManager] Delete error:', error);
        }
    }
    /**
   * Invalidate all cache entries for a tenant and resource
   */ async invalidate(tenant, resource) {
        try {
            const pattern = resource ? `${tenant}:${resource}:*` : `${tenant}:*`;
            let count = 0;
            // L1: Clear matching keys
            if (this.config.l1Enabled) {
                const keys = this.l1Cache.keys();
                for (const key of keys){
                    if (this.matchesPattern(key, pattern)) {
                        this.l1Cache.delete(key);
                        count++;
                    }
                }
            }
            // L2: Clear matching keys in Redis
            if (this.config.l2Enabled) {
                const redisCount = await (0, _redisclient.deletePattern)(pattern);
                count += redisCount;
            }
            if (this.config.enableMonitoring) {
                console.log(`[CacheManager] INVALIDATE: ${pattern} (${count} keys)`);
            }
            return count;
        } catch (error) {
            console.error('[CacheManager] Invalidate error:', error);
            return 0;
        }
    }
    /**
   * Warm cache with data
   */ async warm(tenant, resource, items) {
        try {
            for (const item of items){
                await this.set(tenant, resource, item.id, item.data);
            }
            if (this.config.enableMonitoring) {
                console.log(`[CacheManager] WARM: ${tenant}:${resource} (${items.length} items)`);
            }
        } catch (error) {
            console.error('[CacheManager] Warm error:', error);
        }
    }
    /**
   * Get cache performance metrics
   */ getPerformance() {
        this.updateHitRates();
        return {
            ...this.performance
        };
    }
    /**
   * Reset performance metrics
   */ resetPerformance() {
        this.performance = {
            l1HitRate: 0,
            l2HitRate: 0,
            averageLatency: 0,
            totalRequests: 0,
            l1Hits: 0,
            l2Hits: 0,
            l3Hits: 0
        };
    }
    /**
   * Check cache health
   */ async healthCheck() {
        const l1Available = true; // L1 is always available (in-memory)
        const l2Available = await (0, _redisclient.isRedisAvailable)();
        let overall;
        if (l1Available && l2Available) {
            overall = 'healthy';
        } else if (l1Available || l2Available) {
            overall = 'degraded';
        } else {
            overall = 'down';
        }
        return {
            l1Available,
            l2Available,
            overall
        };
    }
    /**
   * Get cache configuration
   */ getConfig() {
        return {
            ...this.config
        };
    }
    /**
   * Update cache configuration
   */ updateConfig(config) {
        this.config = {
            ...this.config,
            ...config
        };
    }
    /**
   * Wrap data in cache entry format
   */ wrapEntry(data, tenant, resource, source) {
        return {
            data,
            metadata: {
                tenant,
                resource,
                cachedAt: Date.now(),
                source
            }
        };
    }
    /**
   * Record cache hit and update metrics
   */ recordHit(layer, startTime) {
        this.performance.totalRequests++;
        if (layer === 'l1') {
            this.performance.l1Hits++;
        } else if (layer === 'l2') {
            this.performance.l2Hits++;
        } else {
            this.performance.l3Hits++;
        }
        // Update average latency
        const latency = Date.now() - startTime;
        const total = this.performance.totalRequests;
        const currentAvg = this.performance.averageLatency;
        this.performance.averageLatency = (currentAvg * (total - 1) + latency) / total;
    }
    /**
   * Update hit rate calculations
   */ updateHitRates() {
        const total = this.performance.totalRequests;
        if (total > 0) {
            this.performance.l1HitRate = this.performance.l1Hits / total * 100;
            this.performance.l2HitRate = (this.performance.l1Hits + this.performance.l2Hits) / total * 100;
        }
    }
    /**
   * Check if key matches pattern
   */ matchesPattern(key, pattern) {
        const regex = new RegExp('^' + pattern.replace(/\*/g, '.*') + '$');
        return regex.test(key);
    }
}
// Global cache manager instance
let globalCacheManager = null;
function getCacheManager(config) {
    if (!globalCacheManager) {
        globalCacheManager = new CacheManager(config);
    }
    return globalCacheManager;
}
function resetCacheManager() {
    globalCacheManager = null;
}
async function getCached(tenant, resource, id, fetchFn) {
    const manager = getCacheManager();
    const result = await manager.get(tenant, resource, id, fetchFn);
    return result.data;
}
async function setCached(tenant, resource, id, data) {
    const manager = getCacheManager();
    await manager.set(tenant, resource, id, data);
}
async function deleteCached(tenant, resource, id) {
    const manager = getCacheManager();
    await manager.delete(tenant, resource, id);
}
async function invalidateCache(tenant, resource) {
    const manager = getCacheManager();
    return await manager.invalidate(tenant, resource);
}
const _default = getCacheManager();

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkM6XFxBaSBQcm9qZWN0ZW5cXEFEU2FwcFxcc3JjXFxsaWJcXGNhY2hlXFxjYWNoZS1tYW5hZ2VyLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogTXVsdGktTGF5ZXIgQ2FjaGUgTWFuYWdlclxuICpcbiAqIEltcGxlbWVudHMgMy1sYXllciBjYWNoaW5nIHN0cmF0ZWd5OlxuICogLSBMMTogSW4tbWVtb3J5IGNhY2hlICgxIG1pbnV0ZSBUVEwpIC0gSG90IGRhdGFcbiAqIC0gTDI6IFJlZGlzIGNhY2hlICgxNSBtaW51dGVzIFRUTCkgLSBTaGFyZWQgZGF0YVxuICogLSBMMzogRGF0YWJhc2UgKFNvdXJjZSBvZiB0cnV0aCkgLSBQZXJzaXN0ZW50IGRhdGFcbiAqXG4gKiBGZWF0dXJlczpcbiAqIC0gQXV0b21hdGljIGNhY2hlIHdhcm1pbmdcbiAqIC0gU21hcnQgaW52YWxpZGF0aW9uXG4gKiAtIENhY2hlLWFzaWRlIHBhdHRlcm5cbiAqIC0gV3JpdGUtdGhyb3VnaCBvcHRpb25cbiAqIC0gVGVuYW50IGlzb2xhdGlvblxuICogLSBQZXJmb3JtYW5jZSBtb25pdG9yaW5nXG4gKi9cblxuaW1wb3J0IHsgTDFDYWNoZSwgZ2V0TDFDYWNoZSB9IGZyb20gJy4vbDEtY2FjaGUnO1xuaW1wb3J0IHtcbiAgZ2V0Q2FjaGVkIGFzIGdldFJlZGlzLFxuICBzZXRDYWNoZWQgYXMgc2V0UmVkaXMsXG4gIGRlbGV0ZUNhY2hlZCBhcyBkZWxldGVSZWRpcyxcbiAgZGVsZXRlUGF0dGVybixcbiAgZ2VuZXJhdGVDYWNoZUtleSxcbiAgaXNSZWRpc0F2YWlsYWJsZSxcbn0gZnJvbSAnLi9yZWRpcy1jbGllbnQnO1xuXG5leHBvcnQgaW50ZXJmYWNlIENhY2hlTWFuYWdlckNvbmZpZyB7XG4gIGwxRW5hYmxlZDogYm9vbGVhbjtcbiAgbDJFbmFibGVkOiBib29sZWFuO1xuICBsMVRUTDogbnVtYmVyOyAvLyBzZWNvbmRzXG4gIGwyVFRMOiBudW1iZXI7IC8vIHNlY29uZHNcbiAgZW5hYmxlTW9uaXRvcmluZzogYm9vbGVhbjtcbiAgd3JpdGVUaHJvdWdoOiBib29sZWFuOyAvLyBVcGRhdGUgY2FjaGUgb24gd3JpdGVcbiAgd2FybU9uTWlzczogYm9vbGVhbjsgLy8gV2FybSBjYWNoZSBvbiByZWFkIG1pc3Ncbn1cblxuZXhwb3J0IGludGVyZmFjZSBDYWNoZUVudHJ5PFQ+IHtcbiAgZGF0YTogVDtcbiAgbWV0YWRhdGE6IHtcbiAgICB0ZW5hbnQ6IHN0cmluZztcbiAgICByZXNvdXJjZTogc3RyaW5nO1xuICAgIGNhY2hlZEF0OiBudW1iZXI7XG4gICAgc291cmNlOiAnbDEnIHwgJ2wyJyB8ICdsMyc7XG4gIH07XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgQ2FjaGVQZXJmb3JtYW5jZSB7XG4gIGwxSGl0UmF0ZTogbnVtYmVyO1xuICBsMkhpdFJhdGU6IG51bWJlcjtcbiAgYXZlcmFnZUxhdGVuY3k6IG51bWJlcjtcbiAgdG90YWxSZXF1ZXN0czogbnVtYmVyO1xuICBsMUhpdHM6IG51bWJlcjtcbiAgbDJIaXRzOiBudW1iZXI7XG4gIGwzSGl0czogbnVtYmVyO1xufVxuXG4vKipcbiAqIENhY2hlIE1hbmFnZXIgaW1wbGVtZW50aW5nIG11bHRpLWxheWVyIHN0cmF0ZWd5XG4gKi9cbmV4cG9ydCBjbGFzcyBDYWNoZU1hbmFnZXIge1xuICBwcml2YXRlIGwxQ2FjaGU6IEwxQ2FjaGU7XG4gIHByaXZhdGUgY29uZmlnOiBDYWNoZU1hbmFnZXJDb25maWc7XG4gIHByaXZhdGUgcGVyZm9ybWFuY2U6IENhY2hlUGVyZm9ybWFuY2U7XG5cbiAgY29uc3RydWN0b3IoY29uZmlnPzogUGFydGlhbDxDYWNoZU1hbmFnZXJDb25maWc+KSB7XG4gICAgdGhpcy5jb25maWcgPSB7XG4gICAgICBsMUVuYWJsZWQ6IGNvbmZpZz8ubDFFbmFibGVkID8/IHRydWUsXG4gICAgICBsMkVuYWJsZWQ6IGNvbmZpZz8ubDJFbmFibGVkID8/IHRydWUsXG4gICAgICBsMVRUTDogY29uZmlnPy5sMVRUTCB8fCA2MCwgLy8gMSBtaW51dGVcbiAgICAgIGwyVFRMOiBjb25maWc/LmwyVFRMIHx8IDkwMCwgLy8gMTUgbWludXRlc1xuICAgICAgZW5hYmxlTW9uaXRvcmluZzogY29uZmlnPy5lbmFibGVNb25pdG9yaW5nID8/IHRydWUsXG4gICAgICB3cml0ZVRocm91Z2g6IGNvbmZpZz8ud3JpdGVUaHJvdWdoID8/IHRydWUsXG4gICAgICB3YXJtT25NaXNzOiBjb25maWc/Lndhcm1Pbk1pc3MgPz8gdHJ1ZSxcbiAgICB9O1xuXG4gICAgdGhpcy5sMUNhY2hlID0gZ2V0TDFDYWNoZSgpO1xuICAgIHRoaXMucGVyZm9ybWFuY2UgPSB7XG4gICAgICBsMUhpdFJhdGU6IDAsXG4gICAgICBsMkhpdFJhdGU6IDAsXG4gICAgICBhdmVyYWdlTGF0ZW5jeTogMCxcbiAgICAgIHRvdGFsUmVxdWVzdHM6IDAsXG4gICAgICBsMUhpdHM6IDAsXG4gICAgICBsMkhpdHM6IDAsXG4gICAgICBsM0hpdHM6IDAsXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgY2FjaGVkIGRhdGEgd2l0aCBtdWx0aS1sYXllciBmYWxsYmFja1xuICAgKi9cbiAgYXN5bmMgZ2V0PFQ+KFxuICAgIHRlbmFudDogc3RyaW5nLFxuICAgIHJlc291cmNlOiBzdHJpbmcsXG4gICAgaWQ6IHN0cmluZyB8IHVuZGVmaW5lZCxcbiAgICBmZXRjaEZuOiAoKSA9PiBQcm9taXNlPFQ+XG4gICk6IFByb21pc2U8Q2FjaGVFbnRyeTxUPj4ge1xuICAgIGNvbnN0IHN0YXJ0VGltZSA9IERhdGUubm93KCk7XG4gICAgY29uc3QgY2FjaGVLZXkgPSBnZW5lcmF0ZUNhY2hlS2V5KHRlbmFudCwgcmVzb3VyY2UsIGlkKTtcblxuICAgIHRyeSB7XG4gICAgICAvLyBMMTogQ2hlY2sgaW4tbWVtb3J5IGNhY2hlXG4gICAgICBpZiAodGhpcy5jb25maWcubDFFbmFibGVkKSB7XG4gICAgICAgIGNvbnN0IGwxRGF0YSA9IHRoaXMubDFDYWNoZS5nZXQ8VD4oY2FjaGVLZXkpO1xuICAgICAgICBpZiAobDFEYXRhICE9PSBudWxsKSB7XG4gICAgICAgICAgdGhpcy5yZWNvcmRIaXQoJ2wxJywgc3RhcnRUaW1lKTtcbiAgICAgICAgICByZXR1cm4gdGhpcy53cmFwRW50cnkobDFEYXRhLCB0ZW5hbnQsIHJlc291cmNlLCAnbDEnKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICAvLyBMMjogQ2hlY2sgUmVkaXMgY2FjaGVcbiAgICAgIGlmICh0aGlzLmNvbmZpZy5sMkVuYWJsZWQpIHtcbiAgICAgICAgY29uc3QgbDJEYXRhID0gYXdhaXQgZ2V0UmVkaXM8VD4oY2FjaGVLZXkpO1xuICAgICAgICBpZiAobDJEYXRhICE9PSBudWxsKSB7XG4gICAgICAgICAgLy8gV2FybSBMMSBjYWNoZVxuICAgICAgICAgIGlmICh0aGlzLmNvbmZpZy5sMUVuYWJsZWQgJiYgdGhpcy5jb25maWcud2FybU9uTWlzcykge1xuICAgICAgICAgICAgdGhpcy5sMUNhY2hlLnNldChjYWNoZUtleSwgbDJEYXRhLCB0aGlzLmNvbmZpZy5sMVRUTCk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgdGhpcy5yZWNvcmRIaXQoJ2wyJywgc3RhcnRUaW1lKTtcbiAgICAgICAgICByZXR1cm4gdGhpcy53cmFwRW50cnkobDJEYXRhLCB0ZW5hbnQsIHJlc291cmNlLCAnbDInKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICAvLyBMMzogRmV0Y2ggZnJvbSBkYXRhYmFzZVxuICAgICAgY29uc3QgbDNEYXRhID0gYXdhaXQgZmV0Y2hGbigpO1xuXG4gICAgICAvLyBTdG9yZSBpbiBhbGwgY2FjaGUgbGF5ZXJzICh3cml0ZS10aHJvdWdoKVxuICAgICAgaWYgKHRoaXMuY29uZmlnLndyaXRlVGhyb3VnaCkge1xuICAgICAgICBhd2FpdCB0aGlzLnNldCh0ZW5hbnQsIHJlc291cmNlLCBpZCwgbDNEYXRhKTtcbiAgICAgIH1cblxuICAgICAgdGhpcy5yZWNvcmRIaXQoJ2wzJywgc3RhcnRUaW1lKTtcbiAgICAgIHJldHVybiB0aGlzLndyYXBFbnRyeShsM0RhdGEsIHRlbmFudCwgcmVzb3VyY2UsICdsMycpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdbQ2FjaGVNYW5hZ2VyXSBHZXQgZXJyb3I6JywgZXJyb3IpO1xuICAgICAgLy8gRmFsbGJhY2sgdG8gZGF0YWJhc2Ugb24gY2FjaGUgZmFpbHVyZVxuICAgICAgY29uc3QgZGF0YSA9IGF3YWl0IGZldGNoRm4oKTtcbiAgICAgIHRoaXMucmVjb3JkSGl0KCdsMycsIHN0YXJ0VGltZSk7XG4gICAgICByZXR1cm4gdGhpcy53cmFwRW50cnkoZGF0YSwgdGVuYW50LCByZXNvdXJjZSwgJ2wzJyk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFNldCBkYXRhIGluIGNhY2hlIGxheWVyc1xuICAgKi9cbiAgYXN5bmMgc2V0PFQ+KFxuICAgIHRlbmFudDogc3RyaW5nLFxuICAgIHJlc291cmNlOiBzdHJpbmcsXG4gICAgaWQ6IHN0cmluZyB8IHVuZGVmaW5lZCxcbiAgICBkYXRhOiBUXG4gICk6IFByb21pc2U8dm9pZD4ge1xuICAgIGNvbnN0IGNhY2hlS2V5ID0gZ2VuZXJhdGVDYWNoZUtleSh0ZW5hbnQsIHJlc291cmNlLCBpZCk7XG5cbiAgICB0cnkge1xuICAgICAgLy8gTDE6IFN0b3JlIGluIG1lbW9yeVxuICAgICAgaWYgKHRoaXMuY29uZmlnLmwxRW5hYmxlZCkge1xuICAgICAgICB0aGlzLmwxQ2FjaGUuc2V0KGNhY2hlS2V5LCBkYXRhLCB0aGlzLmNvbmZpZy5sMVRUTCk7XG4gICAgICB9XG5cbiAgICAgIC8vIEwyOiBTdG9yZSBpbiBSZWRpc1xuICAgICAgaWYgKHRoaXMuY29uZmlnLmwyRW5hYmxlZCkge1xuICAgICAgICBhd2FpdCBzZXRSZWRpcyhjYWNoZUtleSwgZGF0YSwgeyB0dGw6IHRoaXMuY29uZmlnLmwyVFRMIH0pO1xuICAgICAgfVxuXG4gICAgICBpZiAodGhpcy5jb25maWcuZW5hYmxlTW9uaXRvcmluZykge1xuICAgICAgICBjb25zb2xlLmxvZyhgW0NhY2hlTWFuYWdlcl0gU0VUOiAke2NhY2hlS2V5fWApO1xuICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdbQ2FjaGVNYW5hZ2VyXSBTZXQgZXJyb3I6JywgZXJyb3IpO1xuICAgICAgLy8gTm9uLWNyaXRpY2FsIGVycm9yIC0gY2FjaGUgc2V0IGZhaWx1cmUgc2hvdWxkbid0IGJyZWFrIHRoZSBhcHBcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogRGVsZXRlIGRhdGEgZnJvbSBhbGwgY2FjaGUgbGF5ZXJzXG4gICAqL1xuICBhc3luYyBkZWxldGUodGVuYW50OiBzdHJpbmcsIHJlc291cmNlOiBzdHJpbmcsIGlkPzogc3RyaW5nKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgY29uc3QgY2FjaGVLZXkgPSBnZW5lcmF0ZUNhY2hlS2V5KHRlbmFudCwgcmVzb3VyY2UsIGlkKTtcblxuICAgIHRyeSB7XG4gICAgICAvLyBMMTogRGVsZXRlIGZyb20gbWVtb3J5XG4gICAgICBpZiAodGhpcy5jb25maWcubDFFbmFibGVkKSB7XG4gICAgICAgIHRoaXMubDFDYWNoZS5kZWxldGUoY2FjaGVLZXkpO1xuICAgICAgfVxuXG4gICAgICAvLyBMMjogRGVsZXRlIGZyb20gUmVkaXNcbiAgICAgIGlmICh0aGlzLmNvbmZpZy5sMkVuYWJsZWQpIHtcbiAgICAgICAgYXdhaXQgZGVsZXRlUmVkaXMoY2FjaGVLZXkpO1xuICAgICAgfVxuXG4gICAgICBpZiAodGhpcy5jb25maWcuZW5hYmxlTW9uaXRvcmluZykge1xuICAgICAgICBjb25zb2xlLmxvZyhgW0NhY2hlTWFuYWdlcl0gREVMRVRFOiAke2NhY2hlS2V5fWApO1xuICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdbQ2FjaGVNYW5hZ2VyXSBEZWxldGUgZXJyb3I6JywgZXJyb3IpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBJbnZhbGlkYXRlIGFsbCBjYWNoZSBlbnRyaWVzIGZvciBhIHRlbmFudCBhbmQgcmVzb3VyY2VcbiAgICovXG4gIGFzeW5jIGludmFsaWRhdGUodGVuYW50OiBzdHJpbmcsIHJlc291cmNlPzogc3RyaW5nKTogUHJvbWlzZTxudW1iZXI+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgcGF0dGVybiA9IHJlc291cmNlXG4gICAgICAgID8gYCR7dGVuYW50fToke3Jlc291cmNlfToqYFxuICAgICAgICA6IGAke3RlbmFudH06KmA7XG5cbiAgICAgIGxldCBjb3VudCA9IDA7XG5cbiAgICAgIC8vIEwxOiBDbGVhciBtYXRjaGluZyBrZXlzXG4gICAgICBpZiAodGhpcy5jb25maWcubDFFbmFibGVkKSB7XG4gICAgICAgIGNvbnN0IGtleXMgPSB0aGlzLmwxQ2FjaGUua2V5cygpO1xuICAgICAgICBmb3IgKGNvbnN0IGtleSBvZiBrZXlzKSB7XG4gICAgICAgICAgaWYgKHRoaXMubWF0Y2hlc1BhdHRlcm4oa2V5LCBwYXR0ZXJuKSkge1xuICAgICAgICAgICAgdGhpcy5sMUNhY2hlLmRlbGV0ZShrZXkpO1xuICAgICAgICAgICAgY291bnQrKztcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgLy8gTDI6IENsZWFyIG1hdGNoaW5nIGtleXMgaW4gUmVkaXNcbiAgICAgIGlmICh0aGlzLmNvbmZpZy5sMkVuYWJsZWQpIHtcbiAgICAgICAgY29uc3QgcmVkaXNDb3VudCA9IGF3YWl0IGRlbGV0ZVBhdHRlcm4ocGF0dGVybik7XG4gICAgICAgIGNvdW50ICs9IHJlZGlzQ291bnQ7XG4gICAgICB9XG5cbiAgICAgIGlmICh0aGlzLmNvbmZpZy5lbmFibGVNb25pdG9yaW5nKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKGBbQ2FjaGVNYW5hZ2VyXSBJTlZBTElEQVRFOiAke3BhdHRlcm59ICgke2NvdW50fSBrZXlzKWApO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gY291bnQ7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ1tDYWNoZU1hbmFnZXJdIEludmFsaWRhdGUgZXJyb3I6JywgZXJyb3IpO1xuICAgICAgcmV0dXJuIDA7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFdhcm0gY2FjaGUgd2l0aCBkYXRhXG4gICAqL1xuICBhc3luYyB3YXJtPFQ+KFxuICAgIHRlbmFudDogc3RyaW5nLFxuICAgIHJlc291cmNlOiBzdHJpbmcsXG4gICAgaXRlbXM6IEFycmF5PHsgaWQ/OiBzdHJpbmc7IGRhdGE6IFQgfT5cbiAgKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgdHJ5IHtcbiAgICAgIGZvciAoY29uc3QgaXRlbSBvZiBpdGVtcykge1xuICAgICAgICBhd2FpdCB0aGlzLnNldCh0ZW5hbnQsIHJlc291cmNlLCBpdGVtLmlkLCBpdGVtLmRhdGEpO1xuICAgICAgfVxuXG4gICAgICBpZiAodGhpcy5jb25maWcuZW5hYmxlTW9uaXRvcmluZykge1xuICAgICAgICBjb25zb2xlLmxvZyhcbiAgICAgICAgICBgW0NhY2hlTWFuYWdlcl0gV0FSTTogJHt0ZW5hbnR9OiR7cmVzb3VyY2V9ICgke2l0ZW1zLmxlbmd0aH0gaXRlbXMpYFxuICAgICAgICApO1xuICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdbQ2FjaGVNYW5hZ2VyXSBXYXJtIGVycm9yOicsIGVycm9yKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogR2V0IGNhY2hlIHBlcmZvcm1hbmNlIG1ldHJpY3NcbiAgICovXG4gIGdldFBlcmZvcm1hbmNlKCk6IENhY2hlUGVyZm9ybWFuY2Uge1xuICAgIHRoaXMudXBkYXRlSGl0UmF0ZXMoKTtcbiAgICByZXR1cm4geyAuLi50aGlzLnBlcmZvcm1hbmNlIH07XG4gIH1cblxuICAvKipcbiAgICogUmVzZXQgcGVyZm9ybWFuY2UgbWV0cmljc1xuICAgKi9cbiAgcmVzZXRQZXJmb3JtYW5jZSgpOiB2b2lkIHtcbiAgICB0aGlzLnBlcmZvcm1hbmNlID0ge1xuICAgICAgbDFIaXRSYXRlOiAwLFxuICAgICAgbDJIaXRSYXRlOiAwLFxuICAgICAgYXZlcmFnZUxhdGVuY3k6IDAsXG4gICAgICB0b3RhbFJlcXVlc3RzOiAwLFxuICAgICAgbDFIaXRzOiAwLFxuICAgICAgbDJIaXRzOiAwLFxuICAgICAgbDNIaXRzOiAwLFxuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogQ2hlY2sgY2FjaGUgaGVhbHRoXG4gICAqL1xuICBhc3luYyBoZWFsdGhDaGVjaygpOiBQcm9taXNlPHtcbiAgICBsMUF2YWlsYWJsZTogYm9vbGVhbjtcbiAgICBsMkF2YWlsYWJsZTogYm9vbGVhbjtcbiAgICBvdmVyYWxsOiAnaGVhbHRoeScgfCAnZGVncmFkZWQnIHwgJ2Rvd24nO1xuICB9PiB7XG4gICAgY29uc3QgbDFBdmFpbGFibGUgPSB0cnVlOyAvLyBMMSBpcyBhbHdheXMgYXZhaWxhYmxlIChpbi1tZW1vcnkpXG4gICAgY29uc3QgbDJBdmFpbGFibGUgPSBhd2FpdCBpc1JlZGlzQXZhaWxhYmxlKCk7XG5cbiAgICBsZXQgb3ZlcmFsbDogJ2hlYWx0aHknIHwgJ2RlZ3JhZGVkJyB8ICdkb3duJztcbiAgICBpZiAobDFBdmFpbGFibGUgJiYgbDJBdmFpbGFibGUpIHtcbiAgICAgIG92ZXJhbGwgPSAnaGVhbHRoeSc7XG4gICAgfSBlbHNlIGlmIChsMUF2YWlsYWJsZSB8fCBsMkF2YWlsYWJsZSkge1xuICAgICAgb3ZlcmFsbCA9ICdkZWdyYWRlZCc7XG4gICAgfSBlbHNlIHtcbiAgICAgIG92ZXJhbGwgPSAnZG93bic7XG4gICAgfVxuXG4gICAgcmV0dXJuIHsgbDFBdmFpbGFibGUsIGwyQXZhaWxhYmxlLCBvdmVyYWxsIH07XG4gIH1cblxuICAvKipcbiAgICogR2V0IGNhY2hlIGNvbmZpZ3VyYXRpb25cbiAgICovXG4gIGdldENvbmZpZygpOiBDYWNoZU1hbmFnZXJDb25maWcge1xuICAgIHJldHVybiB7IC4uLnRoaXMuY29uZmlnIH07XG4gIH1cblxuICAvKipcbiAgICogVXBkYXRlIGNhY2hlIGNvbmZpZ3VyYXRpb25cbiAgICovXG4gIHVwZGF0ZUNvbmZpZyhjb25maWc6IFBhcnRpYWw8Q2FjaGVNYW5hZ2VyQ29uZmlnPik6IHZvaWQge1xuICAgIHRoaXMuY29uZmlnID0geyAuLi50aGlzLmNvbmZpZywgLi4uY29uZmlnIH07XG4gIH1cblxuICAvKipcbiAgICogV3JhcCBkYXRhIGluIGNhY2hlIGVudHJ5IGZvcm1hdFxuICAgKi9cbiAgcHJpdmF0ZSB3cmFwRW50cnk8VD4oXG4gICAgZGF0YTogVCxcbiAgICB0ZW5hbnQ6IHN0cmluZyxcbiAgICByZXNvdXJjZTogc3RyaW5nLFxuICAgIHNvdXJjZTogJ2wxJyB8ICdsMicgfCAnbDMnXG4gICk6IENhY2hlRW50cnk8VD4ge1xuICAgIHJldHVybiB7XG4gICAgICBkYXRhLFxuICAgICAgbWV0YWRhdGE6IHtcbiAgICAgICAgdGVuYW50LFxuICAgICAgICByZXNvdXJjZSxcbiAgICAgICAgY2FjaGVkQXQ6IERhdGUubm93KCksXG4gICAgICAgIHNvdXJjZSxcbiAgICAgIH0sXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZWNvcmQgY2FjaGUgaGl0IGFuZCB1cGRhdGUgbWV0cmljc1xuICAgKi9cbiAgcHJpdmF0ZSByZWNvcmRIaXQobGF5ZXI6ICdsMScgfCAnbDInIHwgJ2wzJywgc3RhcnRUaW1lOiBudW1iZXIpOiB2b2lkIHtcbiAgICB0aGlzLnBlcmZvcm1hbmNlLnRvdGFsUmVxdWVzdHMrKztcblxuICAgIGlmIChsYXllciA9PT0gJ2wxJykge1xuICAgICAgdGhpcy5wZXJmb3JtYW5jZS5sMUhpdHMrKztcbiAgICB9IGVsc2UgaWYgKGxheWVyID09PSAnbDInKSB7XG4gICAgICB0aGlzLnBlcmZvcm1hbmNlLmwySGl0cysrO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnBlcmZvcm1hbmNlLmwzSGl0cysrO1xuICAgIH1cblxuICAgIC8vIFVwZGF0ZSBhdmVyYWdlIGxhdGVuY3lcbiAgICBjb25zdCBsYXRlbmN5ID0gRGF0ZS5ub3coKSAtIHN0YXJ0VGltZTtcbiAgICBjb25zdCB0b3RhbCA9IHRoaXMucGVyZm9ybWFuY2UudG90YWxSZXF1ZXN0cztcbiAgICBjb25zdCBjdXJyZW50QXZnID0gdGhpcy5wZXJmb3JtYW5jZS5hdmVyYWdlTGF0ZW5jeTtcbiAgICB0aGlzLnBlcmZvcm1hbmNlLmF2ZXJhZ2VMYXRlbmN5ID1cbiAgICAgIChjdXJyZW50QXZnICogKHRvdGFsIC0gMSkgKyBsYXRlbmN5KSAvIHRvdGFsO1xuICB9XG5cbiAgLyoqXG4gICAqIFVwZGF0ZSBoaXQgcmF0ZSBjYWxjdWxhdGlvbnNcbiAgICovXG4gIHByaXZhdGUgdXBkYXRlSGl0UmF0ZXMoKTogdm9pZCB7XG4gICAgY29uc3QgdG90YWwgPSB0aGlzLnBlcmZvcm1hbmNlLnRvdGFsUmVxdWVzdHM7XG4gICAgaWYgKHRvdGFsID4gMCkge1xuICAgICAgdGhpcy5wZXJmb3JtYW5jZS5sMUhpdFJhdGUgPVxuICAgICAgICAodGhpcy5wZXJmb3JtYW5jZS5sMUhpdHMgLyB0b3RhbCkgKiAxMDA7XG4gICAgICB0aGlzLnBlcmZvcm1hbmNlLmwySGl0UmF0ZSA9XG4gICAgICAgICgodGhpcy5wZXJmb3JtYW5jZS5sMUhpdHMgKyB0aGlzLnBlcmZvcm1hbmNlLmwySGl0cykgLyB0b3RhbCkgKiAxMDA7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIENoZWNrIGlmIGtleSBtYXRjaGVzIHBhdHRlcm5cbiAgICovXG4gIHByaXZhdGUgbWF0Y2hlc1BhdHRlcm4oa2V5OiBzdHJpbmcsIHBhdHRlcm46IHN0cmluZyk6IGJvb2xlYW4ge1xuICAgIGNvbnN0IHJlZ2V4ID0gbmV3IFJlZ0V4cCgnXicgKyBwYXR0ZXJuLnJlcGxhY2UoL1xcKi9nLCAnLionKSArICckJyk7XG4gICAgcmV0dXJuIHJlZ2V4LnRlc3Qoa2V5KTtcbiAgfVxufVxuXG4vLyBHbG9iYWwgY2FjaGUgbWFuYWdlciBpbnN0YW5jZVxubGV0IGdsb2JhbENhY2hlTWFuYWdlcjogQ2FjaGVNYW5hZ2VyIHwgbnVsbCA9IG51bGw7XG5cbi8qKlxuICogR2V0IGdsb2JhbCBjYWNoZSBtYW5hZ2VyIGluc3RhbmNlXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBnZXRDYWNoZU1hbmFnZXIoXG4gIGNvbmZpZz86IFBhcnRpYWw8Q2FjaGVNYW5hZ2VyQ29uZmlnPlxuKTogQ2FjaGVNYW5hZ2VyIHtcbiAgaWYgKCFnbG9iYWxDYWNoZU1hbmFnZXIpIHtcbiAgICBnbG9iYWxDYWNoZU1hbmFnZXIgPSBuZXcgQ2FjaGVNYW5hZ2VyKGNvbmZpZyk7XG4gIH1cbiAgcmV0dXJuIGdsb2JhbENhY2hlTWFuYWdlcjtcbn1cblxuLyoqXG4gKiBSZXNldCBnbG9iYWwgY2FjaGUgbWFuYWdlciBpbnN0YW5jZVxuICovXG5leHBvcnQgZnVuY3Rpb24gcmVzZXRDYWNoZU1hbmFnZXIoKTogdm9pZCB7XG4gIGdsb2JhbENhY2hlTWFuYWdlciA9IG51bGw7XG59XG5cbi8qKlxuICogSGVscGVyIGZ1bmN0aW9uIGZvciBzaW1wbGUgY2FjaGVkIGdldFxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0Q2FjaGVkPFQ+KFxuICB0ZW5hbnQ6IHN0cmluZyxcbiAgcmVzb3VyY2U6IHN0cmluZyxcbiAgaWQ6IHN0cmluZyB8IHVuZGVmaW5lZCxcbiAgZmV0Y2hGbjogKCkgPT4gUHJvbWlzZTxUPlxuKTogUHJvbWlzZTxUPiB7XG4gIGNvbnN0IG1hbmFnZXIgPSBnZXRDYWNoZU1hbmFnZXIoKTtcbiAgY29uc3QgcmVzdWx0ID0gYXdhaXQgbWFuYWdlci5nZXQodGVuYW50LCByZXNvdXJjZSwgaWQsIGZldGNoRm4pO1xuICByZXR1cm4gcmVzdWx0LmRhdGE7XG59XG5cbi8qKlxuICogSGVscGVyIGZ1bmN0aW9uIGZvciBzaW1wbGUgY2FjaGVkIHNldFxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gc2V0Q2FjaGVkPFQ+KFxuICB0ZW5hbnQ6IHN0cmluZyxcbiAgcmVzb3VyY2U6IHN0cmluZyxcbiAgaWQ6IHN0cmluZyB8IHVuZGVmaW5lZCxcbiAgZGF0YTogVFxuKTogUHJvbWlzZTx2b2lkPiB7XG4gIGNvbnN0IG1hbmFnZXIgPSBnZXRDYWNoZU1hbmFnZXIoKTtcbiAgYXdhaXQgbWFuYWdlci5zZXQodGVuYW50LCByZXNvdXJjZSwgaWQsIGRhdGEpO1xufVxuXG4vKipcbiAqIEhlbHBlciBmdW5jdGlvbiBmb3Igc2ltcGxlIGNhY2hlZCBkZWxldGVcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGRlbGV0ZUNhY2hlZChcbiAgdGVuYW50OiBzdHJpbmcsXG4gIHJlc291cmNlOiBzdHJpbmcsXG4gIGlkPzogc3RyaW5nXG4pOiBQcm9taXNlPHZvaWQ+IHtcbiAgY29uc3QgbWFuYWdlciA9IGdldENhY2hlTWFuYWdlcigpO1xuICBhd2FpdCBtYW5hZ2VyLmRlbGV0ZSh0ZW5hbnQsIHJlc291cmNlLCBpZCk7XG59XG5cbi8qKlxuICogSGVscGVyIGZ1bmN0aW9uIGZvciBjYWNoZSBpbnZhbGlkYXRpb25cbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGludmFsaWRhdGVDYWNoZShcbiAgdGVuYW50OiBzdHJpbmcsXG4gIHJlc291cmNlPzogc3RyaW5nXG4pOiBQcm9taXNlPG51bWJlcj4ge1xuICBjb25zdCBtYW5hZ2VyID0gZ2V0Q2FjaGVNYW5hZ2VyKCk7XG4gIHJldHVybiBhd2FpdCBtYW5hZ2VyLmludmFsaWRhdGUodGVuYW50LCByZXNvdXJjZSk7XG59XG5cbi8vIEV4cG9ydCBkZWZhdWx0IGluc3RhbmNlXG5leHBvcnQgZGVmYXVsdCBnZXRDYWNoZU1hbmFnZXIoKTtcbiJdLCJuYW1lcyI6WyJDYWNoZU1hbmFnZXIiLCJkZWxldGVDYWNoZWQiLCJnZXRDYWNoZU1hbmFnZXIiLCJnZXRDYWNoZWQiLCJpbnZhbGlkYXRlQ2FjaGUiLCJyZXNldENhY2hlTWFuYWdlciIsInNldENhY2hlZCIsImNvbmZpZyIsImwxRW5hYmxlZCIsImwyRW5hYmxlZCIsImwxVFRMIiwibDJUVEwiLCJlbmFibGVNb25pdG9yaW5nIiwid3JpdGVUaHJvdWdoIiwid2FybU9uTWlzcyIsImwxQ2FjaGUiLCJnZXRMMUNhY2hlIiwicGVyZm9ybWFuY2UiLCJsMUhpdFJhdGUiLCJsMkhpdFJhdGUiLCJhdmVyYWdlTGF0ZW5jeSIsInRvdGFsUmVxdWVzdHMiLCJsMUhpdHMiLCJsMkhpdHMiLCJsM0hpdHMiLCJnZXQiLCJ0ZW5hbnQiLCJyZXNvdXJjZSIsImlkIiwiZmV0Y2hGbiIsInN0YXJ0VGltZSIsIkRhdGUiLCJub3ciLCJjYWNoZUtleSIsImdlbmVyYXRlQ2FjaGVLZXkiLCJsMURhdGEiLCJyZWNvcmRIaXQiLCJ3cmFwRW50cnkiLCJsMkRhdGEiLCJnZXRSZWRpcyIsInNldCIsImwzRGF0YSIsImVycm9yIiwiY29uc29sZSIsImRhdGEiLCJzZXRSZWRpcyIsInR0bCIsImxvZyIsImRlbGV0ZSIsImRlbGV0ZVJlZGlzIiwiaW52YWxpZGF0ZSIsInBhdHRlcm4iLCJjb3VudCIsImtleXMiLCJrZXkiLCJtYXRjaGVzUGF0dGVybiIsInJlZGlzQ291bnQiLCJkZWxldGVQYXR0ZXJuIiwid2FybSIsIml0ZW1zIiwiaXRlbSIsImxlbmd0aCIsImdldFBlcmZvcm1hbmNlIiwidXBkYXRlSGl0UmF0ZXMiLCJyZXNldFBlcmZvcm1hbmNlIiwiaGVhbHRoQ2hlY2siLCJsMUF2YWlsYWJsZSIsImwyQXZhaWxhYmxlIiwiaXNSZWRpc0F2YWlsYWJsZSIsIm92ZXJhbGwiLCJnZXRDb25maWciLCJ1cGRhdGVDb25maWciLCJzb3VyY2UiLCJtZXRhZGF0YSIsImNhY2hlZEF0IiwibGF5ZXIiLCJsYXRlbmN5IiwidG90YWwiLCJjdXJyZW50QXZnIiwicmVnZXgiLCJSZWdFeHAiLCJyZXBsYWNlIiwidGVzdCIsImdsb2JhbENhY2hlTWFuYWdlciIsIm1hbmFnZXIiLCJyZXN1bHQiXSwibWFwcGluZ3MiOiJBQUFBOzs7Ozs7Ozs7Ozs7Ozs7Q0FlQzs7Ozs7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