{"version":3,"names":["addSessionTimeoutWarning","cov_medqfgh3d","f","s","checkSessionHealth","clearSessionCookie","getSessionContext","isSessionExpiringSoon","setSessionCookie","validateSession","validateSessionAndTenant","DEFAULT_CONFIG","cookieName","excludePaths","detectPrivilegeChanges","sessionManager","_manager","getSessionManager","request","config","b","fullConfig","pathname","nextUrl","isPathExcluded","sessionToken","extractSessionToken","createUnauthorizedResponse","userId","extractUserId","validation","valid","response","reason","cookies","delete","session","privilegeCheck","checkPrivilegeChange","requiresRegeneration","token","newToken","regenerateSession","_server","NextResponse","json","error","code","status","set","httpOnly","secure","process","env","NODE_ENV","sameSite","path","maxAge","refreshResult","refreshSession","success","requestHeaders","Headers","headers","organizationId","lastActivity","expiresAt","next","console","Sentry","Promise","resolve","then","_interop_require_wildcard","require","captureException","tags","middleware","sentryError","get","userRole","deviceFingerprint","generateDeviceFingerprint","warningMinutes","expirationTime","Date","getTime","currentTime","now","warningTime","value","supabase","_server1","createClient","data","user","auth","getUser","id","some","endsWith","prefix","slice","startsWith","userAgent","acceptLanguage","acceptEncoding","fingerprint","Buffer","from","toString","message","expiresIn","Math","max","floor","sessionValidation","validateTenantAccess","tenantValidation","manager","store","getStore","getHealthStatus","Error","healthy","latency"],"sources":["C:\\Ai Projecten\\ADSapp\\src\\lib\\middleware\\session.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport { getSessionManager, SessionManager } from '@/lib/session/manager';\nimport { createClient } from '@/lib/supabase/server';\n\n/**\n * Session Middleware for Enterprise Session Management\n *\n * Validates and manages sessions on every authenticated request:\n * - Validates session token from cookies\n * - Enforces 30-minute inactivity timeout\n * - Updates last activity timestamp\n * - Checks for privilege changes\n * - Handles expired sessions gracefully\n * - Integrates with tenant validation\n *\n * Security Features:\n * - Automatic session expiration\n * - Privilege change detection\n * - Session revocation on security events\n * - Device tracking\n * - Audit logging\n *\n * @module session-middleware\n */\n\n/**\n * Session context attached to request\n */\nexport interface SessionContext {\n  userId: string;\n  organizationId: string;\n  sessionToken: string;\n  userRole: string;\n  lastActivity: string;\n  expiresAt: string;\n  deviceFingerprint: string;\n}\n\n/**\n * Session middleware configuration\n */\nexport interface SessionMiddlewareConfig {\n  /**\n   * Cookie name for session token\n   */\n  cookieName?: string;\n\n  /**\n   * Paths to exclude from session validation\n   */\n  excludePaths?: string[];\n\n  /**\n   * Enable privilege change detection\n   */\n  detectPrivilegeChanges?: boolean;\n\n  /**\n   * Session manager instance (for testing)\n   */\n  sessionManager?: SessionManager;\n}\n\n/**\n * Default configuration\n */\nconst DEFAULT_CONFIG: Required<SessionMiddlewareConfig> = {\n  cookieName: 'adsapp_session',\n  excludePaths: [\n    '/api/auth/signin',\n    '/api/auth/signup',\n    '/api/auth/forgot-password',\n    '/api/auth/reset-password',\n    '/api/health',\n    '/api/webhooks'\n  ],\n  detectPrivilegeChanges: true,\n  sessionManager: getSessionManager()\n};\n\n/**\n * Validate and refresh session\n *\n * Main session middleware function that:\n * 1. Checks if path requires session validation\n * 2. Extracts session token from cookies\n * 3. Validates session\n * 4. Checks for privilege changes\n * 5. Refreshes session activity\n * 6. Attaches session context to request\n *\n * @param request - NextRequest object\n * @param config - Optional configuration\n * @returns NextResponse or null if validation succeeds\n *\n * @example\n * ```typescript\n * // In API route\n * export async function GET(request: NextRequest) {\n *   const sessionValidation = await validateSession(request);\n *   if (sessionValidation) return sessionValidation;\n *\n *   const context = getSessionContext(request);\n *   // Use context for business logic\n * }\n * ```\n */\nexport async function validateSession(\n  request: NextRequest,\n  config: SessionMiddlewareConfig = {}\n): Promise<NextResponse | null> {\n  const fullConfig = { ...DEFAULT_CONFIG, ...config };\n  const pathname = request.nextUrl.pathname;\n\n  // Check if path is excluded from session validation\n  if (isPathExcluded(pathname, fullConfig.excludePaths)) {\n    return null;\n  }\n\n  try {\n    // Extract session token from cookies\n    const sessionToken = extractSessionToken(request, fullConfig.cookieName);\n\n    if (!sessionToken) {\n      return createUnauthorizedResponse('No session token provided');\n    }\n\n    // Extract user ID from Supabase auth\n    const userId = await extractUserId(request);\n\n    if (!userId) {\n      return createUnauthorizedResponse('User not authenticated');\n    }\n\n    // Validate session\n    const sessionManager = fullConfig.sessionManager;\n    const validation = await sessionManager.validateSession(userId, sessionToken);\n\n    if (!validation.valid) {\n      // Session invalid - clear cookie and return error\n      const response = createUnauthorizedResponse(\n        validation.reason || 'Invalid session'\n      );\n      response.cookies.delete(fullConfig.cookieName);\n      return response;\n    }\n\n    const session = validation.session!;\n\n    // Check for privilege changes\n    if (fullConfig.detectPrivilegeChanges) {\n      const privilegeCheck = await sessionManager.checkPrivilegeChange(\n        userId,\n        sessionToken\n      );\n\n      if (privilegeCheck.requiresRegeneration) {\n        // Privilege changed - regenerate session\n        const { token: newToken } = await sessionManager.regenerateSession(\n          userId,\n          sessionToken\n        );\n\n        // Return response with new session token\n        const response = NextResponse.json(\n          {\n            error: 'Session regenerated due to privilege change',\n            code: 'SESSION_REGENERATED',\n            newToken\n          },\n          { status: 401 }\n        );\n\n        // Set new session cookie\n        response.cookies.set(fullConfig.cookieName, newToken, {\n          httpOnly: true,\n          secure: process.env.NODE_ENV === 'production',\n          sameSite: 'lax',\n          path: '/',\n          maxAge: 30 * 60 // 30 minutes\n        });\n\n        return response;\n      }\n    }\n\n    // Refresh session activity\n    const refreshResult = await sessionManager.refreshSession(\n      userId,\n      sessionToken\n    );\n\n    if (!refreshResult.success) {\n      return createUnauthorizedResponse(\n        refreshResult.error || 'Failed to refresh session'\n      );\n    }\n\n    // Attach session context to request headers\n    const requestHeaders = new Headers(request.headers);\n    requestHeaders.set('x-session-user-id', session.userId);\n    requestHeaders.set('x-session-org-id', session.organizationId);\n    requestHeaders.set('x-session-token', sessionToken);\n    requestHeaders.set('x-session-last-activity', session.lastActivity);\n    requestHeaders.set('x-session-expires-at', session.expiresAt);\n\n    // Continue request with session context\n    return NextResponse.next({\n      request: { headers: requestHeaders }\n    });\n  } catch (error) {\n    console.error('[SessionMiddleware] Validation error:', error);\n\n    // Log error to monitoring service\n    if (process.env.NODE_ENV === 'production') {\n      try {\n        const Sentry = await import('@sentry/nextjs');\n        Sentry.captureException(error, {\n          tags: {\n            middleware: 'session-validation'\n          }\n        });\n      } catch (sentryError) {\n        console.error('[SessionMiddleware] Failed to log error:', sentryError);\n      }\n    }\n\n    return NextResponse.json(\n      {\n        error: 'Internal server error during session validation',\n        code: 'INTERNAL_ERROR'\n      },\n      { status: 500 }\n    );\n  }\n}\n\n/**\n * Extract session context from request headers\n *\n * Use this after session middleware validation to get session info.\n *\n * @param request - NextRequest with session headers\n * @returns Session context\n *\n * @example\n * ```typescript\n * const context = getSessionContext(request);\n * console.log(`User ${context.userId} in org ${context.organizationId}`);\n * ```\n */\nexport function getSessionContext(request: NextRequest): SessionContext {\n  return {\n    userId: request.headers.get('x-session-user-id') || '',\n    organizationId: request.headers.get('x-session-org-id') || '',\n    sessionToken: request.headers.get('x-session-token') || '',\n    userRole: request.headers.get('x-user-role') || 'agent',\n    lastActivity: request.headers.get('x-session-last-activity') || '',\n    expiresAt: request.headers.get('x-session-expires-at') || '',\n    deviceFingerprint: generateDeviceFingerprint(request)\n  };\n}\n\n/**\n * Check if session is about to expire\n *\n * Useful for showing warnings to user before session expires.\n *\n * @param request - NextRequest with session headers\n * @param warningMinutes - Minutes before expiration to warn (default: 5)\n * @returns True if session expires soon\n *\n * @example\n * ```typescript\n * if (isSessionExpiringSoon(request, 5)) {\n *   // Show warning to user\n * }\n * ```\n */\nexport function isSessionExpiringSoon(\n  request: NextRequest,\n  warningMinutes: number = 5\n): boolean {\n  const expiresAt = request.headers.get('x-session-expires-at');\n\n  if (!expiresAt) {\n    return false;\n  }\n\n  const expirationTime = new Date(expiresAt).getTime();\n  const currentTime = Date.now();\n  const warningTime = warningMinutes * 60 * 1000;\n\n  return expirationTime - currentTime <= warningTime;\n}\n\n/**\n * Create session cookie\n *\n * Helper function to set session cookie with secure defaults.\n *\n * @param response - NextResponse object\n * @param sessionToken - Session token\n * @param cookieName - Cookie name (default: 'adsapp_session')\n * @param maxAge - Cookie max age in seconds (default: 30 minutes)\n *\n * @example\n * ```typescript\n * const response = NextResponse.json({ success: true });\n * setSessionCookie(response, 'token123');\n * ```\n */\nexport function setSessionCookie(\n  response: NextResponse,\n  sessionToken: string,\n  cookieName: string = 'adsapp_session',\n  maxAge: number = 30 * 60\n): void {\n  response.cookies.set(cookieName, sessionToken, {\n    httpOnly: true,\n    secure: process.env.NODE_ENV === 'production',\n    sameSite: 'lax',\n    path: '/',\n    maxAge\n  });\n}\n\n/**\n * Clear session cookie\n *\n * Helper function to remove session cookie.\n *\n * @param response - NextResponse object\n * @param cookieName - Cookie name (default: 'adsapp_session')\n *\n * @example\n * ```typescript\n * const response = NextResponse.json({ message: 'Logged out' });\n * clearSessionCookie(response);\n * ```\n */\nexport function clearSessionCookie(\n  response: NextResponse,\n  cookieName: string = 'adsapp_session'\n): void {\n  response.cookies.delete(cookieName);\n}\n\n/**\n * Extract session token from request cookies\n *\n * @param request - NextRequest object\n * @param cookieName - Cookie name\n * @returns Session token or null\n */\nfunction extractSessionToken(\n  request: NextRequest,\n  cookieName: string\n): string | null {\n  return request.cookies.get(cookieName)?.value || null;\n}\n\n/**\n * Extract user ID from Supabase auth\n *\n * @param request - NextRequest object\n * @returns User ID or null\n */\nasync function extractUserId(request: NextRequest): Promise<string | null> {\n  try {\n    const supabase = await createClient();\n    const { data: { user }, error } = await supabase.auth.getUser();\n\n    if (error || !user) {\n      return null;\n    }\n\n    return user.id;\n  } catch (error) {\n    console.error('[SessionMiddleware] Failed to extract user ID:', error);\n    return null;\n  }\n}\n\n/**\n * Check if path is excluded from session validation\n *\n * @param pathname - Request pathname\n * @param excludePaths - List of excluded paths\n * @returns True if path is excluded\n */\nfunction isPathExcluded(pathname: string, excludePaths: string[]): boolean {\n  return excludePaths.some(path => {\n    if (path.endsWith('*')) {\n      // Wildcard matching\n      const prefix = path.slice(0, -1);\n      return pathname.startsWith(prefix);\n    }\n    return pathname === path;\n  });\n}\n\n/**\n * Generate device fingerprint from request\n *\n * Creates unique identifier for device/browser combination.\n *\n * @param request - NextRequest object\n * @returns Device fingerprint\n */\nfunction generateDeviceFingerprint(request: NextRequest): string {\n  const userAgent = request.headers.get('user-agent') || 'unknown';\n  const acceptLanguage = request.headers.get('accept-language') || 'unknown';\n  const acceptEncoding = request.headers.get('accept-encoding') || 'unknown';\n\n  // Create hash-like fingerprint (in production, use actual hashing)\n  const fingerprint = Buffer.from(\n    `${userAgent}:${acceptLanguage}:${acceptEncoding}`\n  ).toString('base64');\n\n  return fingerprint.slice(0, 32);\n}\n\n/**\n * Create unauthorized response\n *\n * @param message - Error message\n * @returns NextResponse with 401 status\n */\nfunction createUnauthorizedResponse(message: string): NextResponse {\n  return NextResponse.json(\n    {\n      error: message,\n      code: 'UNAUTHORIZED'\n    },\n    { status: 401 }\n  );\n}\n\n/**\n * Session timeout warning middleware\n *\n * Adds session timeout information to response headers.\n *\n * @param request - NextRequest object\n * @param response - NextResponse object\n * @param warningMinutes - Minutes before expiration to warn\n *\n * @example\n * ```typescript\n * const response = NextResponse.json({ data: '...' });\n * addSessionTimeoutWarning(request, response, 5);\n * ```\n */\nexport function addSessionTimeoutWarning(\n  request: NextRequest,\n  response: NextResponse,\n  warningMinutes: number = 5\n): void {\n  if (isSessionExpiringSoon(request, warningMinutes)) {\n    const expiresAt = request.headers.get('x-session-expires-at') || '';\n    const expiresIn = Math.max(\n      0,\n      Math.floor((new Date(expiresAt).getTime() - Date.now()) / 1000)\n    );\n\n    response.headers.set('X-Session-Expires-Soon', 'true');\n    response.headers.set('X-Session-Expires-In', expiresIn.toString());\n  }\n}\n\n/**\n * Combine session validation with tenant validation\n *\n * Utility function to apply both middlewares in sequence.\n *\n * @param request - NextRequest object\n * @returns NextResponse or null if all validations pass\n *\n * @example\n * ```typescript\n * export async function GET(request: NextRequest) {\n *   const validation = await validateSessionAndTenant(request);\n *   if (validation) return validation;\n *\n *   // Both session and tenant validated\n * }\n * ```\n */\nexport async function validateSessionAndTenant(\n  request: NextRequest\n): Promise<NextResponse | null> {\n  // First validate session\n  const sessionValidation = await validateSession(request);\n  if (sessionValidation) return sessionValidation;\n\n  // Then validate tenant (if implemented)\n  const { validateTenantAccess } = await import('./tenant-validation');\n  const tenantValidation = await validateTenantAccess(request);\n  if (tenantValidation) return tenantValidation;\n\n  return null;\n}\n\n/**\n * Session health check\n *\n * Verifies session system is operational.\n *\n * @returns Health status\n *\n * @example\n * ```typescript\n * const health = await checkSessionHealth();\n * if (!health.healthy) {\n *   console.error('Session system unhealthy:', health.error);\n * }\n * ```\n */\nexport async function checkSessionHealth(): Promise<{\n  healthy: boolean;\n  latency: number;\n  error?: string;\n}> {\n  try {\n    const manager = getSessionManager();\n    const store = manager.getStore();\n    return await store.getHealthStatus();\n  } catch (error) {\n    const message = error instanceof Error ? error.message : 'Unknown error';\n    return {\n      healthy: false,\n      latency: -1,\n      error: message\n    };\n  }\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}