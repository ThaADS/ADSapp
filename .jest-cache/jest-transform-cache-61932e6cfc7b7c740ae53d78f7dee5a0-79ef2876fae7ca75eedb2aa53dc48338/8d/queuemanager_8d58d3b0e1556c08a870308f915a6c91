1841bd0d646d9469a97feaa1ec837c8d
"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
function _export(target, all) {
    for(var name in all)Object.defineProperty(target, name, {
        enumerable: true,
        get: Object.getOwnPropertyDescriptor(all, name).get
    });
}
_export(exports, {
    get QueueManager () {
        return QueueManager;
    },
    get getQueueManager () {
        return getQueueManager;
    },
    get initializeQueueManager () {
        return initializeQueueManager;
    }
});
const _bullconfig = require("./bull-config");
const _bulkmessageprocessor = require("./processors/bulk-message-processor");
const _contactimportprocessor = require("./processors/contact-import-processor");
const _templateprocessor = require("./processors/template-processor");
const _emailnotificationprocessor = require("./processors/email-notification-processor");
class QueueManager {
    constructor(){
        this.isShuttingDown = false;
        this.queues = new Map();
        this.workers = new Map();
        this.queueEvents = new Map();
    }
    /**
   * Initialize all queues and workers
   */ async initialize() {
        console.log('[QueueManager] Initializing queues and workers...');
        try {
            // Initialize bulk message queue
            await this.initializeQueue(_bullconfig.QueueName.BULK_MESSAGE, _bulkmessageprocessor.processBulkMessage);
            // Initialize contact import queue
            await this.initializeQueue(_bullconfig.QueueName.CONTACT_IMPORT, _contactimportprocessor.processContactImport);
            // Initialize template processing queue
            await this.initializeQueue(_bullconfig.QueueName.TEMPLATE_PROCESSING, _templateprocessor.processTemplate);
            // Initialize email notification queue
            await this.initializeQueue(_bullconfig.QueueName.EMAIL_NOTIFICATION, _emailnotificationprocessor.processEmailNotification);
            console.log('[QueueManager] All queues and workers initialized');
        } catch (error) {
            console.error('[QueueManager] Initialization error:', error);
            throw error;
        }
    }
    /**
   * Initialize a single queue with its worker
   */ async initializeQueue(queueName, processor) {
        try {
            // Create queue
            const queue = (0, _bullconfig.createQueue)(queueName);
            this.queues.set(queueName, queue);
            // Create worker
            const worker = (0, _bullconfig.createWorker)(queueName, processor);
            this.workers.set(queueName, worker);
            // Create queue events
            const queueEvents = (0, _bullconfig.createQueueEvents)(queueName);
            this.queueEvents.set(queueName, queueEvents);
            console.log(`[QueueManager] Initialized ${queueName}`);
        } catch (error) {
            console.error(`[QueueManager] Error initializing ${queueName}:`, error);
            throw error;
        }
    }
    /**
   * Get queue by name
   */ getQueue(queueName) {
        return this.queues.get(queueName);
    }
    /**
   * Add a job to a queue
   */ async addJob(queueName, jobName, data, options) {
        const queue = this.queues.get(queueName);
        if (!queue) {
            throw new Error(`Queue ${queueName} not initialized`);
        }
        const job = await queue.add(jobName, data, {
            priority: options?.priority || _bullconfig.JobPriority.NORMAL,
            delay: options?.delay,
            attempts: options?.attempts,
            backoff: options?.backoff,
            removeOnComplete: options?.removeOnComplete,
            removeOnFail: options?.removeOnFail
        });
        console.log(`[QueueManager] Job ${job.id} added to ${queueName}`);
        return job.id?.toString() || '';
    }
    /**
   * Get job by ID
   */ async getJob(queueName, jobId) {
        const queue = this.queues.get(queueName);
        if (!queue) {
            throw new Error(`Queue ${queueName} not initialized`);
        }
        const job = await queue.getJob(jobId);
        if (!job) {
            return null;
        }
        const state = await job.getState();
        return {
            id: job.id?.toString() || '',
            name: job.name,
            queueName: queue.name,
            data: job.data,
            progress: job.progress,
            attemptsMade: job.attemptsMade,
            attemptsTotal: job.opts.attempts || 0,
            delay: job.opts.delay || 0,
            timestamp: job.timestamp,
            processedOn: job.processedOn,
            finishedOn: job.finishedOn,
            failedReason: job.failedReason,
            stacktrace: job.stacktrace,
            returnValue: job.returnvalue,
            state: state
        };
    }
    /**
   * Cancel a job
   */ async cancelJob(queueName, jobId) {
        const queue = this.queues.get(queueName);
        if (!queue) {
            throw new Error(`Queue ${queueName} not initialized`);
        }
        const job = await queue.getJob(jobId);
        if (!job) {
            return false;
        }
        await job.remove();
        console.log(`[QueueManager] Job ${jobId} cancelled from ${queueName}`);
        return true;
    }
    /**
   * Retry a failed job
   */ async retryJob(queueName, jobId) {
        const queue = this.queues.get(queueName);
        if (!queue) {
            throw new Error(`Queue ${queueName} not initialized`);
        }
        const job = await queue.getJob(jobId);
        if (!job) {
            return false;
        }
        await job.retry();
        console.log(`[QueueManager] Job ${jobId} retried in ${queueName}`);
        return true;
    }
    /**
   * Get queue statistics
   */ async getQueueStatistics(queueName) {
        const queue = this.queues.get(queueName);
        if (!queue) {
            throw new Error(`Queue ${queueName} not initialized`);
        }
        return await (0, _bullconfig.getQueueStats)(queue);
    }
    /**
   * Get all queue statistics
   */ async getAllQueueStatistics() {
        const stats = {};
        for (const [queueName, queue] of this.queues){
            stats[queueName] = await (0, _bullconfig.getQueueStats)(queue);
        }
        return stats;
    }
    /**
   * Pause a queue
   */ async pauseQueue(queueName) {
        const queue = this.queues.get(queueName);
        if (!queue) {
            throw new Error(`Queue ${queueName} not initialized`);
        }
        await queue.pause();
        console.log(`[QueueManager] Queue ${queueName} paused`);
    }
    /**
   * Resume a queue
   */ async resumeQueue(queueName) {
        const queue = this.queues.get(queueName);
        if (!queue) {
            throw new Error(`Queue ${queueName} not initialized`);
        }
        await queue.resume();
        console.log(`[QueueManager] Queue ${queueName} resumed`);
    }
    /**
   * Get failed jobs
   */ async getFailedJobs(queueName, start = 0, end = 10) {
        const queue = this.queues.get(queueName);
        if (!queue) {
            throw new Error(`Queue ${queueName} not initialized`);
        }
        const failedJobs = await queue.getFailed(start, end);
        return Promise.all(failedJobs.map(async (job)=>{
            const state = await job.getState();
            return {
                id: job.id?.toString() || '',
                name: job.name,
                queueName: queue.name,
                data: job.data,
                progress: job.progress,
                attemptsMade: job.attemptsMade,
                attemptsTotal: job.opts.attempts || 0,
                delay: job.opts.delay || 0,
                timestamp: job.timestamp,
                processedOn: job.processedOn,
                finishedOn: job.finishedOn,
                failedReason: job.failedReason,
                stacktrace: job.stacktrace,
                returnValue: job.returnvalue,
                state: state
            };
        }));
    }
    /**
   * Clean completed jobs
   */ async cleanCompletedJobs(queueName, grace = 3600000) {
        const queue = this.queues.get(queueName);
        if (!queue) {
            throw new Error(`Queue ${queueName} not initialized`);
        }
        const cleaned = await queue.clean(grace, 1000, 'completed');
        console.log(`[QueueManager] Cleaned ${cleaned.length} completed jobs from ${queueName}`);
        return cleaned;
    }
    /**
   * Clean failed jobs
   */ async cleanFailedJobs(queueName, grace = 86400000) {
        const queue = this.queues.get(queueName);
        if (!queue) {
            throw new Error(`Queue ${queueName} not initialized`);
        }
        const cleaned = await queue.clean(grace, 1000, 'failed');
        console.log(`[QueueManager] Cleaned ${cleaned.length} failed jobs from ${queueName}`);
        return cleaned;
    }
    /**
   * Graceful shutdown of all queues and workers
   */ async shutdown() {
        if (this.isShuttingDown) {
            console.log('[QueueManager] Shutdown already in progress');
            return;
        }
        this.isShuttingDown = true;
        console.log('[QueueManager] Starting graceful shutdown...');
        const shutdownPromises = [];
        for (const [queueName, queue] of this.queues){
            const worker = this.workers.get(queueName);
            const queueEvents = this.queueEvents.get(queueName);
            if (worker && queueEvents) {
                shutdownPromises.push((0, _bullconfig.gracefulShutdown)(queue, worker, queueEvents));
            }
        }
        await Promise.all(shutdownPromises);
        this.queues.clear();
        this.workers.clear();
        this.queueEvents.clear();
        console.log('[QueueManager] Graceful shutdown complete');
    }
    /**
   * Health check for all queues
   */ async healthCheck() {
        const queueHealth = {};
        let allHealthy = true;
        for (const [queueName, queue] of this.queues){
            try {
                const stats = await (0, _bullconfig.getQueueStats)(queue);
                queueHealth[queueName] = {
                    healthy: true,
                    stats
                };
            } catch (error) {
                allHealthy = false;
                queueHealth[queueName] = {
                    healthy: false,
                    error: error instanceof Error ? error.message : 'Unknown error'
                };
            }
        }
        return {
            healthy: allHealthy,
            queues: queueHealth
        };
    }
}
/**
 * Singleton instance
 */ let queueManagerInstance = null;
function getQueueManager() {
    if (!queueManagerInstance) {
        queueManagerInstance = new QueueManager();
    }
    return queueManagerInstance;
}
async function initializeQueueManager() {
    const manager = getQueueManager();
    await manager.initialize();
    return manager;
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkM6XFxBaSBQcm9qZWN0ZW5cXEFEU2FwcFxcc3JjXFxsaWJcXHF1ZXVlXFxxdWV1ZS1tYW5hZ2VyLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFF1ZXVlLCBXb3JrZXIsIFF1ZXVlRXZlbnRzLCBKb2IgfSBmcm9tICdidWxsbXEnO1xuaW1wb3J0IHtcbiAgY3JlYXRlUXVldWUsXG4gIGNyZWF0ZVdvcmtlcixcbiAgY3JlYXRlUXVldWVFdmVudHMsXG4gIFF1ZXVlTmFtZSxcbiAgSm9iUHJpb3JpdHksXG4gIGdldFF1ZXVlU3RhdHMsXG4gIGdyYWNlZnVsU2h1dGRvd25cbn0gZnJvbSAnLi9idWxsLWNvbmZpZyc7XG5pbXBvcnQgeyBwcm9jZXNzQnVsa01lc3NhZ2UgfSBmcm9tICcuL3Byb2Nlc3NvcnMvYnVsay1tZXNzYWdlLXByb2Nlc3Nvcic7XG5pbXBvcnQgeyBwcm9jZXNzQ29udGFjdEltcG9ydCB9IGZyb20gJy4vcHJvY2Vzc29ycy9jb250YWN0LWltcG9ydC1wcm9jZXNzb3InO1xuaW1wb3J0IHsgcHJvY2Vzc1RlbXBsYXRlIH0gZnJvbSAnLi9wcm9jZXNzb3JzL3RlbXBsYXRlLXByb2Nlc3Nvcic7XG5pbXBvcnQgeyBwcm9jZXNzRW1haWxOb3RpZmljYXRpb24gfSBmcm9tICcuL3Byb2Nlc3NvcnMvZW1haWwtbm90aWZpY2F0aW9uLXByb2Nlc3Nvcic7XG5cbi8qKlxuICogUXVldWUgTWFuYWdlclxuICpcbiAqIENlbnRyYWxpemVkIG1hbmFnZW1lbnQgZm9yIGFsbCBCdWxsTVEgcXVldWVzIGFuZCB3b3JrZXJzLlxuICogSGFuZGxlcyBqb2IgY3JlYXRpb24sIGNhbmNlbGxhdGlvbiwgbW9uaXRvcmluZywgYW5kIGxpZmVjeWNsZSBtYW5hZ2VtZW50LlxuICpcbiAqIEZlYXR1cmVzOlxuICogLSBDZW50cmFsaXplZCBxdWV1ZSBtYW5hZ2VtZW50XG4gKiAtIFdvcmtlciBsaWZlY3ljbGUgbWFuYWdlbWVudFxuICogLSBKb2IgY3JlYXRpb24gd2l0aCBwcmlvcml0eVxuICogLSBKb2IgY2FuY2VsbGF0aW9uIGFuZCByZXRyeVxuICogLSBRdWV1ZSBtb25pdG9yaW5nIGFuZCBzdGF0aXN0aWNzXG4gKiAtIEdyYWNlZnVsIHNodXRkb3duIGhhbmRsaW5nXG4gKlxuICogQG1vZHVsZSBxdWV1ZS1tYW5hZ2VyXG4gKi9cblxuLyoqXG4gKiBKb2IgY3JlYXRpb24gb3B0aW9uc1xuICovXG5leHBvcnQgaW50ZXJmYWNlIENyZWF0ZUpvYk9wdGlvbnMge1xuICBwcmlvcml0eT86IEpvYlByaW9yaXR5O1xuICBkZWxheT86IG51bWJlcjsgLy8gRGVsYXkgaW4gbWlsbGlzZWNvbmRzXG4gIGF0dGVtcHRzPzogbnVtYmVyO1xuICBiYWNrb2ZmPzoge1xuICAgIHR5cGU6ICdleHBvbmVudGlhbCcgfCAnZml4ZWQnO1xuICAgIGRlbGF5OiBudW1iZXI7XG4gIH07XG4gIHJlbW92ZU9uQ29tcGxldGU/OiBib29sZWFuIHwgbnVtYmVyO1xuICByZW1vdmVPbkZhaWw/OiBib29sZWFuIHwgbnVtYmVyO1xufVxuXG4vKipcbiAqIEpvYiBpbmZvcm1hdGlvblxuICovXG5leHBvcnQgaW50ZXJmYWNlIEpvYkluZm8ge1xuICBpZDogc3RyaW5nO1xuICBuYW1lOiBzdHJpbmc7XG4gIHF1ZXVlTmFtZTogc3RyaW5nO1xuICBkYXRhOiBhbnk7XG4gIHByb2dyZXNzOiBudW1iZXIgfCBvYmplY3Q7XG4gIGF0dGVtcHRzTWFkZTogbnVtYmVyO1xuICBhdHRlbXB0c1RvdGFsOiBudW1iZXI7XG4gIGRlbGF5OiBudW1iZXI7XG4gIHRpbWVzdGFtcDogbnVtYmVyO1xuICBwcm9jZXNzZWRPbj86IG51bWJlcjtcbiAgZmluaXNoZWRPbj86IG51bWJlcjtcbiAgZmFpbGVkUmVhc29uPzogc3RyaW5nO1xuICBzdGFja3RyYWNlPzogc3RyaW5nW107XG4gIHJldHVyblZhbHVlPzogYW55O1xuICBzdGF0ZTogJ3dhaXRpbmcnIHwgJ2FjdGl2ZScgfCAnY29tcGxldGVkJyB8ICdmYWlsZWQnIHwgJ2RlbGF5ZWQnIHwgJ3BhdXNlZCc7XG59XG5cbi8qKlxuICogUXVldWUgTWFuYWdlciBDbGFzc1xuICovXG5leHBvcnQgY2xhc3MgUXVldWVNYW5hZ2VyIHtcbiAgcHJpdmF0ZSBxdWV1ZXM6IE1hcDxRdWV1ZU5hbWUsIFF1ZXVlPjtcbiAgcHJpdmF0ZSB3b3JrZXJzOiBNYXA8UXVldWVOYW1lLCBXb3JrZXI+O1xuICBwcml2YXRlIHF1ZXVlRXZlbnRzOiBNYXA8UXVldWVOYW1lLCBRdWV1ZUV2ZW50cz47XG4gIHByaXZhdGUgaXNTaHV0dGluZ0Rvd246IGJvb2xlYW4gPSBmYWxzZTtcblxuICBjb25zdHJ1Y3RvcigpIHtcbiAgICB0aGlzLnF1ZXVlcyA9IG5ldyBNYXAoKTtcbiAgICB0aGlzLndvcmtlcnMgPSBuZXcgTWFwKCk7XG4gICAgdGhpcy5xdWV1ZUV2ZW50cyA9IG5ldyBNYXAoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBJbml0aWFsaXplIGFsbCBxdWV1ZXMgYW5kIHdvcmtlcnNcbiAgICovXG4gIGFzeW5jIGluaXRpYWxpemUoKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgY29uc29sZS5sb2coJ1tRdWV1ZU1hbmFnZXJdIEluaXRpYWxpemluZyBxdWV1ZXMgYW5kIHdvcmtlcnMuLi4nKTtcblxuICAgIHRyeSB7XG4gICAgICAvLyBJbml0aWFsaXplIGJ1bGsgbWVzc2FnZSBxdWV1ZVxuICAgICAgYXdhaXQgdGhpcy5pbml0aWFsaXplUXVldWUoUXVldWVOYW1lLkJVTEtfTUVTU0FHRSwgcHJvY2Vzc0J1bGtNZXNzYWdlKTtcblxuICAgICAgLy8gSW5pdGlhbGl6ZSBjb250YWN0IGltcG9ydCBxdWV1ZVxuICAgICAgYXdhaXQgdGhpcy5pbml0aWFsaXplUXVldWUoXG4gICAgICAgIFF1ZXVlTmFtZS5DT05UQUNUX0lNUE9SVCxcbiAgICAgICAgcHJvY2Vzc0NvbnRhY3RJbXBvcnRcbiAgICAgICk7XG5cbiAgICAgIC8vIEluaXRpYWxpemUgdGVtcGxhdGUgcHJvY2Vzc2luZyBxdWV1ZVxuICAgICAgYXdhaXQgdGhpcy5pbml0aWFsaXplUXVldWUoXG4gICAgICAgIFF1ZXVlTmFtZS5URU1QTEFURV9QUk9DRVNTSU5HLFxuICAgICAgICBwcm9jZXNzVGVtcGxhdGVcbiAgICAgICk7XG5cbiAgICAgIC8vIEluaXRpYWxpemUgZW1haWwgbm90aWZpY2F0aW9uIHF1ZXVlXG4gICAgICBhd2FpdCB0aGlzLmluaXRpYWxpemVRdWV1ZShcbiAgICAgICAgUXVldWVOYW1lLkVNQUlMX05PVElGSUNBVElPTixcbiAgICAgICAgcHJvY2Vzc0VtYWlsTm90aWZpY2F0aW9uXG4gICAgICApO1xuXG4gICAgICBjb25zb2xlLmxvZygnW1F1ZXVlTWFuYWdlcl0gQWxsIHF1ZXVlcyBhbmQgd29ya2VycyBpbml0aWFsaXplZCcpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdbUXVldWVNYW5hZ2VyXSBJbml0aWFsaXphdGlvbiBlcnJvcjonLCBlcnJvcik7XG4gICAgICB0aHJvdyBlcnJvcjtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogSW5pdGlhbGl6ZSBhIHNpbmdsZSBxdWV1ZSB3aXRoIGl0cyB3b3JrZXJcbiAgICovXG4gIHByaXZhdGUgYXN5bmMgaW5pdGlhbGl6ZVF1ZXVlKFxuICAgIHF1ZXVlTmFtZTogUXVldWVOYW1lLFxuICAgIHByb2Nlc3NvcjogKGpvYjogSm9iKSA9PiBQcm9taXNlPGFueT5cbiAgKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgdHJ5IHtcbiAgICAgIC8vIENyZWF0ZSBxdWV1ZVxuICAgICAgY29uc3QgcXVldWUgPSBjcmVhdGVRdWV1ZShxdWV1ZU5hbWUpO1xuICAgICAgdGhpcy5xdWV1ZXMuc2V0KHF1ZXVlTmFtZSwgcXVldWUpO1xuXG4gICAgICAvLyBDcmVhdGUgd29ya2VyXG4gICAgICBjb25zdCB3b3JrZXIgPSBjcmVhdGVXb3JrZXIocXVldWVOYW1lLCBwcm9jZXNzb3IpO1xuICAgICAgdGhpcy53b3JrZXJzLnNldChxdWV1ZU5hbWUsIHdvcmtlcik7XG5cbiAgICAgIC8vIENyZWF0ZSBxdWV1ZSBldmVudHNcbiAgICAgIGNvbnN0IHF1ZXVlRXZlbnRzID0gY3JlYXRlUXVldWVFdmVudHMocXVldWVOYW1lKTtcbiAgICAgIHRoaXMucXVldWVFdmVudHMuc2V0KHF1ZXVlTmFtZSwgcXVldWVFdmVudHMpO1xuXG4gICAgICBjb25zb2xlLmxvZyhgW1F1ZXVlTWFuYWdlcl0gSW5pdGlhbGl6ZWQgJHtxdWV1ZU5hbWV9YCk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoYFtRdWV1ZU1hbmFnZXJdIEVycm9yIGluaXRpYWxpemluZyAke3F1ZXVlTmFtZX06YCwgZXJyb3IpO1xuICAgICAgdGhyb3cgZXJyb3I7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEdldCBxdWV1ZSBieSBuYW1lXG4gICAqL1xuICBnZXRRdWV1ZShxdWV1ZU5hbWU6IFF1ZXVlTmFtZSk6IFF1ZXVlIHwgdW5kZWZpbmVkIHtcbiAgICByZXR1cm4gdGhpcy5xdWV1ZXMuZ2V0KHF1ZXVlTmFtZSk7XG4gIH1cblxuICAvKipcbiAgICogQWRkIGEgam9iIHRvIGEgcXVldWVcbiAgICovXG4gIGFzeW5jIGFkZEpvYihcbiAgICBxdWV1ZU5hbWU6IFF1ZXVlTmFtZSxcbiAgICBqb2JOYW1lOiBzdHJpbmcsXG4gICAgZGF0YTogYW55LFxuICAgIG9wdGlvbnM/OiBDcmVhdGVKb2JPcHRpb25zXG4gICk6IFByb21pc2U8c3RyaW5nPiB7XG4gICAgY29uc3QgcXVldWUgPSB0aGlzLnF1ZXVlcy5nZXQocXVldWVOYW1lKTtcblxuICAgIGlmICghcXVldWUpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgUXVldWUgJHtxdWV1ZU5hbWV9IG5vdCBpbml0aWFsaXplZGApO1xuICAgIH1cblxuICAgIGNvbnN0IGpvYiA9IGF3YWl0IHF1ZXVlLmFkZChqb2JOYW1lLCBkYXRhLCB7XG4gICAgICBwcmlvcml0eTogb3B0aW9ucz8ucHJpb3JpdHkgfHwgSm9iUHJpb3JpdHkuTk9STUFMLFxuICAgICAgZGVsYXk6IG9wdGlvbnM/LmRlbGF5LFxuICAgICAgYXR0ZW1wdHM6IG9wdGlvbnM/LmF0dGVtcHRzLFxuICAgICAgYmFja29mZjogb3B0aW9ucz8uYmFja29mZixcbiAgICAgIHJlbW92ZU9uQ29tcGxldGU6IG9wdGlvbnM/LnJlbW92ZU9uQ29tcGxldGUsXG4gICAgICByZW1vdmVPbkZhaWw6IG9wdGlvbnM/LnJlbW92ZU9uRmFpbFxuICAgIH0pO1xuXG4gICAgY29uc29sZS5sb2coYFtRdWV1ZU1hbmFnZXJdIEpvYiAke2pvYi5pZH0gYWRkZWQgdG8gJHtxdWV1ZU5hbWV9YCk7XG5cbiAgICByZXR1cm4gam9iLmlkPy50b1N0cmluZygpIHx8ICcnO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBqb2IgYnkgSURcbiAgICovXG4gIGFzeW5jIGdldEpvYihxdWV1ZU5hbWU6IFF1ZXVlTmFtZSwgam9iSWQ6IHN0cmluZyk6IFByb21pc2U8Sm9iSW5mbyB8IG51bGw+IHtcbiAgICBjb25zdCBxdWV1ZSA9IHRoaXMucXVldWVzLmdldChxdWV1ZU5hbWUpO1xuXG4gICAgaWYgKCFxdWV1ZSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBRdWV1ZSAke3F1ZXVlTmFtZX0gbm90IGluaXRpYWxpemVkYCk7XG4gICAgfVxuXG4gICAgY29uc3Qgam9iID0gYXdhaXQgcXVldWUuZ2V0Sm9iKGpvYklkKTtcblxuICAgIGlmICgham9iKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICBjb25zdCBzdGF0ZSA9IGF3YWl0IGpvYi5nZXRTdGF0ZSgpO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIGlkOiBqb2IuaWQ/LnRvU3RyaW5nKCkgfHwgJycsXG4gICAgICBuYW1lOiBqb2IubmFtZSxcbiAgICAgIHF1ZXVlTmFtZTogcXVldWUubmFtZSxcbiAgICAgIGRhdGE6IGpvYi5kYXRhLFxuICAgICAgcHJvZ3Jlc3M6IGpvYi5wcm9ncmVzcyxcbiAgICAgIGF0dGVtcHRzTWFkZTogam9iLmF0dGVtcHRzTWFkZSxcbiAgICAgIGF0dGVtcHRzVG90YWw6IGpvYi5vcHRzLmF0dGVtcHRzIHx8IDAsXG4gICAgICBkZWxheTogam9iLm9wdHMuZGVsYXkgfHwgMCxcbiAgICAgIHRpbWVzdGFtcDogam9iLnRpbWVzdGFtcCxcbiAgICAgIHByb2Nlc3NlZE9uOiBqb2IucHJvY2Vzc2VkT24sXG4gICAgICBmaW5pc2hlZE9uOiBqb2IuZmluaXNoZWRPbixcbiAgICAgIGZhaWxlZFJlYXNvbjogam9iLmZhaWxlZFJlYXNvbixcbiAgICAgIHN0YWNrdHJhY2U6IGpvYi5zdGFja3RyYWNlLFxuICAgICAgcmV0dXJuVmFsdWU6IGpvYi5yZXR1cm52YWx1ZSxcbiAgICAgIHN0YXRlOiBzdGF0ZSBhcyBhbnlcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIENhbmNlbCBhIGpvYlxuICAgKi9cbiAgYXN5bmMgY2FuY2VsSm9iKHF1ZXVlTmFtZTogUXVldWVOYW1lLCBqb2JJZDogc3RyaW5nKTogUHJvbWlzZTxib29sZWFuPiB7XG4gICAgY29uc3QgcXVldWUgPSB0aGlzLnF1ZXVlcy5nZXQocXVldWVOYW1lKTtcblxuICAgIGlmICghcXVldWUpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgUXVldWUgJHtxdWV1ZU5hbWV9IG5vdCBpbml0aWFsaXplZGApO1xuICAgIH1cblxuICAgIGNvbnN0IGpvYiA9IGF3YWl0IHF1ZXVlLmdldEpvYihqb2JJZCk7XG5cbiAgICBpZiAoIWpvYikge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIGF3YWl0IGpvYi5yZW1vdmUoKTtcblxuICAgIGNvbnNvbGUubG9nKGBbUXVldWVNYW5hZ2VyXSBKb2IgJHtqb2JJZH0gY2FuY2VsbGVkIGZyb20gJHtxdWV1ZU5hbWV9YCk7XG5cbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXRyeSBhIGZhaWxlZCBqb2JcbiAgICovXG4gIGFzeW5jIHJldHJ5Sm9iKHF1ZXVlTmFtZTogUXVldWVOYW1lLCBqb2JJZDogc3RyaW5nKTogUHJvbWlzZTxib29sZWFuPiB7XG4gICAgY29uc3QgcXVldWUgPSB0aGlzLnF1ZXVlcy5nZXQocXVldWVOYW1lKTtcblxuICAgIGlmICghcXVldWUpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgUXVldWUgJHtxdWV1ZU5hbWV9IG5vdCBpbml0aWFsaXplZGApO1xuICAgIH1cblxuICAgIGNvbnN0IGpvYiA9IGF3YWl0IHF1ZXVlLmdldEpvYihqb2JJZCk7XG5cbiAgICBpZiAoIWpvYikge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIGF3YWl0IGpvYi5yZXRyeSgpO1xuXG4gICAgY29uc29sZS5sb2coYFtRdWV1ZU1hbmFnZXJdIEpvYiAke2pvYklkfSByZXRyaWVkIGluICR7cXVldWVOYW1lfWApO1xuXG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICAvKipcbiAgICogR2V0IHF1ZXVlIHN0YXRpc3RpY3NcbiAgICovXG4gIGFzeW5jIGdldFF1ZXVlU3RhdGlzdGljcyhxdWV1ZU5hbWU6IFF1ZXVlTmFtZSkge1xuICAgIGNvbnN0IHF1ZXVlID0gdGhpcy5xdWV1ZXMuZ2V0KHF1ZXVlTmFtZSk7XG5cbiAgICBpZiAoIXF1ZXVlKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYFF1ZXVlICR7cXVldWVOYW1lfSBub3QgaW5pdGlhbGl6ZWRgKTtcbiAgICB9XG5cbiAgICByZXR1cm4gYXdhaXQgZ2V0UXVldWVTdGF0cyhxdWV1ZSk7XG4gIH1cblxuICAvKipcbiAgICogR2V0IGFsbCBxdWV1ZSBzdGF0aXN0aWNzXG4gICAqL1xuICBhc3luYyBnZXRBbGxRdWV1ZVN0YXRpc3RpY3MoKSB7XG4gICAgY29uc3Qgc3RhdHM6IFJlY29yZDxzdHJpbmcsIGFueT4gPSB7fTtcblxuICAgIGZvciAoY29uc3QgW3F1ZXVlTmFtZSwgcXVldWVdIG9mIHRoaXMucXVldWVzKSB7XG4gICAgICBzdGF0c1txdWV1ZU5hbWVdID0gYXdhaXQgZ2V0UXVldWVTdGF0cyhxdWV1ZSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHN0YXRzO1xuICB9XG5cbiAgLyoqXG4gICAqIFBhdXNlIGEgcXVldWVcbiAgICovXG4gIGFzeW5jIHBhdXNlUXVldWUocXVldWVOYW1lOiBRdWV1ZU5hbWUpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBjb25zdCBxdWV1ZSA9IHRoaXMucXVldWVzLmdldChxdWV1ZU5hbWUpO1xuXG4gICAgaWYgKCFxdWV1ZSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBRdWV1ZSAke3F1ZXVlTmFtZX0gbm90IGluaXRpYWxpemVkYCk7XG4gICAgfVxuXG4gICAgYXdhaXQgcXVldWUucGF1c2UoKTtcblxuICAgIGNvbnNvbGUubG9nKGBbUXVldWVNYW5hZ2VyXSBRdWV1ZSAke3F1ZXVlTmFtZX0gcGF1c2VkYCk7XG4gIH1cblxuICAvKipcbiAgICogUmVzdW1lIGEgcXVldWVcbiAgICovXG4gIGFzeW5jIHJlc3VtZVF1ZXVlKHF1ZXVlTmFtZTogUXVldWVOYW1lKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgY29uc3QgcXVldWUgPSB0aGlzLnF1ZXVlcy5nZXQocXVldWVOYW1lKTtcblxuICAgIGlmICghcXVldWUpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgUXVldWUgJHtxdWV1ZU5hbWV9IG5vdCBpbml0aWFsaXplZGApO1xuICAgIH1cblxuICAgIGF3YWl0IHF1ZXVlLnJlc3VtZSgpO1xuXG4gICAgY29uc29sZS5sb2coYFtRdWV1ZU1hbmFnZXJdIFF1ZXVlICR7cXVldWVOYW1lfSByZXN1bWVkYCk7XG4gIH1cblxuICAvKipcbiAgICogR2V0IGZhaWxlZCBqb2JzXG4gICAqL1xuICBhc3luYyBnZXRGYWlsZWRKb2JzKFxuICAgIHF1ZXVlTmFtZTogUXVldWVOYW1lLFxuICAgIHN0YXJ0OiBudW1iZXIgPSAwLFxuICAgIGVuZDogbnVtYmVyID0gMTBcbiAgKTogUHJvbWlzZTxKb2JJbmZvW10+IHtcbiAgICBjb25zdCBxdWV1ZSA9IHRoaXMucXVldWVzLmdldChxdWV1ZU5hbWUpO1xuXG4gICAgaWYgKCFxdWV1ZSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBRdWV1ZSAke3F1ZXVlTmFtZX0gbm90IGluaXRpYWxpemVkYCk7XG4gICAgfVxuXG4gICAgY29uc3QgZmFpbGVkSm9icyA9IGF3YWl0IHF1ZXVlLmdldEZhaWxlZChzdGFydCwgZW5kKTtcblxuICAgIHJldHVybiBQcm9taXNlLmFsbChcbiAgICAgIGZhaWxlZEpvYnMubWFwKGFzeW5jIChqb2IpID0+IHtcbiAgICAgICAgY29uc3Qgc3RhdGUgPSBhd2FpdCBqb2IuZ2V0U3RhdGUoKTtcblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIGlkOiBqb2IuaWQ/LnRvU3RyaW5nKCkgfHwgJycsXG4gICAgICAgICAgbmFtZTogam9iLm5hbWUsXG4gICAgICAgICAgcXVldWVOYW1lOiBxdWV1ZS5uYW1lLFxuICAgICAgICAgIGRhdGE6IGpvYi5kYXRhLFxuICAgICAgICAgIHByb2dyZXNzOiBqb2IucHJvZ3Jlc3MsXG4gICAgICAgICAgYXR0ZW1wdHNNYWRlOiBqb2IuYXR0ZW1wdHNNYWRlLFxuICAgICAgICAgIGF0dGVtcHRzVG90YWw6IGpvYi5vcHRzLmF0dGVtcHRzIHx8IDAsXG4gICAgICAgICAgZGVsYXk6IGpvYi5vcHRzLmRlbGF5IHx8IDAsXG4gICAgICAgICAgdGltZXN0YW1wOiBqb2IudGltZXN0YW1wLFxuICAgICAgICAgIHByb2Nlc3NlZE9uOiBqb2IucHJvY2Vzc2VkT24sXG4gICAgICAgICAgZmluaXNoZWRPbjogam9iLmZpbmlzaGVkT24sXG4gICAgICAgICAgZmFpbGVkUmVhc29uOiBqb2IuZmFpbGVkUmVhc29uLFxuICAgICAgICAgIHN0YWNrdHJhY2U6IGpvYi5zdGFja3RyYWNlLFxuICAgICAgICAgIHJldHVyblZhbHVlOiBqb2IucmV0dXJudmFsdWUsXG4gICAgICAgICAgc3RhdGU6IHN0YXRlIGFzIGFueVxuICAgICAgICB9O1xuICAgICAgfSlcbiAgICApO1xuICB9XG5cbiAgLyoqXG4gICAqIENsZWFuIGNvbXBsZXRlZCBqb2JzXG4gICAqL1xuICBhc3luYyBjbGVhbkNvbXBsZXRlZEpvYnMoXG4gICAgcXVldWVOYW1lOiBRdWV1ZU5hbWUsXG4gICAgZ3JhY2U6IG51bWJlciA9IDM2MDAwMDBcbiAgKTogUHJvbWlzZTxzdHJpbmdbXT4ge1xuICAgIGNvbnN0IHF1ZXVlID0gdGhpcy5xdWV1ZXMuZ2V0KHF1ZXVlTmFtZSk7XG5cbiAgICBpZiAoIXF1ZXVlKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYFF1ZXVlICR7cXVldWVOYW1lfSBub3QgaW5pdGlhbGl6ZWRgKTtcbiAgICB9XG5cbiAgICBjb25zdCBjbGVhbmVkID0gYXdhaXQgcXVldWUuY2xlYW4oZ3JhY2UsIDEwMDAsICdjb21wbGV0ZWQnKTtcblxuICAgIGNvbnNvbGUubG9nKFxuICAgICAgYFtRdWV1ZU1hbmFnZXJdIENsZWFuZWQgJHtjbGVhbmVkLmxlbmd0aH0gY29tcGxldGVkIGpvYnMgZnJvbSAke3F1ZXVlTmFtZX1gXG4gICAgKTtcblxuICAgIHJldHVybiBjbGVhbmVkO1xuICB9XG5cbiAgLyoqXG4gICAqIENsZWFuIGZhaWxlZCBqb2JzXG4gICAqL1xuICBhc3luYyBjbGVhbkZhaWxlZEpvYnMoXG4gICAgcXVldWVOYW1lOiBRdWV1ZU5hbWUsXG4gICAgZ3JhY2U6IG51bWJlciA9IDg2NDAwMDAwXG4gICk6IFByb21pc2U8c3RyaW5nW10+IHtcbiAgICBjb25zdCBxdWV1ZSA9IHRoaXMucXVldWVzLmdldChxdWV1ZU5hbWUpO1xuXG4gICAgaWYgKCFxdWV1ZSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBRdWV1ZSAke3F1ZXVlTmFtZX0gbm90IGluaXRpYWxpemVkYCk7XG4gICAgfVxuXG4gICAgY29uc3QgY2xlYW5lZCA9IGF3YWl0IHF1ZXVlLmNsZWFuKGdyYWNlLCAxMDAwLCAnZmFpbGVkJyk7XG5cbiAgICBjb25zb2xlLmxvZyhcbiAgICAgIGBbUXVldWVNYW5hZ2VyXSBDbGVhbmVkICR7Y2xlYW5lZC5sZW5ndGh9IGZhaWxlZCBqb2JzIGZyb20gJHtxdWV1ZU5hbWV9YFxuICAgICk7XG5cbiAgICByZXR1cm4gY2xlYW5lZDtcbiAgfVxuXG4gIC8qKlxuICAgKiBHcmFjZWZ1bCBzaHV0ZG93biBvZiBhbGwgcXVldWVzIGFuZCB3b3JrZXJzXG4gICAqL1xuICBhc3luYyBzaHV0ZG93bigpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBpZiAodGhpcy5pc1NodXR0aW5nRG93bikge1xuICAgICAgY29uc29sZS5sb2coJ1tRdWV1ZU1hbmFnZXJdIFNodXRkb3duIGFscmVhZHkgaW4gcHJvZ3Jlc3MnKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB0aGlzLmlzU2h1dHRpbmdEb3duID0gdHJ1ZTtcblxuICAgIGNvbnNvbGUubG9nKCdbUXVldWVNYW5hZ2VyXSBTdGFydGluZyBncmFjZWZ1bCBzaHV0ZG93bi4uLicpO1xuXG4gICAgY29uc3Qgc2h1dGRvd25Qcm9taXNlczogUHJvbWlzZTx2b2lkPltdID0gW107XG5cbiAgICBmb3IgKGNvbnN0IFtxdWV1ZU5hbWUsIHF1ZXVlXSBvZiB0aGlzLnF1ZXVlcykge1xuICAgICAgY29uc3Qgd29ya2VyID0gdGhpcy53b3JrZXJzLmdldChxdWV1ZU5hbWUpO1xuICAgICAgY29uc3QgcXVldWVFdmVudHMgPSB0aGlzLnF1ZXVlRXZlbnRzLmdldChxdWV1ZU5hbWUpO1xuXG4gICAgICBpZiAod29ya2VyICYmIHF1ZXVlRXZlbnRzKSB7XG4gICAgICAgIHNodXRkb3duUHJvbWlzZXMucHVzaChncmFjZWZ1bFNodXRkb3duKHF1ZXVlLCB3b3JrZXIsIHF1ZXVlRXZlbnRzKSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgYXdhaXQgUHJvbWlzZS5hbGwoc2h1dGRvd25Qcm9taXNlcyk7XG5cbiAgICB0aGlzLnF1ZXVlcy5jbGVhcigpO1xuICAgIHRoaXMud29ya2Vycy5jbGVhcigpO1xuICAgIHRoaXMucXVldWVFdmVudHMuY2xlYXIoKTtcblxuICAgIGNvbnNvbGUubG9nKCdbUXVldWVNYW5hZ2VyXSBHcmFjZWZ1bCBzaHV0ZG93biBjb21wbGV0ZScpO1xuICB9XG5cbiAgLyoqXG4gICAqIEhlYWx0aCBjaGVjayBmb3IgYWxsIHF1ZXVlc1xuICAgKi9cbiAgYXN5bmMgaGVhbHRoQ2hlY2soKTogUHJvbWlzZTx7XG4gICAgaGVhbHRoeTogYm9vbGVhbjtcbiAgICBxdWV1ZXM6IFJlY29yZDxzdHJpbmcsIGFueT47XG4gIH0+IHtcbiAgICBjb25zdCBxdWV1ZUhlYWx0aDogUmVjb3JkPHN0cmluZywgYW55PiA9IHt9O1xuICAgIGxldCBhbGxIZWFsdGh5ID0gdHJ1ZTtcblxuICAgIGZvciAoY29uc3QgW3F1ZXVlTmFtZSwgcXVldWVdIG9mIHRoaXMucXVldWVzKSB7XG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCBzdGF0cyA9IGF3YWl0IGdldFF1ZXVlU3RhdHMocXVldWUpO1xuICAgICAgICBxdWV1ZUhlYWx0aFtxdWV1ZU5hbWVdID0ge1xuICAgICAgICAgIGhlYWx0aHk6IHRydWUsXG4gICAgICAgICAgc3RhdHNcbiAgICAgICAgfTtcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGFsbEhlYWx0aHkgPSBmYWxzZTtcbiAgICAgICAgcXVldWVIZWFsdGhbcXVldWVOYW1lXSA9IHtcbiAgICAgICAgICBoZWFsdGh5OiBmYWxzZSxcbiAgICAgICAgICBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnVW5rbm93biBlcnJvcidcbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4ge1xuICAgICAgaGVhbHRoeTogYWxsSGVhbHRoeSxcbiAgICAgIHF1ZXVlczogcXVldWVIZWFsdGhcbiAgICB9O1xuICB9XG59XG5cbi8qKlxuICogU2luZ2xldG9uIGluc3RhbmNlXG4gKi9cbmxldCBxdWV1ZU1hbmFnZXJJbnN0YW5jZTogUXVldWVNYW5hZ2VyIHwgbnVsbCA9IG51bGw7XG5cbi8qKlxuICogR2V0IHF1ZXVlIG1hbmFnZXIgaW5zdGFuY2VcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdldFF1ZXVlTWFuYWdlcigpOiBRdWV1ZU1hbmFnZXIge1xuICBpZiAoIXF1ZXVlTWFuYWdlckluc3RhbmNlKSB7XG4gICAgcXVldWVNYW5hZ2VySW5zdGFuY2UgPSBuZXcgUXVldWVNYW5hZ2VyKCk7XG4gIH1cblxuICByZXR1cm4gcXVldWVNYW5hZ2VySW5zdGFuY2U7XG59XG5cbi8qKlxuICogSW5pdGlhbGl6ZSBxdWV1ZSBtYW5hZ2VyIChjYWxsIG9uY2UgYXQgYXBwbGljYXRpb24gc3RhcnR1cClcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGluaXRpYWxpemVRdWV1ZU1hbmFnZXIoKTogUHJvbWlzZTxRdWV1ZU1hbmFnZXI+IHtcbiAgY29uc3QgbWFuYWdlciA9IGdldFF1ZXVlTWFuYWdlcigpO1xuICBhd2FpdCBtYW5hZ2VyLmluaXRpYWxpemUoKTtcbiAgcmV0dXJuIG1hbmFnZXI7XG59XG4iXSwibmFtZXMiOlsiUXVldWVNYW5hZ2VyIiwiZ2V0UXVldWVNYW5hZ2VyIiwiaW5pdGlhbGl6ZVF1ZXVlTWFuYWdlciIsImlzU2h1dHRpbmdEb3duIiwicXVldWVzIiwiTWFwIiwid29ya2VycyIsInF1ZXVlRXZlbnRzIiwiaW5pdGlhbGl6ZSIsImNvbnNvbGUiLCJsb2ciLCJpbml0aWFsaXplUXVldWUiLCJRdWV1ZU5hbWUiLCJCVUxLX01FU1NBR0UiLCJwcm9jZXNzQnVsa01lc3NhZ2UiLCJDT05UQUNUX0lNUE9SVCIsInByb2Nlc3NDb250YWN0SW1wb3J0IiwiVEVNUExBVEVfUFJPQ0VTU0lORyIsInByb2Nlc3NUZW1wbGF0ZSIsIkVNQUlMX05PVElGSUNBVElPTiIsInByb2Nlc3NFbWFpbE5vdGlmaWNhdGlvbiIsImVycm9yIiwicXVldWVOYW1lIiwicHJvY2Vzc29yIiwicXVldWUiLCJjcmVhdGVRdWV1ZSIsInNldCIsIndvcmtlciIsImNyZWF0ZVdvcmtlciIsImNyZWF0ZVF1ZXVlRXZlbnRzIiwiZ2V0UXVldWUiLCJnZXQiLCJhZGRKb2IiLCJqb2JOYW1lIiwiZGF0YSIsIm9wdGlvbnMiLCJFcnJvciIsImpvYiIsImFkZCIsInByaW9yaXR5IiwiSm9iUHJpb3JpdHkiLCJOT1JNQUwiLCJkZWxheSIsImF0dGVtcHRzIiwiYmFja29mZiIsInJlbW92ZU9uQ29tcGxldGUiLCJyZW1vdmVPbkZhaWwiLCJpZCIsInRvU3RyaW5nIiwiZ2V0Sm9iIiwiam9iSWQiLCJzdGF0ZSIsImdldFN0YXRlIiwibmFtZSIsInByb2dyZXNzIiwiYXR0ZW1wdHNNYWRlIiwiYXR0ZW1wdHNUb3RhbCIsIm9wdHMiLCJ0aW1lc3RhbXAiLCJwcm9jZXNzZWRPbiIsImZpbmlzaGVkT24iLCJmYWlsZWRSZWFzb24iLCJzdGFja3RyYWNlIiwicmV0dXJuVmFsdWUiLCJyZXR1cm52YWx1ZSIsImNhbmNlbEpvYiIsInJlbW92ZSIsInJldHJ5Sm9iIiwicmV0cnkiLCJnZXRRdWV1ZVN0YXRpc3RpY3MiLCJnZXRRdWV1ZVN0YXRzIiwiZ2V0QWxsUXVldWVTdGF0aXN0aWNzIiwic3RhdHMiLCJwYXVzZVF1ZXVlIiwicGF1c2UiLCJyZXN1bWVRdWV1ZSIsInJlc3VtZSIsImdldEZhaWxlZEpvYnMiLCJzdGFydCIsImVuZCIsImZhaWxlZEpvYnMiLCJnZXRGYWlsZWQiLCJQcm9taXNlIiwiYWxsIiwibWFwIiwiY2xlYW5Db21wbGV0ZWRKb2JzIiwiZ3JhY2UiLCJjbGVhbmVkIiwiY2xlYW4iLCJsZW5ndGgiLCJjbGVhbkZhaWxlZEpvYnMiLCJzaHV0ZG93biIsInNodXRkb3duUHJvbWlzZXMiLCJwdXNoIiwiZ3JhY2VmdWxTaHV0ZG93biIsImNsZWFyIiwiaGVhbHRoQ2hlY2siLCJxdWV1ZUhlYWx0aCIsImFsbEhlYWx0aHkiLCJoZWFsdGh5IiwibWVzc2FnZSIsInF1ZXVlTWFuYWdlckluc3RhbmNlIiwibWFuYWdlciJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7UUF1RWFBO2VB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