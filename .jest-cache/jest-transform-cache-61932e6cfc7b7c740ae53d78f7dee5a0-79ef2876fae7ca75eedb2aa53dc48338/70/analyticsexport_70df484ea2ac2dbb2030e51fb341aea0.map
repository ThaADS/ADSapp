{"version":3,"names":["cov_y3ptkf69i","actualCoverage","s","AnalyticsExporter","exportData","options","f","format","dateRange","metrics","organizationId","data","fetchAnalyticsData","b","exportToCSV","exportToExcel","exportToPDF","Error","queries","includes","push","supabase","from","select","eq","gte","start","lte","end","results","Promise","all","aggregateData","aggregated","forEach","metric","index","csvRows","headers","Object","keys","join","maxLength","Math","max","values","map","arr","length","i","row","key","item","JSON","stringify","content","filename","Date","toISOString","split","mimeType","csvData","entries","value","toUpperCase","Array","isArray","_server","createClient"],"sources":["C:\\Ai Projecten\\ADSapp\\src\\lib\\export\\analytics-export.ts"],"sourcesContent":["import { createClient } from '@/lib/supabase/server'\n\nexport interface ExportOptions {\n  format: 'csv' | 'excel' | 'pdf'\n  dateRange: {\n    start: string\n    end: string\n  }\n  metrics: string[]\n  organizationId: string\n}\n\nexport class AnalyticsExporter {\n  private supabase = createClient()\n\n  async exportData(options: ExportOptions) {\n    const { format, dateRange, metrics, organizationId } = options\n\n    // Fetch analytics data\n    const data = await this.fetchAnalyticsData(organizationId, dateRange, metrics)\n\n    switch (format) {\n      case 'csv':\n        return this.exportToCSV(data)\n      case 'excel':\n        return this.exportToExcel(data)\n      case 'pdf':\n        return this.exportToPDF(data)\n      default:\n        throw new Error(`Unsupported export format: ${format}`)\n    }\n  }\n\n  private async fetchAnalyticsData(organizationId: string, dateRange: any, metrics: string[]) {\n    const queries = []\n\n    if (metrics.includes('messages')) {\n      queries.push(\n        this.supabase\n          .from('messages')\n          .select('*')\n          .eq('organization_id', organizationId)\n          .gte('created_at', dateRange.start)\n          .lte('created_at', dateRange.end)\n      )\n    }\n\n    if (metrics.includes('conversations')) {\n      queries.push(\n        this.supabase\n          .from('conversations')\n          .select('*')\n          .eq('organization_id', organizationId)\n          .gte('created_at', dateRange.start)\n          .lte('created_at', dateRange.end)\n      )\n    }\n\n    if (metrics.includes('contacts')) {\n      queries.push(\n        this.supabase\n          .from('contacts')\n          .select('*')\n          .eq('organization_id', organizationId)\n          .gte('created_at', dateRange.start)\n          .lte('created_at', dateRange.end)\n      )\n    }\n\n    const results = await Promise.all(queries)\n    return this.aggregateData(results, metrics)\n  }\n\n  private aggregateData(results: any[], metrics: string[]) {\n    const aggregated: any = {}\n\n    metrics.forEach((metric, index) => {\n      if (results[index]?.data) {\n        aggregated[metric] = results[index].data\n      }\n    })\n\n    return aggregated\n  }\n\n  private exportToCSV(data: any) {\n    const csvRows = []\n    \n    // Add headers\n    const headers = Object.keys(data).join(',')\n    csvRows.push(headers)\n\n    // Add data rows\n    const maxLength = Math.max(...Object.values(data).map((arr: any) => arr.length))\n    \n    for (let i = 0; i < maxLength; i++) {\n      const row = Object.keys(data).map(key => {\n        const item = data[key][i]\n        return item ? JSON.stringify(item) : ''\n      }).join(',')\n      csvRows.push(row)\n    }\n\n    return {\n      content: csvRows.join('\\n'),\n      filename: `analytics-export-${new Date().toISOString().split('T')[0]}.csv`,\n      mimeType: 'text/csv'\n    }\n  }\n\n  private exportToExcel(data: any) {\n    // For now, return CSV format with Excel MIME type\n    // In production, you'd use a library like xlsx\n    const csvData = this.exportToCSV(data)\n    \n    return {\n      content: csvData.content,\n      filename: `analytics-export-${new Date().toISOString().split('T')[0]}.xlsx`,\n      mimeType: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet'\n    }\n  }\n\n  private exportToPDF(data: any) {\n    // Basic PDF export - in production, use a library like jsPDF\n    const content = `\n      Analytics Export Report\n      Generated: ${new Date().toISOString()}\n      \n      ${Object.entries(data).map(([key, value]) => \n        `${key.toUpperCase()}: ${Array.isArray(value) ? value.length : 0} items`\n      ).join('\\n')}\n    `\n\n    return {\n      content,\n      filename: `analytics-export-${new Date().toISOString().split('T')[0]}.pdf`,\n      mimeType: 'application/pdf'\n    }\n  }\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;IAmBI;IAAAA,aAAA,YAAAA,CAAA;MAAA,OAAAC,cAAA;IAAA;EAAA;EAAA,OAAAA,cAAA;AAAA;AAAAD,aAAA;AAAAA,aAAA,GAAAE,CAAA;;;;;;+BAPS;;;;;;WAAAC,iBAAA;;;;;iCAZgB;AAYtB,MAAMA,iBAAA;EAGX,MAAMC,WAAWC,OAAsB,EAAE;IAAA;IAAAL,aAAA,GAAAM,CAAA;IACvC,MAAM;MAAEC,MAAM;MAAEC,SAAS;MAAEC,OAAO;MAAEC;IAAc,CAAE;IAAA;IAAA,CAAAV,aAAA,GAAAE,CAAA,OAAGG,OAAA;IAEvD;IACA,MAAMM,IAAA;IAAA;IAAA,CAAAX,aAAA,GAAAE,CAAA,OAAO,MAAM,IAAI,CAACU,kBAAkB,CAACF,cAAA,EAAgBF,SAAA,EAAWC,OAAA;IAAA;IAAAT,aAAA,GAAAE,CAAA;IAEtE,QAAQK,MAAA;MACN,KAAK;QAAA;QAAAP,aAAA,GAAAa,CAAA;QAAAb,aAAA,GAAAE,CAAA;QACH,OAAO,IAAI,CAACY,WAAW,CAACH,IAAA;MAC1B,KAAK;QAAA;QAAAX,aAAA,GAAAa,CAAA;QAAAb,aAAA,GAAAE,CAAA;QACH,OAAO,IAAI,CAACa,aAAa,CAACJ,IAAA;MAC5B,KAAK;QAAA;QAAAX,aAAA,GAAAa,CAAA;QAAAb,aAAA,GAAAE,CAAA;QACH,OAAO,IAAI,CAACc,WAAW,CAACL,IAAA;MAC1B;QAAA;QAAAX,aAAA,GAAAa,CAAA;QAAAb,aAAA,GAAAE,CAAA;QACE,MAAM,IAAIe,KAAA,CAAM,8BAA8BV,MAAA,EAAQ;IAC1D;EACF;EAEA,MAAcK,mBAAmBF,cAAsB,EAAEF,SAAc,EAAEC,OAAiB,EAAE;IAAA;IAAAT,aAAA,GAAAM,CAAA;IAC1F,MAAMY,OAAA;IAAA;IAAA,CAAAlB,aAAA,GAAAE,CAAA,QAAU,EAAE;IAAA;IAAAF,aAAA,GAAAE,CAAA;IAElB,IAAIO,OAAA,CAAQU,QAAQ,CAAC,aAAa;MAAA;MAAAnB,aAAA,GAAAa,CAAA;MAAAb,aAAA,GAAAE,CAAA;MAChCgB,OAAA,CAAQE,IAAI,CACV,IAAI,CAACC,QAAQ,CACVC,IAAI,CAAC,YACLC,MAAM,CAAC,KACPC,EAAE,CAAC,mBAAmBd,cAAA,EACtBe,GAAG,CAAC,cAAcjB,SAAA,CAAUkB,KAAK,EACjCC,GAAG,CAAC,cAAcnB,SAAA,CAAUoB,GAAG;IAEtC;IAAA;IAAA;MAAA5B,aAAA,GAAAa,CAAA;IAAA;IAAAb,aAAA,GAAAE,CAAA;IAEA,IAAIO,OAAA,CAAQU,QAAQ,CAAC,kBAAkB;MAAA;MAAAnB,aAAA,GAAAa,CAAA;MAAAb,aAAA,GAAAE,CAAA;MACrCgB,OAAA,CAAQE,IAAI,CACV,IAAI,CAACC,QAAQ,CACVC,IAAI,CAAC,iBACLC,MAAM,CAAC,KACPC,EAAE,CAAC,mBAAmBd,cAAA,EACtBe,GAAG,CAAC,cAAcjB,SAAA,CAAUkB,KAAK,EACjCC,GAAG,CAAC,cAAcnB,SAAA,CAAUoB,GAAG;IAEtC;IAAA;IAAA;MAAA5B,aAAA,GAAAa,CAAA;IAAA;IAAAb,aAAA,GAAAE,CAAA;IAEA,IAAIO,OAAA,CAAQU,QAAQ,CAAC,aAAa;MAAA;MAAAnB,aAAA,GAAAa,CAAA;MAAAb,aAAA,GAAAE,CAAA;MAChCgB,OAAA,CAAQE,IAAI,CACV,IAAI,CAACC,QAAQ,CACVC,IAAI,CAAC,YACLC,MAAM,CAAC,KACPC,EAAE,CAAC,mBAAmBd,cAAA,EACtBe,GAAG,CAAC,cAAcjB,SAAA,CAAUkB,KAAK,EACjCC,GAAG,CAAC,cAAcnB,SAAA,CAAUoB,GAAG;IAEtC;IAAA;IAAA;MAAA5B,aAAA,GAAAa,CAAA;IAAA;IAEA,MAAMgB,OAAA;IAAA;IAAA,CAAA7B,aAAA,GAAAE,CAAA,QAAU,MAAM4B,OAAA,CAAQC,GAAG,CAACb,OAAA;IAAA;IAAAlB,aAAA,GAAAE,CAAA;IAClC,OAAO,IAAI,CAAC8B,aAAa,CAACH,OAAA,EAASpB,OAAA;EACrC;EAEQuB,cAAcH,OAAc,EAAEpB,OAAiB,EAAE;IAAA;IAAAT,aAAA,GAAAM,CAAA;IACvD,MAAM2B,UAAA;IAAA;IAAA,CAAAjC,aAAA,GAAAE,CAAA,QAAkB,CAAC;IAAA;IAAAF,aAAA,GAAAE,CAAA;IAEzBO,OAAA,CAAQyB,OAAO,CAAC,CAACC,MAAA,EAAQC,KAAA;MAAA;MAAApC,aAAA,GAAAM,CAAA;MAAAN,aAAA,GAAAE,CAAA;MACvB,IAAI2B,OAAO,CAACO,KAAA,CAAM,EAAEzB,IAAA,EAAM;QAAA;QAAAX,aAAA,GAAAa,CAAA;QAAAb,aAAA,GAAAE,CAAA;QACxB+B,UAAU,CAACE,MAAA,CAAO,GAAGN,OAAO,CAACO,KAAA,CAAM,CAACzB,IAAI;MAC1C;MAAA;MAAA;QAAAX,aAAA,GAAAa,CAAA;MAAA;IACF;IAAA;IAAAb,aAAA,GAAAE,CAAA;IAEA,OAAO+B,UAAA;EACT;EAEQnB,YAAYH,IAAS,EAAE;IAAA;IAAAX,aAAA,GAAAM,CAAA;IAC7B,MAAM+B,OAAA;IAAA;IAAA,CAAArC,aAAA,GAAAE,CAAA,QAAU,EAAE;IAElB;IACA,MAAMoC,OAAA;IAAA;IAAA,CAAAtC,aAAA,GAAAE,CAAA,QAAUqC,MAAA,CAAOC,IAAI,CAAC7B,IAAA,EAAM8B,IAAI,CAAC;IAAA;IAAAzC,aAAA,GAAAE,CAAA;IACvCmC,OAAA,CAAQjB,IAAI,CAACkB,OAAA;IAEb;IACA,MAAMI,SAAA;IAAA;IAAA,CAAA1C,aAAA,GAAAE,CAAA,QAAYyC,IAAA,CAAKC,GAAG,IAAIL,MAAA,CAAOM,MAAM,CAAClC,IAAA,EAAMmC,GAAG,CAAEC,GAAA,IAAa;MAAA;MAAA/C,aAAA,GAAAM,CAAA;MAAAN,aAAA,GAAAE,CAAA;MAAA,OAAA6C,GAAA,CAAIC,MAAM;IAAN,CAAM;IAAA;IAAAhD,aAAA,GAAAE,CAAA;IAE9E,KAAK,IAAI+C,CAAA;IAAA;IAAA,CAAAjD,aAAA,GAAAE,CAAA,QAAI,IAAG+C,CAAA,GAAIP,SAAA,EAAWO,CAAA,IAAK;MAClC,MAAMC,GAAA;MAAA;MAAA,CAAAlD,aAAA,GAAAE,CAAA,QAAMqC,MAAA,CAAOC,IAAI,CAAC7B,IAAA,EAAMmC,GAAG,CAACK,GAAA;QAAA;QAAAnD,aAAA,GAAAM,CAAA;QAChC,MAAM8C,IAAA;QAAA;QAAA,CAAApD,aAAA,GAAAE,CAAA,QAAOS,IAAI,CAACwC,GAAA,CAAI,CAACF,CAAA,CAAE;QAAA;QAAAjD,aAAA,GAAAE,CAAA;QACzB,OAAOkD,IAAA;QAAA;QAAA,CAAApD,aAAA,GAAAa,CAAA,UAAOwC,IAAA,CAAKC,SAAS,CAACF,IAAA;QAAA;QAAA,CAAApD,aAAA,GAAAa,CAAA,UAAQ;MACvC,GAAG4B,IAAI,CAAC;MAAA;MAAAzC,aAAA,GAAAE,CAAA;MACRmC,OAAA,CAAQjB,IAAI,CAAC8B,GAAA;IACf;IAAA;IAAAlD,aAAA,GAAAE,CAAA;IAEA,OAAO;MACLqD,OAAA,EAASlB,OAAA,CAAQI,IAAI,CAAC;MACtBe,QAAA,EAAU,oBAAoB,IAAIC,IAAA,GAAOC,WAAW,GAAGC,KAAK,CAAC,IAAI,CAAC,EAAE,MAAM;MAC1EC,QAAA,EAAU;IACZ;EACF;EAEQ7C,cAAcJ,IAAS,EAAE;IAAA;IAAAX,aAAA,GAAAM,CAAA;IAC/B;IACA;IACA,MAAMuD,OAAA;IAAA;IAAA,CAAA7D,aAAA,GAAAE,CAAA,QAAU,IAAI,CAACY,WAAW,CAACH,IAAA;IAAA;IAAAX,aAAA,GAAAE,CAAA;IAEjC,OAAO;MACLqD,OAAA,EAASM,OAAA,CAAQN,OAAO;MACxBC,QAAA,EAAU,oBAAoB,IAAIC,IAAA,GAAOC,WAAW,GAAGC,KAAK,CAAC,IAAI,CAAC,EAAE,OAAO;MAC3EC,QAAA,EAAU;IACZ;EACF;EAEQ5C,YAAYL,IAAS,EAAE;IAAA;IAAAX,aAAA,GAAAM,CAAA;IAC7B;IACA,MAAMiD,OAAA;IAAA;IAAA,CAAAvD,aAAA,GAAAE,CAAA,QAAU;;mBAED,IAAIuD,IAAA,GAAOC,WAAW;;QAEjCnB,MAAA,CAAOuB,OAAO,CAACnD,IAAA,EAAMmC,GAAG,CAAC,CAAC,CAACK,GAAA,EAAKY,KAAA,CAAM,KACtC;MAAA;MAAA/D,aAAA,GAAAM,CAAA;MAAAN,aAAA,GAAAE,CAAA;MAAA,UAAGiD,GAAA,CAAIa,WAAW,OAAOC,KAAA,CAAMC,OAAO,CAACH,KAAA;MAAA;MAAA,CAAA/D,aAAA,GAAAa,CAAA,UAASkD,KAAA,CAAMf,MAAM;MAAA;MAAA,CAAAhD,aAAA,GAAAa,CAAA,UAAG,UAAS;IAAD,CAAC,EACxE4B,IAAI,CAAC;KACR;IAAA;IAAAzC,aAAA,GAAAE,CAAA;IAED,OAAO;MACLqD,OAAA;MACAC,QAAA,EAAU,oBAAoB,IAAIC,IAAA,GAAOC,WAAW,GAAGC,KAAK,CAAC,IAAI,CAAC,EAAE,MAAM;MAC1EC,QAAA,EAAU;IACZ;EACF;;;;;SA7HQvC,QAAA,GAAW,IAAA8C,OAAA,CAAAC,YAAY;;AA8HjC","ignoreList":[]}