{"version":3,"names":["cov_4v19hfw5s","actualCoverage","s","StripeWebhookProcessor","processEvent","event","f","console","log","type","b","handleSubscriptionCreated","data","object","handleSubscriptionUpdated","handleSubscriptionDeleted","handleTrialWillEnd","handleInvoiceCreated","handleInvoiceFinalized","handleInvoicePaid","handlePaymentFailed","handlePaymentActionRequired","handleInvoiceUpcoming","handlePaymentMethodAttached","handlePaymentMethodDetached","handleSetupIntentSucceeded","handleCustomerCreated","handleCustomerUpdated","handleCustomerDeleted","handleCheckoutCompleted","handleCheckoutExpired","handlePriceUpdated","logWebhookEvent","error","Error","message","subscription","organizationId","metadata","planId","extractPlanFromSubscription","supabase","from","update","stripe_subscription_id","id","subscription_status","status","subscription_tier","trial_ends_at","trial_end","Date","toISOString","current_period_start","current_period_end","eq","usageTracker","initializeUsageForOrganization","notificationService","sendSubscriptionWelcome","currentOrg","select","single","wasUpgrade","isPlanUpgrade","wasDowngrade","isPlanDowngrade","sendPlanUpgradeNotification","sendPlanDowngradeNotification","enforceDowngradeLimits","updatePlanLimits","sendSubscriptionCancellation","daysLeft","Math","ceil","now","sendTrialEndingNotification","invoice","invoiceManager","createInvoiceRecord","finalizeInvoice","getOrganizationFromSubscription","sendInvoiceFinalized","markInvoicePaid","billing_reason","resetMonthlyUsage","sendPaymentSuccess","amount_paid","markPaymentFailed","sendPaymentFailed","amount_due","schedulePaymentRetry","sendPaymentActionRequired","hosted_invoice_url","usageCharges","calculateOverageCharges","addUsageBasedCharges","sendUpcomingInvoice","paymentMethod","paymentMethodManager","setupIntent","customer","payment_method","stripe_customer_id","session","sendCheckoutSuccess","sendCheckoutExpired","price","priceId","items","priceToPlainMap","process","env","STRIPE_STARTER_PRICE_ID","STRIPE_PROFESSIONAL_PRICE_ID","STRIPE_ENTERPRISE_PRICE_ID","subscriptionId","currentPlan","newPlan","planHierarchy","starter","professional","enterprise","invoiceId","errorMessage","insert","event_id","event_type","error_message","processed_at","event_data","then","catch","_server","createClient","_usagetracking","UsageTracker","_invoicemanagement","InvoiceManager","_paymentmethods","PaymentMethodManager","_notificationservice","NotificationService"],"sources":["C:\\Ai Projecten\\ADSapp\\src\\lib\\billing\\webhook-processor.ts"],"sourcesContent":["import Stripe from 'stripe'\nimport { createClient } from '@/lib/supabase/server'\nimport { UsageTracker } from './usage-tracking'\nimport { InvoiceManager } from './invoice-management'\nimport { PaymentMethodManager } from './payment-methods'\nimport { NotificationService } from './notification-service'\n\nexport class StripeWebhookProcessor {\n  private supabase = createClient()\n  private usageTracker = new UsageTracker()\n  private invoiceManager = new InvoiceManager()\n  private paymentMethodManager = new PaymentMethodManager()\n  private notificationService = new NotificationService()\n\n  async processEvent(event: Stripe.Event): Promise<void> {\n    console.log(`[Webhook] Processing ${event.type}`)\n\n    try {\n      switch (event.type) {\n        // Subscription Events\n        case 'customer.subscription.created':\n          await this.handleSubscriptionCreated(event.data.object as Stripe.Subscription)\n          break\n        case 'customer.subscription.updated':\n          await this.handleSubscriptionUpdated(event.data.object as Stripe.Subscription)\n          break\n        case 'customer.subscription.deleted':\n          await this.handleSubscriptionDeleted(event.data.object as Stripe.Subscription)\n          break\n        case 'customer.subscription.trial_will_end':\n          await this.handleTrialWillEnd(event.data.object as Stripe.Subscription)\n          break\n\n        // Invoice Events\n        case 'invoice.created':\n          await this.handleInvoiceCreated(event.data.object as Stripe.Invoice)\n          break\n        case 'invoice.finalized':\n          await this.handleInvoiceFinalized(event.data.object as Stripe.Invoice)\n          break\n        case 'invoice.paid':\n          await this.handleInvoicePaid(event.data.object as Stripe.Invoice)\n          break\n        case 'invoice.payment_failed':\n          await this.handlePaymentFailed(event.data.object as Stripe.Invoice)\n          break\n        case 'invoice.payment_action_required':\n          await this.handlePaymentActionRequired(event.data.object as Stripe.Invoice)\n          break\n        case 'invoice.upcoming':\n          await this.handleInvoiceUpcoming(event.data.object as Stripe.Invoice)\n          break\n\n        // Payment Method Events\n        case 'payment_method.attached':\n          await this.handlePaymentMethodAttached(event.data.object as Stripe.PaymentMethod)\n          break\n        case 'payment_method.detached':\n          await this.handlePaymentMethodDetached(event.data.object as Stripe.PaymentMethod)\n          break\n        case 'setup_intent.succeeded':\n          await this.handleSetupIntentSucceeded(event.data.object as Stripe.SetupIntent)\n          break\n\n        // Customer Events\n        case 'customer.created':\n          await this.handleCustomerCreated(event.data.object as Stripe.Customer)\n          break\n        case 'customer.updated':\n          await this.handleCustomerUpdated(event.data.object as Stripe.Customer)\n          break\n        case 'customer.deleted':\n          await this.handleCustomerDeleted(event.data.object as Stripe.Customer)\n          break\n\n        // Checkout Events\n        case 'checkout.session.completed':\n          await this.handleCheckoutCompleted(event.data.object as Stripe.Checkout.Session)\n          break\n        case 'checkout.session.expired':\n          await this.handleCheckoutExpired(event.data.object as Stripe.Checkout.Session)\n          break\n\n        // Price and Product Events\n        case 'price.created':\n        case 'price.updated':\n          await this.handlePriceUpdated(event.data.object as Stripe.Price)\n          break\n\n        default:\n          console.log(`[Webhook] Unhandled event type: ${event.type}`)\n      }\n\n      // Log successful processing\n      await this.logWebhookEvent(event, 'success')\n    } catch (error) {\n      console.error(`[Webhook] Error processing ${event.type}:`, error)\n      await this.logWebhookEvent(event, 'error', error instanceof Error ? error.message : 'Unknown error')\n      throw error\n    }\n  }\n\n  private async handleSubscriptionCreated(subscription: Stripe.Subscription): Promise<void> {\n    const organizationId = subscription.metadata.organizationId\n    if (!organizationId) return\n\n    const planId = this.extractPlanFromSubscription(subscription)\n    const supabase = await this.supabase\n\n    // Update organization with subscription details\n    await supabase\n      .from('organizations')\n      .update({\n        stripe_subscription_id: subscription.id,\n        subscription_status: subscription.status as any,\n        subscription_tier: planId,\n        trial_ends_at: subscription.trial_end ? new Date(subscription.trial_end * 1000).toISOString() : null,\n        current_period_start: new Date(subscription.current_period_start * 1000).toISOString(),\n        current_period_end: new Date(subscription.current_period_end * 1000).toISOString(),\n      })\n      .eq('id', organizationId)\n\n    // Initialize usage tracking for the new subscription\n    await this.usageTracker.initializeUsageForOrganization(organizationId)\n\n    // Send welcome notification\n    await this.notificationService.sendSubscriptionWelcome(organizationId, planId)\n  }\n\n  private async handleSubscriptionUpdated(subscription: Stripe.Subscription): Promise<void> {\n    const organizationId = subscription.metadata.organizationId\n    if (!organizationId) return\n\n    const planId = this.extractPlanFromSubscription(subscription)\n    const supabase = await this.supabase\n\n    // Get current organization data\n    const { data: currentOrg } = await supabase\n      .from('organizations')\n      .select('subscription_tier, subscription_status')\n      .eq('id', organizationId)\n      .single()\n\n    const wasUpgrade = currentOrg && this.isPlanUpgrade(currentOrg.subscription_tier, planId)\n    const wasDowngrade = currentOrg && this.isPlanDowngrade(currentOrg.subscription_tier, planId)\n\n    // Update organization\n    await supabase\n      .from('organizations')\n      .update({\n        subscription_status: subscription.status as any,\n        subscription_tier: planId,\n        trial_ends_at: subscription.trial_end ? new Date(subscription.trial_end * 1000).toISOString() : null,\n        current_period_start: new Date(subscription.current_period_start * 1000).toISOString(),\n        current_period_end: new Date(subscription.current_period_end * 1000).toISOString(),\n      })\n      .eq('id', organizationId)\n\n    // Handle plan changes\n    if (wasUpgrade) {\n      await this.notificationService.sendPlanUpgradeNotification(organizationId, planId)\n    } else if (wasDowngrade) {\n      await this.notificationService.sendPlanDowngradeNotification(organizationId, planId)\n      await this.usageTracker.enforceDowngradeLimits(organizationId, planId)\n    }\n\n    // Update usage limits\n    await this.usageTracker.updatePlanLimits(organizationId, planId)\n  }\n\n  private async handleSubscriptionDeleted(subscription: Stripe.Subscription): Promise<void> {\n    const organizationId = subscription.metadata.organizationId\n    if (!organizationId) return\n\n    const supabase = await this.supabase\n\n    await supabase\n      .from('organizations')\n      .update({\n        subscription_status: 'cancelled',\n        subscription_tier: 'starter', // Downgrade to free plan\n        stripe_subscription_id: null,\n        trial_ends_at: null,\n      })\n      .eq('id', organizationId)\n\n    // Enforce free plan limits\n    await this.usageTracker.enforceDowngradeLimits(organizationId, 'starter')\n\n    // Send cancellation notification\n    await this.notificationService.sendSubscriptionCancellation(organizationId)\n  }\n\n  private async handleTrialWillEnd(subscription: Stripe.Subscription): Promise<void> {\n    const organizationId = subscription.metadata.organizationId\n    if (!organizationId) return\n\n    const daysLeft = Math.ceil((subscription.trial_end! - Date.now() / 1000) / 86400)\n    await this.notificationService.sendTrialEndingNotification(organizationId, daysLeft)\n  }\n\n  private async handleInvoiceCreated(invoice: Stripe.Invoice): Promise<void> {\n    if (!invoice.subscription) return\n\n    await this.invoiceManager.createInvoiceRecord(invoice)\n  }\n\n  private async handleInvoiceFinalized(invoice: Stripe.Invoice): Promise<void> {\n    await this.invoiceManager.finalizeInvoice(invoice)\n\n    if (invoice.subscription) {\n      const organizationId = await this.getOrganizationFromSubscription(invoice.subscription as string)\n      if (organizationId) {\n        await this.notificationService.sendInvoiceFinalized(organizationId, invoice.id)\n      }\n    }\n  }\n\n  private async handleInvoicePaid(invoice: Stripe.Invoice): Promise<void> {\n    await this.invoiceManager.markInvoicePaid(invoice)\n\n    if (invoice.subscription) {\n      const organizationId = await this.getOrganizationFromSubscription(invoice.subscription as string)\n      if (organizationId) {\n        // Reset usage for new billing period if this is a subscription invoice\n        if (invoice.billing_reason === 'subscription_cycle') {\n          await this.usageTracker.resetMonthlyUsage(organizationId)\n        }\n\n        await this.notificationService.sendPaymentSuccess(organizationId, invoice.amount_paid / 100)\n      }\n    }\n  }\n\n  private async handlePaymentFailed(invoice: Stripe.Invoice): Promise<void> {\n    await this.invoiceManager.markPaymentFailed(invoice)\n\n    if (invoice.subscription) {\n      const organizationId = await this.getOrganizationFromSubscription(invoice.subscription as string)\n      if (organizationId) {\n        const supabase = await this.supabase\n\n        // Update subscription status to past_due\n        await supabase\n          .from('organizations')\n          .update({ subscription_status: 'past_due' })\n          .eq('id', organizationId)\n\n        // Send payment failed notification\n        await this.notificationService.sendPaymentFailed(organizationId, invoice.amount_due / 100)\n\n        // Schedule retry logic\n        await this.schedulePaymentRetry(organizationId, invoice.id)\n      }\n    }\n  }\n\n  private async handlePaymentActionRequired(invoice: Stripe.Invoice): Promise<void> {\n    if (invoice.subscription) {\n      const organizationId = await this.getOrganizationFromSubscription(invoice.subscription as string)\n      if (organizationId) {\n        await this.notificationService.sendPaymentActionRequired(organizationId, invoice.hosted_invoice_url!)\n      }\n    }\n  }\n\n  private async handleInvoiceUpcoming(invoice: Stripe.Invoice): Promise<void> {\n    if (invoice.subscription) {\n      const organizationId = await this.getOrganizationFromSubscription(invoice.subscription as string)\n      if (organizationId) {\n        // Calculate usage-based charges\n        const usageCharges = await this.usageTracker.calculateOverageCharges(organizationId)\n\n        if (usageCharges > 0) {\n          await this.usageTracker.addUsageBasedCharges(invoice.subscription as string, usageCharges)\n        }\n\n        // Send upcoming invoice notification\n        await this.notificationService.sendUpcomingInvoice(organizationId, invoice.amount_due / 100)\n      }\n    }\n  }\n\n  private async handlePaymentMethodAttached(paymentMethod: Stripe.PaymentMethod): Promise<void> {\n    await this.paymentMethodManager.handlePaymentMethodAttached(paymentMethod)\n  }\n\n  private async handlePaymentMethodDetached(paymentMethod: Stripe.PaymentMethod): Promise<void> {\n    await this.paymentMethodManager.handlePaymentMethodDetached(paymentMethod)\n  }\n\n  private async handleSetupIntentSucceeded(setupIntent: Stripe.SetupIntent): Promise<void> {\n    if (setupIntent.customer && setupIntent.payment_method) {\n      await this.paymentMethodManager.handleSetupIntentSucceeded(setupIntent)\n    }\n  }\n\n  private async handleCustomerCreated(customer: Stripe.Customer): Promise<void> {\n    // Customer creation is handled in the StripeService.createCustomer method\n    console.log(`[Webhook] Customer created: ${customer.id}`)\n  }\n\n  private async handleCustomerUpdated(customer: Stripe.Customer): Promise<void> {\n    const organizationId = customer.metadata.organizationId\n    if (!organizationId) return\n\n    const supabase = await this.supabase\n\n    // Update organization with customer details if needed\n    await supabase\n      .from('organizations')\n      .update({\n        // Add any customer-specific fields you want to sync\n      })\n      .eq('id', organizationId)\n  }\n\n  private async handleCustomerDeleted(customer: Stripe.Customer): Promise<void> {\n    const organizationId = customer.metadata.organizationId\n    if (!organizationId) return\n\n    const supabase = await this.supabase\n\n    // Clear Stripe customer reference\n    await supabase\n      .from('organizations')\n      .update({\n        stripe_customer_id: null,\n        stripe_subscription_id: null,\n        subscription_status: 'cancelled',\n      })\n      .eq('id', organizationId)\n  }\n\n  private async handleCheckoutCompleted(session: Stripe.Checkout.Session): Promise<void> {\n    const { organizationId, planId } = session.metadata!\n\n    if (session.subscription) {\n      const supabase = await this.supabase\n\n      await supabase\n        .from('organizations')\n        .update({\n          stripe_customer_id: session.customer as string,\n          stripe_subscription_id: session.subscription as string,\n          subscription_status: 'active',\n          subscription_tier: planId,\n        })\n        .eq('id', organizationId)\n\n      // Send success notification\n      await this.notificationService.sendCheckoutSuccess(organizationId, planId)\n    }\n  }\n\n  private async handleCheckoutExpired(session: Stripe.Checkout.Session): Promise<void> {\n    const { organizationId } = session.metadata || {}\n    if (organizationId) {\n      await this.notificationService.sendCheckoutExpired(organizationId)\n    }\n  }\n\n  private async handlePriceUpdated(price: Stripe.Price): Promise<void> {\n    // Handle price updates - might need to update plan configurations\n    console.log(`[Webhook] Price updated: ${price.id}`)\n  }\n\n  // Helper methods\n  private extractPlanFromSubscription(subscription: Stripe.Subscription): string {\n    // Extract plan ID from subscription items\n    const priceId = subscription.items.data[0]?.price?.id\n    if (!priceId) return 'starter'\n\n    // Map price IDs to plan IDs\n    const priceToPlainMap: Record<string, string> = {\n      [process.env.STRIPE_STARTER_PRICE_ID!]: 'starter',\n      [process.env.STRIPE_PROFESSIONAL_PRICE_ID!]: 'professional',\n      [process.env.STRIPE_ENTERPRISE_PRICE_ID!]: 'enterprise',\n    }\n\n    return priceToPlainMap[priceId] || 'starter'\n  }\n\n  private async getOrganizationFromSubscription(subscriptionId: string): Promise<string | null> {\n    const supabase = await this.supabase\n    const { data } = await supabase\n      .from('organizations')\n      .select('id')\n      .eq('stripe_subscription_id', subscriptionId)\n      .single()\n\n    return data?.id || null\n  }\n\n  private isPlanUpgrade(currentPlan: string, newPlan: string): boolean {\n    const planHierarchy = { starter: 0, professional: 1, enterprise: 2 }\n    return planHierarchy[newPlan as keyof typeof planHierarchy] > planHierarchy[currentPlan as keyof typeof planHierarchy]\n  }\n\n  private isPlanDowngrade(currentPlan: string, newPlan: string): boolean {\n    const planHierarchy = { starter: 0, professional: 1, enterprise: 2 }\n    return planHierarchy[newPlan as keyof typeof planHierarchy] < planHierarchy[currentPlan as keyof typeof planHierarchy]\n  }\n\n  private async schedulePaymentRetry(organizationId: string, invoiceId: string): Promise<void> {\n    // Implement payment retry logic - could use a job queue or cron job\n    console.log(`[Webhook] Scheduling payment retry for org ${organizationId}, invoice ${invoiceId}`)\n  }\n\n  private async logWebhookEvent(event: Stripe.Event, status: 'success' | 'error', errorMessage?: string): Promise<void> {\n    const supabase = await this.supabase\n\n    await supabase\n      .from('webhook_events')\n      .insert({\n        event_id: event.id,\n        event_type: event.type,\n        status,\n        error_message: errorMessage,\n        processed_at: new Date().toISOString(),\n        event_data: event.data.object,\n      })\n      .then(() => {\n        console.log(`[Webhook] Logged event ${event.id} with status ${status}`)\n      })\n      .catch((error) => {\n        console.error(`[Webhook] Failed to log event ${event.id}:`, error)\n      })\n  }\n}"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}