{"version":3,"names":["withApiMiddleware","cov_zbt2sg8lm","f","s","withAuth","withOrganization","withPublicAccess","withStrictRateLimit","withWebhook","handler","options","b","request","context","startTime","Date","now","cors","corsResponse","handleCors","rateLimiting","rateLimiter","_apiutils","rateLimit","validation","validateRequest","user","profile","requireAuth","requireOrganization","authResult","handleAuthentication","organization_id","ApiException","enhancedContext","response","logging","logApiRequest","id","error","logApiError","createErrorResponse","corsOptions","origin","headers","get","method","Headers","Array","isArray","includes","set","methods","join","_server","NextResponse","status","body","json","result","success","issues","message","SyntaxError","query","searchParams","URL","url","queryObject","Object","fromEntries","entries","supabase","_server1","createClient","data","authError","auth","getUser","profileError","from","select","eq","single","console","userId","duration","logData","user_agent","ip_address","getClientIP","user_id","status_code","duration_ms","timestamp","toISOString","insert","errorData","error_message","error_stack","stack","error_code","code","logError","forwarded","real","cf","split","trim","windowMs","max","keyGenerator"],"sources":["C:\\Ai Projecten\\ADSapp\\src\\lib\\api-middleware.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server'\nimport { createErrorResponse, rateLimit, ApiException } from '@/lib/api-utils'\nimport { createClient } from '@/lib/supabase/server'\n\nexport interface ApiMiddlewareOptions {\n  requireAuth?: boolean\n  requireOrganization?: boolean\n  rateLimiting?: {\n    windowMs: number\n    max: number\n    keyGenerator?: (request: NextRequest) => string\n  }\n  validation?: {\n    body?: any // Zod schema or custom validation function\n    query?: any\n    params?: any\n  }\n  cors?: {\n    origin?: string | string[]\n    methods?: string[]\n    headers?: string[]\n  }\n  logging?: boolean\n}\n\nexport function withApiMiddleware(\n  handler: (request: NextRequest, context?: any) => Promise<NextResponse>,\n  options: ApiMiddlewareOptions = {}\n) {\n  return async (request: NextRequest, context?: any): Promise<NextResponse> => {\n    const startTime = Date.now()\n\n    try {\n      // CORS handling\n      if (options.cors) {\n        const corsResponse = handleCors(request, options.cors)\n        if (corsResponse) return corsResponse\n      }\n\n      // Rate limiting\n      if (options.rateLimiting) {\n        const rateLimiter = rateLimit(options.rateLimiting)\n        await rateLimiter(request)\n      }\n\n      // Request validation\n      if (options.validation) {\n        await validateRequest(request, options.validation)\n      }\n\n      // Authentication\n      let user = null\n      let profile = null\n\n      if (options.requireAuth || options.requireOrganization) {\n        const authResult = await handleAuthentication(request)\n        user = authResult.user\n        profile = authResult.profile\n\n        if (options.requireOrganization && !profile?.organization_id) {\n          throw new ApiException('Organization required', 403, 'NO_ORGANIZATION')\n        }\n      }\n\n      // Add context\n      const enhancedContext = {\n        ...context,\n        user,\n        profile,\n        startTime\n      }\n\n      // Execute handler\n      const response = await handler(request, enhancedContext)\n\n      // Logging\n      if (options.logging) {\n        await logApiRequest(request, response, user?.id, Date.now() - startTime)\n      }\n\n      return response\n\n    } catch (error) {\n      // Error logging\n      if (options.logging) {\n        await logApiError(request, error, Date.now() - startTime)\n      }\n\n      return createErrorResponse(error)\n    }\n  }\n}\n\nfunction handleCors(request: NextRequest, corsOptions: any): NextResponse | null {\n  const origin = request.headers.get('origin')\n  const method = request.method\n\n  // Handle preflight requests\n  if (method === 'OPTIONS') {\n    const headers = new Headers()\n\n    if (corsOptions.origin) {\n      if (Array.isArray(corsOptions.origin)) {\n        if (origin && corsOptions.origin.includes(origin)) {\n          headers.set('Access-Control-Allow-Origin', origin)\n        }\n      } else if (corsOptions.origin === '*' || corsOptions.origin === origin) {\n        headers.set('Access-Control-Allow-Origin', corsOptions.origin)\n      }\n    }\n\n    if (corsOptions.methods) {\n      headers.set('Access-Control-Allow-Methods', corsOptions.methods.join(', '))\n    }\n\n    if (corsOptions.headers) {\n      headers.set('Access-Control-Allow-Headers', corsOptions.headers.join(', '))\n    }\n\n    headers.set('Access-Control-Max-Age', '86400')\n\n    return new NextResponse(null, { status: 200, headers })\n  }\n\n  return null\n}\n\nasync function validateRequest(request: NextRequest, validation: any) {\n  // Body validation\n  if (validation.body && ['POST', 'PUT', 'PATCH'].includes(request.method)) {\n    try {\n      const body = await request.json()\n\n      if (typeof validation.body === 'function') {\n        const result = validation.body(body)\n        if (!result.success) {\n          throw new ApiException(\n            `Validation error: ${result.error.issues?.[0]?.message || 'Invalid request body'}`,\n            400,\n            'VALIDATION_ERROR'\n          )\n        }\n      }\n    } catch (error) {\n      if (error instanceof SyntaxError) {\n        throw new ApiException('Invalid JSON in request body', 400, 'INVALID_JSON')\n      }\n      throw error\n    }\n  }\n\n  // Query parameters validation\n  if (validation.query) {\n    const { searchParams } = new URL(request.url)\n    const queryObject = Object.fromEntries(searchParams.entries())\n\n    if (typeof validation.query === 'function') {\n      const result = validation.query(queryObject)\n      if (!result.success) {\n        throw new ApiException(\n          `Query validation error: ${result.error.issues?.[0]?.message || 'Invalid query parameters'}`,\n          400,\n          'QUERY_VALIDATION_ERROR'\n        )\n      }\n    }\n  }\n}\n\nasync function handleAuthentication(request: NextRequest) {\n  const supabase = await createClient()\n\n  const {\n    data: { user },\n    error: authError\n  } = await supabase.auth.getUser()\n\n  if (authError || !user) {\n    throw new ApiException('Authentication required', 401, 'UNAUTHORIZED')\n  }\n\n  // Get user profile with organization\n  const { data: profile, error: profileError } = await supabase\n    .from('profiles')\n    .select('*, organization:organizations(*)')\n    .eq('id', user.id)\n    .single()\n\n  if (profileError) {\n    console.error('Error fetching user profile:', profileError)\n    throw new ApiException('Failed to fetch user profile', 500, 'PROFILE_ERROR')\n  }\n\n  return { user, profile }\n}\n\nasync function logApiRequest(\n  request: NextRequest,\n  response: NextResponse,\n  userId?: string,\n  duration?: number\n) {\n  try {\n    const supabase = await createClient()\n\n    const logData = {\n      method: request.method,\n      url: request.url,\n      user_agent: request.headers.get('user-agent'),\n      ip_address: getClientIP(request),\n      user_id: userId,\n      status_code: response.status,\n      duration_ms: duration,\n      timestamp: new Date().toISOString()\n    }\n\n    await supabase\n      .from('api_logs')\n      .insert(logData)\n  } catch (error) {\n    console.error('Failed to log API request:', error)\n  }\n}\n\nasync function logApiError(\n  request: NextRequest,\n  error: any,\n  duration?: number\n) {\n  try {\n    const supabase = await createClient()\n\n    const errorData = {\n      method: request.method,\n      url: request.url,\n      error_message: error.message,\n      error_stack: error.stack,\n      error_code: error.code || 'UNKNOWN_ERROR',\n      user_agent: request.headers.get('user-agent'),\n      ip_address: getClientIP(request),\n      duration_ms: duration,\n      timestamp: new Date().toISOString()\n    }\n\n    await supabase\n      .from('api_error_logs')\n      .insert(errorData)\n  } catch (logError) {\n    console.error('Failed to log API error:', logError)\n  }\n}\n\nfunction getClientIP(request: NextRequest): string {\n  const forwarded = request.headers.get('x-forwarded-for')\n  const real = request.headers.get('x-real-ip')\n  const cf = request.headers.get('cf-connecting-ip')\n\n  if (forwarded) {\n    return forwarded.split(',')[0].trim()\n  }\n\n  return real || cf || 'unknown'\n}\n\n// Pre-configured middleware combinations for common use cases\n\nexport const withAuth = (handler: any) => withApiMiddleware(handler, {\n  requireAuth: true,\n  logging: true,\n  rateLimiting: {\n    windowMs: 60 * 1000, // 1 minute\n    max: 100 // 100 requests per minute\n  }\n})\n\nexport const withOrganization = (handler: any) => withApiMiddleware(handler, {\n  requireAuth: true,\n  requireOrganization: true,\n  logging: true,\n  rateLimiting: {\n    windowMs: 60 * 1000,\n    max: 100\n  }\n})\n\nexport const withStrictRateLimit = (handler: any) => withApiMiddleware(handler, {\n  requireAuth: true,\n  requireOrganization: true,\n  logging: true,\n  rateLimiting: {\n    windowMs: 60 * 1000, // 1 minute\n    max: 10 // 10 requests per minute\n  }\n})\n\nexport const withPublicAccess = (handler: any) => withApiMiddleware(handler, {\n  requireAuth: false,\n  logging: true,\n  rateLimiting: {\n    windowMs: 60 * 1000,\n    max: 50 // 50 requests per minute for public endpoints\n  },\n  cors: {\n    origin: '*',\n    methods: ['GET', 'POST', 'OPTIONS'],\n    headers: ['Content-Type', 'Authorization']\n  }\n})\n\n// Webhook middleware with different rate limiting\nexport const withWebhook = (handler: any) => withApiMiddleware(handler, {\n  requireAuth: false,\n  logging: true,\n  rateLimiting: {\n    windowMs: 60 * 1000,\n    max: 1000, // Higher limit for webhooks\n    keyGenerator: (request) => request.headers.get('x-forwarded-for') || 'webhook'\n  }\n})"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}