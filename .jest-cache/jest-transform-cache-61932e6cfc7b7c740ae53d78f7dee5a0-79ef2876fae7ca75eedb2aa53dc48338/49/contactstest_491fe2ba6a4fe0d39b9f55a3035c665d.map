{"version":3,"sources":["C:\\Ai Projecten\\ADSapp\\tests\\integration\\api\\contacts.test.ts"],"sourcesContent":["/**\n * Contacts API Integration Tests\n *\n * Tests for /api/contacts endpoints including CRUD operations,\n * search/filtering, and multi-tenant isolation.\n */\n\nimport { describe, it, expect, beforeEach, jest } from '@jest/globals'\nimport { NextRequest } from 'next/server'\nimport {\n  createAuthenticatedRequest as createAuthReq,\n  parseResponse,\n  expectErrorResponse,\n  createPaginatedUrl,\n  expectPaginatedResponse,\n} from '../../utils/api-test-helpers'\nimport {\n  createMockUser,\n  createMockContact,\n  createMockSupabaseClient,\n  generateMockContacts,\n} from '../../utils/test-helpers'\n\njest.mock('@/lib/supabase/server')\n\n// Helper wrapper for backward compatibility with test signatures\nfunction createAuthenticatedRequest(method: string, url: string, userId: string, organizationId: string, body?: any) {\n  const fullUrl = url.startsWith('http') ? url : `http://localhost:3000${url}`\n  return createAuthReq({\n    method,\n    url: fullUrl,\n    body,\n    user: { id: userId },\n    organizationId,\n  })\n}\n\ndescribe('GET /api/contacts', () => {\n  let mockSupabase: any\n  let mockUser: any\n  let mockContacts: any[]\n\n  beforeEach(() => {\n    mockSupabase = createMockSupabaseClient()\n    mockUser = createMockUser()\n    mockContacts = generateMockContacts(15, { organization_id: mockUser.organization_id })\n    jest.clearAllMocks()\n  })\n\n  it('should list contacts with pagination', async () => {\n    mockSupabase.from = jest.fn().mockReturnValue({\n      select: jest.fn().mockReturnThis(),\n      eq: jest.fn().mockReturnThis(),\n      order: jest.fn().mockReturnThis(),\n      range: jest.fn().mockResolvedValue({\n        data: mockContacts.slice(0, 10),\n        error: null,\n        count: 15,\n      }),\n    })\n\n    const url = createPaginatedUrl('/api/contacts', { page: 1, limit: 10 })\n    const request = createAuthenticatedRequest('GET', url, mockUser.id, mockUser.organization_id)\n\n    const response = await simulateGetContacts(request, mockSupabase, mockUser)\n    const { status, data } = await parseResponse(response)\n\n    expect(status).toBe(200)\n    expectPaginatedResponse(data)\n    expect(data.contacts).toHaveLength(10)\n    expect(data.pagination.total).toBe(15)\n    expect(data.pagination.hasMore).toBe(true)\n  })\n\n  it('should filter contacts by search term', async () => {\n    const searchResults = mockContacts.filter(c => c.name.includes('John'))\n\n    mockSupabase.from = jest.fn().mockReturnValue({\n      select: jest.fn().mockReturnThis(),\n      eq: jest.fn().mockReturnThis(),\n      or: jest.fn().mockReturnThis(),\n      order: jest.fn().mockReturnThis(),\n      range: jest.fn().mockResolvedValue({\n        data: searchResults,\n        error: null,\n        count: searchResults.length,\n      }),\n    })\n\n    const url = '/api/contacts?search=John'\n    const request = createAuthenticatedRequest('GET', url, mockUser.id, mockUser.organization_id)\n\n    const response = await simulateGetContacts(request, mockSupabase, mockUser)\n    const { status, data } = await parseResponse(response)\n\n    expect(status).toBe(200)\n    expect(data.filters.search).toBe('John')\n  })\n\n  it('should enforce tenant isolation - cannot see other org contacts', async () => {\n    const otherOrgContact = createMockContact({ organization_id: 'different-org-id' })\n\n    mockSupabase.from = jest.fn().mockReturnValue({\n      select: jest.fn().mockReturnThis(),\n      eq: jest.fn().mockImplementation((field: string, value: string) => {\n        // Verify that organization_id filter is applied\n        expect(field).toBe('organization_id')\n        expect(value).toBe(mockUser.organization_id)\n        return {\n          order: jest.fn().mockReturnThis(),\n          range: jest.fn().mockResolvedValue({\n            data: mockContacts, // Only org's contacts\n            error: null,\n            count: mockContacts.length,\n          }),\n        }\n      }),\n    })\n\n    const request = createAuthenticatedRequest('GET', '/api/contacts', mockUser.id, mockUser.organization_id)\n\n    const response = await simulateGetContacts(request, mockSupabase, mockUser)\n    const { status, data } = await parseResponse(response)\n\n    expect(status).toBe(200)\n    // Verify no contacts from other organizations\n    data.contacts.forEach((contact: any) => {\n      expect(contact.organization_id).toBe(mockUser.organization_id)\n    })\n  })\n\n  it('should filter by tags', async () => {\n    const vipContacts = mockContacts.filter(c => c.tags?.includes('vip'))\n\n    mockSupabase.from = jest.fn().mockReturnValue({\n      select: jest.fn().mockReturnThis(),\n      eq: jest.fn().mockReturnThis(),\n      overlaps: jest.fn().mockReturnThis(),\n      order: jest.fn().mockReturnThis(),\n      range: jest.fn().mockResolvedValue({\n        data: vipContacts,\n        error: null,\n        count: vipContacts.length,\n      }),\n    })\n\n    const url = '/api/contacts?tags=vip'\n    const request = createAuthenticatedRequest('GET', url, mockUser.id, mockUser.organization_id)\n\n    const response = await simulateGetContacts(request, mockSupabase, mockUser)\n    const { status, data } = await parseResponse(response)\n\n    expect(status).toBe(200)\n    expect(data.filters.tags).toContain('vip')\n  })\n})\n\ndescribe('POST /api/contacts', () => {\n  let mockSupabase: any\n  let mockUser: any\n\n  beforeEach(() => {\n    mockSupabase = createMockSupabaseClient()\n    mockUser = createMockUser()\n    jest.clearAllMocks()\n  })\n\n  it('should create new contact with valid data', async () => {\n    const newContactData = {\n      phone_number: '+15551234567',\n      name: 'New Contact',\n      email: 'newcontact@example.com',\n      tags: ['customer'],\n    }\n\n    mockSupabase.from = jest.fn().mockImplementation((table: string) => {\n      if (table === 'contacts') {\n        return {\n          select: jest.fn().mockReturnThis(),\n          eq: jest.fn().mockReturnThis(),\n          single: jest.fn().mockResolvedValue({ data: null, error: null }), // No duplicate\n          insert: jest.fn().mockReturnThis(),\n        }\n      }\n      return {\n        insert: jest.fn().mockReturnThis(),\n        select: jest.fn().mockReturnThis(),\n        single: jest.fn().mockResolvedValue({\n          data: { ...newContactData, id: 'new-contact-id', organization_id: mockUser.organization_id },\n          error: null,\n        }),\n      }\n    })\n\n    const request = createAuthenticatedRequest('POST', '/api/contacts', mockUser.id, mockUser.organization_id, newContactData)\n\n    const response = await simulateCreateContact(request, mockSupabase, mockUser)\n    const { status, data } = await parseResponse(response)\n\n    expect(status).toBe(201)\n    expect(data.phone_number).toBe(newContactData.phone_number)\n    expect(data.organization_id).toBe(mockUser.organization_id)\n  })\n\n  it('should reject duplicate phone number in same organization', async () => {\n    const existingContact = createMockContact({ organization_id: mockUser.organization_id })\n\n    mockSupabase.from = jest.fn().mockReturnValue({\n      select: jest.fn().mockReturnThis(),\n      eq: jest.fn().mockReturnThis(),\n      single: jest.fn().mockResolvedValue({\n        data: existingContact,\n        error: null,\n      }),\n    })\n\n    const request = createAuthenticatedRequest(\n      'POST',\n      '/api/contacts',\n      mockUser.id,\n      mockUser.organization_id,\n      { phone_number: existingContact.phone_number, name: 'Duplicate' }\n    )\n\n    const response = await simulateCreateContact(request, mockSupabase, mockUser)\n    const { status, data } = await parseResponse(response)\n\n    expect(status).toBe(409)\n    expectErrorResponse(data, 409, 'already exists')\n  })\n\n  it('should validate phone number format', async () => {\n    const request = createAuthenticatedRequest(\n      'POST',\n      '/api/contacts',\n      mockUser.id,\n      mockUser.organization_id,\n      { phone_number: 'invalid', name: 'Test' }\n    )\n\n    const response = await simulateCreateContact(request, mockSupabase, mockUser)\n    const { status, data } = await parseResponse(response)\n\n    expect(status).toBe(400)\n    expectErrorResponse(data, 400, 'Invalid phone number format')\n  })\n\n  it('should require phone number field', async () => {\n    const request = createAuthenticatedRequest(\n      'POST',\n      '/api/contacts',\n      mockUser.id,\n      mockUser.organization_id,\n      { name: 'Test Contact' }\n    )\n\n    const response = await simulateCreateContact(request, mockSupabase, mockUser)\n    const { status, data } = await parseResponse(response)\n\n    expect(status).toBe(400)\n    expectErrorResponse(data, 400, 'Phone number is required')\n  })\n})\n\ndescribe('PUT /api/contacts/[id]', () => {\n  let mockSupabase: any\n  let mockUser: any\n  let mockContact: any\n\n  beforeEach(() => {\n    mockSupabase = createMockSupabaseClient()\n    mockUser = createMockUser()\n    mockContact = createMockContact({ organization_id: mockUser.organization_id })\n    jest.clearAllMocks()\n  })\n\n  it('should update contact with valid data', async () => {\n    const updateData = { name: 'Updated Name', tags: ['vip'] }\n\n    mockSupabase.from = jest.fn().mockReturnValue({\n      select: jest.fn().mockReturnThis(),\n      eq: jest.fn().mockReturnThis(),\n      single: jest.fn().mockResolvedValue({ data: mockContact, error: null }),\n      update: jest.fn().mockReturnThis(),\n    })\n\n    const request = createAuthenticatedRequest(\n      'PUT',\n      `/api/contacts/${mockContact.id}`,\n      mockUser.id,\n      mockUser.organization_id,\n      updateData\n    )\n\n    const response = await simulateUpdateContact(request, mockSupabase, mockUser, mockContact.id)\n    const { status, data } = await parseResponse(response)\n\n    expect(status).toBe(200)\n    expect(data.name).toBe(updateData.name)\n  })\n\n  it('should prevent updating contact from different organization', async () => {\n    const otherOrgContact = createMockContact({ organization_id: 'different-org-id' })\n\n    mockSupabase.from = jest.fn().mockReturnValue({\n      select: jest.fn().mockReturnThis(),\n      eq: jest.fn().mockReturnThis(),\n      single: jest.fn().mockResolvedValue({ data: null, error: { code: 'PGRST116' } }),\n    })\n\n    const request = createAuthenticatedRequest(\n      'PUT',\n      `/api/contacts/${otherOrgContact.id}`,\n      mockUser.id,\n      mockUser.organization_id,\n      { name: 'Hacked' }\n    )\n\n    const response = await simulateUpdateContact(request, mockSupabase, mockUser, otherOrgContact.id)\n    const { status, data } = await parseResponse(response)\n\n    expect(status).toBe(404)\n    expectErrorResponse(data, 404, 'not found')\n  })\n})\n\ndescribe('DELETE /api/contacts/[id]', () => {\n  let mockSupabase: any\n  let mockUser: any\n  let mockContact: any\n\n  beforeEach(() => {\n    mockSupabase = createMockSupabaseClient()\n    mockUser = createMockUser()\n    mockContact = createMockContact({ organization_id: mockUser.organization_id })\n    jest.clearAllMocks()\n  })\n\n  it('should soft delete contact', async () => {\n    mockSupabase.from = jest.fn().mockReturnValue({\n      select: jest.fn().mockReturnThis(),\n      eq: jest.fn().mockReturnThis(),\n      single: jest.fn().mockResolvedValue({ data: mockContact, error: null }),\n      update: jest.fn().mockReturnThis(),\n    })\n\n    const request = createAuthenticatedRequest(\n      'DELETE',\n      `/api/contacts/${mockContact.id}`,\n      mockUser.id,\n      mockUser.organization_id\n    )\n\n    const response = await simulateDeleteContact(request, mockSupabase, mockUser, mockContact.id)\n    const { status, data } = await parseResponse(response)\n\n    expect(status).toBe(200)\n    expect(data.message).toContain('deleted')\n  })\n\n  it('should prevent deleting contact from different organization', async () => {\n    const otherOrgContact = createMockContact({ organization_id: 'different-org-id' })\n\n    mockSupabase.from = jest.fn().mockReturnValue({\n      select: jest.fn().mockReturnThis(),\n      eq: jest.fn().mockReturnThis(),\n      single: jest.fn().mockResolvedValue({ data: null, error: { code: 'PGRST116' } }),\n    })\n\n    const request = createAuthenticatedRequest(\n      'DELETE',\n      `/api/contacts/${otherOrgContact.id}`,\n      mockUser.id,\n      mockUser.organization_id\n    )\n\n    const response = await simulateDeleteContact(request, mockSupabase, mockUser, otherOrgContact.id)\n    const { status, data } = await parseResponse(response)\n\n    expect(status).toBe(404)\n    expectErrorResponse(data, 404, 'not found')\n  })\n})\n\n// =============================================================================\n// Helper Functions to Simulate API Route Handlers\n// =============================================================================\n\nasync function simulateGetContacts(request: NextRequest, supabase: any, user: any): Promise<any> {\n  try {\n    const { searchParams } = new URL(request.url)\n    const search = searchParams.get('search')\n    const tags = searchParams.get('tags')?.split(',')\n    const page = parseInt(searchParams.get('page') || '1')\n    const limit = parseInt(searchParams.get('limit') || '20')\n    const offset = (page - 1) * limit\n\n    let query = supabase.from('contacts').select('*', { count: 'exact' }).eq('organization_id', user.organization_id)\n\n    if (search) {\n      query = query.or(`name.ilike.%${search}%,phone_number.ilike.%${search}%`)\n    }\n\n    if (tags && tags.length > 0) {\n      query = query.overlaps('tags', tags)\n    }\n\n    const { data: contacts, error, count } = await query.order('created_at', { ascending: false }).range(offset, offset + limit - 1)\n\n    if (error) throw error\n\n    return new Response(\n      JSON.stringify({\n        contacts,\n        pagination: {\n          page,\n          limit,\n          total: count || 0,\n          hasMore: offset + limit < (count || 0),\n        },\n        filters: { search, tags },\n      }),\n      { status: 200, headers: { 'Content-Type': 'application/json' } }\n    )\n  } catch (error: any) {\n    return new Response(JSON.stringify({ error: error.message }), {\n      status: 500,\n      headers: { 'Content-Type': 'application/json' },\n    })\n  }\n}\n\nasync function simulateCreateContact(request: NextRequest, supabase: any, user: any): Promise<any> {\n  try {\n    const body = await request.json()\n    const { phone_number, name, email, tags } = body\n\n    if (!phone_number) {\n      return new Response(JSON.stringify({ error: 'Phone number is required' }), {\n        status: 400,\n        headers: { 'Content-Type': 'application/json' },\n      })\n    }\n\n    const phoneRegex = /^\\+?[1-9]\\d{1,14}$/\n    if (!phoneRegex.test(phone_number.replace(/[\\s-()]/g, ''))) {\n      return new Response(JSON.stringify({ error: 'Invalid phone number format' }), {\n        status: 400,\n        headers: { 'Content-Type': 'application/json' },\n      })\n    }\n\n    // Check for duplicates\n    const { data: existingContact } = await supabase\n      .from('contacts')\n      .select('id')\n      .eq('organization_id', user.organization_id)\n      .eq('phone_number', phone_number)\n      .single()\n\n    if (existingContact) {\n      return new Response(JSON.stringify({ error: 'Contact with this phone number already exists' }), {\n        status: 409,\n        headers: { 'Content-Type': 'application/json' },\n      })\n    }\n\n    // Create contact\n    const { data: contact, error } = await supabase\n      .from('contacts')\n      .insert({\n        organization_id: user.organization_id,\n        phone_number,\n        name,\n        email,\n        tags,\n      })\n      .select()\n      .single()\n\n    if (error) throw error\n\n    return new Response(JSON.stringify(contact), {\n      status: 201,\n      headers: { 'Content-Type': 'application/json' },\n    })\n  } catch (error: any) {\n    return new Response(JSON.stringify({ error: error.message }), {\n      status: 500,\n      headers: { 'Content-Type': 'application/json' },\n    })\n  }\n}\n\nasync function simulateUpdateContact(request: NextRequest, supabase: any, user: any, contactId: string): Promise<any> {\n  try {\n    const body = await request.json()\n\n    // Check contact exists and belongs to organization\n    const { data: contact, error: fetchError } = await supabase\n      .from('contacts')\n      .select('*')\n      .eq('id', contactId)\n      .eq('organization_id', user.organization_id)\n      .single()\n\n    if (fetchError || !contact) {\n      return new Response(JSON.stringify({ error: 'Contact not found' }), {\n        status: 404,\n        headers: { 'Content-Type': 'application/json' },\n      })\n    }\n\n    // Update contact\n    const { data: updated, error } = await supabase\n      .from('contacts')\n      .update(body)\n      .eq('id', contactId)\n      .eq('organization_id', user.organization_id)\n      .select()\n      .single()\n\n    if (error) throw error\n\n    return new Response(JSON.stringify(updated), {\n      status: 200,\n      headers: { 'Content-Type': 'application/json' },\n    })\n  } catch (error: any) {\n    return new Response(JSON.stringify({ error: error.message }), {\n      status: 500,\n      headers: { 'Content-Type': 'application/json' },\n    })\n  }\n}\n\nasync function simulateDeleteContact(request: NextRequest, supabase: any, user: any, contactId: string): Promise<any> {\n  try {\n    // Check contact exists and belongs to organization\n    const { data: contact, error: fetchError } = await supabase\n      .from('contacts')\n      .select('*')\n      .eq('id', contactId)\n      .eq('organization_id', user.organization_id)\n      .single()\n\n    if (fetchError || !contact) {\n      return new Response(JSON.stringify({ error: 'Contact not found' }), {\n        status: 404,\n        headers: { 'Content-Type': 'application/json' },\n      })\n    }\n\n    // Soft delete\n    const { error } = await supabase\n      .from('contacts')\n      .update({ deleted_at: new Date().toISOString() })\n      .eq('id', contactId)\n      .eq('organization_id', user.organization_id)\n\n    if (error) throw error\n\n    return new Response(JSON.stringify({ message: 'Contact deleted successfully' }), {\n      status: 200,\n      headers: { 'Content-Type': 'application/json' },\n    })\n  } catch (error: any) {\n    return new Response(JSON.stringify({ error: error.message }), {\n      status: 500,\n      headers: { 'Content-Type': 'application/json' },\n    })\n  }\n}\n"],"names":["jest","mock","createAuthenticatedRequest","method","url","userId","organizationId","body","fullUrl","startsWith","createAuthReq","user","id","describe","mockSupabase","mockUser","mockContacts","beforeEach","createMockSupabaseClient","createMockUser","generateMockContacts","organization_id","clearAllMocks","it","from","fn","mockReturnValue","select","mockReturnThis","eq","order","range","mockResolvedValue","data","slice","error","count","createPaginatedUrl","page","limit","request","response","simulateGetContacts","status","parseResponse","expect","toBe","expectPaginatedResponse","contacts","toHaveLength","pagination","total","hasMore","searchResults","filter","c","name","includes","or","length","filters","search","otherOrgContact","createMockContact","mockImplementation","field","value","forEach","contact","vipContacts","tags","overlaps","toContain","newContactData","phone_number","email","table","single","insert","simulateCreateContact","existingContact","expectErrorResponse","mockContact","updateData","update","simulateUpdateContact","code","simulateDeleteContact","message","supabase","searchParams","URL","get","split","parseInt","offset","query","ascending","Response","JSON","stringify","headers","json","phoneRegex","test","replace","contactId","fetchError","updated","deleted_at","Date","toISOString"],"mappings":"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"}