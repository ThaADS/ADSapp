{"version":3,"names":["GET","cov_2kr9tdcgh8","f","s","POST","request","user","_apiutils","requireAuthenticatedUser","profile","getUserOrganization","id","searchParams","URL","url","status","get","type","page","limit","offset","validatePagination","queue","_queue","BulkOperationQueue","result","listOperations","organization_id","createSuccessResponse","operations","pagination","total","hasMore","error","console","createErrorResponse","body","json","configuration","b","_server","NextResponse","totalItems","messageConfig","message","recipients","length","invalidRecipients","filter","r","phoneNumber","contactId","messageLimit","checkMessageLimit","allowed","reason","importConfig","file","mapping","estimateFileSize","format","supabase","_server1","createClient","count","from","select","eq","convCount","estimateConversationsToClose","operation","createOperation","organizationId","userId","queueOperationForProcessing","messageCount","data","org","single","subscription_status","limits","starter","professional","enterprise","subscription_tier","today","Date","toISOString","split","dailyUsage","messagesUsedToday","messages_sent","dailyLimit","fileUrl","response","fetch","method","contentLength","headers","fileSizeBytes","parseInt","estimatedRows","Math","floor","max","config","query","olderThanDays","cutoffDate","now","lt","operationId","log"],"sources":["C:\\Ai Projecten\\ADSapp\\src\\app\\api\\bulk\\operations\\route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server'\nimport { requireAuthenticatedUser, getUserOrganization, createErrorResponse, createSuccessResponse, validatePagination } from '@/lib/api-utils'\nimport { BulkOperationQueue, BulkMessageConfig, BulkContactImportConfig } from '@/lib/bulk-operations/queue'\nimport { createClient } from '@/lib/supabase/server'\n\nexport async function GET(request: NextRequest) {\n  try {\n    // Authenticate user\n    const user = await requireAuthenticatedUser()\n    const profile = await getUserOrganization(user.id)\n\n    const { searchParams } = new URL(request.url)\n    const status = searchParams.get('status') as any\n    const type = searchParams.get('type') as any\n    const { page, limit, offset } = validatePagination(request)\n\n    const queue = new BulkOperationQueue()\n    const result = await queue.listOperations(profile.organization_id, {\n      status,\n      type,\n      limit,\n      offset\n    })\n\n    return createSuccessResponse({\n      operations: result.operations,\n      pagination: {\n        page,\n        limit,\n        total: result.total,\n        hasMore: offset + limit < result.total\n      }\n    })\n\n  } catch (error) {\n    console.error('List bulk operations error:', error)\n    return createErrorResponse(error)\n  }\n}\n\nexport async function POST(request: NextRequest) {\n  try {\n    // Authenticate user\n    const user = await requireAuthenticatedUser()\n    const profile = await getUserOrganization(user.id)\n\n    const body = await request.json()\n    const { type, configuration } = body\n\n    if (!type || !configuration) {\n      return NextResponse.json(\n        { error: 'Type and configuration are required' },\n        { status: 400 }\n      )\n    }\n\n    // Validate configuration based on type\n    let totalItems: number\n\n    switch (type) {\n      case 'bulk_message':\n        const messageConfig = configuration as BulkMessageConfig\n        if (!messageConfig.message || !messageConfig.recipients) {\n          return NextResponse.json(\n            { error: 'Message and recipients are required for bulk message operation' },\n            { status: 400 }\n          )\n        }\n        totalItems = messageConfig.recipients.length\n\n        // Validate recipients\n        const invalidRecipients = messageConfig.recipients.filter(r => !r.phoneNumber || !r.contactId)\n        if (invalidRecipients.length > 0) {\n          return NextResponse.json(\n            { error: 'All recipients must have phoneNumber and contactId' },\n            { status: 400 }\n          )\n        }\n\n        // Check organization limits\n        const messageLimit = await checkMessageLimit(profile.organization_id, totalItems)\n        if (!messageLimit.allowed) {\n          return NextResponse.json(\n            { error: messageLimit.reason },\n            { status: 429 }\n          )\n        }\n        break\n\n      case 'bulk_contact_import':\n        const importConfig = configuration as BulkContactImportConfig\n        if (!importConfig.file || !importConfig.mapping) {\n          return NextResponse.json(\n            { error: 'File and mapping are required for bulk contact import' },\n            { status: 400 }\n          )\n        }\n\n        // Estimate total items from file (this is approximate)\n        totalItems = await estimateFileSize(importConfig.file.url, importConfig.file.format)\n        break\n\n      case 'bulk_contact_export':\n        // Get total contacts for export\n        const supabase = await createClient()\n        const { count } = await supabase\n          .from('contacts')\n          .select('id', { count: 'exact' })\n          .eq('organization_id', profile.organization_id)\n\n        totalItems = count || 0\n        break\n\n      case 'bulk_conversation_close':\n        // Estimate conversations to close\n        const convCount = await estimateConversationsToClose(profile.organization_id, configuration)\n        totalItems = convCount\n        break\n\n      default:\n        return NextResponse.json(\n          { error: 'Invalid operation type' },\n          { status: 400 }\n        )\n    }\n\n    // Create the bulk operation\n    const queue = new BulkOperationQueue()\n    const operation = await queue.createOperation({\n      organizationId: profile.organization_id,\n      userId: user.id,\n      type,\n      status: 'queued',\n      totalItems,\n      configuration\n    })\n\n    // Queue the operation for processing\n    await queueOperationForProcessing(operation.id)\n\n    return createSuccessResponse(operation, 201)\n\n  } catch (error) {\n    console.error('Create bulk operation error:', error)\n    return createErrorResponse(error)\n  }\n}\n\nasync function checkMessageLimit(organizationId: string, messageCount: number): Promise<{ allowed: boolean; reason?: string }> {\n  const supabase = await createClient()\n\n  // Get organization subscription details\n  const { data: org } = await supabase\n    .from('organizations')\n    .select('subscription_tier, subscription_status')\n    .eq('id', organizationId)\n    .single()\n\n  if (!org) {\n    return { allowed: false, reason: 'Organization not found' }\n  }\n\n  // Check subscription status\n  if (org.subscription_status !== 'active' && org.subscription_status !== 'trial') {\n    return { allowed: false, reason: 'Active subscription required for bulk messaging' }\n  }\n\n  // Check tier limits\n  const limits = {\n    starter: 100,\n    professional: 1000,\n    enterprise: 10000\n  }\n\n  const limit = limits[org.subscription_tier] || 0\n\n  if (messageCount > limit) {\n    return {\n      allowed: false,\n      reason: `Bulk message limit exceeded. Your ${org.subscription_tier} plan allows up to ${limit} messages per operation.`\n    }\n  }\n\n  // Check daily usage (optional additional check)\n  const today = new Date().toISOString().split('T')[0]\n  const { data: dailyUsage } = await supabase\n    .from('daily_analytics')\n    .select('messages_sent')\n    .eq('organization_id', organizationId)\n    .eq('date', today)\n    .single()\n\n  const messagesUsedToday = dailyUsage?.messages_sent || 0\n  const dailyLimit = limits[org.subscription_tier] * 10 // 10x the per-operation limit as daily limit\n\n  if (messagesUsedToday + messageCount > dailyLimit) {\n    return {\n      allowed: false,\n      reason: `Daily message limit would be exceeded. Used: ${messagesUsedToday}, Attempting: ${messageCount}, Daily limit: ${dailyLimit}`\n    }\n  }\n\n  return { allowed: true }\n}\n\nasync function estimateFileSize(fileUrl: string, format: string): Promise<number> {\n  try {\n    // Make a HEAD request to get file size\n    const response = await fetch(fileUrl, { method: 'HEAD' })\n    const contentLength = response.headers.get('content-length')\n\n    if (contentLength) {\n      const fileSizeBytes = parseInt(contentLength)\n\n      // Rough estimates based on file format\n      let estimatedRows: number\n      switch (format) {\n        case 'csv':\n          estimatedRows = Math.floor(fileSizeBytes / 100) // ~100 bytes per row\n          break\n        case 'xlsx':\n          estimatedRows = Math.floor(fileSizeBytes / 200) // ~200 bytes per row\n          break\n        case 'json':\n          estimatedRows = Math.floor(fileSizeBytes / 300) // ~300 bytes per row\n          break\n        default:\n          estimatedRows = Math.floor(fileSizeBytes / 150)\n      }\n\n      return Math.max(1, estimatedRows)\n    }\n\n    return 1000 // Default estimate if size can't be determined\n  } catch (error) {\n    console.error('Error estimating file size:', error)\n    return 1000 // Default estimate\n  }\n}\n\nasync function estimateConversationsToClose(organizationId: string, config: any): Promise<number> {\n  const supabase = await createClient()\n\n  let query = supabase\n    .from('conversations')\n    .select('id', { count: 'exact' })\n    .eq('organization_id', organizationId)\n\n  if (config.status) {\n    query = query.eq('status', config.status)\n  }\n\n  if (config.olderThanDays) {\n    const cutoffDate = new Date(Date.now() - config.olderThanDays * 24 * 60 * 60 * 1000).toISOString()\n    query = query.lt('last_message_at', cutoffDate)\n  }\n\n  const { count } = await query\n\n  return count || 0\n}\n\nasync function queueOperationForProcessing(operationId: string): Promise<void> {\n  // In a real implementation, this would add the operation to a job queue\n  // For now, we'll just log it\n  console.log(`Queued bulk operation ${operationId} for processing`)\n\n  // You could integrate with a job queue system like:\n  // - Bull Queue (Redis-based)\n  // - AWS SQS\n  // - Google Cloud Tasks\n  // - Or implement a simple polling mechanism\n}"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}