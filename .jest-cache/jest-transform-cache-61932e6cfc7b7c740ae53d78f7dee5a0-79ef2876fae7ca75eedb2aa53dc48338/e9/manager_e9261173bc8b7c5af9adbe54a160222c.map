{"version":3,"names":["SessionEventType","cov_gry2sdhft","f","s","SessionManager","getSessionManager","resetSessionManager","constructor","store","b","_redisstore","createRedisSessionStore","createSession","params","userId","organizationId","userRole","deviceInfo","sessionToken","generateSessionToken","session","logSessionToDatabase","logAuditEvent","eventType","metadata","timestamp","Date","toISOString","token","validateSession","getSession","valid","reason","isRevoked","expiresAt","userExists","validateUserExists","revokeSession","orgActive","validateOrganizationActive","refreshSession","validation","success","error","updatedSession","updateSessionActivity","updateSessionInDatabase","revoked","markSessionRevokedInDatabase","revokeAllUserSessions","supabase","_server","createClient","data","profile","from","select","eq","single","organization_id","count","sessionsRevoked","getUserSessions","checkPrivilegeChange","changed","requiresRegeneration","currentRole","getUserRoleFromDatabase","sessionRecord","sessionRole","user_role","oldRole","newRole","regenerateSession","oldSessionToken","oldSession","Error","role","result","_uuid","v4","now","Math","random","toString","substring","insert","user_id","session_token","device_info","created_at","createdAt","last_activity","lastActivity","expires_at","console","update","subscription_status","event","process","env","NODE_ENV","log","Sentry","Promise","resolve","then","_interop_require_wildcard","require","captureMessage","level","extra","getStore","sessionManagerInstance"],"sources":["C:\\Ai Projecten\\ADSapp\\src\\lib\\session\\manager.ts"],"sourcesContent":["import { v4 as uuidv4 } from 'uuid';\nimport { createClient } from '@/lib/supabase/server';\nimport {\n  RedisSessionStore,\n  createRedisSessionStore,\n  RedisSession,\n  DeviceInfo\n} from './redis-store';\n\n/**\n * Session Manager for Enterprise Session Management\n *\n * Provides high-level session management operations including:\n * - Session creation with concurrent limits\n * - Session validation and refresh\n * - Privilege change detection and session regeneration\n * - Multi-device session tracking\n * - Security event logging\n *\n * Security Features:\n * - Automatic session regeneration on privilege changes\n * - Concurrent session limits (max 5 per user)\n * - Session revocation on security events\n * - Device fingerprinting\n * - Audit logging for all session operations\n *\n * @module session-manager\n */\n\n/**\n * Session creation parameters\n */\nexport interface CreateSessionParams {\n  userId: string;\n  organizationId: string;\n  userRole: string;\n  deviceInfo: DeviceInfo;\n}\n\n/**\n * Session validation result\n */\nexport interface SessionValidationResult {\n  valid: boolean;\n  session?: RedisSession;\n  reason?: string;\n}\n\n/**\n * Session refresh result\n */\nexport interface SessionRefreshResult {\n  success: boolean;\n  session?: RedisSession;\n  newToken?: string;\n  error?: string;\n}\n\n/**\n * Privilege change detection result\n */\nexport interface PrivilegeChangeResult {\n  changed: boolean;\n  oldRole?: string;\n  newRole?: string;\n  requiresRegeneration: boolean;\n}\n\n/**\n * Session event types for audit logging\n */\nexport enum SessionEventType {\n  CREATED = 'session_created',\n  VALIDATED = 'session_validated',\n  REFRESHED = 'session_refreshed',\n  REVOKED = 'session_revoked',\n  EXPIRED = 'session_expired',\n  PRIVILEGE_CHANGED = 'privilege_changed',\n  CONCURRENT_LIMIT = 'concurrent_limit_reached',\n  INVALID_TOKEN = 'invalid_token',\n  SECURITY_EVENT = 'security_event'\n}\n\n/**\n * Session audit event\n */\nexport interface SessionAuditEvent {\n  eventType: SessionEventType;\n  userId: string;\n  organizationId: string;\n  sessionToken?: string;\n  deviceInfo?: DeviceInfo;\n  metadata?: Record<string, unknown>;\n  timestamp: string;\n}\n\n/**\n * Session Manager Class\n *\n * Manages enterprise-grade session operations with security features:\n * - Concurrent session management\n * - Privilege-based session regeneration\n * - Comprehensive audit logging\n * - Multi-device tracking\n *\n * @example\n * ```typescript\n * const manager = new SessionManager();\n *\n * // Create session\n * const { session, token } = await manager.createSession({\n *   userId: 'user123',\n *   organizationId: 'org456',\n *   userRole: 'admin',\n *   deviceInfo: { userAgent: '...', ip: '...' }\n * });\n *\n * // Validate session\n * const validation = await manager.validateSession('user123', token);\n * ```\n */\nexport class SessionManager {\n  private store: RedisSessionStore;\n\n  /**\n   * Initialize Session Manager\n   *\n   * @param store - Optional custom Redis session store\n   */\n  constructor(store?: RedisSessionStore) {\n    this.store = store || createRedisSessionStore();\n  }\n\n  /**\n   * Create a new session\n   *\n   * Process:\n   * 1. Generate secure session token\n   * 2. Check concurrent session limits\n   * 3. Create session in Redis\n   * 4. Log session creation to database\n   * 5. Log audit event\n   *\n   * @param params - Session creation parameters\n   * @returns Session object and token\n   * @throws Error if session creation fails\n   *\n   * @example\n   * ```typescript\n   * const result = await manager.createSession({\n   *   userId: 'user123',\n   *   organizationId: 'org456',\n   *   userRole: 'admin',\n   *   deviceInfo: {\n   *     userAgent: 'Mozilla/5.0...',\n   *     ip: '192.168.1.1',\n   *     platform: 'web'\n   *   }\n   * });\n   * ```\n   */\n  async createSession(params: CreateSessionParams): Promise<{\n    session: RedisSession;\n    token: string;\n  }> {\n    const { userId, organizationId, userRole, deviceInfo } = params;\n\n    // Generate secure session token\n    const sessionToken = this.generateSessionToken();\n\n    // Create session in Redis (handles concurrent limits automatically)\n    const session = await this.store.createSession({\n      userId,\n      organizationId,\n      sessionToken,\n      deviceInfo\n    });\n\n    // Log session to database\n    await this.logSessionToDatabase(session, userRole);\n\n    // Log audit event\n    await this.logAuditEvent({\n      eventType: SessionEventType.CREATED,\n      userId,\n      organizationId,\n      sessionToken,\n      deviceInfo,\n      metadata: { userRole },\n      timestamp: new Date().toISOString()\n    });\n\n    return {\n      session,\n      token: sessionToken\n    };\n  }\n\n  /**\n   * Validate a session\n   *\n   * Checks:\n   * 1. Session exists in Redis\n   * 2. Not expired\n   * 3. Not revoked\n   * 4. User still exists in database\n   * 5. Organization still active\n   *\n   * @param userId - User ID\n   * @param sessionToken - Session token\n   * @returns Validation result\n   *\n   * @example\n   * ```typescript\n   * const validation = await manager.validateSession('user123', 'token789');\n   * if (validation.valid) {\n   *   // Session is valid\n   * } else {\n   *   // Session invalid: validation.reason\n   * }\n   * ```\n   */\n  async validateSession(\n    userId: string,\n    sessionToken: string\n  ): Promise<SessionValidationResult> {\n    // Get session from Redis\n    const session = await this.store.getSession(userId, sessionToken);\n\n    if (!session) {\n      await this.logAuditEvent({\n        eventType: SessionEventType.INVALID_TOKEN,\n        userId,\n        organizationId: '',\n        sessionToken,\n        timestamp: new Date().toISOString()\n      });\n\n      return {\n        valid: false,\n        reason: 'Session not found or expired'\n      };\n    }\n\n    // Check if session is revoked\n    if (session.isRevoked) {\n      return {\n        valid: false,\n        reason: 'Session has been revoked'\n      };\n    }\n\n    // Check if session is expired\n    if (new Date(session.expiresAt) < new Date()) {\n      await this.logAuditEvent({\n        eventType: SessionEventType.EXPIRED,\n        userId,\n        organizationId: session.organizationId,\n        sessionToken,\n        timestamp: new Date().toISOString()\n      });\n\n      return {\n        valid: false,\n        reason: 'Session has expired'\n      };\n    }\n\n    // Validate user still exists\n    const userExists = await this.validateUserExists(userId);\n    if (!userExists) {\n      await this.store.revokeSession(userId, sessionToken);\n      return {\n        valid: false,\n        reason: 'User no longer exists'\n      };\n    }\n\n    // Validate organization still active\n    const orgActive = await this.validateOrganizationActive(\n      session.organizationId\n    );\n    if (!orgActive) {\n      await this.store.revokeSession(userId, sessionToken);\n      return {\n        valid: false,\n        reason: 'Organization is not active'\n      };\n    }\n\n    // Log validation event\n    await this.logAuditEvent({\n      eventType: SessionEventType.VALIDATED,\n      userId,\n      organizationId: session.organizationId,\n      sessionToken,\n      timestamp: new Date().toISOString()\n    });\n\n    return {\n      valid: true,\n      session\n    };\n  }\n\n  /**\n   * Refresh session activity\n   *\n   * Updates last activity timestamp and extends TTL.\n   * Called by middleware on each authenticated request.\n   *\n   * @param userId - User ID\n   * @param sessionToken - Session token\n   * @returns Updated session or null\n   *\n   * @example\n   * ```typescript\n   * // Called by session middleware\n   * const session = await manager.refreshSession('user123', 'token789');\n   * ```\n   */\n  async refreshSession(\n    userId: string,\n    sessionToken: string\n  ): Promise<SessionRefreshResult> {\n    // Validate session first\n    const validation = await this.validateSession(userId, sessionToken);\n\n    if (!validation.valid) {\n      return {\n        success: false,\n        error: validation.reason\n      };\n    }\n\n    // Update activity in Redis\n    const updatedSession = await this.store.updateSessionActivity(\n      userId,\n      sessionToken\n    );\n\n    if (!updatedSession) {\n      return {\n        success: false,\n        error: 'Failed to update session activity'\n      };\n    }\n\n    // Update database record\n    await this.updateSessionInDatabase(updatedSession);\n\n    // Log refresh event\n    await this.logAuditEvent({\n      eventType: SessionEventType.REFRESHED,\n      userId,\n      organizationId: updatedSession.organizationId,\n      sessionToken,\n      timestamp: new Date().toISOString()\n    });\n\n    return {\n      success: true,\n      session: updatedSession\n    };\n  }\n\n  /**\n   * Revoke a specific session\n   *\n   * Used for:\n   * - User logout from specific device\n   * - Security events\n   * - Administrative actions\n   *\n   * @param userId - User ID\n   * @param sessionToken - Session token\n   * @returns True if revoked successfully\n   *\n   * @example\n   * ```typescript\n   * // User logs out from one device\n   * await manager.revokeSession('user123', 'token789');\n   * ```\n   */\n  async revokeSession(userId: string, sessionToken: string): Promise<boolean> {\n    const session = await this.store.getSession(userId, sessionToken);\n\n    if (!session) {\n      return false;\n    }\n\n    // Revoke in Redis\n    const revoked = await this.store.revokeSession(userId, sessionToken);\n\n    if (revoked) {\n      // Update database\n      await this.markSessionRevokedInDatabase(sessionToken);\n\n      // Log audit event\n      await this.logAuditEvent({\n        eventType: SessionEventType.REVOKED,\n        userId,\n        organizationId: session.organizationId,\n        sessionToken,\n        timestamp: new Date().toISOString()\n      });\n    }\n\n    return revoked;\n  }\n\n  /**\n   * Revoke all sessions for a user\n   *\n   * Used for:\n   * - Password changes\n   * - Account compromise\n   * - Security policies\n   * - Manual user action\n   *\n   * @param userId - User ID\n   * @param reason - Reason for revocation\n   * @returns Number of sessions revoked\n   *\n   * @example\n   * ```typescript\n   * // User changes password\n   * const count = await manager.revokeAllUserSessions(\n   *   'user123',\n   *   'password_changed'\n   * );\n   * ```\n   */\n  async revokeAllUserSessions(\n    userId: string,\n    reason: string\n  ): Promise<number> {\n    // Get user's organization\n    const supabase = await createClient();\n    const { data: profile } = await supabase\n      .from('profiles')\n      .select('organization_id')\n      .eq('id', userId)\n      .single();\n\n    const organizationId = profile?.organization_id || '';\n\n    // Revoke all sessions in Redis\n    const count = await this.store.revokeAllUserSessions(userId);\n\n    // Log audit event\n    await this.logAuditEvent({\n      eventType: SessionEventType.SECURITY_EVENT,\n      userId,\n      organizationId,\n      metadata: {\n        reason,\n        sessionsRevoked: count\n      },\n      timestamp: new Date().toISOString()\n    });\n\n    return count;\n  }\n\n  /**\n   * Get all active sessions for a user\n   *\n   * @param userId - User ID\n   * @returns Array of active sessions\n   *\n   * @example\n   * ```typescript\n   * const sessions = await manager.getUserSessions('user123');\n   * console.log(`User has ${sessions.length} active sessions`);\n   * ```\n   */\n  async getUserSessions(userId: string): Promise<RedisSession[]> {\n    return this.store.getUserSessions(userId);\n  }\n\n  /**\n   * Check for privilege changes\n   *\n   * Compares session role with current user role in database.\n   * Triggers session regeneration if privileges changed.\n   *\n   * @param userId - User ID\n   * @param sessionToken - Session token\n   * @returns Privilege change result\n   *\n   * @example\n   * ```typescript\n   * const result = await manager.checkPrivilegeChange('user123', 'token789');\n   * if (result.requiresRegeneration) {\n   *   await manager.regenerateSession('user123', 'token789');\n   * }\n   * ```\n   */\n  async checkPrivilegeChange(\n    userId: string,\n    sessionToken: string\n  ): Promise<PrivilegeChangeResult> {\n    // Get current session\n    const session = await this.store.getSession(userId, sessionToken);\n\n    if (!session) {\n      return {\n        changed: false,\n        requiresRegeneration: false\n      };\n    }\n\n    // Get current user role from database\n    const currentRole = await this.getUserRoleFromDatabase(userId);\n\n    if (!currentRole) {\n      return {\n        changed: false,\n        requiresRegeneration: false\n      };\n    }\n\n    // Get session role from database\n    const supabase = await createClient();\n    const { data: sessionRecord } = await supabase\n      .from('sessions')\n      .select('user_role')\n      .eq('session_token', sessionToken)\n      .single();\n\n    const sessionRole = sessionRecord?.user_role;\n\n    if (sessionRole && sessionRole !== currentRole) {\n      // Privilege changed\n      await this.logAuditEvent({\n        eventType: SessionEventType.PRIVILEGE_CHANGED,\n        userId,\n        organizationId: session.organizationId,\n        sessionToken,\n        metadata: {\n          oldRole: sessionRole,\n          newRole: currentRole\n        },\n        timestamp: new Date().toISOString()\n      });\n\n      return {\n        changed: true,\n        oldRole: sessionRole,\n        newRole: currentRole,\n        requiresRegeneration: true\n      };\n    }\n\n    return {\n      changed: false,\n      requiresRegeneration: false\n    };\n  }\n\n  /**\n   * Regenerate session after privilege change\n   *\n   * Creates new session token while maintaining session continuity.\n   *\n   * @param userId - User ID\n   * @param oldSessionToken - Old session token\n   * @returns New session and token\n   *\n   * @example\n   * ```typescript\n   * const { session, token } = await manager.regenerateSession(\n   *   'user123',\n   *   'old_token'\n   * );\n   * // Send new token to client\n   * ```\n   */\n  async regenerateSession(\n    userId: string,\n    oldSessionToken: string\n  ): Promise<{ session: RedisSession; token: string }> {\n    // Get old session\n    const oldSession = await this.store.getSession(userId, oldSessionToken);\n\n    if (!oldSession) {\n      throw new Error('Session not found');\n    }\n\n    // Get current user info\n    const supabase = await createClient();\n    const { data: profile } = await supabase\n      .from('profiles')\n      .select('role')\n      .eq('id', userId)\n      .single();\n\n    const currentRole = profile?.role || 'agent';\n\n    // Revoke old session\n    await this.revokeSession(userId, oldSessionToken);\n\n    // Create new session\n    const result = await this.createSession({\n      userId,\n      organizationId: oldSession.organizationId,\n      userRole: currentRole,\n      deviceInfo: oldSession.deviceInfo\n    });\n\n    return result;\n  }\n\n  /**\n   * Generate secure session token\n   *\n   * Creates cryptographically secure random token.\n   *\n   * @returns Session token\n   */\n  private generateSessionToken(): string {\n    return `${uuidv4()}_${Date.now()}_${Math.random().toString(36).substring(2)}`;\n  }\n\n  /**\n   * Log session to database\n   *\n   * Creates persistent record in sessions table.\n   *\n   * @param session - Redis session\n   * @param userRole - User role\n   */\n  private async logSessionToDatabase(\n    session: RedisSession,\n    userRole: string\n  ): Promise<void> {\n    try {\n      const supabase = await createClient();\n\n      await supabase.from('sessions').insert({\n        user_id: session.userId,\n        organization_id: session.organizationId,\n        session_token: session.sessionToken,\n        device_info: session.deviceInfo,\n        user_role: userRole,\n        created_at: session.createdAt,\n        last_activity: session.lastActivity,\n        expires_at: session.expiresAt,\n        revoked: false\n      });\n    } catch (error) {\n      console.error('[SessionManager] Failed to log session to database:', error);\n      // Don't throw - Redis is source of truth\n    }\n  }\n\n  /**\n   * Update session in database\n   *\n   * @param session - Updated session\n   */\n  private async updateSessionInDatabase(session: RedisSession): Promise<void> {\n    try {\n      const supabase = await createClient();\n\n      await supabase\n        .from('sessions')\n        .update({\n          last_activity: session.lastActivity,\n          expires_at: session.expiresAt\n        })\n        .eq('session_token', session.sessionToken);\n    } catch (error) {\n      console.error('[SessionManager] Failed to update session in database:', error);\n    }\n  }\n\n  /**\n   * Mark session as revoked in database\n   *\n   * @param sessionToken - Session token\n   */\n  private async markSessionRevokedInDatabase(\n    sessionToken: string\n  ): Promise<void> {\n    try {\n      const supabase = await createClient();\n\n      await supabase\n        .from('sessions')\n        .update({\n          revoked: true\n        })\n        .eq('session_token', sessionToken);\n    } catch (error) {\n      console.error('[SessionManager] Failed to mark session revoked:', error);\n    }\n  }\n\n  /**\n   * Validate user exists in database\n   *\n   * @param userId - User ID\n   * @returns True if user exists\n   */\n  private async validateUserExists(userId: string): Promise<boolean> {\n    try {\n      const supabase = await createClient();\n\n      const { data, error } = await supabase\n        .from('profiles')\n        .select('id')\n        .eq('id', userId)\n        .single();\n\n      return !error && !!data;\n    } catch (error) {\n      console.error('[SessionManager] Failed to validate user:', error);\n      return false;\n    }\n  }\n\n  /**\n   * Validate organization is active\n   *\n   * @param organizationId - Organization ID\n   * @returns True if organization active\n   */\n  private async validateOrganizationActive(\n    organizationId: string\n  ): Promise<boolean> {\n    try {\n      const supabase = await createClient();\n\n      const { data, error } = await supabase\n        .from('organizations')\n        .select('subscription_status')\n        .eq('id', organizationId)\n        .single();\n\n      if (error || !data) return false;\n\n      return data.subscription_status === 'active' ||\n             data.subscription_status === 'trial';\n    } catch (error) {\n      console.error('[SessionManager] Failed to validate organization:', error);\n      return false;\n    }\n  }\n\n  /**\n   * Get user role from database\n   *\n   * @param userId - User ID\n   * @returns User role or null\n   */\n  private async getUserRoleFromDatabase(\n    userId: string\n  ): Promise<string | null> {\n    try {\n      const supabase = await createClient();\n\n      const { data, error } = await supabase\n        .from('profiles')\n        .select('role')\n        .eq('id', userId)\n        .single();\n\n      return error || !data ? null : data.role;\n    } catch (error) {\n      console.error('[SessionManager] Failed to get user role:', error);\n      return null;\n    }\n  }\n\n  /**\n   * Log audit event\n   *\n   * Records session events for security monitoring.\n   *\n   * @param event - Audit event\n   */\n  private async logAuditEvent(event: SessionAuditEvent): Promise<void> {\n    try {\n      // Log to console in development\n      if (process.env.NODE_ENV === 'development') {\n        console.log('[SessionManager] Audit Event:', event);\n      }\n\n      // In production, send to monitoring service (Sentry, custom analytics, etc.)\n      if (process.env.NODE_ENV === 'production') {\n        try {\n          const Sentry = await import('@sentry/nextjs');\n          Sentry.captureMessage('Session Audit Event', {\n            level: 'info',\n            extra: event as Record<string, unknown>\n          });\n        } catch (error) {\n          console.error('[SessionManager] Failed to log to Sentry:', error);\n        }\n      }\n    } catch (error) {\n      console.error('[SessionManager] Failed to log audit event:', error);\n    }\n  }\n\n  /**\n   * Get store instance (for testing)\n   *\n   * @returns Redis session store\n   */\n  getStore(): RedisSessionStore {\n    return this.store;\n  }\n}\n\n/**\n * Create singleton session manager instance\n */\nlet sessionManagerInstance: SessionManager | null = null;\n\n/**\n * Get or create session manager instance\n *\n * @returns SessionManager singleton\n *\n * @example\n * ```typescript\n * const manager = getSessionManager();\n * await manager.validateSession(userId, token);\n * ```\n */\nexport function getSessionManager(): SessionManager {\n  if (!sessionManagerInstance) {\n    sessionManagerInstance = new SessionManager();\n  }\n  return sessionManagerInstance;\n}\n\n/**\n * Reset session manager instance (for testing)\n */\nexport function resetSessionManager(): void {\n  sessionManagerInstance = null;\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;MAuEYA,iBAAA;IAAA;IAAAC,aAAA,GAAAC,CAAA;IAAAD,aAAA,GAAAE,CAAA;WAAAH,gBAAA;;MAkDCI,eAAA;IAAA;IAAAH,aAAA,GAAAC,CAAA;IAAAD,aAAA,GAAAE,CAAA;WAAAC,cAAA;;MAwsBGC,kBAAA;IAAA;IAAAJ,aAAA,GAAAC,CAAA;IAAAD,aAAA,GAAAE,CAAA;WAAAE,iBAAA;;MAUAC,oBAAA;IAAA;IAAAL,aAAA,GAAAC,CAAA;IAAAD,aAAA,GAAAE,CAAA;WAAAG,mBAAA;;;;;iCA30Ba;;;iCACA;;;kCAMtB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAgEA,IAAAN,gBAAK;AAAA;AAAA,cAAAC,aAAA,GAAAE,CAAA,kBAAAH,gBAAA;EAAA;EAAAC,aAAA,GAAAC,CAAA;EAAAD,aAAA,GAAAE,CAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;SAAAH,gBAAA;;AAkDL,MAAMI,cAAA;EAGX;;;;;EAKAG,YAAYC,KAAyB,EAAE;IAAA;IAAAP,aAAA,GAAAC,CAAA;IAAAD,aAAA,GAAAE,CAAA;IACrC,IAAI,CAACK,KAAK;IAAG;IAAA,CAAAP,aAAA,GAAAQ,CAAA,WAAAD,KAAA;IAAA;IAAA,CAAAP,aAAA,GAAAQ,CAAA,WAAS,IAAAC,WAAA,CAAAC,uBAAuB;EAC/C;EAEA;;;;;;;;;;;;;;;;;;;;;;;;;;;;EA4BA,MAAMC,cAAcC,MAA2B,EAG5C;IAAA;IAAAZ,aAAA,GAAAC,CAAA;IACD,MAAM;MAAEY,MAAM;MAAEC,cAAc;MAAEC,QAAQ;MAAEC;IAAU,CAAE;IAAA;IAAA,CAAAhB,aAAA,GAAAE,CAAA,QAAGU,MAAA;IAEzD;IACA,MAAMK,YAAA;IAAA;IAAA,CAAAjB,aAAA,GAAAE,CAAA,QAAe,IAAI,CAACgB,oBAAoB;IAE9C;IACA,MAAMC,OAAA;IAAA;IAAA,CAAAnB,aAAA,GAAAE,CAAA,QAAU,MAAM,IAAI,CAACK,KAAK,CAACI,aAAa,CAAC;MAC7CE,MAAA;MACAC,cAAA;MACAG,YAAA;MACAD;IACF;IAEA;IAAA;IAAAhB,aAAA,GAAAE,CAAA;IACA,MAAM,IAAI,CAACkB,oBAAoB,CAACD,OAAA,EAASJ,QAAA;IAEzC;IAAA;IAAAf,aAAA,GAAAE,CAAA;IACA,MAAM,IAAI,CAACmB,aAAa,CAAC;MACvBC,SAAS;MACTT,MAAA;MACAC,cAAA;MACAG,YAAA;MACAD,UAAA;MACAO,QAAA,EAAU;QAAER;MAAS;MACrBS,SAAA,EAAW,IAAIC,IAAA,GAAOC,WAAW;IACnC;IAAA;IAAA1B,aAAA,GAAAE,CAAA;IAEA,OAAO;MACLiB,OAAA;MACAQ,KAAA,EAAOV;IACT;EACF;EAEA;;;;;;;;;;;;;;;;;;;;;;;;EAwBA,MAAMW,gBACJf,MAAc,EACdI,YAAoB,EACc;IAAA;IAAAjB,aAAA,GAAAC,CAAA;IAClC;IACA,MAAMkB,OAAA;IAAA;IAAA,CAAAnB,aAAA,GAAAE,CAAA,QAAU,MAAM,IAAI,CAACK,KAAK,CAACsB,UAAU,CAAChB,MAAA,EAAQI,YAAA;IAAA;IAAAjB,aAAA,GAAAE,CAAA;IAEpD,IAAI,CAACiB,OAAA,EAAS;MAAA;MAAAnB,aAAA,GAAAQ,CAAA;MAAAR,aAAA,GAAAE,CAAA;MACZ,MAAM,IAAI,CAACmB,aAAa,CAAC;QACvBC,SAAS;QACTT,MAAA;QACAC,cAAA,EAAgB;QAChBG,YAAA;QACAO,SAAA,EAAW,IAAIC,IAAA,GAAOC,WAAW;MACnC;MAAA;MAAA1B,aAAA,GAAAE,CAAA;MAEA,OAAO;QACL4B,KAAA,EAAO;QACPC,MAAA,EAAQ;MACV;IACF;IAAA;IAAA;MAAA/B,aAAA,GAAAQ,CAAA;IAAA;IAEA;IAAAR,aAAA,GAAAE,CAAA;IACA,IAAIiB,OAAA,CAAQa,SAAS,EAAE;MAAA;MAAAhC,aAAA,GAAAQ,CAAA;MAAAR,aAAA,GAAAE,CAAA;MACrB,OAAO;QACL4B,KAAA,EAAO;QACPC,MAAA,EAAQ;MACV;IACF;IAAA;IAAA;MAAA/B,aAAA,GAAAQ,CAAA;IAAA;IAEA;IAAAR,aAAA,GAAAE,CAAA;IACA,IAAI,IAAIuB,IAAA,CAAKN,OAAA,CAAQc,SAAS,IAAI,IAAIR,IAAA,IAAQ;MAAA;MAAAzB,aAAA,GAAAQ,CAAA;MAAAR,aAAA,GAAAE,CAAA;MAC5C,MAAM,IAAI,CAACmB,aAAa,CAAC;QACvBC,SAAS;QACTT,MAAA;QACAC,cAAA,EAAgBK,OAAA,CAAQL,cAAc;QACtCG,YAAA;QACAO,SAAA,EAAW,IAAIC,IAAA,GAAOC,WAAW;MACnC;MAAA;MAAA1B,aAAA,GAAAE,CAAA;MAEA,OAAO;QACL4B,KAAA,EAAO;QACPC,MAAA,EAAQ;MACV;IACF;IAAA;IAAA;MAAA/B,aAAA,GAAAQ,CAAA;IAAA;IAEA;IACA,MAAM0B,UAAA;IAAA;IAAA,CAAAlC,aAAA,GAAAE,CAAA,QAAa,MAAM,IAAI,CAACiC,kBAAkB,CAACtB,MAAA;IAAA;IAAAb,aAAA,GAAAE,CAAA;IACjD,IAAI,CAACgC,UAAA,EAAY;MAAA;MAAAlC,aAAA,GAAAQ,CAAA;MAAAR,aAAA,GAAAE,CAAA;MACf,MAAM,IAAI,CAACK,KAAK,CAAC6B,aAAa,CAACvB,MAAA,EAAQI,YAAA;MAAA;MAAAjB,aAAA,GAAAE,CAAA;MACvC,OAAO;QACL4B,KAAA,EAAO;QACPC,MAAA,EAAQ;MACV;IACF;IAAA;IAAA;MAAA/B,aAAA,GAAAQ,CAAA;IAAA;IAEA;IACA,MAAM6B,SAAA;IAAA;IAAA,CAAArC,aAAA,GAAAE,CAAA,QAAY,MAAM,IAAI,CAACoC,0BAA0B,CACrDnB,OAAA,CAAQL,cAAc;IAAA;IAAAd,aAAA,GAAAE,CAAA;IAExB,IAAI,CAACmC,SAAA,EAAW;MAAA;MAAArC,aAAA,GAAAQ,CAAA;MAAAR,aAAA,GAAAE,CAAA;MACd,MAAM,IAAI,CAACK,KAAK,CAAC6B,aAAa,CAACvB,MAAA,EAAQI,YAAA;MAAA;MAAAjB,aAAA,GAAAE,CAAA;MACvC,OAAO;QACL4B,KAAA,EAAO;QACPC,MAAA,EAAQ;MACV;IACF;IAAA;IAAA;MAAA/B,aAAA,GAAAQ,CAAA;IAAA;IAEA;IAAAR,aAAA,GAAAE,CAAA;IACA,MAAM,IAAI,CAACmB,aAAa,CAAC;MACvBC,SAAS;MACTT,MAAA;MACAC,cAAA,EAAgBK,OAAA,CAAQL,cAAc;MACtCG,YAAA;MACAO,SAAA,EAAW,IAAIC,IAAA,GAAOC,WAAW;IACnC;IAAA;IAAA1B,aAAA,GAAAE,CAAA;IAEA,OAAO;MACL4B,KAAA,EAAO;MACPX;IACF;EACF;EAEA;;;;;;;;;;;;;;;;EAgBA,MAAMoB,eACJ1B,MAAc,EACdI,YAAoB,EACW;IAAA;IAAAjB,aAAA,GAAAC,CAAA;IAC/B;IACA,MAAMuC,UAAA;IAAA;IAAA,CAAAxC,aAAA,GAAAE,CAAA,QAAa,MAAM,IAAI,CAAC0B,eAAe,CAACf,MAAA,EAAQI,YAAA;IAAA;IAAAjB,aAAA,GAAAE,CAAA;IAEtD,IAAI,CAACsC,UAAA,CAAWV,KAAK,EAAE;MAAA;MAAA9B,aAAA,GAAAQ,CAAA;MAAAR,aAAA,GAAAE,CAAA;MACrB,OAAO;QACLuC,OAAA,EAAS;QACTC,KAAA,EAAOF,UAAA,CAAWT;MACpB;IACF;IAAA;IAAA;MAAA/B,aAAA,GAAAQ,CAAA;IAAA;IAEA;IACA,MAAMmC,cAAA;IAAA;IAAA,CAAA3C,aAAA,GAAAE,CAAA,QAAiB,MAAM,IAAI,CAACK,KAAK,CAACqC,qBAAqB,CAC3D/B,MAAA,EACAI,YAAA;IAAA;IAAAjB,aAAA,GAAAE,CAAA;IAGF,IAAI,CAACyC,cAAA,EAAgB;MAAA;MAAA3C,aAAA,GAAAQ,CAAA;MAAAR,aAAA,GAAAE,CAAA;MACnB,OAAO;QACLuC,OAAA,EAAS;QACTC,KAAA,EAAO;MACT;IACF;IAAA;IAAA;MAAA1C,aAAA,GAAAQ,CAAA;IAAA;IAEA;IAAAR,aAAA,GAAAE,CAAA;IACA,MAAM,IAAI,CAAC2C,uBAAuB,CAACF,cAAA;IAEnC;IAAA;IAAA3C,aAAA,GAAAE,CAAA;IACA,MAAM,IAAI,CAACmB,aAAa,CAAC;MACvBC,SAAS;MACTT,MAAA;MACAC,cAAA,EAAgB6B,cAAA,CAAe7B,cAAc;MAC7CG,YAAA;MACAO,SAAA,EAAW,IAAIC,IAAA,GAAOC,WAAW;IACnC;IAAA;IAAA1B,aAAA,GAAAE,CAAA;IAEA,OAAO;MACLuC,OAAA,EAAS;MACTtB,OAAA,EAASwB;IACX;EACF;EAEA;;;;;;;;;;;;;;;;;;EAkBA,MAAMP,cAAcvB,MAAc,EAAEI,YAAoB,EAAoB;IAAA;IAAAjB,aAAA,GAAAC,CAAA;IAC1E,MAAMkB,OAAA;IAAA;IAAA,CAAAnB,aAAA,GAAAE,CAAA,QAAU,MAAM,IAAI,CAACK,KAAK,CAACsB,UAAU,CAAChB,MAAA,EAAQI,YAAA;IAAA;IAAAjB,aAAA,GAAAE,CAAA;IAEpD,IAAI,CAACiB,OAAA,EAAS;MAAA;MAAAnB,aAAA,GAAAQ,CAAA;MAAAR,aAAA,GAAAE,CAAA;MACZ,OAAO;IACT;IAAA;IAAA;MAAAF,aAAA,GAAAQ,CAAA;IAAA;IAEA;IACA,MAAMsC,OAAA;IAAA;IAAA,CAAA9C,aAAA,GAAAE,CAAA,QAAU,MAAM,IAAI,CAACK,KAAK,CAAC6B,aAAa,CAACvB,MAAA,EAAQI,YAAA;IAAA;IAAAjB,aAAA,GAAAE,CAAA;IAEvD,IAAI4C,OAAA,EAAS;MAAA;MAAA9C,aAAA,GAAAQ,CAAA;MAAAR,aAAA,GAAAE,CAAA;MACX;MACA,MAAM,IAAI,CAAC6C,4BAA4B,CAAC9B,YAAA;MAExC;MAAA;MAAAjB,aAAA,GAAAE,CAAA;MACA,MAAM,IAAI,CAACmB,aAAa,CAAC;QACvBC,SAAS;QACTT,MAAA;QACAC,cAAA,EAAgBK,OAAA,CAAQL,cAAc;QACtCG,YAAA;QACAO,SAAA,EAAW,IAAIC,IAAA,GAAOC,WAAW;MACnC;IACF;IAAA;IAAA;MAAA1B,aAAA,GAAAQ,CAAA;IAAA;IAAAR,aAAA,GAAAE,CAAA;IAEA,OAAO4C,OAAA;EACT;EAEA;;;;;;;;;;;;;;;;;;;;;;EAsBA,MAAME,sBACJnC,MAAc,EACdkB,MAAc,EACG;IAAA;IAAA/B,aAAA,GAAAC,CAAA;IACjB;IACA,MAAMgD,QAAA;IAAA;IAAA,CAAAjD,aAAA,GAAAE,CAAA,QAAW,MAAM,IAAAgD,OAAA,CAAAC,YAAY;IACnC,MAAM;MAAEC,IAAA,EAAMC;IAAO,CAAE;IAAA;IAAA,CAAArD,aAAA,GAAAE,CAAA,QAAG,MAAM+C,QAAA,CAC7BK,IAAI,CAAC,YACLC,MAAM,CAAC,mBACPC,EAAE,CAAC,MAAM3C,MAAA,EACT4C,MAAM;IAET,MAAM3C,cAAA;IAAA;IAAA,CAAAd,aAAA,GAAAE,CAAA;IAAiB;IAAA,CAAAF,aAAA,GAAAQ,CAAA,WAAA6C,OAAA,EAASK,eAAA;IAAA;IAAA,CAAA1D,aAAA,GAAAQ,CAAA,WAAmB;IAEnD;IACA,MAAMmD,KAAA;IAAA;IAAA,CAAA3D,aAAA,GAAAE,CAAA,QAAQ,MAAM,IAAI,CAACK,KAAK,CAACyC,qBAAqB,CAACnC,MAAA;IAErD;IAAA;IAAAb,aAAA,GAAAE,CAAA;IACA,MAAM,IAAI,CAACmB,aAAa,CAAC;MACvBC,SAAS;MACTT,MAAA;MACAC,cAAA;MACAS,QAAA,EAAU;QACRQ,MAAA;QACA6B,eAAA,EAAiBD;MACnB;MACAnC,SAAA,EAAW,IAAIC,IAAA,GAAOC,WAAW;IACnC;IAAA;IAAA1B,aAAA,GAAAE,CAAA;IAEA,OAAOyD,KAAA;EACT;EAEA;;;;;;;;;;;;EAYA,MAAME,gBAAgBhD,MAAc,EAA2B;IAAA;IAAAb,aAAA,GAAAC,CAAA;IAAAD,aAAA,GAAAE,CAAA;IAC7D,OAAO,IAAI,CAACK,KAAK,CAACsD,eAAe,CAAChD,MAAA;EACpC;EAEA;;;;;;;;;;;;;;;;;;EAkBA,MAAMiD,qBACJjD,MAAc,EACdI,YAAoB,EACY;IAAA;IAAAjB,aAAA,GAAAC,CAAA;IAChC;IACA,MAAMkB,OAAA;IAAA;IAAA,CAAAnB,aAAA,GAAAE,CAAA,QAAU,MAAM,IAAI,CAACK,KAAK,CAACsB,UAAU,CAAChB,MAAA,EAAQI,YAAA;IAAA;IAAAjB,aAAA,GAAAE,CAAA;IAEpD,IAAI,CAACiB,OAAA,EAAS;MAAA;MAAAnB,aAAA,GAAAQ,CAAA;MAAAR,aAAA,GAAAE,CAAA;MACZ,OAAO;QACL6D,OAAA,EAAS;QACTC,oBAAA,EAAsB;MACxB;IACF;IAAA;IAAA;MAAAhE,aAAA,GAAAQ,CAAA;IAAA;IAEA;IACA,MAAMyD,WAAA;IAAA;IAAA,CAAAjE,aAAA,GAAAE,CAAA,SAAc,MAAM,IAAI,CAACgE,uBAAuB,CAACrD,MAAA;IAAA;IAAAb,aAAA,GAAAE,CAAA;IAEvD,IAAI,CAAC+D,WAAA,EAAa;MAAA;MAAAjE,aAAA,GAAAQ,CAAA;MAAAR,aAAA,GAAAE,CAAA;MAChB,OAAO;QACL6D,OAAA,EAAS;QACTC,oBAAA,EAAsB;MACxB;IACF;IAAA;IAAA;MAAAhE,aAAA,GAAAQ,CAAA;IAAA;IAEA;IACA,MAAMyC,QAAA;IAAA;IAAA,CAAAjD,aAAA,GAAAE,CAAA,SAAW,MAAM,IAAAgD,OAAA,CAAAC,YAAY;IACnC,MAAM;MAAEC,IAAA,EAAMe;IAAa,CAAE;IAAA;IAAA,CAAAnE,aAAA,GAAAE,CAAA,SAAG,MAAM+C,QAAA,CACnCK,IAAI,CAAC,YACLC,MAAM,CAAC,aACPC,EAAE,CAAC,iBAAiBvC,YAAA,EACpBwC,MAAM;IAET,MAAMW,WAAA;IAAA;IAAA,CAAApE,aAAA,GAAAE,CAAA,SAAciE,aAAA,EAAeE,SAAA;IAAA;IAAArE,aAAA,GAAAE,CAAA;IAEnC;IAAI;IAAA,CAAAF,aAAA,GAAAQ,CAAA,WAAA4D,WAAA;IAAA;IAAA,CAAApE,aAAA,GAAAQ,CAAA,WAAe4D,WAAA,KAAgBH,WAAA,GAAa;MAAA;MAAAjE,aAAA,GAAAQ,CAAA;MAAAR,aAAA,GAAAE,CAAA;MAC9C;MACA,MAAM,IAAI,CAACmB,aAAa,CAAC;QACvBC,SAAS;QACTT,MAAA;QACAC,cAAA,EAAgBK,OAAA,CAAQL,cAAc;QACtCG,YAAA;QACAM,QAAA,EAAU;UACR+C,OAAA,EAASF,WAAA;UACTG,OAAA,EAASN;QACX;QACAzC,SAAA,EAAW,IAAIC,IAAA,GAAOC,WAAW;MACnC;MAAA;MAAA1B,aAAA,GAAAE,CAAA;MAEA,OAAO;QACL6D,OAAA,EAAS;QACTO,OAAA,EAASF,WAAA;QACTG,OAAA,EAASN,WAAA;QACTD,oBAAA,EAAsB;MACxB;IACF;IAAA;IAAA;MAAAhE,aAAA,GAAAQ,CAAA;IAAA;IAAAR,aAAA,GAAAE,CAAA;IAEA,OAAO;MACL6D,OAAA,EAAS;MACTC,oBAAA,EAAsB;IACxB;EACF;EAEA;;;;;;;;;;;;;;;;;;EAkBA,MAAMQ,kBACJ3D,MAAc,EACd4D,eAAuB,EAC4B;IAAA;IAAAzE,aAAA,GAAAC,CAAA;IACnD;IACA,MAAMyE,UAAA;IAAA;IAAA,CAAA1E,aAAA,GAAAE,CAAA,SAAa,MAAM,IAAI,CAACK,KAAK,CAACsB,UAAU,CAAChB,MAAA,EAAQ4D,eAAA;IAAA;IAAAzE,aAAA,GAAAE,CAAA;IAEvD,IAAI,CAACwE,UAAA,EAAY;MAAA;MAAA1E,aAAA,GAAAQ,CAAA;MAAAR,aAAA,GAAAE,CAAA;MACf,MAAM,IAAIyE,KAAA,CAAM;IAClB;IAAA;IAAA;MAAA3E,aAAA,GAAAQ,CAAA;IAAA;IAEA;IACA,MAAMyC,QAAA;IAAA;IAAA,CAAAjD,aAAA,GAAAE,CAAA,SAAW,MAAM,IAAAgD,OAAA,CAAAC,YAAY;IACnC,MAAM;MAAEC,IAAA,EAAMC;IAAO,CAAE;IAAA;IAAA,CAAArD,aAAA,GAAAE,CAAA,SAAG,MAAM+C,QAAA,CAC7BK,IAAI,CAAC,YACLC,MAAM,CAAC,QACPC,EAAE,CAAC,MAAM3C,MAAA,EACT4C,MAAM;IAET,MAAMQ,WAAA;IAAA;IAAA,CAAAjE,aAAA,GAAAE,CAAA;IAAc;IAAA,CAAAF,aAAA,GAAAQ,CAAA,WAAA6C,OAAA,EAASuB,IAAA;IAAA;IAAA,CAAA5E,aAAA,GAAAQ,CAAA,WAAQ;IAErC;IAAA;IAAAR,aAAA,GAAAE,CAAA;IACA,MAAM,IAAI,CAACkC,aAAa,CAACvB,MAAA,EAAQ4D,eAAA;IAEjC;IACA,MAAMI,MAAA;IAAA;IAAA,CAAA7E,aAAA,GAAAE,CAAA,SAAS,MAAM,IAAI,CAACS,aAAa,CAAC;MACtCE,MAAA;MACAC,cAAA,EAAgB4D,UAAA,CAAW5D,cAAc;MACzCC,QAAA,EAAUkD,WAAA;MACVjD,UAAA,EAAY0D,UAAA,CAAW1D;IACzB;IAAA;IAAAhB,aAAA,GAAAE,CAAA;IAEA,OAAO2E,MAAA;EACT;EAEA;;;;;;;EAOA3D,oBAAQA,CAAA,EAA+B;IAAA;IAAAlB,aAAA,GAAAC,CAAA;IAAAD,aAAA,GAAAE,CAAA;IACrC,OAAO,GAAG,IAAA4E,KAAA,CAAAC,EAAM,OAAMtD,IAAA,CAAKuD,GAAG,MAAMC,IAAA,CAAKC,MAAM,GAAGC,QAAQ,CAAC,IAAIC,SAAS,CAAC,IAAI;EAC/E;EAEA;;;;;;;;EAQA,MAAchE,qBACZD,OAAqB,EACrBJ,QAAgB,EACD;IAAA;IAAAf,aAAA,GAAAC,CAAA;IAAAD,aAAA,GAAAE,CAAA;IACf,IAAI;MACF,MAAM+C,QAAA;MAAA;MAAA,CAAAjD,aAAA,GAAAE,CAAA,SAAW,MAAM,IAAAgD,OAAA,CAAAC,YAAY;MAAA;MAAAnD,aAAA,GAAAE,CAAA;MAEnC,MAAM+C,QAAA,CAASK,IAAI,CAAC,YAAY+B,MAAM,CAAC;QACrCC,OAAA,EAASnE,OAAA,CAAQN,MAAM;QACvB6C,eAAA,EAAiBvC,OAAA,CAAQL,cAAc;QACvCyE,aAAA,EAAepE,OAAA,CAAQF,YAAY;QACnCuE,WAAA,EAAarE,OAAA,CAAQH,UAAU;QAC/BqD,SAAA,EAAWtD,QAAA;QACX0E,UAAA,EAAYtE,OAAA,CAAQuE,SAAS;QAC7BC,aAAA,EAAexE,OAAA,CAAQyE,YAAY;QACnCC,UAAA,EAAY1E,OAAA,CAAQc,SAAS;QAC7Ba,OAAA,EAAS;MACX;IACF,EAAE,OAAOJ,KAAA,EAAO;MAAA;MAAA1C,aAAA,GAAAE,CAAA;MACd4F,OAAA,CAAQpD,KAAK,CAAC,uDAAuDA,KAAA;MACrE;IACF;EACF;EAEA;;;;;EAKA,MAAcG,wBAAwB1B,OAAqB,EAAiB;IAAA;IAAAnB,aAAA,GAAAC,CAAA;IAAAD,aAAA,GAAAE,CAAA;IAC1E,IAAI;MACF,MAAM+C,QAAA;MAAA;MAAA,CAAAjD,aAAA,GAAAE,CAAA,SAAW,MAAM,IAAAgD,OAAA,CAAAC,YAAY;MAAA;MAAAnD,aAAA,GAAAE,CAAA;MAEnC,MAAM+C,QAAA,CACHK,IAAI,CAAC,YACLyC,MAAM,CAAC;QACNJ,aAAA,EAAexE,OAAA,CAAQyE,YAAY;QACnCC,UAAA,EAAY1E,OAAA,CAAQc;MACtB,GACCuB,EAAE,CAAC,iBAAiBrC,OAAA,CAAQF,YAAY;IAC7C,EAAE,OAAOyB,KAAA,EAAO;MAAA;MAAA1C,aAAA,GAAAE,CAAA;MACd4F,OAAA,CAAQpD,KAAK,CAAC,0DAA0DA,KAAA;IAC1E;EACF;EAEA;;;;;EAKA,MAAcK,6BACZ9B,YAAoB,EACL;IAAA;IAAAjB,aAAA,GAAAC,CAAA;IAAAD,aAAA,GAAAE,CAAA;IACf,IAAI;MACF,MAAM+C,QAAA;MAAA;MAAA,CAAAjD,aAAA,GAAAE,CAAA,SAAW,MAAM,IAAAgD,OAAA,CAAAC,YAAY;MAAA;MAAAnD,aAAA,GAAAE,CAAA;MAEnC,MAAM+C,QAAA,CACHK,IAAI,CAAC,YACLyC,MAAM,CAAC;QACNjD,OAAA,EAAS;MACX,GACCU,EAAE,CAAC,iBAAiBvC,YAAA;IACzB,EAAE,OAAOyB,KAAA,EAAO;MAAA;MAAA1C,aAAA,GAAAE,CAAA;MACd4F,OAAA,CAAQpD,KAAK,CAAC,oDAAoDA,KAAA;IACpE;EACF;EAEA;;;;;;EAMA,MAAcP,mBAAmBtB,MAAc,EAAoB;IAAA;IAAAb,aAAA,GAAAC,CAAA;IAAAD,aAAA,GAAAE,CAAA;IACjE,IAAI;MACF,MAAM+C,QAAA;MAAA;MAAA,CAAAjD,aAAA,GAAAE,CAAA,SAAW,MAAM,IAAAgD,OAAA,CAAAC,YAAY;MAEnC,MAAM;QAAEC,IAAI;QAAEV;MAAK,CAAE;MAAA;MAAA,CAAA1C,aAAA,GAAAE,CAAA,SAAG,MAAM+C,QAAA,CAC3BK,IAAI,CAAC,YACLC,MAAM,CAAC,MACPC,EAAE,CAAC,MAAM3C,MAAA,EACT4C,MAAM;MAAA;MAAAzD,aAAA,GAAAE,CAAA;MAET,OAAO,2BAAAF,aAAA,GAAAQ,CAAA,YAACkC,KAAA;MAAA;MAAA,CAAA1C,aAAA,GAAAQ,CAAA,WAAS,CAAC,CAAC4C,IAAA;IACrB,EAAE,OAAOV,KAAA,EAAO;MAAA;MAAA1C,aAAA,GAAAE,CAAA;MACd4F,OAAA,CAAQpD,KAAK,CAAC,6CAA6CA,KAAA;MAAA;MAAA1C,aAAA,GAAAE,CAAA;MAC3D,OAAO;IACT;EACF;EAEA;;;;;;EAMA,MAAcoC,2BACZxB,cAAsB,EACJ;IAAA;IAAAd,aAAA,GAAAC,CAAA;IAAAD,aAAA,GAAAE,CAAA;IAClB,IAAI;MACF,MAAM+C,QAAA;MAAA;MAAA,CAAAjD,aAAA,GAAAE,CAAA,SAAW,MAAM,IAAAgD,OAAA,CAAAC,YAAY;MAEnC,MAAM;QAAEC,IAAI;QAAEV;MAAK,CAAE;MAAA;MAAA,CAAA1C,aAAA,GAAAE,CAAA,SAAG,MAAM+C,QAAA,CAC3BK,IAAI,CAAC,iBACLC,MAAM,CAAC,uBACPC,EAAE,CAAC,MAAM1C,cAAA,EACT2C,MAAM;MAAA;MAAAzD,aAAA,GAAAE,CAAA;MAET;MAAI;MAAA,CAAAF,aAAA,GAAAQ,CAAA,WAAAkC,KAAA;MAAA;MAAA,CAAA1C,aAAA,GAAAQ,CAAA,WAAS,CAAC4C,IAAA,GAAM;QAAA;QAAApD,aAAA,GAAAQ,CAAA;QAAAR,aAAA,GAAAE,CAAA;QAAA,OAAO;MAAA;MAAA;MAAA;QAAAF,aAAA,GAAAQ,CAAA;MAAA;MAAAR,aAAA,GAAAE,CAAA;MAE3B,OAAO,2BAAAF,aAAA,GAAAQ,CAAA,WAAA4C,IAAA,CAAK4C,mBAAmB,KAAK;MAAA;MAAA,CAAAhG,aAAA,GAAAQ,CAAA,WAC7B4C,IAAA,CAAK4C,mBAAmB,KAAK;IACtC,EAAE,OAAOtD,KAAA,EAAO;MAAA;MAAA1C,aAAA,GAAAE,CAAA;MACd4F,OAAA,CAAQpD,KAAK,CAAC,qDAAqDA,KAAA;MAAA;MAAA1C,aAAA,GAAAE,CAAA;MACnE,OAAO;IACT;EACF;EAEA;;;;;;EAMA,MAAcgE,wBACZrD,MAAc,EACU;IAAA;IAAAb,aAAA,GAAAC,CAAA;IAAAD,aAAA,GAAAE,CAAA;IACxB,IAAI;MACF,MAAM+C,QAAA;MAAA;MAAA,CAAAjD,aAAA,GAAAE,CAAA,SAAW,MAAM,IAAAgD,OAAA,CAAAC,YAAY;MAEnC,MAAM;QAAEC,IAAI;QAAEV;MAAK,CAAE;MAAA;MAAA,CAAA1C,aAAA,GAAAE,CAAA,SAAG,MAAM+C,QAAA,CAC3BK,IAAI,CAAC,YACLC,MAAM,CAAC,QACPC,EAAE,CAAC,MAAM3C,MAAA,EACT4C,MAAM;MAAA;MAAAzD,aAAA,GAAAE,CAAA;MAET,OAAO,2BAAAF,aAAA,GAAAQ,CAAA,WAAAkC,KAAA;MAAA;MAAA,CAAA1C,aAAA,GAAAQ,CAAA,WAAS,CAAC4C,IAAA;MAAA;MAAA,CAAApD,aAAA,GAAAQ,CAAA,WAAO;MAAA;MAAA,CAAAR,aAAA,GAAAQ,CAAA,WAAO4C,IAAA,CAAKwB,IAAI;IAC1C,EAAE,OAAOlC,KAAA,EAAO;MAAA;MAAA1C,aAAA,GAAAE,CAAA;MACd4F,OAAA,CAAQpD,KAAK,CAAC,6CAA6CA,KAAA;MAAA;MAAA1C,aAAA,GAAAE,CAAA;MAC3D,OAAO;IACT;EACF;EAEA;;;;;;;EAOA,MAAcmB,cAAc4E,KAAwB,EAAiB;IAAA;IAAAjG,aAAA,GAAAC,CAAA;IAAAD,aAAA,GAAAE,CAAA;IACnE,IAAI;MAAA;MAAAF,aAAA,GAAAE,CAAA;MACF;MACA,IAAIgG,OAAA,CAAQC,GAAG,CAACC,QAAQ,KAAK,eAAe;QAAA;QAAApG,aAAA,GAAAQ,CAAA;QAAAR,aAAA,GAAAE,CAAA;QAC1C4F,OAAA,CAAQO,GAAG,CAAC,iCAAiCJ,KAAA;MAC/C;MAAA;MAAA;QAAAjG,aAAA,GAAAQ,CAAA;MAAA;MAEA;MAAAR,aAAA,GAAAE,CAAA;MACA,IAAIgG,OAAA,CAAQC,GAAG,CAACC,QAAQ,KAAK,cAAc;QAAA;QAAApG,aAAA,GAAAQ,CAAA;QAAAR,aAAA,GAAAE,CAAA;QACzC,IAAI;UACF,MAAMoG,MAAA;UAAA;UAAA,CAAAtG,aAAA,GAAAE,CAAA,SAAS,MAAMqG,OAAA,CAAAC,OAAA,GAAAC,IAAA;YAAA;YAAAzG,aAAA,GAAAC,CAAA;YAAAD,aAAA,GAAAE,CAAA;YAAA,oBAAAwG,yBAAA,CAAAC,OAAA,CAAO;UAAA;UAAA;UAAA3G,aAAA,GAAAE,CAAA;UAC5BoG,MAAA,CAAOM,cAAc,CAAC,uBAAuB;YAC3CC,KAAA,EAAO;YACPC,KAAA,EAAOb;UACT;QACF,EAAE,OAAOvD,KAAA,EAAO;UAAA;UAAA1C,aAAA,GAAAE,CAAA;UACd4F,OAAA,CAAQpD,KAAK,CAAC,6CAA6CA,KAAA;QAC7D;MACF;MAAA;MAAA;QAAA1C,aAAA,GAAAQ,CAAA;MAAA;IACF,EAAE,OAAOkC,KAAA,EAAO;MAAA;MAAA1C,aAAA,GAAAE,CAAA;MACd4F,OAAA,CAAQpD,KAAK,CAAC,+CAA+CA,KAAA;IAC/D;EACF;EAEA;;;;;EAKAqE,SAAA,EAA8B;IAAA;IAAA/G,aAAA,GAAAC,CAAA;IAAAD,aAAA,GAAAE,CAAA;IAC5B,OAAO,IAAI,CAACK,KAAK;EACnB;AACF;AAEA;;;AAGA,IAAIyG,sBAAA;AAAA;AAAA,CAAAhH,aAAA,GAAAE,CAAA,SAAgD;AAa7C,SAASE,kBAAA;EAAA;EAAAJ,aAAA,GAAAC,CAAA;EAAAD,aAAA,GAAAE,CAAA;EACd,IAAI,CAAC8G,sBAAA,EAAwB;IAAA;IAAAhH,aAAA,GAAAQ,CAAA;IAAAR,aAAA,GAAAE,CAAA;IAC3B8G,sBAAA,GAAyB,IAAI7G,cAAA;EAC/B;EAAA;EAAA;IAAAH,aAAA,GAAAQ,CAAA;EAAA;EAAAR,aAAA,GAAAE,CAAA;EACA,OAAO8G,sBAAA;AACT;AAKO,SAAS3G,oBAAA;EAAA;EAAAL,aAAA,GAAAC,CAAA;EAAAD,aAAA,GAAAE,CAAA;EACd8G,sBAAA,GAAyB;AAC3B","ignoreList":[]}