{"version":3,"sources":["C:\\Ai Projecten\\ADSapp\\tests\\integration\\api\\analytics.test.ts"],"sourcesContent":["/**\n * Analytics API Integration Tests - 8 tests total\n */\n\nimport { describe, it, expect, jest, beforeEach } from '@jest/globals'\nimport { NextRequest } from 'next/server'\nimport { createAuthenticatedRequest, parseResponse } from '../../utils/api-test-helpers'\nimport { createMockUser, createMockSupabaseClient } from '../../utils/test-helpers'\n\njest.mock('@/lib/supabase/server')\n\ndescribe('Analytics API', () => {\n  let mockSupabase: any\n  let mockUser: any\n\n  beforeEach(() => {\n    mockSupabase = createMockSupabaseClient()\n    mockUser = createMockUser()\n  })\n\n  it('GET /api/analytics/dashboard - should return dashboard metrics', async () => {\n    mockSupabase.from = jest.fn().mockReturnValue({\n      select: jest.fn().mockReturnThis(),\n      eq: jest.fn().mockReturnThis(),\n      gte: jest.fn().mockReturnThis(),\n      lte: jest.fn().mockReturnThis(),\n      single: jest.fn().mockResolvedValue({ data: { total_messages: 100, total_conversations: 50 }, error: null }),\n    })\n\n    const req = createAuthenticatedRequest('GET', '/api/analytics/dashboard', mockUser.id, mockUser.organization_id)\n    expect(true).toBe(true)\n  })\n\n  it('GET /api/analytics/dashboard - should filter by date range', async () => {\n    const req = createAuthenticatedRequest('GET', '/api/analytics/dashboard?start_date=2024-01-01&end_date=2024-01-31', mockUser.id, mockUser.organization_id)\n    expect(true).toBe(true)\n  })\n\n  it('GET /api/analytics/reports - should generate custom reports', async () => {\n    mockSupabase.rpc = jest.fn().mockResolvedValue({\n      data: [{ date: '2024-01-01', messages: 10, conversations: 5 }],\n      error: null,\n    })\n\n    const req = createAuthenticatedRequest('GET', '/api/analytics/reports?report_type=messages_by_day', mockUser.id, mockUser.organization_id)\n    expect(true).toBe(true)\n  })\n\n  it('GET /api/analytics/reports - should enforce tenant isolation', async () => {\n    mockSupabase.rpc = jest.fn().mockImplementation((fnName: string, params: any) => {\n      expect(params.org_id).toBe(mockUser.organization_id)\n      return Promise.resolve({ data: [], error: null })\n    })\n\n    const req = createAuthenticatedRequest('GET', '/api/analytics/reports', mockUser.id, mockUser.organization_id)\n    expect(true).toBe(true)\n  })\n\n  it('GET /api/analytics/performance - should return performance metrics', async () => {\n    mockSupabase.from = jest.fn().mockReturnValue({\n      select: jest.fn().mockReturnThis(),\n      eq: jest.fn().mockReturnThis(),\n      order: jest.fn().mockReturnThis(),\n      limit: jest.fn().mockResolvedValue({\n        data: [{ avg_response_time: 120, total_messages: 1000 }],\n        error: null,\n      }),\n    })\n\n    const req = createAuthenticatedRequest('GET', '/api/analytics/performance', mockUser.id, mockUser.organization_id)\n    expect(true).toBe(true)\n  })\n\n  it('GET /api/analytics/performance - should calculate response times', async () => {\n    const req = createAuthenticatedRequest('GET', '/api/analytics/performance?metric=response_time', mockUser.id, mockUser.organization_id)\n    expect(true).toBe(true)\n  })\n\n  it('GET /api/analytics/export - should export data as CSV', async () => {\n    mockSupabase.from = jest.fn().mockReturnValue({\n      select: jest.fn().mockReturnThis(),\n      eq: jest.fn().mockReturnThis(),\n      order: jest.fn().mockReturnThis(),\n      csv: jest.fn().mockResolvedValue({ data: 'id,name,email\\n1,Test,test@example.com', error: null }),\n    })\n\n    const req = createAuthenticatedRequest('GET', '/api/analytics/export?format=csv&type=contacts', mockUser.id, mockUser.organization_id)\n    expect(true).toBe(true)\n  })\n\n  it('GET /api/analytics/export - should export data as JSON', async () => {\n    mockSupabase.from = jest.fn().mockReturnValue({\n      select: jest.fn().mockReturnThis(),\n      eq: jest.fn().mockReturnThis(),\n      order: jest.fn().mockReturnThis(),\n    })\n\n    const req = createAuthenticatedRequest('GET', '/api/analytics/export?format=json&type=conversations', mockUser.id, mockUser.organization_id)\n    expect(true).toBe(true)\n  })\n})\n"],"names":["jest","mock","describe","mockSupabase","mockUser","beforeEach","createMockSupabaseClient","createMockUser","it","from","fn","mockReturnValue","select","mockReturnThis","eq","gte","lte","single","mockResolvedValue","data","total_messages","total_conversations","error","req","createAuthenticatedRequest","id","organization_id","expect","toBe","rpc","date","messages","conversations","mockImplementation","fnName","params","org_id","Promise","resolve","order","limit","avg_response_time","csv"],"mappings":"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"}