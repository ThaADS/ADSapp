{"version":3,"names":["cov_1czlnethlx","actualCoverage","s","UsageTracker","initializeUsageForOrganization","organizationId","f","supabase","now","Date","startOfMonth","getFullYear","getMonth","from","upsert","organization_id","period_start","toISOString","period_end","messages_sent","users_active","contacts_managed","automation_runs","api_calls","storage_used","overage_charges","last_updated","on","existing","do_nothing","recordMessageUsage","messageCount","b","currentPeriod","getCurrentBillingPeriod","start","end","calculateAndUpdateOverages","recordUserActivity","userId","user_id","last_active","updateActiveUsersCount","recordContactUsage","contactCount","Math","max","recordAutomationUsage","automationRuns","recordApiUsage","apiCalls","recordStorageUsage","storageMB","getCurrentUsage","data","usage","select","eq","single","messages","users","contacts","storageUsed","getPlanLimits","planId","plan","_server1","SUBSCRIPTION_PLANS","getDefaultLimits","limits","maxMessages","maxUsers","maxContacts","maxAutomationRuns","automationRules","maxApiCalls","maxStorageSize","getStorageLimit","overageRates","getOverageRates","calculateOverageCharges","org","subscription_tier","totalOverage","overageMessages","ceil","messagesPerCent","overageUsers","usersPerDollar","overageContacts","contactsPerCent","overageRuns","automationRunsPerCent","overageCalls","apiCallsPerCent","overageStorage","overageGB","storagePerGb","addUsageBasedCharges","subscriptionId","amount","stripe","subscriptionItems","createUsageRecord","quantity","round","timestamp","floor","error","console","resetMonthlyUsage","currentUsage","insert","archived_at","nextPeriod","getNextBillingPeriod","updatePlanLimits","newPlanId","log","enforceDowngradeLimits","newLimits","order","ascending","length","usersToDeactivate","slice","update","is_active","in","map","u","id","count","head","contactsToArchive","nullsFirst","limit","is_archived","c","activeUsers","overageAmount","storageLimits","starter","professional","enterprise","baseRates","_server","createClient"],"sources":["C:\\Ai Projecten\\ADSapp\\src\\lib\\billing\\usage-tracking.ts"],"sourcesContent":["import { createClient } from '@/lib/supabase/server'\nimport { stripe } from '@/lib/stripe/server'\nimport { SUBSCRIPTION_PLANS } from '@/lib/stripe/server'\nimport { isBuildTime, withBuildSafeCheck } from '@/lib/build-safe-init'\n\nexport interface UsageMetrics {\n  messages: number\n  users: number\n  contacts: number\n  automationRuns: number\n  apiCalls: number\n  storageUsed: number // in MB\n}\n\nexport interface UsageLimits {\n  maxMessages: number\n  maxUsers: number\n  maxContacts: number\n  maxAutomationRuns: number\n  maxApiCalls: number\n  maxStorageSize: number // in MB\n  overageRates: {\n    messagesPerCent: number\n    usersPerDollar: number\n    contactsPerCent: number\n    automationRunsPerCent: number\n    apiCallsPerCent: number\n    storagePerGb: number\n  }\n}\n\nexport interface OverageCharges {\n  messages: number\n  users: number\n  contacts: number\n  automationRuns: number\n  apiCalls: number\n  storage: number\n  total: number\n}\n\nexport class UsageTracker {\n  private supabase = createClient()\n\n  async initializeUsageForOrganization(organizationId: string): Promise<void> {\n    const supabase = await this.supabase\n    const now = new Date()\n    const startOfMonth = new Date(now.getFullYear(), now.getMonth(), 1)\n\n    // Create initial usage record for current month\n    await supabase\n      .from('usage_tracking')\n      .upsert({\n        organization_id: organizationId,\n        period_start: startOfMonth.toISOString(),\n        period_end: new Date(now.getFullYear(), now.getMonth() + 1, 0).toISOString(),\n        messages_sent: 0,\n        users_active: 0,\n        contacts_managed: 0,\n        automation_runs: 0,\n        api_calls: 0,\n        storage_used: 0,\n        overage_charges: 0,\n        last_updated: now.toISOString(),\n      })\n      .on('conflict', (existing) => existing.do_nothing())\n  }\n\n  async recordMessageUsage(organizationId: string, messageCount: number = 1): Promise<void> {\n    const supabase = await this.supabase\n    const currentPeriod = this.getCurrentBillingPeriod()\n\n    await supabase\n      .from('usage_tracking')\n      .upsert({\n        organization_id: organizationId,\n        period_start: currentPeriod.start,\n        period_end: currentPeriod.end,\n        messages_sent: messageCount,\n        last_updated: new Date().toISOString(),\n      })\n      .on('conflict', (existing) => ({\n        ...existing,\n        messages_sent: existing.messages_sent + messageCount,\n        last_updated: new Date().toISOString(),\n      }))\n\n    // Check if usage exceeds limits and calculate overage\n    await this.calculateAndUpdateOverages(organizationId)\n  }\n\n  async recordUserActivity(organizationId: string, userId: string): Promise<void> {\n    const supabase = await this.supabase\n    const currentPeriod = this.getCurrentBillingPeriod()\n\n    // Record user activity for the current period\n    await supabase\n      .from('user_activity_tracking')\n      .upsert({\n        organization_id: organizationId,\n        user_id: userId,\n        period_start: currentPeriod.start,\n        last_active: new Date().toISOString(),\n      })\n      .on('conflict', (existing) => ({\n        ...existing,\n        last_active: new Date().toISOString(),\n      }))\n\n    // Update monthly active users count\n    await this.updateActiveUsersCount(organizationId)\n  }\n\n  async recordContactUsage(organizationId: string, contactCount: number): Promise<void> {\n    const supabase = await this.supabase\n    const currentPeriod = this.getCurrentBillingPeriod()\n\n    await supabase\n      .from('usage_tracking')\n      .upsert({\n        organization_id: organizationId,\n        period_start: currentPeriod.start,\n        period_end: currentPeriod.end,\n        contacts_managed: contactCount,\n        last_updated: new Date().toISOString(),\n      })\n      .on('conflict', (existing) => ({\n        ...existing,\n        contacts_managed: Math.max(existing.contacts_managed, contactCount),\n        last_updated: new Date().toISOString(),\n      }))\n\n    await this.calculateAndUpdateOverages(organizationId)\n  }\n\n  async recordAutomationUsage(organizationId: string, automationRuns: number = 1): Promise<void> {\n    const supabase = await this.supabase\n    const currentPeriod = this.getCurrentBillingPeriod()\n\n    await supabase\n      .from('usage_tracking')\n      .upsert({\n        organization_id: organizationId,\n        period_start: currentPeriod.start,\n        period_end: currentPeriod.end,\n        automation_runs: automationRuns,\n        last_updated: new Date().toISOString(),\n      })\n      .on('conflict', (existing) => ({\n        ...existing,\n        automation_runs: existing.automation_runs + automationRuns,\n        last_updated: new Date().toISOString(),\n      }))\n\n    await this.calculateAndUpdateOverages(organizationId)\n  }\n\n  async recordApiUsage(organizationId: string, apiCalls: number = 1): Promise<void> {\n    const supabase = await this.supabase\n    const currentPeriod = this.getCurrentBillingPeriod()\n\n    await supabase\n      .from('usage_tracking')\n      .upsert({\n        organization_id: organizationId,\n        period_start: currentPeriod.start,\n        period_end: currentPeriod.end,\n        api_calls: apiCalls,\n        last_updated: new Date().toISOString(),\n      })\n      .on('conflict', (existing) => ({\n        ...existing,\n        api_calls: existing.api_calls + apiCalls,\n        last_updated: new Date().toISOString(),\n      }))\n\n    await this.calculateAndUpdateOverages(organizationId)\n  }\n\n  async recordStorageUsage(organizationId: string, storageMB: number): Promise<void> {\n    const supabase = await this.supabase\n    const currentPeriod = this.getCurrentBillingPeriod()\n\n    await supabase\n      .from('usage_tracking')\n      .upsert({\n        organization_id: organizationId,\n        period_start: currentPeriod.start,\n        period_end: currentPeriod.end,\n        storage_used: storageMB,\n        last_updated: new Date().toISOString(),\n      })\n      .on('conflict', (existing) => ({\n        ...existing,\n        storage_used: Math.max(existing.storage_used, storageMB),\n        last_updated: new Date().toISOString(),\n      }))\n\n    await this.calculateAndUpdateOverages(organizationId)\n  }\n\n  async getCurrentUsage(organizationId: string): Promise<UsageMetrics> {\n    const supabase = await this.supabase\n    const currentPeriod = this.getCurrentBillingPeriod()\n\n    const { data: usage } = await supabase\n      .from('usage_tracking')\n      .select('*')\n      .eq('organization_id', organizationId)\n      .eq('period_start', currentPeriod.start)\n      .single()\n\n    if (!usage) {\n      return {\n        messages: 0,\n        users: 0,\n        contacts: 0,\n        automationRuns: 0,\n        apiCalls: 0,\n        storageUsed: 0,\n      }\n    }\n\n    return {\n      messages: usage.messages_sent || 0,\n      users: usage.users_active || 0,\n      contacts: usage.contacts_managed || 0,\n      automationRuns: usage.automation_runs || 0,\n      apiCalls: usage.api_calls || 0,\n      storageUsed: usage.storage_used || 0,\n    }\n  }\n\n  async getPlanLimits(planId: string): Promise<UsageLimits> {\n    const plan = SUBSCRIPTION_PLANS[planId as keyof typeof SUBSCRIPTION_PLANS]\n    if (!plan) {\n      return this.getDefaultLimits()\n    }\n\n    // Enhanced limits with overage rates\n    const limits: UsageLimits = {\n      maxMessages: plan.limits.maxMessages,\n      maxUsers: plan.limits.maxUsers,\n      maxContacts: plan.limits.maxContacts,\n      maxAutomationRuns: plan.limits.automationRules * 100, // 100 runs per rule\n      maxApiCalls: plan.limits.maxMessages * 2, // 2 API calls per message\n      maxStorageSize: this.getStorageLimit(planId),\n      overageRates: this.getOverageRates(planId),\n    }\n\n    return limits\n  }\n\n  async calculateOverageCharges(organizationId: string): Promise<number> {\n    const supabase = await this.supabase\n\n    // Get organization plan\n    const { data: org } = await supabase\n      .from('organizations')\n      .select('subscription_tier')\n      .eq('id', organizationId)\n      .single()\n\n    if (!org) return 0\n\n    const usage = await this.getCurrentUsage(organizationId)\n    const limits = await this.getPlanLimits(org.subscription_tier)\n\n    let totalOverage = 0\n\n    // Calculate message overage\n    if (limits.maxMessages !== -1 && usage.messages > limits.maxMessages) {\n      const overageMessages = usage.messages - limits.maxMessages\n      totalOverage += Math.ceil(overageMessages / 100) * limits.overageRates.messagesPerCent\n    }\n\n    // Calculate user overage\n    if (limits.maxUsers !== -1 && usage.users > limits.maxUsers) {\n      const overageUsers = usage.users - limits.maxUsers\n      totalOverage += overageUsers * limits.overageRates.usersPerDollar\n    }\n\n    // Calculate contact overage\n    if (limits.maxContacts !== -1 && usage.contacts > limits.maxContacts) {\n      const overageContacts = usage.contacts - limits.maxContacts\n      totalOverage += Math.ceil(overageContacts / 100) * limits.overageRates.contactsPerCent\n    }\n\n    // Calculate automation overage\n    if (limits.maxAutomationRuns !== -1 && usage.automationRuns > limits.maxAutomationRuns) {\n      const overageRuns = usage.automationRuns - limits.maxAutomationRuns\n      totalOverage += Math.ceil(overageRuns / 100) * limits.overageRates.automationRunsPerCent\n    }\n\n    // Calculate API overage\n    if (limits.maxApiCalls !== -1 && usage.apiCalls > limits.maxApiCalls) {\n      const overageCalls = usage.apiCalls - limits.maxApiCalls\n      totalOverage += Math.ceil(overageCalls / 1000) * limits.overageRates.apiCallsPerCent\n    }\n\n    // Calculate storage overage\n    if (limits.maxStorageSize !== -1 && usage.storageUsed > limits.maxStorageSize) {\n      const overageStorage = usage.storageUsed - limits.maxStorageSize\n      const overageGB = Math.ceil(overageStorage / 1024)\n      totalOverage += overageGB * limits.overageRates.storagePerGb\n    }\n\n    return totalOverage\n  }\n\n  async addUsageBasedCharges(subscriptionId: string, amount: number): Promise<void> {\n    if (amount <= 0) return\n\n    try {\n      // Create usage record on subscription\n      await stripe.subscriptionItems.createUsageRecord(\n        subscriptionId,\n        {\n          quantity: Math.round(amount * 100), // Convert to cents\n          timestamp: Math.floor(Date.now() / 1000),\n        }\n      )\n    } catch (error) {\n      console.error('Failed to add usage-based charges:', error)\n    }\n  }\n\n  async resetMonthlyUsage(organizationId: string): Promise<void> {\n    const supabase = await this.supabase\n    const currentPeriod = this.getCurrentBillingPeriod()\n\n    // Archive current usage\n    const { data: currentUsage } = await supabase\n      .from('usage_tracking')\n      .select('*')\n      .eq('organization_id', organizationId)\n      .eq('period_start', currentPeriod.start)\n      .single()\n\n    if (currentUsage) {\n      await supabase\n        .from('usage_history')\n        .insert({\n          ...currentUsage,\n          archived_at: new Date().toISOString(),\n        })\n    }\n\n    // Create new usage record for next month\n    const nextPeriod = this.getNextBillingPeriod()\n    await supabase\n      .from('usage_tracking')\n      .upsert({\n        organization_id: organizationId,\n        period_start: nextPeriod.start,\n        period_end: nextPeriod.end,\n        messages_sent: 0,\n        users_active: 0,\n        contacts_managed: 0,\n        automation_runs: 0,\n        api_calls: 0,\n        storage_used: 0,\n        overage_charges: 0,\n        last_updated: new Date().toISOString(),\n      })\n  }\n\n  async updatePlanLimits(organizationId: string, newPlanId: string): Promise<void> {\n    // Implementation for updating plan limits\n    console.log(`Updating plan limits for org ${organizationId} to ${newPlanId}`)\n  }\n\n  async enforceDowngradeLimits(organizationId: string, newPlanId: string): Promise<void> {\n    const supabase = await this.supabase\n    const newLimits = await this.getPlanLimits(newPlanId)\n\n    // Enforce user limits\n    if (newLimits.maxUsers !== -1) {\n      const { data: users } = await supabase\n        .from('profiles')\n        .select('id')\n        .eq('organization_id', organizationId)\n        .order('created_at', { ascending: true })\n\n      if (users && users.length > newLimits.maxUsers) {\n        const usersToDeactivate = users.slice(newLimits.maxUsers)\n        await supabase\n          .from('profiles')\n          .update({ is_active: false })\n          .in('id', usersToDeactivate.map(u => u.id))\n      }\n    }\n\n    // Enforce contact limits\n    if (newLimits.maxContacts !== -1) {\n      const { count: contactCount } = await supabase\n        .from('contacts')\n        .select('*', { count: 'exact', head: true })\n        .eq('organization_id', organizationId)\n\n      if (contactCount && contactCount > newLimits.maxContacts) {\n        // Archive oldest contacts\n        const { data: contactsToArchive } = await supabase\n          .from('contacts')\n          .select('id')\n          .eq('organization_id', organizationId)\n          .order('last_message_at', { ascending: true, nullsFirst: true })\n          .limit(contactCount - newLimits.maxContacts)\n\n        if (contactsToArchive) {\n          await supabase\n            .from('contacts')\n            .update({ is_archived: true })\n            .in('id', contactsToArchive.map(c => c.id))\n        }\n      }\n    }\n  }\n\n  private async updateActiveUsersCount(organizationId: string): Promise<void> {\n    const supabase = await this.supabase\n    const currentPeriod = this.getCurrentBillingPeriod()\n\n    // Count unique active users in current period\n    const { count: activeUsers } = await supabase\n      .from('user_activity_tracking')\n      .select('user_id', { count: 'exact', head: true })\n      .eq('organization_id', organizationId)\n      .eq('period_start', currentPeriod.start)\n\n    // Update usage tracking\n    await supabase\n      .from('usage_tracking')\n      .upsert({\n        organization_id: organizationId,\n        period_start: currentPeriod.start,\n        period_end: currentPeriod.end,\n        users_active: activeUsers || 0,\n        last_updated: new Date().toISOString(),\n      })\n      .on('conflict', (existing) => ({\n        ...existing,\n        users_active: activeUsers || 0,\n        last_updated: new Date().toISOString(),\n      }))\n  }\n\n  private async calculateAndUpdateOverages(organizationId: string): Promise<void> {\n    const overageAmount = await this.calculateOverageCharges(organizationId)\n\n    if (overageAmount > 0) {\n      const supabase = await this.supabase\n      const currentPeriod = this.getCurrentBillingPeriod()\n\n      await supabase\n        .from('usage_tracking')\n        .update({\n          overage_charges: overageAmount,\n          last_updated: new Date().toISOString(),\n        })\n        .eq('organization_id', organizationId)\n        .eq('period_start', currentPeriod.start)\n    }\n  }\n\n  private getCurrentBillingPeriod(): { start: string; end: string } {\n    const now = new Date()\n    const start = new Date(now.getFullYear(), now.getMonth(), 1)\n    const end = new Date(now.getFullYear(), now.getMonth() + 1, 0)\n\n    return {\n      start: start.toISOString(),\n      end: end.toISOString(),\n    }\n  }\n\n  private getNextBillingPeriod(): { start: string; end: string } {\n    const now = new Date()\n    const start = new Date(now.getFullYear(), now.getMonth() + 1, 1)\n    const end = new Date(now.getFullYear(), now.getMonth() + 2, 0)\n\n    return {\n      start: start.toISOString(),\n      end: end.toISOString(),\n    }\n  }\n\n  private getStorageLimit(planId: string): number {\n    const storageLimits = {\n      starter: 1024, // 1GB\n      professional: 10240, // 10GB\n      enterprise: -1, // Unlimited\n    }\n    return storageLimits[planId as keyof typeof storageLimits] || 1024\n  }\n\n  private getOverageRates(planId: string): UsageLimits['overageRates'] {\n    const baseRates = {\n      messagesPerCent: 2, // $0.02 per 100 messages\n      usersPerDollar: 5, // $5 per additional user\n      contactsPerCent: 1, // $0.01 per 100 contacts\n      automationRunsPerCent: 1, // $0.01 per 100 runs\n      apiCallsPerCent: 1, // $0.01 per 1000 calls\n      storagePerGb: 1, // $1 per GB\n    }\n\n    // Enterprise gets better rates\n    if (planId === 'enterprise') {\n      return {\n        messagesPerCent: 1,\n        usersPerDollar: 3,\n        contactsPerCent: 0.5,\n        automationRunsPerCent: 0.5,\n        apiCallsPerCent: 0.5,\n        storagePerGb: 0.5,\n      }\n    }\n\n    return baseRates\n  }\n\n  private getDefaultLimits(): UsageLimits {\n    return {\n      maxMessages: 1000,\n      maxUsers: 3,\n      maxContacts: 1000,\n      maxAutomationRuns: 500,\n      maxApiCalls: 2000,\n      maxStorageSize: 1024,\n      overageRates: this.getOverageRates('starter'),\n    }\n  }\n}"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;IA8CI;IAAAA,cAAA,YAA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","ignoreList":[]}