f0989d4b27f7a453b8cc30370ef8b1f8
"use strict";

/* istanbul ignore next */
function cov_9uaxcrozx() {
  var path = "C:\\Ai Projecten\\ADSapp\\src\\lib\\billing\\subscription-lifecycle.ts";
  var hash = "5d47499b13a839a3229c325ebaeb40f7b4564ebf";
  var global = new Function("return this")();
  var gcv = "__coverage__";
  var coverageData = {
    path: "C:\\Ai Projecten\\ADSapp\\src\\lib\\billing\\subscription-lifecycle.ts",
    statementMap: {
      "0": {
        start: {
          line: 2,
          column: 0
        },
        end: {
          line: 4,
          column: 3
        }
      },
      "1": {
        start: {
          line: 5,
          column: 0
        },
        end: {
          line: 10,
          column: 3
        }
      },
      "2": {
        start: {
          line: 8,
          column: 8
        },
        end: {
          line: 8,
          column: 44
        }
      },
      "3": {
        start: {
          line: 11,
          column: 16
        },
        end: {
          line: 11,
          column: 45
        }
      },
      "4": {
        start: {
          line: 12,
          column: 17
        },
        end: {
          line: 12,
          column: 44
        }
      },
      "5": {
        start: {
          line: 13,
          column: 23
        },
        end: {
          line: 13,
          column: 50
        }
      },
      "6": {
        start: {
          line: 14,
          column: 29
        },
        end: {
          line: 14,
          column: 62
        }
      },
      "7": {
        start: {
          line: 17,
          column: 8
        },
        end: {
          line: 19,
          column: 9
        }
      },
      "8": {
        start: {
          line: 18,
          column: 12
        },
        end: {
          line: 18,
          column: 66
        }
      },
      "9": {
        start: {
          line: 20,
          column: 8
        },
        end: {
          line: 20,
          column: 33
        }
      },
      "10": {
        start: {
          line: 23,
          column: 8
        },
        end: {
          line: 25,
          column: 9
        }
      },
      "11": {
        start: {
          line: 24,
          column: 12
        },
        end: {
          line: 24,
          column: 86
        }
      },
      "12": {
        start: {
          line: 26,
          column: 8
        },
        end: {
          line: 26,
          column: 40
        }
      },
      "13": {
        start: {
          line: 31,
          column: 25
        },
        end: {
          line: 31,
          column: 44
        }
      },
      "14": {
        start: {
          line: 33,
          column: 30
        },
        end: {
          line: 33,
          column: 172
        }
      },
      "15": {
        start: {
          line: 34,
          column: 8
        },
        end: {
          line: 36,
          column: 9
        }
      },
      "16": {
        start: {
          line: 35,
          column: 12
        },
        end: {
          line: 35,
          column: 60
        }
      },
      "17": {
        start: {
          line: 37,
          column: 36
        },
        end: {
          line: 37,
          column: 108
        }
      },
      "18": {
        start: {
          line: 38,
          column: 24
        },
        end: {
          line: 38,
          column: 62
        }
      },
      "19": {
        start: {
          line: 39,
          column: 8
        },
        end: {
          line: 41,
          column: 9
        }
      },
      "20": {
        start: {
          line: 40,
          column: 12
        },
        end: {
          line: 40,
          column: 47
        }
      },
      "21": {
        start: {
          line: 43,
          column: 30
        },
        end: {
          line: 43,
          column: 31
        }
      },
      "22": {
        start: {
          line: 44,
          column: 8
        },
        end: {
          line: 46,
          column: 9
        }
      },
      "23": {
        start: {
          line: 45,
          column: 12
        },
        end: {
          line: 45,
          column: 104
        }
      },
      "24": {
        start: {
          line: 48,
          column: 36
        },
        end: {
          line: 64,
          column: 10
        }
      },
      "25": {
        start: {
          line: 66,
          column: 8
        },
        end: {
          line: 69,
          column: 36
        }
      },
      "26": {
        start: {
          line: 71,
          column: 8
        },
        end: {
          line: 77,
          column: 11
        }
      },
      "27": {
        start: {
          line: 79,
          column: 8
        },
        end: {
          line: 79,
          column: 81
        }
      },
      "28": {
        start: {
          line: 81,
          column: 8
        },
        end: {
          line: 81,
          column: 99
        }
      },
      "29": {
        start: {
          line: 82,
          column: 8
        },
        end: {
          line: 85,
          column: 10
        }
      },
      "30": {
        start: {
          line: 90,
          column: 25
        },
        end: {
          line: 90,
          column: 44
        }
      },
      "31": {
        start: {
          line: 92,
          column: 30
        },
        end: {
          line: 92,
          column: 152
        }
      },
      "32": {
        start: {
          line: 93,
          column: 8
        },
        end: {
          line: 95,
          column: 9
        }
      },
      "33": {
        start: {
          line: 94,
          column: 12
        },
        end: {
          line: 94,
          column: 60
        }
      },
      "34": {
        start: {
          line: 96,
          column: 36
        },
        end: {
          line: 96,
          column: 108
        }
      },
      "35": {
        start: {
          line: 97,
          column: 24
        },
        end: {
          line: 97,
          column: 62
        }
      },
      "36": {
        start: {
          line: 99,
          column: 29
        },
        end: {
          line: 99,
          column: 89
        }
      },
      "37": {
        start: {
          line: 100,
          column: 26
        },
        end: {
          line: 100,
          column: 79
        }
      },
      "38": {
        start: {
          line: 101,
          column: 32
        },
        end: {
          line: 101,
          column: 82
        }
      },
      "39": {
        start: {
          line: 102,
          column: 8
        },
        end: {
          line: 104,
          column: 9
        }
      },
      "40": {
        start: {
          line: 103,
          column: 12
        },
        end: {
          line: 103,
          column: 118
        }
      },
      "41": {
        start: {
          line: 106,
          column: 30
        },
        end: {
          line: 106,
          column: 31
        }
      },
      "42": {
        start: {
          line: 107,
          column: 8
        },
        end: {
          line: 109,
          column: 9
        }
      },
      "43": {
        start: {
          line: 108,
          column: 12
        },
        end: {
          line: 108,
          column: 104
        }
      },
      "44": {
        start: {
          line: 111,
          column: 36
        },
        end: {
          line: 125,
          column: 10
        }
      },
      "45": {
        start: {
          line: 127,
          column: 8
        },
        end: {
          line: 130,
          column: 36
        }
      },
      "46": {
        start: {
          line: 132,
          column: 8
        },
        end: {
          line: 138,
          column: 11
        }
      },
      "47": {
        start: {
          line: 140,
          column: 8
        },
        end: {
          line: 140,
          column: 87
        }
      },
      "48": {
        start: {
          line: 142,
          column: 8
        },
        end: {
          line: 142,
          column: 101
        }
      },
      "49": {
        start: {
          line: 143,
          column: 8
        },
        end: {
          line: 146,
          column: 10
        }
      },
      "50": {
        start: {
          line: 149,
          column: 25
        },
        end: {
          line: 149,
          column: 44
        }
      },
      "51": {
        start: {
          line: 151,
          column: 30
        },
        end: {
          line: 151,
          column: 152
        }
      },
      "52": {
        start: {
          line: 152,
          column: 8
        },
        end: {
          line: 154,
          column: 9
        }
      },
      "53": {
        start: {
          line: 153,
          column: 12
        },
        end: {
          line: 153,
          column: 60
        }
      },
      "54": {
        start: {
          line: 157,
          column: 8
        },
        end: {
          line: 182,
          column: 9
        }
      },
      "55": {
        start: {
          line: 159,
          column: 12
        },
        end: {
          line: 159,
          column: 106
        }
      },
      "56": {
        start: {
          line: 160,
          column: 12
        },
        end: {
          line: 160,
          column: 39
        }
      },
      "57": {
        start: {
          line: 162,
          column: 12
        },
        end: {
          line: 166,
          column: 40
        }
      },
      "58": {
        start: {
          line: 168,
          column: 12
        },
        end: {
          line: 170,
          column: 13
        }
      },
      "59": {
        start: {
          line: 169,
          column: 16
        },
        end: {
          line: 169,
          column: 95
        }
      },
      "60": {
        start: {
          line: 173,
          column: 12
        },
        end: {
          line: 180,
          column: 15
        }
      },
      "61": {
        start: {
          line: 181,
          column: 12
        },
        end: {
          line: 181,
          column: 85
        }
      },
      "62": {
        start: {
          line: 184,
          column: 8
        },
        end: {
          line: 189,
          column: 11
        }
      },
      "63": {
        start: {
          line: 191,
          column: 8
        },
        end: {
          line: 199,
          column: 11
        }
      },
      "64": {
        start: {
          line: 201,
          column: 8
        },
        end: {
          line: 201,
          column: 89
        }
      },
      "65": {
        start: {
          line: 203,
          column: 8
        },
        end: {
          line: 205,
          column: 9
        }
      },
      "66": {
        start: {
          line: 204,
          column: 12
        },
        end: {
          line: 204,
          column: 62
        }
      },
      "67": {
        start: {
          line: 206,
          column: 8
        },
        end: {
          line: 209,
          column: 10
        }
      },
      "68": {
        start: {
          line: 212,
          column: 25
        },
        end: {
          line: 212,
          column: 44
        }
      },
      "69": {
        start: {
          line: 214,
          column: 30
        },
        end: {
          line: 214,
          column: 153
        }
      },
      "70": {
        start: {
          line: 215,
          column: 8
        },
        end: {
          line: 217,
          column: 9
        }
      },
      "71": {
        start: {
          line: 216,
          column: 12
        },
        end: {
          line: 216,
          column: 49
        }
      },
      "72": {
        start: {
          line: 219,
          column: 8
        },
        end: {
          line: 245,
          column: 9
        }
      },
      "73": {
        start: {
          line: 221,
          column: 12
        },
        end: {
          line: 241,
          column: 13
        }
      },
      "74": {
        start: {
          line: 222,
          column: 45
        },
        end: {
          line: 222,
          column: 117
        }
      },
      "75": {
        start: {
          line: 223,
          column: 16
        },
        end: {
          line: 237,
          column: 17
        }
      },
      "76": {
        start: {
          line: 225,
          column: 20
        },
        end: {
          line: 225,
          column: 116
        }
      },
      "77": {
        start: {
          line: 228,
          column: 20
        },
        end: {
          line: 236,
          column: 23
        }
      },
      "78": {
        start: {
          line: 240,
          column: 16
        },
        end: {
          line: 240,
          column: 112
        }
      },
      "79": {
        start: {
          line: 244,
          column: 12
        },
        end: {
          line: 244,
          column: 108
        }
      },
      "80": {
        start: {
          line: 247,
          column: 8
        },
        end: {
          line: 252,
          column: 36
        }
      },
      "81": {
        start: {
          line: 254,
          column: 8
        },
        end: {
          line: 259,
          column: 11
        }
      },
      "82": {
        start: {
          line: 261,
          column: 8
        },
        end: {
          line: 261,
          column: 97
        }
      },
      "83": {
        start: {
          line: 262,
          column: 8
        },
        end: {
          line: 262,
          column: 28
        }
      },
      "84": {
        start: {
          line: 266,
          column: 25
        },
        end: {
          line: 266,
          column: 44
        }
      },
      "85": {
        start: {
          line: 268,
          column: 30
        },
        end: {
          line: 268,
          column: 133
        }
      },
      "86": {
        start: {
          line: 269,
          column: 8
        },
        end: {
          line: 271,
          column: 9
        }
      },
      "87": {
        start: {
          line: 270,
          column: 12
        },
        end: {
          line: 270,
          column: 60
        }
      },
      "88": {
        start: {
          line: 272,
          column: 25
        },
        end: {
          line: 272,
          column: 35
        }
      },
      "89": {
        start: {
          line: 273,
          column: 8
        },
        end: {
          line: 273,
          column: 61
        }
      },
      "90": {
        start: {
          line: 275,
          column: 35
        },
        end: {
          line: 284,
          column: 10
        }
      },
      "91": {
        start: {
          line: 286,
          column: 8
        },
        end: {
          line: 289,
          column: 36
        }
      },
      "92": {
        start: {
          line: 290,
          column: 8
        },
        end: {
          line: 290,
          column: 34
        }
      },
      "93": {
        start: {
          line: 293,
          column: 25
        },
        end: {
          line: 293,
          column: 44
        }
      },
      "94": {
        start: {
          line: 294,
          column: 30
        },
        end: {
          line: 294,
          column: 112
        }
      },
      "95": {
        start: {
          line: 295,
          column: 8
        },
        end: {
          line: 297,
          column: 9
        }
      },
      "96": {
        start: {
          line: 296,
          column: 12
        },
        end: {
          line: 296,
          column: 24
        }
      },
      "97": {
        start: {
          line: 298,
          column: 29
        },
        end: {
          line: 298,
          column: 101
        }
      },
      "98": {
        start: {
          line: 299,
          column: 21
        },
        end: {
          line: 299,
          column: 71
        }
      },
      "99": {
        start: {
          line: 300,
          column: 20
        },
        end: {
          line: 300,
          column: 30
        }
      },
      "100": {
        start: {
          line: 301,
          column: 20
        },
        end: {
          line: 301,
          column: 28
        }
      },
      "101": {
        start: {
          line: 302,
          column: 8
        },
        end: {
          line: 316,
          column: 10
        }
      },
      "102": {
        start: {
          line: 319,
          column: 25
        },
        end: {
          line: 319,
          column: 44
        }
      },
      "103": {
        start: {
          line: 320,
          column: 34
        },
        end: {
          line: 322,
          column: 10
        }
      },
      "104": {
        start: {
          line: 323,
          column: 8
        },
        end: {
          line: 323,
          column: 29
        }
      },
      "105": {
        start: {
          line: 327,
          column: 30
        },
        end: {
          line: 331,
          column: 10
        }
      },
      "106": {
        start: {
          line: 332,
          column: 8
        },
        end: {
          line: 339,
          column: 9
        }
      },
      "107": {
        start: {
          line: 333,
          column: 35
        },
        end: {
          line: 333,
          column: 71
        }
      },
      "108": {
        start: {
          line: 334,
          column: 12
        },
        end: {
          line: 334,
          column: 42
        }
      },
      "109": {
        start: {
          line: 334,
          column: 33
        },
        end: {
          line: 334,
          column: 42
        }
      },
      "110": {
        start: {
          line: 336,
          column: 12
        },
        end: {
          line: 338,
          column: 13
        }
      },
      "111": {
        start: {
          line: 337,
          column: 16
        },
        end: {
          line: 337,
          column: 81
        }
      },
      "112": {
        start: {
          line: 343,
          column: 8
        },
        end: {
          line: 359,
          column: 9
        }
      },
      "113": {
        start: {
          line: 344,
          column: 28
        },
        end: {
          line: 354,
          column: 14
        }
      },
      "114": {
        start: {
          line: 355,
          column: 12
        },
        end: {
          line: 355,
          column: 38
        }
      },
      "115": {
        start: {
          line: 357,
          column: 12
        },
        end: {
          line: 357,
          column: 65
        }
      },
      "116": {
        start: {
          line: 358,
          column: 12
        },
        end: {
          line: 358,
          column: 21
        }
      },
      "117": {
        start: {
          line: 362,
          column: 27
        },
        end: {
          line: 362,
          column: 29
        }
      },
      "118": {
        start: {
          line: 363,
          column: 8
        },
        end: {
          line: 365,
          column: 9
        }
      },
      "119": {
        start: {
          line: 364,
          column: 12
        },
        end: {
          line: 364,
          column: 83
        }
      },
      "120": {
        start: {
          line: 366,
          column: 8
        },
        end: {
          line: 368,
          column: 9
        }
      },
      "121": {
        start: {
          line: 367,
          column: 12
        },
        end: {
          line: 367,
          column: 92
        }
      },
      "122": {
        start: {
          line: 369,
          column: 8
        },
        end: {
          line: 371,
          column: 9
        }
      },
      "123": {
        start: {
          line: 370,
          column: 12
        },
        end: {
          line: 370,
          column: 92
        }
      },
      "124": {
        start: {
          line: 372,
          column: 8
        },
        end: {
          line: 372,
          column: 26
        }
      },
      "125": {
        start: {
          line: 375,
          column: 21
        },
        end: {
          line: 375,
          column: 56
        }
      },
      "126": {
        start: {
          line: 376,
          column: 8
        },
        end: {
          line: 387,
          column: 11
        }
      },
      "127": {
        start: {
          line: 391,
          column: 8
        },
        end: {
          line: 391,
          column: 52
        }
      },
      "128": {
        start: {
          line: 391,
          column: 39
        },
        end: {
          line: 391,
          column: 52
        }
      },
      "129": {
        start: {
          line: 392,
          column: 29
        },
        end: {
          line: 392,
          column: 70
        }
      },
      "130": {
        start: {
          line: 393,
          column: 38
        },
        end: {
          line: 393,
          column: 99
        }
      },
      "131": {
        start: {
          line: 394,
          column: 8
        },
        end: {
          line: 394,
          column: 43
        }
      },
      "132": {
        start: {
          line: 397,
          column: 25
        },
        end: {
          line: 397,
          column: 44
        }
      },
      "133": {
        start: {
          line: 398,
          column: 8
        },
        end: {
          line: 406,
          column: 11
        }
      },
      "134": {
        start: {
          line: 410,
          column: 8
        },
        end: {
          line: 410,
          column: 85
        }
      },
      "135": {
        start: {
          line: 413,
          column: 25
        },
        end: {
          line: 413,
          column: 44
        }
      },
      "136": {
        start: {
          line: 414,
          column: 8
        },
        end: {
          line: 419,
          column: 36
        }
      },
      "137": {
        start: {
          line: 421,
          column: 8
        },
        end: {
          line: 421,
          column: 87
        }
      },
      "138": {
        start: {
          line: 424,
          column: 8
        },
        end: {
          line: 424,
          column: 52
        }
      },
      "139": {
        start: {
          line: 425,
          column: 8
        },
        end: {
          line: 425,
          column: 33
        }
      },
      "140": {
        start: {
          line: 426,
          column: 8
        },
        end: {
          line: 426,
          column: 40
        }
      }
    },
    fnMap: {
      "0": {
        name: "(anonymous_0)",
        decl: {
          start: {
            line: 7,
            column: 9
          },
          end: {
            line: 7,
            column: 10
          }
        },
        loc: {
          start: {
            line: 7,
            column: 20
          },
          end: {
            line: 9,
            column: 5
          }
        },
        line: 7
      },
      "1": {
        name: "(anonymous_1)",
        decl: {
          start: {
            line: 16,
            column: 4
          },
          end: {
            line: 16,
            column: 5
          }
        },
        loc: {
          start: {
            line: 16,
            column: 22
          },
          end: {
            line: 21,
            column: 5
          }
        },
        line: 16
      },
      "2": {
        name: "(anonymous_2)",
        decl: {
          start: {
            line: 22,
            column: 4
          },
          end: {
            line: 22,
            column: 5
          }
        },
        loc: {
          start: {
            line: 22,
            column: 29
          },
          end: {
            line: 27,
            column: 5
          }
        },
        line: 22
      },
      "3": {
        name: "(anonymous_3)",
        decl: {
          start: {
            line: 28,
            column: 4
          },
          end: {
            line: 28,
            column: 5
          }
        },
        loc: {
          start: {
            line: 30,
            column: 7
          },
          end: {
            line: 86,
            column: 5
          }
        },
        line: 30
      },
      "4": {
        name: "(anonymous_4)",
        decl: {
          start: {
            line: 87,
            column: 4
          },
          end: {
            line: 87,
            column: 5
          }
        },
        loc: {
          start: {
            line: 89,
            column: 7
          },
          end: {
            line: 147,
            column: 5
          }
        },
        line: 89
      },
      "5": {
        name: "(anonymous_5)",
        decl: {
          start: {
            line: 148,
            column: 4
          },
          end: {
            line: 148,
            column: 5
          }
        },
        loc: {
          start: {
            line: 148,
            column: 54
          },
          end: {
            line: 210,
            column: 5
          }
        },
        line: 148
      },
      "6": {
        name: "(anonymous_6)",
        decl: {
          start: {
            line: 211,
            column: 4
          },
          end: {
            line: 211,
            column: 5
          }
        },
        loc: {
          start: {
            line: 211,
            column: 57
          },
          end: {
            line: 263,
            column: 5
          }
        },
        line: 211
      },
      "7": {
        name: "(anonymous_7)",
        decl: {
          start: {
            line: 264,
            column: 4
          },
          end: {
            line: 264,
            column: 5
          }
        },
        loc: {
          start: {
            line: 265,
            column: 6
          },
          end: {
            line: 291,
            column: 5
          }
        },
        line: 265
      },
      "8": {
        name: "(anonymous_8)",
        decl: {
          start: {
            line: 292,
            column: 4
          },
          end: {
            line: 292,
            column: 5
          }
        },
        loc: {
          start: {
            line: 292,
            column: 49
          },
          end: {
            line: 317,
            column: 5
          }
        },
        line: 292
      },
      "9": {
        name: "(anonymous_9)",
        decl: {
          start: {
            line: 318,
            column: 4
          },
          end: {
            line: 318,
            column: 5
          }
        },
        loc: {
          start: {
            line: 318,
            column: 49
          },
          end: {
            line: 324,
            column: 5
          }
        },
        line: 318
      },
      "10": {
        name: "(anonymous_10)",
        decl: {
          start: {
            line: 325,
            column: 4
          },
          end: {
            line: 325,
            column: 5
          }
        },
        loc: {
          start: {
            line: 325,
            column: 40
          },
          end: {
            line: 340,
            column: 5
          }
        },
        line: 325
      },
      "11": {
        name: "(anonymous_11)",
        decl: {
          start: {
            line: 342,
            column: 4
          },
          end: {
            line: 342,
            column: 5
          }
        },
        loc: {
          start: {
            line: 342,
            column: 62
          },
          end: {
            line: 360,
            column: 5
          }
        },
        line: 342
      },
      "12": {
        name: "(anonymous_12)",
        decl: {
          start: {
            line: 361,
            column: 4
          },
          end: {
            line: 361,
            column: 5
          }
        },
        loc: {
          start: {
            line: 361,
            column: 50
          },
          end: {
            line: 373,
            column: 5
          }
        },
        line: 361
      },
      "13": {
        name: "(anonymous_13)",
        decl: {
          start: {
            line: 374,
            column: 4
          },
          end: {
            line: 374,
            column: 5
          }
        },
        loc: {
          start: {
            line: 374,
            column: 68
          },
          end: {
            line: 388,
            column: 5
          }
        },
        line: 374
      },
      "14": {
        name: "(anonymous_14)",
        decl: {
          start: {
            line: 389,
            column: 4
          },
          end: {
            line: 389,
            column: 5
          }
        },
        loc: {
          start: {
            line: 389,
            column: 41
          },
          end: {
            line: 395,
            column: 5
          }
        },
        line: 389
      },
      "15": {
        name: "(anonymous_15)",
        decl: {
          start: {
            line: 396,
            column: 4
          },
          end: {
            line: 396,
            column: 5
          }
        },
        loc: {
          start: {
            line: 396,
            column: 56
          },
          end: {
            line: 407,
            column: 5
          }
        },
        line: 396
      },
      "16": {
        name: "(anonymous_16)",
        decl: {
          start: {
            line: 408,
            column: 4
          },
          end: {
            line: 408,
            column: 5
          }
        },
        loc: {
          start: {
            line: 408,
            column: 49
          },
          end: {
            line: 411,
            column: 5
          }
        },
        line: 408
      },
      "17": {
        name: "(anonymous_17)",
        decl: {
          start: {
            line: 412,
            column: 4
          },
          end: {
            line: 412,
            column: 5
          }
        },
        loc: {
          start: {
            line: 412,
            column: 63
          },
          end: {
            line: 422,
            column: 5
          }
        },
        line: 412
      },
      "18": {
        name: "(anonymous_18)",
        decl: {
          start: {
            line: 423,
            column: 4
          },
          end: {
            line: 423,
            column: 5
          }
        },
        loc: {
          start: {
            line: 423,
            column: 17
          },
          end: {
            line: 427,
            column: 5
          }
        },
        line: 423
      }
    },
    branchMap: {
      "0": {
        loc: {
          start: {
            line: 17,
            column: 8
          },
          end: {
            line: 19,
            column: 9
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 17,
            column: 8
          },
          end: {
            line: 19,
            column: 9
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 17
      },
      "1": {
        loc: {
          start: {
            line: 23,
            column: 8
          },
          end: {
            line: 25,
            column: 9
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 23,
            column: 8
          },
          end: {
            line: 25,
            column: 9
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 23
      },
      "2": {
        loc: {
          start: {
            line: 28,
            column: 57
          },
          end: {
            line: 30,
            column: 5
          }
        },
        type: "default-arg",
        locations: [{
          start: {
            line: 28,
            column: 67
          },
          end: {
            line: 30,
            column: 5
          }
        }],
        line: 28
      },
      "3": {
        loc: {
          start: {
            line: 34,
            column: 8
          },
          end: {
            line: 36,
            column: 9
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 34,
            column: 8
          },
          end: {
            line: 36,
            column: 9
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 34
      },
      "4": {
        loc: {
          start: {
            line: 39,
            column: 8
          },
          end: {
            line: 41,
            column: 9
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 39,
            column: 8
          },
          end: {
            line: 41,
            column: 9
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 39
      },
      "5": {
        loc: {
          start: {
            line: 44,
            column: 8
          },
          end: {
            line: 46,
            column: 9
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 44,
            column: 8
          },
          end: {
            line: 46,
            column: 9
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 44
      },
      "6": {
        loc: {
          start: {
            line: 55,
            column: 32
          },
          end: {
            line: 55,
            column: 78
          }
        },
        type: "cond-expr",
        locations: [{
          start: {
            line: 55,
            column: 50
          },
          end: {
            line: 55,
            column: 69
          }
        }, {
          start: {
            line: 55,
            column: 72
          },
          end: {
            line: 55,
            column: 78
          }
        }],
        line: 55
      },
      "7": {
        loc: {
          start: {
            line: 56,
            column: 34
          },
          end: {
            line: 56,
            column: 92
          }
        },
        type: "cond-expr",
        locations: [{
          start: {
            line: 56,
            column: 73
          },
          end: {
            line: 56,
            column: 78
          }
        }, {
          start: {
            line: 56,
            column: 81
          },
          end: {
            line: 56,
            column: 92
          }
        }],
        line: 56
      },
      "8": {
        loc: {
          start: {
            line: 57,
            column: 23
          },
          end: {
            line: 57,
            column: 99
          }
        },
        type: "cond-expr",
        locations: [{
          start: {
            line: 57,
            column: 42
          },
          end: {
            line: 57,
            column: 87
          }
        }, {
          start: {
            line: 57,
            column: 90
          },
          end: {
            line: 57,
            column: 99
          }
        }],
        line: 57
      },
      "9": {
        loc: {
          start: {
            line: 87,
            column: 59
          },
          end: {
            line: 89,
            column: 5
          }
        },
        type: "default-arg",
        locations: [{
          start: {
            line: 87,
            column: 69
          },
          end: {
            line: 89,
            column: 5
          }
        }],
        line: 87
      },
      "10": {
        loc: {
          start: {
            line: 93,
            column: 8
          },
          end: {
            line: 95,
            column: 9
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 93,
            column: 8
          },
          end: {
            line: 95,
            column: 9
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 93
      },
      "11": {
        loc: {
          start: {
            line: 102,
            column: 8
          },
          end: {
            line: 104,
            column: 9
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 102,
            column: 8
          },
          end: {
            line: 104,
            column: 9
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 102
      },
      "12": {
        loc: {
          start: {
            line: 107,
            column: 8
          },
          end: {
            line: 109,
            column: 9
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 107,
            column: 8
          },
          end: {
            line: 109,
            column: 9
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 107
      },
      "13": {
        loc: {
          start: {
            line: 118,
            column: 32
          },
          end: {
            line: 118,
            column: 78
          }
        },
        type: "cond-expr",
        locations: [{
          start: {
            line: 118,
            column: 50
          },
          end: {
            line: 118,
            column: 69
          }
        }, {
          start: {
            line: 118,
            column: 72
          },
          end: {
            line: 118,
            column: 78
          }
        }],
        line: 118
      },
      "14": {
        loc: {
          start: {
            line: 152,
            column: 8
          },
          end: {
            line: 154,
            column: 9
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 152,
            column: 8
          },
          end: {
            line: 154,
            column: 9
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 152
      },
      "15": {
        loc: {
          start: {
            line: 157,
            column: 8
          },
          end: {
            line: 182,
            column: 9
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 157,
            column: 8
          },
          end: {
            line: 182,
            column: 9
          }
        }, {
          start: {
            line: 171,
            column: 15
          },
          end: {
            line: 182,
            column: 9
          }
        }],
        line: 157
      },
      "16": {
        loc: {
          start: {
            line: 164,
            column: 35
          },
          end: {
            line: 164,
            column: 94
          }
        },
        type: "cond-expr",
        locations: [{
          start: {
            line: 164,
            column: 61
          },
          end: {
            line: 164,
            column: 70
          }
        }, {
          start: {
            line: 164,
            column: 73
          },
          end: {
            line: 164,
            column: 94
          }
        }],
        line: 164
      },
      "17": {
        loc: {
          start: {
            line: 168,
            column: 12
          },
          end: {
            line: 170,
            column: 13
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 168,
            column: 12
          },
          end: {
            line: 170,
            column: 13
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 168
      },
      "18": {
        loc: {
          start: {
            line: 177,
            column: 42
          },
          end: {
            line: 177,
            column: 64
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 177,
            column: 42
          },
          end: {
            line: 177,
            column: 58
          }
        }, {
          start: {
            line: 177,
            column: 62
          },
          end: {
            line: 177,
            column: 64
          }
        }],
        line: 177
      },
      "19": {
        loc: {
          start: {
            line: 203,
            column: 8
          },
          end: {
            line: 205,
            column: 9
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 203,
            column: 8
          },
          end: {
            line: 205,
            column: 9
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 203
      },
      "20": {
        loc: {
          start: {
            line: 215,
            column: 8
          },
          end: {
            line: 217,
            column: 9
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 215,
            column: 8
          },
          end: {
            line: 217,
            column: 9
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 215
      },
      "21": {
        loc: {
          start: {
            line: 219,
            column: 8
          },
          end: {
            line: 245,
            column: 9
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 219,
            column: 8
          },
          end: {
            line: 245,
            column: 9
          }
        }, {
          start: {
            line: 242,
            column: 15
          },
          end: {
            line: 245,
            column: 9
          }
        }],
        line: 219
      },
      "22": {
        loc: {
          start: {
            line: 223,
            column: 16
          },
          end: {
            line: 237,
            column: 17
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 223,
            column: 16
          },
          end: {
            line: 237,
            column: 17
          }
        }, {
          start: {
            line: 226,
            column: 23
          },
          end: {
            line: 237,
            column: 17
          }
        }],
        line: 223
      },
      "23": {
        loc: {
          start: {
            line: 269,
            column: 8
          },
          end: {
            line: 271,
            column: 9
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 269,
            column: 8
          },
          end: {
            line: 271,
            column: 9
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 269
      },
      "24": {
        loc: {
          start: {
            line: 295,
            column: 8
          },
          end: {
            line: 297,
            column: 9
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 295,
            column: 8
          },
          end: {
            line: 297,
            column: 9
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 295
      },
      "25": {
        loc: {
          start: {
            line: 309,
            column: 25
          },
          end: {
            line: 309,
            column: 101
          }
        },
        type: "cond-expr",
        locations: [{
          start: {
            line: 309,
            column: 50
          },
          end: {
            line: 309,
            column: 89
          }
        }, {
          start: {
            line: 309,
            column: 92
          },
          end: {
            line: 309,
            column: 101
          }
        }],
        line: 309
      },
      "26": {
        loc: {
          start: {
            line: 312,
            column: 22
          },
          end: {
            line: 312,
            column: 98
          }
        },
        type: "cond-expr",
        locations: [{
          start: {
            line: 312,
            column: 47
          },
          end: {
            line: 312,
            column: 86
          }
        }, {
          start: {
            line: 312,
            column: 89
          },
          end: {
            line: 312,
            column: 98
          }
        }],
        line: 312
      },
      "27": {
        loc: {
          start: {
            line: 313,
            column: 24
          },
          end: {
            line: 313,
            column: 104
          }
        },
        type: "cond-expr",
        locations: [{
          start: {
            line: 313,
            column: 51
          },
          end: {
            line: 313,
            column: 92
          }
        }, {
          start: {
            line: 313,
            column: 95
          },
          end: {
            line: 313,
            column: 104
          }
        }],
        line: 313
      },
      "28": {
        loc: {
          start: {
            line: 323,
            column: 15
          },
          end: {
            line: 323,
            column: 28
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 323,
            column: 15
          },
          end: {
            line: 323,
            column: 22
          }
        }, {
          start: {
            line: 323,
            column: 26
          },
          end: {
            line: 323,
            column: 28
          }
        }],
        line: 323
      },
      "29": {
        loc: {
          start: {
            line: 334,
            column: 12
          },
          end: {
            line: 334,
            column: 42
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 334,
            column: 12
          },
          end: {
            line: 334,
            column: 42
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 334
      },
      "30": {
        loc: {
          start: {
            line: 336,
            column: 12
          },
          end: {
            line: 338,
            column: 13
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 336,
            column: 12
          },
          end: {
            line: 338,
            column: 13
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 336
      },
      "31": {
        loc: {
          start: {
            line: 363,
            column: 8
          },
          end: {
            line: 365,
            column: 9
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 363,
            column: 8
          },
          end: {
            line: 365,
            column: 9
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 363
      },
      "32": {
        loc: {
          start: {
            line: 363,
            column: 12
          },
          end: {
            line: 363,
            column: 80
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 363,
            column: 12
          },
          end: {
            line: 363,
            column: 37
          }
        }, {
          start: {
            line: 363,
            column: 41
          },
          end: {
            line: 363,
            column: 80
          }
        }],
        line: 363
      },
      "33": {
        loc: {
          start: {
            line: 366,
            column: 8
          },
          end: {
            line: 368,
            column: 9
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 366,
            column: 8
          },
          end: {
            line: 368,
            column: 9
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 366
      },
      "34": {
        loc: {
          start: {
            line: 366,
            column: 12
          },
          end: {
            line: 366,
            column: 89
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 366,
            column: 12
          },
          end: {
            line: 366,
            column: 40
          }
        }, {
          start: {
            line: 366,
            column: 44
          },
          end: {
            line: 366,
            column: 89
          }
        }],
        line: 366
      },
      "35": {
        loc: {
          start: {
            line: 369,
            column: 8
          },
          end: {
            line: 371,
            column: 9
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 369,
            column: 8
          },
          end: {
            line: 371,
            column: 9
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 369
      },
      "36": {
        loc: {
          start: {
            line: 369,
            column: 12
          },
          end: {
            line: 369,
            column: 89
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 369,
            column: 12
          },
          end: {
            line: 369,
            column: 40
          }
        }, {
          start: {
            line: 369,
            column: 44
          },
          end: {
            line: 369,
            column: 89
          }
        }],
        line: 369
      },
      "37": {
        loc: {
          start: {
            line: 391,
            column: 8
          },
          end: {
            line: 391,
            column: 52
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 391,
            column: 8
          },
          end: {
            line: 391,
            column: 52
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 391
      },
      "38": {
        loc: {
          start: {
            line: 403,
            column: 30
          },
          end: {
            line: 403,
            column: 57
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 403,
            column: 30
          },
          end: {
            line: 403,
            column: 52
          }
        }, {
          start: {
            line: 403,
            column: 56
          },
          end: {
            line: 403,
            column: 57
          }
        }],
        line: 403
      }
    },
    s: {
      "0": 0,
      "1": 0,
      "2": 0,
      "3": 0,
      "4": 0,
      "5": 0,
      "6": 0,
      "7": 0,
      "8": 0,
      "9": 0,
      "10": 0,
      "11": 0,
      "12": 0,
      "13": 0,
      "14": 0,
      "15": 0,
      "16": 0,
      "17": 0,
      "18": 0,
      "19": 0,
      "20": 0,
      "21": 0,
      "22": 0,
      "23": 0,
      "24": 0,
      "25": 0,
      "26": 0,
      "27": 0,
      "28": 0,
      "29": 0,
      "30": 0,
      "31": 0,
      "32": 0,
      "33": 0,
      "34": 0,
      "35": 0,
      "36": 0,
      "37": 0,
      "38": 0,
      "39": 0,
      "40": 0,
      "41": 0,
      "42": 0,
      "43": 0,
      "44": 0,
      "45": 0,
      "46": 0,
      "47": 0,
      "48": 0,
      "49": 0,
      "50": 0,
      "51": 0,
      "52": 0,
      "53": 0,
      "54": 0,
      "55": 0,
      "56": 0,
      "57": 0,
      "58": 0,
      "59": 0,
      "60": 0,
      "61": 0,
      "62": 0,
      "63": 0,
      "64": 0,
      "65": 0,
      "66": 0,
      "67": 0,
      "68": 0,
      "69": 0,
      "70": 0,
      "71": 0,
      "72": 0,
      "73": 0,
      "74": 0,
      "75": 0,
      "76": 0,
      "77": 0,
      "78": 0,
      "79": 0,
      "80": 0,
      "81": 0,
      "82": 0,
      "83": 0,
      "84": 0,
      "85": 0,
      "86": 0,
      "87": 0,
      "88": 0,
      "89": 0,
      "90": 0,
      "91": 0,
      "92": 0,
      "93": 0,
      "94": 0,
      "95": 0,
      "96": 0,
      "97": 0,
      "98": 0,
      "99": 0,
      "100": 0,
      "101": 0,
      "102": 0,
      "103": 0,
      "104": 0,
      "105": 0,
      "106": 0,
      "107": 0,
      "108": 0,
      "109": 0,
      "110": 0,
      "111": 0,
      "112": 0,
      "113": 0,
      "114": 0,
      "115": 0,
      "116": 0,
      "117": 0,
      "118": 0,
      "119": 0,
      "120": 0,
      "121": 0,
      "122": 0,
      "123": 0,
      "124": 0,
      "125": 0,
      "126": 0,
      "127": 0,
      "128": 0,
      "129": 0,
      "130": 0,
      "131": 0,
      "132": 0,
      "133": 0,
      "134": 0,
      "135": 0,
      "136": 0,
      "137": 0,
      "138": 0,
      "139": 0,
      "140": 0
    },
    f: {
      "0": 0,
      "1": 0,
      "2": 0,
      "3": 0,
      "4": 0,
      "5": 0,
      "6": 0,
      "7": 0,
      "8": 0,
      "9": 0,
      "10": 0,
      "11": 0,
      "12": 0,
      "13": 0,
      "14": 0,
      "15": 0,
      "16": 0,
      "17": 0,
      "18": 0
    },
    b: {
      "0": [0, 0],
      "1": [0, 0],
      "2": [0],
      "3": [0, 0],
      "4": [0, 0],
      "5": [0, 0],
      "6": [0, 0],
      "7": [0, 0],
      "8": [0, 0],
      "9": [0],
      "10": [0, 0],
      "11": [0, 0],
      "12": [0, 0],
      "13": [0, 0],
      "14": [0, 0],
      "15": [0, 0],
      "16": [0, 0],
      "17": [0, 0],
      "18": [0, 0],
      "19": [0, 0],
      "20": [0, 0],
      "21": [0, 0],
      "22": [0, 0],
      "23": [0, 0],
      "24": [0, 0],
      "25": [0, 0],
      "26": [0, 0],
      "27": [0, 0],
      "28": [0, 0],
      "29": [0, 0],
      "30": [0, 0],
      "31": [0, 0],
      "32": [0, 0],
      "33": [0, 0],
      "34": [0, 0],
      "35": [0, 0],
      "36": [0, 0],
      "37": [0, 0],
      "38": [0, 0]
    },
    inputSourceMap: {
      version: 3,
      sources: ["C:\\Ai Projecten\\ADSapp\\src\\lib\\billing\\subscription-lifecycle.ts"],
      sourcesContent: ["import Stripe from 'stripe'\nimport { createClient } from '@/lib/supabase/server'\nimport { stripe, SUBSCRIPTION_PLANS } from '@/lib/stripe/server'\nimport { UsageTracker } from './usage-tracking'\nimport { NotificationService } from './notification-service'\n\nexport interface SubscriptionChange {\n  from: string\n  to: string\n  effectiveDate: Date\n  prorationAmount?: number\n  reason: 'upgrade' | 'downgrade' | 'trial_end' | 'cancellation' | 'reactivation'\n}\n\nexport interface SubscriptionMetrics {\n  id: string\n  organizationId: string\n  status: string\n  currentPlan: string\n  mrr: number // Monthly Recurring Revenue\n  arr: number // Annual Recurring Revenue\n  trialEndsAt?: Date\n  currentPeriodStart: Date\n  currentPeriodEnd: Date\n  cancelAt?: Date\n  canceledAt?: Date\n  cancellationReason?: string\n  reactivationEligible: boolean\n}\n\nexport interface PlanChangeOptions {\n  prorate: boolean\n  billingCycleAnchor?: 'now' | 'unchanged'\n  trialEnd?: Date\n  metadata?: Record<string, string>\n}\n\nexport interface CancellationOptions {\n  immediate: boolean\n  reason: string\n  feedback?: string\n  offerRetention?: boolean\n  downgradeToFree?: boolean\n}\n\nexport class SubscriptionLifecycleManager {\n  private supabase = createClient()\n  private usageTracker: UsageTracker | null = null\n  private notificationService: NotificationService | null = null\n\n  private getUsageTracker(): UsageTracker {\n    if (!this.usageTracker) {\n      this.usageTracker = new UsageTracker()\n    }\n    return this.usageTracker\n  }\n\n  private getNotificationService(): NotificationService {\n    if (!this.notificationService) {\n      this.notificationService = new NotificationService()\n    }\n    return this.notificationService\n  }\n\n  async upgradeSubscription(\n    organizationId: string,\n    newPlanId: keyof typeof SUBSCRIPTION_PLANS,\n    options: PlanChangeOptions = { prorate: true }\n  ): Promise<{ subscription: Stripe.Subscription; prorationAmount: number }> {\n    const supabase = await this.supabase\n\n    // Get current subscription\n    const { data: org } = await supabase\n      .from('organizations')\n      .select('stripe_subscription_id, subscription_tier, stripe_customer_id')\n      .eq('id', organizationId)\n      .single()\n\n    if (!org?.stripe_subscription_id) {\n      throw new Error('No active subscription found')\n    }\n\n    const currentSubscription = await stripe.subscriptions.retrieve(org.stripe_subscription_id)\n    const newPlan = SUBSCRIPTION_PLANS[newPlanId]\n\n    if (!newPlan) {\n      throw new Error('Invalid plan ID')\n    }\n\n    // Calculate proration if needed\n    let prorationAmount = 0\n    if (options.prorate) {\n      prorationAmount = await this.calculateProration(\n        currentSubscription,\n        newPlan.stripePriceId\n      )\n    }\n\n    // Update the subscription\n    const updatedSubscription = await stripe.subscriptions.update(org.stripe_subscription_id, {\n      items: [\n        {\n          id: currentSubscription.items.data[0].id,\n          price: newPlan.stripePriceId,\n        },\n      ],\n      proration_behavior: options.prorate ? 'create_prorations' : 'none',\n      billing_cycle_anchor: options.billingCycleAnchor === 'now' ? 'now' : 'unchanged',\n      trial_end: options.trialEnd ? Math.floor(options.trialEnd.getTime() / 1000) : undefined,\n      metadata: {\n        ...currentSubscription.metadata,\n        previousPlan: org.subscription_tier,\n        upgradeDate: new Date().toISOString(),\n        ...options.metadata,\n      },\n    })\n\n    // Update organization record\n    await supabase\n      .from('organizations')\n      .update({\n        subscription_tier: newPlanId,\n        updated_at: new Date().toISOString(),\n      })\n      .eq('id', organizationId)\n\n    // Log the change\n    await this.logSubscriptionChange(organizationId, {\n      from: org.subscription_tier,\n      to: newPlanId,\n      effectiveDate: new Date(),\n      prorationAmount,\n      reason: 'upgrade',\n    })\n\n    // Update usage limits\n    await this.getUsageTracker().updatePlanLimits(organizationId, newPlanId)\n\n    // Send upgrade notification\n    await this.getNotificationService().sendPlanUpgradeNotification(organizationId, newPlanId)\n\n    return {\n      subscription: updatedSubscription,\n      prorationAmount,\n    }\n  }\n\n  async downgradeSubscription(\n    organizationId: string,\n    newPlanId: keyof typeof SUBSCRIPTION_PLANS,\n    options: PlanChangeOptions = { prorate: true }\n  ): Promise<{ subscription: Stripe.Subscription; prorationAmount: number }> {\n    const supabase = await this.supabase\n\n    // Get current subscription\n    const { data: org } = await supabase\n      .from('organizations')\n      .select('stripe_subscription_id, subscription_tier')\n      .eq('id', organizationId)\n      .single()\n\n    if (!org?.stripe_subscription_id) {\n      throw new Error('No active subscription found')\n    }\n\n    const currentSubscription = await stripe.subscriptions.retrieve(org.stripe_subscription_id)\n    const newPlan = SUBSCRIPTION_PLANS[newPlanId]\n\n    // Check usage limits before downgrade\n    const currentUsage = await this.getUsageTracker().getCurrentUsage(organizationId)\n    const newLimits = await this.getUsageTracker().getPlanLimits(newPlanId)\n\n    const usageViolations = this.checkUsageViolations(currentUsage, newLimits)\n    if (usageViolations.length > 0) {\n      throw new Error(`Cannot downgrade: Current usage exceeds new plan limits: ${usageViolations.join(', ')}`)\n    }\n\n    // Calculate proration (usually a credit for downgrade)\n    let prorationAmount = 0\n    if (options.prorate) {\n      prorationAmount = await this.calculateProration(\n        currentSubscription,\n        newPlan.stripePriceId\n      )\n    }\n\n    // Update the subscription\n    const updatedSubscription = await stripe.subscriptions.update(org.stripe_subscription_id, {\n      items: [\n        {\n          id: currentSubscription.items.data[0].id,\n          price: newPlan.stripePriceId,\n        },\n      ],\n      proration_behavior: options.prorate ? 'create_prorations' : 'none',\n      metadata: {\n        ...currentSubscription.metadata,\n        previousPlan: org.subscription_tier,\n        downgradeDate: new Date().toISOString(),\n        ...options.metadata,\n      },\n    })\n\n    // Update organization record\n    await supabase\n      .from('organizations')\n      .update({\n        subscription_tier: newPlanId,\n        updated_at: new Date().toISOString(),\n      })\n      .eq('id', organizationId)\n\n    // Log the change\n    await this.logSubscriptionChange(organizationId, {\n      from: org.subscription_tier,\n      to: newPlanId,\n      effectiveDate: new Date(),\n      prorationAmount,\n      reason: 'downgrade',\n    })\n\n    // Enforce new limits\n    await this.getUsageTracker().enforceDowngradeLimits(organizationId, newPlanId)\n\n    // Send downgrade notification\n    await this.getNotificationService().sendPlanDowngradeNotification(organizationId, newPlanId)\n\n    return {\n      subscription: updatedSubscription,\n      prorationAmount,\n    }\n  }\n\n  async cancelSubscription(\n    organizationId: string,\n    options: CancellationOptions\n  ): Promise<{ subscription: Stripe.Subscription; effectiveDate: Date }> {\n    const supabase = await this.supabase\n\n    // Get current subscription\n    const { data: org } = await supabase\n      .from('organizations')\n      .select('stripe_subscription_id, subscription_tier')\n      .eq('id', organizationId)\n      .single()\n\n    if (!org?.stripe_subscription_id) {\n      throw new Error('No active subscription found')\n    }\n\n    let canceledSubscription: Stripe.Subscription\n    let effectiveDate: Date\n\n    if (options.immediate) {\n      // Cancel immediately\n      canceledSubscription = await stripe.subscriptions.cancel(org.stripe_subscription_id)\n      effectiveDate = new Date()\n\n      // Update organization immediately\n      await supabase\n        .from('organizations')\n        .update({\n          subscription_status: 'cancelled',\n          subscription_tier: options.downgradeToFree ? 'starter' : org.subscription_tier,\n          updated_at: new Date().toISOString(),\n        })\n        .eq('id', organizationId)\n\n      // Enforce free tier limits if downgrading\n      if (options.downgradeToFree) {\n        await this.getUsageTracker().enforceDowngradeLimits(organizationId, 'starter')\n      }\n    } else {\n      // Cancel at period end\n      canceledSubscription = await stripe.subscriptions.update(org.stripe_subscription_id, {\n        cancel_at_period_end: true,\n        metadata: {\n          cancellationReason: options.reason,\n          cancellationFeedback: options.feedback || '',\n          cancelledAt: new Date().toISOString(),\n        },\n      })\n      effectiveDate = new Date(canceledSubscription.current_period_end * 1000)\n    }\n\n    // Log cancellation\n    await this.logSubscriptionChange(organizationId, {\n      from: org.subscription_tier,\n      to: 'cancelled',\n      effectiveDate,\n      reason: 'cancellation',\n    })\n\n    // Store cancellation details\n    await supabase\n      .from('subscription_cancellations')\n      .insert({\n        organization_id: organizationId,\n        subscription_id: org.stripe_subscription_id,\n        reason: options.reason,\n        feedback: options.feedback,\n        immediate: options.immediate,\n        cancelled_at: new Date().toISOString(),\n        effective_date: effectiveDate.toISOString(),\n      })\n\n    // Send cancellation notification\n    await this.getNotificationService().sendSubscriptionCancellation(organizationId)\n\n    // Offer retention if requested\n    if (options.offerRetention) {\n      await this.offerRetentionDiscount(organizationId)\n    }\n\n    return {\n      subscription: canceledSubscription,\n      effectiveDate,\n    }\n  }\n\n  async reactivateSubscription(\n    organizationId: string,\n    planId: keyof typeof SUBSCRIPTION_PLANS\n  ): Promise<Stripe.Subscription> {\n    const supabase = await this.supabase\n\n    // Get organization details\n    const { data: org } = await supabase\n      .from('organizations')\n      .select('stripe_customer_id, stripe_subscription_id')\n      .eq('id', organizationId)\n      .single()\n\n    if (!org?.stripe_customer_id) {\n      throw new Error('No customer found')\n    }\n\n    let subscription: Stripe.Subscription\n\n    if (org.stripe_subscription_id) {\n      // Try to reactivate existing subscription\n      try {\n        const existingSubscription = await stripe.subscriptions.retrieve(org.stripe_subscription_id)\n\n        if (existingSubscription.status === 'canceled') {\n          // Create new subscription\n          subscription = await this.createNewSubscription(org.stripe_customer_id, planId, organizationId)\n        } else {\n          // Update existing subscription\n          subscription = await stripe.subscriptions.update(org.stripe_subscription_id, {\n            cancel_at_period_end: false,\n            items: [\n              {\n                id: existingSubscription.items.data[0].id,\n                price: SUBSCRIPTION_PLANS[planId].stripePriceId,\n              },\n            ],\n          })\n        }\n      } catch (error) {\n        // Create new subscription if existing one is not found\n        subscription = await this.createNewSubscription(org.stripe_customer_id, planId, organizationId)\n      }\n    } else {\n      // Create new subscription\n      subscription = await this.createNewSubscription(org.stripe_customer_id, planId, organizationId)\n    }\n\n    // Update organization\n    await supabase\n      .from('organizations')\n      .update({\n        stripe_subscription_id: subscription.id,\n        subscription_status: 'active',\n        subscription_tier: planId,\n        updated_at: new Date().toISOString(),\n      })\n      .eq('id', organizationId)\n\n    // Log reactivation\n    await this.logSubscriptionChange(organizationId, {\n      from: 'cancelled',\n      to: planId,\n      effectiveDate: new Date(),\n      reason: 'reactivation',\n    })\n\n    // Send reactivation notification\n    await this.getNotificationService().sendSubscriptionReactivation(organizationId, planId)\n\n    return subscription\n  }\n\n  async pauseSubscription(\n    organizationId: string,\n    pauseDuration: number // in days\n  ): Promise<Stripe.Subscription> {\n    const supabase = await this.supabase\n\n    // Get current subscription\n    const { data: org } = await supabase\n      .from('organizations')\n      .select('stripe_subscription_id')\n      .eq('id', organizationId)\n      .single()\n\n    if (!org?.stripe_subscription_id) {\n      throw new Error('No active subscription found')\n    }\n\n    const pauseEnd = new Date()\n    pauseEnd.setDate(pauseEnd.getDate() + pauseDuration)\n\n    // Pause the subscription\n    const pausedSubscription = await stripe.subscriptions.update(org.stripe_subscription_id, {\n      pause_collection: {\n        behavior: 'void',\n        resumes_at: Math.floor(pauseEnd.getTime() / 1000),\n      },\n      metadata: {\n        pausedAt: new Date().toISOString(),\n        pauseDuration: pauseDuration.toString(),\n      },\n    })\n\n    // Update organization status\n    await supabase\n      .from('organizations')\n      .update({\n        subscription_status: 'paused',\n        updated_at: new Date().toISOString(),\n      })\n      .eq('id', organizationId)\n\n    return pausedSubscription\n  }\n\n  async getSubscriptionMetrics(organizationId: string): Promise<SubscriptionMetrics | null> {\n    const supabase = await this.supabase\n\n    const { data: org } = await supabase\n      .from('organizations')\n      .select('*')\n      .eq('id', organizationId)\n      .single()\n\n    if (!org?.stripe_subscription_id) {\n      return null\n    }\n\n    const subscription = await stripe.subscriptions.retrieve(org.stripe_subscription_id)\n    const plan = SUBSCRIPTION_PLANS[org.subscription_tier as keyof typeof SUBSCRIPTION_PLANS]\n\n    const mrr = plan.price\n    const arr = mrr * 12\n\n    return {\n      id: subscription.id,\n      organizationId,\n      status: subscription.status,\n      currentPlan: org.subscription_tier,\n      mrr,\n      arr,\n      trialEndsAt: subscription.trial_end ? new Date(subscription.trial_end * 1000) : undefined,\n      currentPeriodStart: new Date(subscription.current_period_start * 1000),\n      currentPeriodEnd: new Date(subscription.current_period_end * 1000),\n      cancelAt: subscription.cancel_at ? new Date(subscription.cancel_at * 1000) : undefined,\n      canceledAt: subscription.canceled_at ? new Date(subscription.canceled_at * 1000) : undefined,\n      cancellationReason: subscription.metadata.cancellationReason,\n      reactivationEligible: this.isReactivationEligible(subscription),\n    }\n  }\n\n  async getSubscriptionHistory(\n    organizationId: string\n  ): Promise<SubscriptionChange[]> {\n    const supabase = await this.supabase\n\n    const { data: changes } = await supabase\n      .from('subscription_changes')\n      .select('*')\n      .eq('organization_id', organizationId)\n      .order('effective_date', { ascending: false })\n\n    return changes || []\n  }\n\n  async processPendingCancellations(): Promise<void> {\n    // Get subscriptions that are set to cancel at period end\n    const subscriptions = await stripe.subscriptions.list({\n      status: 'active',\n      cancel_at_period_end: true,\n      limit: 100,\n    })\n\n    for (const subscription of subscriptions.data) {\n      const organizationId = subscription.metadata.organizationId\n      if (!organizationId) continue\n\n      // Check if cancellation date has passed\n      if (subscription.current_period_end * 1000 <= Date.now()) {\n        await this.finalizeCancellation(organizationId, subscription.id)\n      }\n    }\n  }\n\n  // Private helper methods\n  private async calculateProration(\n    currentSubscription: Stripe.Subscription,\n    newPriceId: string\n  ): Promise<number> {\n    try {\n      const preview = await stripe.invoices.retrieveUpcoming({\n        customer: currentSubscription.customer as string,\n        subscription: currentSubscription.id,\n        subscription_items: [\n          {\n            id: currentSubscription.items.data[0].id,\n            price: newPriceId,\n          },\n        ],\n        subscription_proration_behavior: 'create_prorations',\n      })\n\n      return preview.amount_due\n    } catch (error) {\n      console.error('Error calculating proration:', error)\n      return 0\n    }\n  }\n\n  private checkUsageViolations(currentUsage: any, newLimits: any): string[] {\n    const violations: string[] = []\n\n    if (newLimits.maxUsers !== -1 && currentUsage.users > newLimits.maxUsers) {\n      violations.push(`Users (${currentUsage.users}/${newLimits.maxUsers})`)\n    }\n\n    if (newLimits.maxContacts !== -1 && currentUsage.contacts > newLimits.maxContacts) {\n      violations.push(`Contacts (${currentUsage.contacts}/${newLimits.maxContacts})`)\n    }\n\n    if (newLimits.maxMessages !== -1 && currentUsage.messages > newLimits.maxMessages) {\n      violations.push(`Messages (${currentUsage.messages}/${newLimits.maxMessages})`)\n    }\n\n    return violations\n  }\n\n  private async createNewSubscription(\n    customerId: string,\n    planId: keyof typeof SUBSCRIPTION_PLANS,\n    organizationId: string\n  ): Promise<Stripe.Subscription> {\n    const plan = SUBSCRIPTION_PLANS[planId]\n\n    return await stripe.subscriptions.create({\n      customer: customerId,\n      items: [{ price: plan.stripePriceId }],\n      metadata: {\n        organizationId,\n        planId,\n      },\n    })\n  }\n\n  private isReactivationEligible(subscription: Stripe.Subscription): boolean {\n    // Check if subscription was canceled within the last 30 days\n    if (!subscription.canceled_at) return false\n\n    const canceledDate = new Date(subscription.canceled_at * 1000)\n    const daysSinceCancellation = (Date.now() - canceledDate.getTime()) / (1000 * 60 * 60 * 24)\n\n    return daysSinceCancellation <= 30\n  }\n\n  private async logSubscriptionChange(\n    organizationId: string,\n    change: SubscriptionChange\n  ): Promise<void> {\n    const supabase = await this.supabase\n\n    await supabase\n      .from('subscription_changes')\n      .insert({\n        organization_id: organizationId,\n        from_plan: change.from,\n        to_plan: change.to,\n        effective_date: change.effectiveDate.toISOString(),\n        proration_amount: change.prorationAmount || 0,\n        reason: change.reason,\n        created_at: new Date().toISOString(),\n      })\n  }\n\n  private async offerRetentionDiscount(organizationId: string): Promise<void> {\n    // Implement retention offer logic\n    console.log(`Offering retention discount to organization ${organizationId}`)\n  }\n\n  private async finalizeCancellation(organizationId: string, subscriptionId: string): Promise<void> {\n    const supabase = await this.supabase\n\n    await supabase\n      .from('organizations')\n      .update({\n        subscription_status: 'cancelled',\n        subscription_tier: 'starter',\n        stripe_subscription_id: null,\n        updated_at: new Date().toISOString(),\n      })\n      .eq('id', organizationId)\n\n    // Enforce free tier limits\n    await this.getUsageTracker().enforceDowngradeLimits(organizationId, 'starter')\n  }\n}"],
      names: ["SubscriptionLifecycleManager", "getUsageTracker", "usageTracker", "UsageTracker", "getNotificationService", "notificationService", "NotificationService", "upgradeSubscription", "organizationId", "newPlanId", "options", "prorate", "supabase", "data", "org", "from", "select", "eq", "single", "stripe_subscription_id", "Error", "currentSubscription", "stripe", "subscriptions", "retrieve", "newPlan", "SUBSCRIPTION_PLANS", "prorationAmount", "calculateProration", "stripePriceId", "updatedSubscription", "update", "items", "id", "price", "proration_behavior", "billing_cycle_anchor", "billingCycleAnchor", "trial_end", "trialEnd", "Math", "floor", "getTime", "undefined", "metadata", "previousPlan", "subscription_tier", "upgradeDate", "Date", "toISOString", "updated_at", "logSubscriptionChange", "to", "effectiveDate", "reason", "updatePlanLimits", "sendPlanUpgradeNotification", "subscription", "downgradeSubscription", "currentUsage", "getCurrentUsage", "newLimits", "getPlanLimits", "usageViolations", "checkUsageViolations", "length", "join", "downgradeDate", "enforceDowngradeLimits", "sendPlanDowngradeNotification", "cancelSubscription", "canceledSubscription", "immediate", "cancel", "subscription_status", "downgradeToFree", "cancel_at_period_end", "cancellationReason", "cancellationFeedback", "feedback", "cancelledAt", "current_period_end", "insert", "organization_id", "subscription_id", "cancelled_at", "effective_date", "sendSubscriptionCancellation", "offerRetention", "offerRetentionDiscount", "reactivateSubscription", "planId", "stripe_customer_id", "existingSubscription", "status", "createNewSubscription", "error", "sendSubscriptionReactivation", "pauseSubscription", "pauseDuration", "pauseEnd", "setDate", "getDate", "pausedSubscription", "pause_collection", "behavior", "resumes_at", "pausedAt", "toString", "getSubscriptionMetrics", "plan", "mrr", "arr", "currentPlan", "trialEndsAt", "currentPeriodStart", "current_period_start", "currentPeriodEnd", "cancelAt", "cancel_at", "canceledAt", "canceled_at", "reactivationEligible", "isReactivationEligible", "getSubscriptionHistory", "changes", "order", "ascending", "processPendingCancellations", "list", "limit", "now", "finalizeCancellation", "newPriceId", "preview", "invoices", "retrieveUpcoming", "customer", "subscription_items", "subscription_proration_behavior", "amount_due", "console", "violations", "maxUsers", "users", "push", "maxContacts", "contacts", "maxMessages", "messages", "customerId", "create", "canceledDate", "daysSinceCancellation", "change", "from_plan", "to_plan", "proration_amount", "created_at", "log", "subscriptionId", "createClient"],
      mappings: "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"
    },
    _coverageSchema: "1a1c01bbd47fc00a2c39e90264f33305004495a9",
    hash: "5d47499b13a839a3229c325ebaeb40f7b4564ebf"
  };
  var coverage = global[gcv] || (global[gcv] = {});
  if (!coverage[path] || coverage[path].hash !== hash) {
    coverage[path] = coverageData;
  }
  var actualCoverage = coverage[path];
  {
    // @ts-ignore
    cov_9uaxcrozx = function () {
      return actualCoverage;
    };
  }
  return actualCoverage;
}
cov_9uaxcrozx();
cov_9uaxcrozx().s[0]++;
Object.defineProperty(exports, "__esModule", {
  value: true
});
/* istanbul ignore next */
cov_9uaxcrozx().s[1]++;
Object.defineProperty(exports, "SubscriptionLifecycleManager", {
  enumerable: true,
  get: function () {
    /* istanbul ignore next */
    cov_9uaxcrozx().f[0]++;
    cov_9uaxcrozx().s[2]++;
    return SubscriptionLifecycleManager;
  }
});
const _server =
/* istanbul ignore next */
(cov_9uaxcrozx().s[3]++, require("../supabase/server"));
const _server1 =
/* istanbul ignore next */
(cov_9uaxcrozx().s[4]++, require("../stripe/server"));
const _usagetracking =
/* istanbul ignore next */
(cov_9uaxcrozx().s[5]++, require("./usage-tracking"));
const _notificationservice =
/* istanbul ignore next */
(cov_9uaxcrozx().s[6]++, require("./notification-service"));
class SubscriptionLifecycleManager {
  getUsageTracker() {
    /* istanbul ignore next */
    cov_9uaxcrozx().f[1]++;
    cov_9uaxcrozx().s[7]++;
    if (!this.usageTracker) {
      /* istanbul ignore next */
      cov_9uaxcrozx().b[0][0]++;
      cov_9uaxcrozx().s[8]++;
      this.usageTracker = new _usagetracking.UsageTracker();
    } else
    /* istanbul ignore next */
    {
      cov_9uaxcrozx().b[0][1]++;
    }
    cov_9uaxcrozx().s[9]++;
    return this.usageTracker;
  }
  getNotificationService() {
    /* istanbul ignore next */
    cov_9uaxcrozx().f[2]++;
    cov_9uaxcrozx().s[10]++;
    if (!this.notificationService) {
      /* istanbul ignore next */
      cov_9uaxcrozx().b[1][0]++;
      cov_9uaxcrozx().s[11]++;
      this.notificationService = new _notificationservice.NotificationService();
    } else
    /* istanbul ignore next */
    {
      cov_9uaxcrozx().b[1][1]++;
    }
    cov_9uaxcrozx().s[12]++;
    return this.notificationService;
  }
  async upgradeSubscription(organizationId, newPlanId, options =
  /* istanbul ignore next */
  (cov_9uaxcrozx().b[2][0]++, {
    prorate: true
  })) {
    /* istanbul ignore next */
    cov_9uaxcrozx().f[3]++;
    const supabase =
    /* istanbul ignore next */
    (cov_9uaxcrozx().s[13]++, await this.supabase);
    // Get current subscription
    const {
      data: org
    } =
    /* istanbul ignore next */
    (cov_9uaxcrozx().s[14]++, await supabase.from('organizations').select('stripe_subscription_id, subscription_tier, stripe_customer_id').eq('id', organizationId).single());
    /* istanbul ignore next */
    cov_9uaxcrozx().s[15]++;
    if (!org?.stripe_subscription_id) {
      /* istanbul ignore next */
      cov_9uaxcrozx().b[3][0]++;
      cov_9uaxcrozx().s[16]++;
      throw new Error('No active subscription found');
    } else
    /* istanbul ignore next */
    {
      cov_9uaxcrozx().b[3][1]++;
    }
    const currentSubscription =
    /* istanbul ignore next */
    (cov_9uaxcrozx().s[17]++, await _server1.stripe.subscriptions.retrieve(org.stripe_subscription_id));
    const newPlan =
    /* istanbul ignore next */
    (cov_9uaxcrozx().s[18]++, _server1.SUBSCRIPTION_PLANS[newPlanId]);
    /* istanbul ignore next */
    cov_9uaxcrozx().s[19]++;
    if (!newPlan) {
      /* istanbul ignore next */
      cov_9uaxcrozx().b[4][0]++;
      cov_9uaxcrozx().s[20]++;
      throw new Error('Invalid plan ID');
    } else
    /* istanbul ignore next */
    {
      cov_9uaxcrozx().b[4][1]++;
    }
    // Calculate proration if needed
    let prorationAmount =
    /* istanbul ignore next */
    (cov_9uaxcrozx().s[21]++, 0);
    /* istanbul ignore next */
    cov_9uaxcrozx().s[22]++;
    if (options.prorate) {
      /* istanbul ignore next */
      cov_9uaxcrozx().b[5][0]++;
      cov_9uaxcrozx().s[23]++;
      prorationAmount = await this.calculateProration(currentSubscription, newPlan.stripePriceId);
    } else
    /* istanbul ignore next */
    {
      cov_9uaxcrozx().b[5][1]++;
    }
    // Update the subscription
    const updatedSubscription =
    /* istanbul ignore next */
    (cov_9uaxcrozx().s[24]++, await _server1.stripe.subscriptions.update(org.stripe_subscription_id, {
      items: [{
        id: currentSubscription.items.data[0].id,
        price: newPlan.stripePriceId
      }],
      proration_behavior: options.prorate ?
      /* istanbul ignore next */
      (cov_9uaxcrozx().b[6][0]++, 'create_prorations') :
      /* istanbul ignore next */
      (cov_9uaxcrozx().b[6][1]++, 'none'),
      billing_cycle_anchor: options.billingCycleAnchor === 'now' ?
      /* istanbul ignore next */
      (cov_9uaxcrozx().b[7][0]++, 'now') :
      /* istanbul ignore next */
      (cov_9uaxcrozx().b[7][1]++, 'unchanged'),
      trial_end: options.trialEnd ?
      /* istanbul ignore next */
      (cov_9uaxcrozx().b[8][0]++, Math.floor(options.trialEnd.getTime() / 1000)) :
      /* istanbul ignore next */
      (cov_9uaxcrozx().b[8][1]++, undefined),
      metadata: {
        ...currentSubscription.metadata,
        previousPlan: org.subscription_tier,
        upgradeDate: new Date().toISOString(),
        ...options.metadata
      }
    }));
    // Update organization record
    /* istanbul ignore next */
    cov_9uaxcrozx().s[25]++;
    await supabase.from('organizations').update({
      subscription_tier: newPlanId,
      updated_at: new Date().toISOString()
    }).eq('id', organizationId);
    // Log the change
    /* istanbul ignore next */
    cov_9uaxcrozx().s[26]++;
    await this.logSubscriptionChange(organizationId, {
      from: org.subscription_tier,
      to: newPlanId,
      effectiveDate: new Date(),
      prorationAmount,
      reason: 'upgrade'
    });
    // Update usage limits
    /* istanbul ignore next */
    cov_9uaxcrozx().s[27]++;
    await this.getUsageTracker().updatePlanLimits(organizationId, newPlanId);
    // Send upgrade notification
    /* istanbul ignore next */
    cov_9uaxcrozx().s[28]++;
    await this.getNotificationService().sendPlanUpgradeNotification(organizationId, newPlanId);
    /* istanbul ignore next */
    cov_9uaxcrozx().s[29]++;
    return {
      subscription: updatedSubscription,
      prorationAmount
    };
  }
  async downgradeSubscription(organizationId, newPlanId, options =
  /* istanbul ignore next */
  (cov_9uaxcrozx().b[9][0]++, {
    prorate: true
  })) {
    /* istanbul ignore next */
    cov_9uaxcrozx().f[4]++;
    const supabase =
    /* istanbul ignore next */
    (cov_9uaxcrozx().s[30]++, await this.supabase);
    // Get current subscription
    const {
      data: org
    } =
    /* istanbul ignore next */
    (cov_9uaxcrozx().s[31]++, await supabase.from('organizations').select('stripe_subscription_id, subscription_tier').eq('id', organizationId).single());
    /* istanbul ignore next */
    cov_9uaxcrozx().s[32]++;
    if (!org?.stripe_subscription_id) {
      /* istanbul ignore next */
      cov_9uaxcrozx().b[10][0]++;
      cov_9uaxcrozx().s[33]++;
      throw new Error('No active subscription found');
    } else
    /* istanbul ignore next */
    {
      cov_9uaxcrozx().b[10][1]++;
    }
    const currentSubscription =
    /* istanbul ignore next */
    (cov_9uaxcrozx().s[34]++, await _server1.stripe.subscriptions.retrieve(org.stripe_subscription_id));
    const newPlan =
    /* istanbul ignore next */
    (cov_9uaxcrozx().s[35]++, _server1.SUBSCRIPTION_PLANS[newPlanId]);
    // Check usage limits before downgrade
    const currentUsage =
    /* istanbul ignore next */
    (cov_9uaxcrozx().s[36]++, await this.getUsageTracker().getCurrentUsage(organizationId));
    const newLimits =
    /* istanbul ignore next */
    (cov_9uaxcrozx().s[37]++, await this.getUsageTracker().getPlanLimits(newPlanId));
    const usageViolations =
    /* istanbul ignore next */
    (cov_9uaxcrozx().s[38]++, this.checkUsageViolations(currentUsage, newLimits));
    /* istanbul ignore next */
    cov_9uaxcrozx().s[39]++;
    if (usageViolations.length > 0) {
      /* istanbul ignore next */
      cov_9uaxcrozx().b[11][0]++;
      cov_9uaxcrozx().s[40]++;
      throw new Error(`Cannot downgrade: Current usage exceeds new plan limits: ${usageViolations.join(', ')}`);
    } else
    /* istanbul ignore next */
    {
      cov_9uaxcrozx().b[11][1]++;
    }
    // Calculate proration (usually a credit for downgrade)
    let prorationAmount =
    /* istanbul ignore next */
    (cov_9uaxcrozx().s[41]++, 0);
    /* istanbul ignore next */
    cov_9uaxcrozx().s[42]++;
    if (options.prorate) {
      /* istanbul ignore next */
      cov_9uaxcrozx().b[12][0]++;
      cov_9uaxcrozx().s[43]++;
      prorationAmount = await this.calculateProration(currentSubscription, newPlan.stripePriceId);
    } else
    /* istanbul ignore next */
    {
      cov_9uaxcrozx().b[12][1]++;
    }
    // Update the subscription
    const updatedSubscription =
    /* istanbul ignore next */
    (cov_9uaxcrozx().s[44]++, await _server1.stripe.subscriptions.update(org.stripe_subscription_id, {
      items: [{
        id: currentSubscription.items.data[0].id,
        price: newPlan.stripePriceId
      }],
      proration_behavior: options.prorate ?
      /* istanbul ignore next */
      (cov_9uaxcrozx().b[13][0]++, 'create_prorations') :
      /* istanbul ignore next */
      (cov_9uaxcrozx().b[13][1]++, 'none'),
      metadata: {
        ...currentSubscription.metadata,
        previousPlan: org.subscription_tier,
        downgradeDate: new Date().toISOString(),
        ...options.metadata
      }
    }));
    // Update organization record
    /* istanbul ignore next */
    cov_9uaxcrozx().s[45]++;
    await supabase.from('organizations').update({
      subscription_tier: newPlanId,
      updated_at: new Date().toISOString()
    }).eq('id', organizationId);
    // Log the change
    /* istanbul ignore next */
    cov_9uaxcrozx().s[46]++;
    await this.logSubscriptionChange(organizationId, {
      from: org.subscription_tier,
      to: newPlanId,
      effectiveDate: new Date(),
      prorationAmount,
      reason: 'downgrade'
    });
    // Enforce new limits
    /* istanbul ignore next */
    cov_9uaxcrozx().s[47]++;
    await this.getUsageTracker().enforceDowngradeLimits(organizationId, newPlanId);
    // Send downgrade notification
    /* istanbul ignore next */
    cov_9uaxcrozx().s[48]++;
    await this.getNotificationService().sendPlanDowngradeNotification(organizationId, newPlanId);
    /* istanbul ignore next */
    cov_9uaxcrozx().s[49]++;
    return {
      subscription: updatedSubscription,
      prorationAmount
    };
  }
  async cancelSubscription(organizationId, options) {
    /* istanbul ignore next */
    cov_9uaxcrozx().f[5]++;
    const supabase =
    /* istanbul ignore next */
    (cov_9uaxcrozx().s[50]++, await this.supabase);
    // Get current subscription
    const {
      data: org
    } =
    /* istanbul ignore next */
    (cov_9uaxcrozx().s[51]++, await supabase.from('organizations').select('stripe_subscription_id, subscription_tier').eq('id', organizationId).single());
    /* istanbul ignore next */
    cov_9uaxcrozx().s[52]++;
    if (!org?.stripe_subscription_id) {
      /* istanbul ignore next */
      cov_9uaxcrozx().b[14][0]++;
      cov_9uaxcrozx().s[53]++;
      throw new Error('No active subscription found');
    } else
    /* istanbul ignore next */
    {
      cov_9uaxcrozx().b[14][1]++;
    }
    let canceledSubscription;
    let effectiveDate;
    /* istanbul ignore next */
    cov_9uaxcrozx().s[54]++;
    if (options.immediate) {
      /* istanbul ignore next */
      cov_9uaxcrozx().b[15][0]++;
      cov_9uaxcrozx().s[55]++;
      // Cancel immediately
      canceledSubscription = await _server1.stripe.subscriptions.cancel(org.stripe_subscription_id);
      /* istanbul ignore next */
      cov_9uaxcrozx().s[56]++;
      effectiveDate = new Date();
      // Update organization immediately
      /* istanbul ignore next */
      cov_9uaxcrozx().s[57]++;
      await supabase.from('organizations').update({
        subscription_status: 'cancelled',
        subscription_tier: options.downgradeToFree ?
        /* istanbul ignore next */
        (cov_9uaxcrozx().b[16][0]++, 'starter') :
        /* istanbul ignore next */
        (cov_9uaxcrozx().b[16][1]++, org.subscription_tier),
        updated_at: new Date().toISOString()
      }).eq('id', organizationId);
      // Enforce free tier limits if downgrading
      /* istanbul ignore next */
      cov_9uaxcrozx().s[58]++;
      if (options.downgradeToFree) {
        /* istanbul ignore next */
        cov_9uaxcrozx().b[17][0]++;
        cov_9uaxcrozx().s[59]++;
        await this.getUsageTracker().enforceDowngradeLimits(organizationId, 'starter');
      } else
      /* istanbul ignore next */
      {
        cov_9uaxcrozx().b[17][1]++;
      }
    } else {
      /* istanbul ignore next */
      cov_9uaxcrozx().b[15][1]++;
      cov_9uaxcrozx().s[60]++;
      // Cancel at period end
      canceledSubscription = await _server1.stripe.subscriptions.update(org.stripe_subscription_id, {
        cancel_at_period_end: true,
        metadata: {
          cancellationReason: options.reason,
          cancellationFeedback:
          /* istanbul ignore next */
          (cov_9uaxcrozx().b[18][0]++, options.feedback) ||
          /* istanbul ignore next */
          (cov_9uaxcrozx().b[18][1]++, ''),
          cancelledAt: new Date().toISOString()
        }
      });
      /* istanbul ignore next */
      cov_9uaxcrozx().s[61]++;
      effectiveDate = new Date(canceledSubscription.current_period_end * 1000);
    }
    // Log cancellation
    /* istanbul ignore next */
    cov_9uaxcrozx().s[62]++;
    await this.logSubscriptionChange(organizationId, {
      from: org.subscription_tier,
      to: 'cancelled',
      effectiveDate,
      reason: 'cancellation'
    });
    // Store cancellation details
    /* istanbul ignore next */
    cov_9uaxcrozx().s[63]++;
    await supabase.from('subscription_cancellations').insert({
      organization_id: organizationId,
      subscription_id: org.stripe_subscription_id,
      reason: options.reason,
      feedback: options.feedback,
      immediate: options.immediate,
      cancelled_at: new Date().toISOString(),
      effective_date: effectiveDate.toISOString()
    });
    // Send cancellation notification
    /* istanbul ignore next */
    cov_9uaxcrozx().s[64]++;
    await this.getNotificationService().sendSubscriptionCancellation(organizationId);
    // Offer retention if requested
    /* istanbul ignore next */
    cov_9uaxcrozx().s[65]++;
    if (options.offerRetention) {
      /* istanbul ignore next */
      cov_9uaxcrozx().b[19][0]++;
      cov_9uaxcrozx().s[66]++;
      await this.offerRetentionDiscount(organizationId);
    } else
    /* istanbul ignore next */
    {
      cov_9uaxcrozx().b[19][1]++;
    }
    cov_9uaxcrozx().s[67]++;
    return {
      subscription: canceledSubscription,
      effectiveDate
    };
  }
  async reactivateSubscription(organizationId, planId) {
    /* istanbul ignore next */
    cov_9uaxcrozx().f[6]++;
    const supabase =
    /* istanbul ignore next */
    (cov_9uaxcrozx().s[68]++, await this.supabase);
    // Get organization details
    const {
      data: org
    } =
    /* istanbul ignore next */
    (cov_9uaxcrozx().s[69]++, await supabase.from('organizations').select('stripe_customer_id, stripe_subscription_id').eq('id', organizationId).single());
    /* istanbul ignore next */
    cov_9uaxcrozx().s[70]++;
    if (!org?.stripe_customer_id) {
      /* istanbul ignore next */
      cov_9uaxcrozx().b[20][0]++;
      cov_9uaxcrozx().s[71]++;
      throw new Error('No customer found');
    } else
    /* istanbul ignore next */
    {
      cov_9uaxcrozx().b[20][1]++;
    }
    let subscription;
    /* istanbul ignore next */
    cov_9uaxcrozx().s[72]++;
    if (org.stripe_subscription_id) {
      /* istanbul ignore next */
      cov_9uaxcrozx().b[21][0]++;
      cov_9uaxcrozx().s[73]++;
      // Try to reactivate existing subscription
      try {
        const existingSubscription =
        /* istanbul ignore next */
        (cov_9uaxcrozx().s[74]++, await _server1.stripe.subscriptions.retrieve(org.stripe_subscription_id));
        /* istanbul ignore next */
        cov_9uaxcrozx().s[75]++;
        if (existingSubscription.status === 'canceled') {
          /* istanbul ignore next */
          cov_9uaxcrozx().b[22][0]++;
          cov_9uaxcrozx().s[76]++;
          // Create new subscription
          subscription = await this.createNewSubscription(org.stripe_customer_id, planId, organizationId);
        } else {
          /* istanbul ignore next */
          cov_9uaxcrozx().b[22][1]++;
          cov_9uaxcrozx().s[77]++;
          // Update existing subscription
          subscription = await _server1.stripe.subscriptions.update(org.stripe_subscription_id, {
            cancel_at_period_end: false,
            items: [{
              id: existingSubscription.items.data[0].id,
              price: _server1.SUBSCRIPTION_PLANS[planId].stripePriceId
            }]
          });
        }
      } catch (error) {
        /* istanbul ignore next */
        cov_9uaxcrozx().s[78]++;
        // Create new subscription if existing one is not found
        subscription = await this.createNewSubscription(org.stripe_customer_id, planId, organizationId);
      }
    } else {
      /* istanbul ignore next */
      cov_9uaxcrozx().b[21][1]++;
      cov_9uaxcrozx().s[79]++;
      // Create new subscription
      subscription = await this.createNewSubscription(org.stripe_customer_id, planId, organizationId);
    }
    // Update organization
    /* istanbul ignore next */
    cov_9uaxcrozx().s[80]++;
    await supabase.from('organizations').update({
      stripe_subscription_id: subscription.id,
      subscription_status: 'active',
      subscription_tier: planId,
      updated_at: new Date().toISOString()
    }).eq('id', organizationId);
    // Log reactivation
    /* istanbul ignore next */
    cov_9uaxcrozx().s[81]++;
    await this.logSubscriptionChange(organizationId, {
      from: 'cancelled',
      to: planId,
      effectiveDate: new Date(),
      reason: 'reactivation'
    });
    // Send reactivation notification
    /* istanbul ignore next */
    cov_9uaxcrozx().s[82]++;
    await this.getNotificationService().sendSubscriptionReactivation(organizationId, planId);
    /* istanbul ignore next */
    cov_9uaxcrozx().s[83]++;
    return subscription;
  }
  async pauseSubscription(organizationId, pauseDuration // in days
  ) {
    /* istanbul ignore next */
    cov_9uaxcrozx().f[7]++;
    const supabase =
    /* istanbul ignore next */
    (cov_9uaxcrozx().s[84]++, await this.supabase);
    // Get current subscription
    const {
      data: org
    } =
    /* istanbul ignore next */
    (cov_9uaxcrozx().s[85]++, await supabase.from('organizations').select('stripe_subscription_id').eq('id', organizationId).single());
    /* istanbul ignore next */
    cov_9uaxcrozx().s[86]++;
    if (!org?.stripe_subscription_id) {
      /* istanbul ignore next */
      cov_9uaxcrozx().b[23][0]++;
      cov_9uaxcrozx().s[87]++;
      throw new Error('No active subscription found');
    } else
    /* istanbul ignore next */
    {
      cov_9uaxcrozx().b[23][1]++;
    }
    const pauseEnd =
    /* istanbul ignore next */
    (cov_9uaxcrozx().s[88]++, new Date());
    /* istanbul ignore next */
    cov_9uaxcrozx().s[89]++;
    pauseEnd.setDate(pauseEnd.getDate() + pauseDuration);
    // Pause the subscription
    const pausedSubscription =
    /* istanbul ignore next */
    (cov_9uaxcrozx().s[90]++, await _server1.stripe.subscriptions.update(org.stripe_subscription_id, {
      pause_collection: {
        behavior: 'void',
        resumes_at: Math.floor(pauseEnd.getTime() / 1000)
      },
      metadata: {
        pausedAt: new Date().toISOString(),
        pauseDuration: pauseDuration.toString()
      }
    }));
    // Update organization status
    /* istanbul ignore next */
    cov_9uaxcrozx().s[91]++;
    await supabase.from('organizations').update({
      subscription_status: 'paused',
      updated_at: new Date().toISOString()
    }).eq('id', organizationId);
    /* istanbul ignore next */
    cov_9uaxcrozx().s[92]++;
    return pausedSubscription;
  }
  async getSubscriptionMetrics(organizationId) {
    /* istanbul ignore next */
    cov_9uaxcrozx().f[8]++;
    const supabase =
    /* istanbul ignore next */
    (cov_9uaxcrozx().s[93]++, await this.supabase);
    const {
      data: org
    } =
    /* istanbul ignore next */
    (cov_9uaxcrozx().s[94]++, await supabase.from('organizations').select('*').eq('id', organizationId).single());
    /* istanbul ignore next */
    cov_9uaxcrozx().s[95]++;
    if (!org?.stripe_subscription_id) {
      /* istanbul ignore next */
      cov_9uaxcrozx().b[24][0]++;
      cov_9uaxcrozx().s[96]++;
      return null;
    } else
    /* istanbul ignore next */
    {
      cov_9uaxcrozx().b[24][1]++;
    }
    const subscription =
    /* istanbul ignore next */
    (cov_9uaxcrozx().s[97]++, await _server1.stripe.subscriptions.retrieve(org.stripe_subscription_id));
    const plan =
    /* istanbul ignore next */
    (cov_9uaxcrozx().s[98]++, _server1.SUBSCRIPTION_PLANS[org.subscription_tier]);
    const mrr =
    /* istanbul ignore next */
    (cov_9uaxcrozx().s[99]++, plan.price);
    const arr =
    /* istanbul ignore next */
    (cov_9uaxcrozx().s[100]++, mrr * 12);
    /* istanbul ignore next */
    cov_9uaxcrozx().s[101]++;
    return {
      id: subscription.id,
      organizationId,
      status: subscription.status,
      currentPlan: org.subscription_tier,
      mrr,
      arr,
      trialEndsAt: subscription.trial_end ?
      /* istanbul ignore next */
      (cov_9uaxcrozx().b[25][0]++, new Date(subscription.trial_end * 1000)) :
      /* istanbul ignore next */
      (cov_9uaxcrozx().b[25][1]++, undefined),
      currentPeriodStart: new Date(subscription.current_period_start * 1000),
      currentPeriodEnd: new Date(subscription.current_period_end * 1000),
      cancelAt: subscription.cancel_at ?
      /* istanbul ignore next */
      (cov_9uaxcrozx().b[26][0]++, new Date(subscription.cancel_at * 1000)) :
      /* istanbul ignore next */
      (cov_9uaxcrozx().b[26][1]++, undefined),
      canceledAt: subscription.canceled_at ?
      /* istanbul ignore next */
      (cov_9uaxcrozx().b[27][0]++, new Date(subscription.canceled_at * 1000)) :
      /* istanbul ignore next */
      (cov_9uaxcrozx().b[27][1]++, undefined),
      cancellationReason: subscription.metadata.cancellationReason,
      reactivationEligible: this.isReactivationEligible(subscription)
    };
  }
  async getSubscriptionHistory(organizationId) {
    /* istanbul ignore next */
    cov_9uaxcrozx().f[9]++;
    const supabase =
    /* istanbul ignore next */
    (cov_9uaxcrozx().s[102]++, await this.supabase);
    const {
      data: changes
    } =
    /* istanbul ignore next */
    (cov_9uaxcrozx().s[103]++, await supabase.from('subscription_changes').select('*').eq('organization_id', organizationId).order('effective_date', {
      ascending: false
    }));
    /* istanbul ignore next */
    cov_9uaxcrozx().s[104]++;
    return /* istanbul ignore next */(cov_9uaxcrozx().b[28][0]++, changes) ||
    /* istanbul ignore next */
    (cov_9uaxcrozx().b[28][1]++, []);
  }
  async processPendingCancellations() {
    /* istanbul ignore next */
    cov_9uaxcrozx().f[10]++;
    // Get subscriptions that are set to cancel at period end
    const subscriptions =
    /* istanbul ignore next */
    (cov_9uaxcrozx().s[105]++, await _server1.stripe.subscriptions.list({
      status: 'active',
      cancel_at_period_end: true,
      limit: 100
    }));
    /* istanbul ignore next */
    cov_9uaxcrozx().s[106]++;
    for (const subscription of subscriptions.data) {
      const organizationId =
      /* istanbul ignore next */
      (cov_9uaxcrozx().s[107]++, subscription.metadata.organizationId);
      /* istanbul ignore next */
      cov_9uaxcrozx().s[108]++;
      if (!organizationId) {
        /* istanbul ignore next */
        cov_9uaxcrozx().b[29][0]++;
        cov_9uaxcrozx().s[109]++;
        continue;
      } else
      /* istanbul ignore next */
      {
        cov_9uaxcrozx().b[29][1]++;
      }
      // Check if cancellation date has passed
      cov_9uaxcrozx().s[110]++;
      if (subscription.current_period_end * 1000 <= Date.now()) {
        /* istanbul ignore next */
        cov_9uaxcrozx().b[30][0]++;
        cov_9uaxcrozx().s[111]++;
        await this.finalizeCancellation(organizationId, subscription.id);
      } else
      /* istanbul ignore next */
      {
        cov_9uaxcrozx().b[30][1]++;
      }
    }
  }
  // Private helper methods
  async calculateProration(currentSubscription, newPriceId) {
    /* istanbul ignore next */
    cov_9uaxcrozx().f[11]++;
    cov_9uaxcrozx().s[112]++;
    try {
      const preview =
      /* istanbul ignore next */
      (cov_9uaxcrozx().s[113]++, await _server1.stripe.invoices.retrieveUpcoming({
        customer: currentSubscription.customer,
        subscription: currentSubscription.id,
        subscription_items: [{
          id: currentSubscription.items.data[0].id,
          price: newPriceId
        }],
        subscription_proration_behavior: 'create_prorations'
      }));
      /* istanbul ignore next */
      cov_9uaxcrozx().s[114]++;
      return preview.amount_due;
    } catch (error) {
      /* istanbul ignore next */
      cov_9uaxcrozx().s[115]++;
      console.error('Error calculating proration:', error);
      /* istanbul ignore next */
      cov_9uaxcrozx().s[116]++;
      return 0;
    }
  }
  checkUsageViolations(currentUsage, newLimits) {
    /* istanbul ignore next */
    cov_9uaxcrozx().f[12]++;
    const violations =
    /* istanbul ignore next */
    (cov_9uaxcrozx().s[117]++, []);
    /* istanbul ignore next */
    cov_9uaxcrozx().s[118]++;
    if (
    /* istanbul ignore next */
    (cov_9uaxcrozx().b[32][0]++, newLimits.maxUsers !== -1) &&
    /* istanbul ignore next */
    (cov_9uaxcrozx().b[32][1]++, currentUsage.users > newLimits.maxUsers)) {
      /* istanbul ignore next */
      cov_9uaxcrozx().b[31][0]++;
      cov_9uaxcrozx().s[119]++;
      violations.push(`Users (${currentUsage.users}/${newLimits.maxUsers})`);
    } else
    /* istanbul ignore next */
    {
      cov_9uaxcrozx().b[31][1]++;
    }
    cov_9uaxcrozx().s[120]++;
    if (
    /* istanbul ignore next */
    (cov_9uaxcrozx().b[34][0]++, newLimits.maxContacts !== -1) &&
    /* istanbul ignore next */
    (cov_9uaxcrozx().b[34][1]++, currentUsage.contacts > newLimits.maxContacts)) {
      /* istanbul ignore next */
      cov_9uaxcrozx().b[33][0]++;
      cov_9uaxcrozx().s[121]++;
      violations.push(`Contacts (${currentUsage.contacts}/${newLimits.maxContacts})`);
    } else
    /* istanbul ignore next */
    {
      cov_9uaxcrozx().b[33][1]++;
    }
    cov_9uaxcrozx().s[122]++;
    if (
    /* istanbul ignore next */
    (cov_9uaxcrozx().b[36][0]++, newLimits.maxMessages !== -1) &&
    /* istanbul ignore next */
    (cov_9uaxcrozx().b[36][1]++, currentUsage.messages > newLimits.maxMessages)) {
      /* istanbul ignore next */
      cov_9uaxcrozx().b[35][0]++;
      cov_9uaxcrozx().s[123]++;
      violations.push(`Messages (${currentUsage.messages}/${newLimits.maxMessages})`);
    } else
    /* istanbul ignore next */
    {
      cov_9uaxcrozx().b[35][1]++;
    }
    cov_9uaxcrozx().s[124]++;
    return violations;
  }
  async createNewSubscription(customerId, planId, organizationId) {
    /* istanbul ignore next */
    cov_9uaxcrozx().f[13]++;
    const plan =
    /* istanbul ignore next */
    (cov_9uaxcrozx().s[125]++, _server1.SUBSCRIPTION_PLANS[planId]);
    /* istanbul ignore next */
    cov_9uaxcrozx().s[126]++;
    return await _server1.stripe.subscriptions.create({
      customer: customerId,
      items: [{
        price: plan.stripePriceId
      }],
      metadata: {
        organizationId,
        planId
      }
    });
  }
  isReactivationEligible(subscription) {
    /* istanbul ignore next */
    cov_9uaxcrozx().f[14]++;
    cov_9uaxcrozx().s[127]++;
    // Check if subscription was canceled within the last 30 days
    if (!subscription.canceled_at) {
      /* istanbul ignore next */
      cov_9uaxcrozx().b[37][0]++;
      cov_9uaxcrozx().s[128]++;
      return false;
    } else
    /* istanbul ignore next */
    {
      cov_9uaxcrozx().b[37][1]++;
    }
    const canceledDate =
    /* istanbul ignore next */
    (cov_9uaxcrozx().s[129]++, new Date(subscription.canceled_at * 1000));
    const daysSinceCancellation =
    /* istanbul ignore next */
    (cov_9uaxcrozx().s[130]++, (Date.now() - canceledDate.getTime()) / (1000 * 60 * 60 * 24));
    /* istanbul ignore next */
    cov_9uaxcrozx().s[131]++;
    return daysSinceCancellation <= 30;
  }
  async logSubscriptionChange(organizationId, change) {
    /* istanbul ignore next */
    cov_9uaxcrozx().f[15]++;
    const supabase =
    /* istanbul ignore next */
    (cov_9uaxcrozx().s[132]++, await this.supabase);
    /* istanbul ignore next */
    cov_9uaxcrozx().s[133]++;
    await supabase.from('subscription_changes').insert({
      organization_id: organizationId,
      from_plan: change.from,
      to_plan: change.to,
      effective_date: change.effectiveDate.toISOString(),
      proration_amount:
      /* istanbul ignore next */
      (cov_9uaxcrozx().b[38][0]++, change.prorationAmount) ||
      /* istanbul ignore next */
      (cov_9uaxcrozx().b[38][1]++, 0),
      reason: change.reason,
      created_at: new Date().toISOString()
    });
  }
  async offerRetentionDiscount(organizationId) {
    /* istanbul ignore next */
    cov_9uaxcrozx().f[16]++;
    cov_9uaxcrozx().s[134]++;
    // Implement retention offer logic
    console.log(`Offering retention discount to organization ${organizationId}`);
  }
  async finalizeCancellation(organizationId, subscriptionId) {
    /* istanbul ignore next */
    cov_9uaxcrozx().f[17]++;
    const supabase =
    /* istanbul ignore next */
    (cov_9uaxcrozx().s[135]++, await this.supabase);
    /* istanbul ignore next */
    cov_9uaxcrozx().s[136]++;
    await supabase.from('organizations').update({
      subscription_status: 'cancelled',
      subscription_tier: 'starter',
      stripe_subscription_id: null,
      updated_at: new Date().toISOString()
    }).eq('id', organizationId);
    // Enforce free tier limits
    /* istanbul ignore next */
    cov_9uaxcrozx().s[137]++;
    await this.getUsageTracker().enforceDowngradeLimits(organizationId, 'starter');
  }
  constructor() {
    /* istanbul ignore next */
    cov_9uaxcrozx().f[18]++;
    cov_9uaxcrozx().s[138]++;
    this.supabase = (0, _server.createClient)();
    /* istanbul ignore next */
    cov_9uaxcrozx().s[139]++;
    this.usageTracker = null;
    /* istanbul ignore next */
    cov_9uaxcrozx().s[140]++;
    this.notificationService = null;
  }
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJjb3ZfOXVheGNyb3p4IiwiYWN0dWFsQ292ZXJhZ2UiLCJzIiwiU3Vic2NyaXB0aW9uTGlmZWN5Y2xlTWFuYWdlciIsImdldFVzYWdlVHJhY2tlciIsImYiLCJ1c2FnZVRyYWNrZXIiLCJiIiwiX3VzYWdldHJhY2tpbmciLCJVc2FnZVRyYWNrZXIiLCJnZXROb3RpZmljYXRpb25TZXJ2aWNlIiwibm90aWZpY2F0aW9uU2VydmljZSIsIl9ub3RpZmljYXRpb25zZXJ2aWNlIiwiTm90aWZpY2F0aW9uU2VydmljZSIsInVwZ3JhZGVTdWJzY3JpcHRpb24iLCJvcmdhbml6YXRpb25JZCIsIm5ld1BsYW5JZCIsIm9wdGlvbnMiLCJwcm9yYXRlIiwic3VwYWJhc2UiLCJkYXRhIiwib3JnIiwiZnJvbSIsInNlbGVjdCIsImVxIiwic2luZ2xlIiwic3RyaXBlX3N1YnNjcmlwdGlvbl9pZCIsIkVycm9yIiwiY3VycmVudFN1YnNjcmlwdGlvbiIsIl9zZXJ2ZXIxIiwic3RyaXBlIiwic3Vic2NyaXB0aW9ucyIsInJldHJpZXZlIiwibmV3UGxhbiIsIlNVQlNDUklQVElPTl9QTEFOUyIsInByb3JhdGlvbkFtb3VudCIsImNhbGN1bGF0ZVByb3JhdGlvbiIsInN0cmlwZVByaWNlSWQiLCJ1cGRhdGVkU3Vic2NyaXB0aW9uIiwidXBkYXRlIiwiaXRlbXMiLCJpZCIsInByaWNlIiwicHJvcmF0aW9uX2JlaGF2aW9yIiwiYmlsbGluZ19jeWNsZV9hbmNob3IiLCJiaWxsaW5nQ3ljbGVBbmNob3IiLCJ0cmlhbF9lbmQiLCJ0cmlhbEVuZCIsIk1hdGgiLCJmbG9vciIsImdldFRpbWUiLCJ1bmRlZmluZWQiLCJtZXRhZGF0YSIsInByZXZpb3VzUGxhbiIsInN1YnNjcmlwdGlvbl90aWVyIiwidXBncmFkZURhdGUiLCJEYXRlIiwidG9JU09TdHJpbmciLCJ1cGRhdGVkX2F0IiwibG9nU3Vic2NyaXB0aW9uQ2hhbmdlIiwidG8iLCJlZmZlY3RpdmVEYXRlIiwicmVhc29uIiwidXBkYXRlUGxhbkxpbWl0cyIsInNlbmRQbGFuVXBncmFkZU5vdGlmaWNhdGlvbiIsInN1YnNjcmlwdGlvbiIsImRvd25ncmFkZVN1YnNjcmlwdGlvbiIsImN1cnJlbnRVc2FnZSIsImdldEN1cnJlbnRVc2FnZSIsIm5ld0xpbWl0cyIsImdldFBsYW5MaW1pdHMiLCJ1c2FnZVZpb2xhdGlvbnMiLCJjaGVja1VzYWdlVmlvbGF0aW9ucyIsImxlbmd0aCIsImpvaW4iLCJkb3duZ3JhZGVEYXRlIiwiZW5mb3JjZURvd25ncmFkZUxpbWl0cyIsInNlbmRQbGFuRG93bmdyYWRlTm90aWZpY2F0aW9uIiwiY2FuY2VsU3Vic2NyaXB0aW9uIiwiY2FuY2VsZWRTdWJzY3JpcHRpb24iLCJpbW1lZGlhdGUiLCJjYW5jZWwiLCJzdWJzY3JpcHRpb25fc3RhdHVzIiwiZG93bmdyYWRlVG9GcmVlIiwiY2FuY2VsX2F0X3BlcmlvZF9lbmQiLCJjYW5jZWxsYXRpb25SZWFzb24iLCJjYW5jZWxsYXRpb25GZWVkYmFjayIsImZlZWRiYWNrIiwiY2FuY2VsbGVkQXQiLCJjdXJyZW50X3BlcmlvZF9lbmQiLCJpbnNlcnQiLCJvcmdhbml6YXRpb25faWQiLCJzdWJzY3JpcHRpb25faWQiLCJjYW5jZWxsZWRfYXQiLCJlZmZlY3RpdmVfZGF0ZSIsInNlbmRTdWJzY3JpcHRpb25DYW5jZWxsYXRpb24iLCJvZmZlclJldGVudGlvbiIsIm9mZmVyUmV0ZW50aW9uRGlzY291bnQiLCJyZWFjdGl2YXRlU3Vic2NyaXB0aW9uIiwicGxhbklkIiwic3RyaXBlX2N1c3RvbWVyX2lkIiwiZXhpc3RpbmdTdWJzY3JpcHRpb24iLCJzdGF0dXMiLCJjcmVhdGVOZXdTdWJzY3JpcHRpb24iLCJlcnJvciIsInNlbmRTdWJzY3JpcHRpb25SZWFjdGl2YXRpb24iLCJwYXVzZVN1YnNjcmlwdGlvbiIsInBhdXNlRHVyYXRpb24iLCJwYXVzZUVuZCIsInNldERhdGUiLCJnZXREYXRlIiwicGF1c2VkU3Vic2NyaXB0aW9uIiwicGF1c2VfY29sbGVjdGlvbiIsImJlaGF2aW9yIiwicmVzdW1lc19hdCIsInBhdXNlZEF0IiwidG9TdHJpbmciLCJnZXRTdWJzY3JpcHRpb25NZXRyaWNzIiwicGxhbiIsIm1yciIsImFyciIsImN1cnJlbnRQbGFuIiwidHJpYWxFbmRzQXQiLCJjdXJyZW50UGVyaW9kU3RhcnQiLCJjdXJyZW50X3BlcmlvZF9zdGFydCIsImN1cnJlbnRQZXJpb2RFbmQiLCJjYW5jZWxBdCIsImNhbmNlbF9hdCIsImNhbmNlbGVkQXQiLCJjYW5jZWxlZF9hdCIsInJlYWN0aXZhdGlvbkVsaWdpYmxlIiwiaXNSZWFjdGl2YXRpb25FbGlnaWJsZSIsImdldFN1YnNjcmlwdGlvbkhpc3RvcnkiLCJjaGFuZ2VzIiwib3JkZXIiLCJhc2NlbmRpbmciLCJwcm9jZXNzUGVuZGluZ0NhbmNlbGxhdGlvbnMiLCJsaXN0IiwibGltaXQiLCJub3ciLCJmaW5hbGl6ZUNhbmNlbGxhdGlvbiIsIm5ld1ByaWNlSWQiLCJwcmV2aWV3IiwiaW52b2ljZXMiLCJyZXRyaWV2ZVVwY29taW5nIiwiY3VzdG9tZXIiLCJzdWJzY3JpcHRpb25faXRlbXMiLCJzdWJzY3JpcHRpb25fcHJvcmF0aW9uX2JlaGF2aW9yIiwiYW1vdW50X2R1ZSIsImNvbnNvbGUiLCJ2aW9sYXRpb25zIiwibWF4VXNlcnMiLCJ1c2VycyIsInB1c2giLCJtYXhDb250YWN0cyIsImNvbnRhY3RzIiwibWF4TWVzc2FnZXMiLCJtZXNzYWdlcyIsImN1c3RvbWVySWQiLCJjcmVhdGUiLCJjYW5jZWxlZERhdGUiLCJkYXlzU2luY2VDYW5jZWxsYXRpb24iLCJjaGFuZ2UiLCJmcm9tX3BsYW4iLCJ0b19wbGFuIiwicHJvcmF0aW9uX2Ftb3VudCIsImNyZWF0ZWRfYXQiLCJsb2ciLCJzdWJzY3JpcHRpb25JZCIsIl9zZXJ2ZXIiLCJjcmVhdGVDbGllbnQiXSwic291cmNlcyI6WyJDOlxcQWkgUHJvamVjdGVuXFxBRFNhcHBcXHNyY1xcbGliXFxiaWxsaW5nXFxzdWJzY3JpcHRpb24tbGlmZWN5Y2xlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBTdHJpcGUgZnJvbSAnc3RyaXBlJ1xuaW1wb3J0IHsgY3JlYXRlQ2xpZW50IH0gZnJvbSAnQC9saWIvc3VwYWJhc2Uvc2VydmVyJ1xuaW1wb3J0IHsgc3RyaXBlLCBTVUJTQ1JJUFRJT05fUExBTlMgfSBmcm9tICdAL2xpYi9zdHJpcGUvc2VydmVyJ1xuaW1wb3J0IHsgVXNhZ2VUcmFja2VyIH0gZnJvbSAnLi91c2FnZS10cmFja2luZydcbmltcG9ydCB7IE5vdGlmaWNhdGlvblNlcnZpY2UgfSBmcm9tICcuL25vdGlmaWNhdGlvbi1zZXJ2aWNlJ1xuXG5leHBvcnQgaW50ZXJmYWNlIFN1YnNjcmlwdGlvbkNoYW5nZSB7XG4gIGZyb206IHN0cmluZ1xuICB0bzogc3RyaW5nXG4gIGVmZmVjdGl2ZURhdGU6IERhdGVcbiAgcHJvcmF0aW9uQW1vdW50PzogbnVtYmVyXG4gIHJlYXNvbjogJ3VwZ3JhZGUnIHwgJ2Rvd25ncmFkZScgfCAndHJpYWxfZW5kJyB8ICdjYW5jZWxsYXRpb24nIHwgJ3JlYWN0aXZhdGlvbidcbn1cblxuZXhwb3J0IGludGVyZmFjZSBTdWJzY3JpcHRpb25NZXRyaWNzIHtcbiAgaWQ6IHN0cmluZ1xuICBvcmdhbml6YXRpb25JZDogc3RyaW5nXG4gIHN0YXR1czogc3RyaW5nXG4gIGN1cnJlbnRQbGFuOiBzdHJpbmdcbiAgbXJyOiBudW1iZXIgLy8gTW9udGhseSBSZWN1cnJpbmcgUmV2ZW51ZVxuICBhcnI6IG51bWJlciAvLyBBbm51YWwgUmVjdXJyaW5nIFJldmVudWVcbiAgdHJpYWxFbmRzQXQ/OiBEYXRlXG4gIGN1cnJlbnRQZXJpb2RTdGFydDogRGF0ZVxuICBjdXJyZW50UGVyaW9kRW5kOiBEYXRlXG4gIGNhbmNlbEF0PzogRGF0ZVxuICBjYW5jZWxlZEF0PzogRGF0ZVxuICBjYW5jZWxsYXRpb25SZWFzb24/OiBzdHJpbmdcbiAgcmVhY3RpdmF0aW9uRWxpZ2libGU6IGJvb2xlYW5cbn1cblxuZXhwb3J0IGludGVyZmFjZSBQbGFuQ2hhbmdlT3B0aW9ucyB7XG4gIHByb3JhdGU6IGJvb2xlYW5cbiAgYmlsbGluZ0N5Y2xlQW5jaG9yPzogJ25vdycgfCAndW5jaGFuZ2VkJ1xuICB0cmlhbEVuZD86IERhdGVcbiAgbWV0YWRhdGE/OiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgQ2FuY2VsbGF0aW9uT3B0aW9ucyB7XG4gIGltbWVkaWF0ZTogYm9vbGVhblxuICByZWFzb246IHN0cmluZ1xuICBmZWVkYmFjaz86IHN0cmluZ1xuICBvZmZlclJldGVudGlvbj86IGJvb2xlYW5cbiAgZG93bmdyYWRlVG9GcmVlPzogYm9vbGVhblxufVxuXG5leHBvcnQgY2xhc3MgU3Vic2NyaXB0aW9uTGlmZWN5Y2xlTWFuYWdlciB7XG4gIHByaXZhdGUgc3VwYWJhc2UgPSBjcmVhdGVDbGllbnQoKVxuICBwcml2YXRlIHVzYWdlVHJhY2tlcjogVXNhZ2VUcmFja2VyIHwgbnVsbCA9IG51bGxcbiAgcHJpdmF0ZSBub3RpZmljYXRpb25TZXJ2aWNlOiBOb3RpZmljYXRpb25TZXJ2aWNlIHwgbnVsbCA9IG51bGxcblxuICBwcml2YXRlIGdldFVzYWdlVHJhY2tlcigpOiBVc2FnZVRyYWNrZXIge1xuICAgIGlmICghdGhpcy51c2FnZVRyYWNrZXIpIHtcbiAgICAgIHRoaXMudXNhZ2VUcmFja2VyID0gbmV3IFVzYWdlVHJhY2tlcigpXG4gICAgfVxuICAgIHJldHVybiB0aGlzLnVzYWdlVHJhY2tlclxuICB9XG5cbiAgcHJpdmF0ZSBnZXROb3RpZmljYXRpb25TZXJ2aWNlKCk6IE5vdGlmaWNhdGlvblNlcnZpY2Uge1xuICAgIGlmICghdGhpcy5ub3RpZmljYXRpb25TZXJ2aWNlKSB7XG4gICAgICB0aGlzLm5vdGlmaWNhdGlvblNlcnZpY2UgPSBuZXcgTm90aWZpY2F0aW9uU2VydmljZSgpXG4gICAgfVxuICAgIHJldHVybiB0aGlzLm5vdGlmaWNhdGlvblNlcnZpY2VcbiAgfVxuXG4gIGFzeW5jIHVwZ3JhZGVTdWJzY3JpcHRpb24oXG4gICAgb3JnYW5pemF0aW9uSWQ6IHN0cmluZyxcbiAgICBuZXdQbGFuSWQ6IGtleW9mIHR5cGVvZiBTVUJTQ1JJUFRJT05fUExBTlMsXG4gICAgb3B0aW9uczogUGxhbkNoYW5nZU9wdGlvbnMgPSB7IHByb3JhdGU6IHRydWUgfVxuICApOiBQcm9taXNlPHsgc3Vic2NyaXB0aW9uOiBTdHJpcGUuU3Vic2NyaXB0aW9uOyBwcm9yYXRpb25BbW91bnQ6IG51bWJlciB9PiB7XG4gICAgY29uc3Qgc3VwYWJhc2UgPSBhd2FpdCB0aGlzLnN1cGFiYXNlXG5cbiAgICAvLyBHZXQgY3VycmVudCBzdWJzY3JpcHRpb25cbiAgICBjb25zdCB7IGRhdGE6IG9yZyB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAgIC5mcm9tKCdvcmdhbml6YXRpb25zJylcbiAgICAgIC5zZWxlY3QoJ3N0cmlwZV9zdWJzY3JpcHRpb25faWQsIHN1YnNjcmlwdGlvbl90aWVyLCBzdHJpcGVfY3VzdG9tZXJfaWQnKVxuICAgICAgLmVxKCdpZCcsIG9yZ2FuaXphdGlvbklkKVxuICAgICAgLnNpbmdsZSgpXG5cbiAgICBpZiAoIW9yZz8uc3RyaXBlX3N1YnNjcmlwdGlvbl9pZCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdObyBhY3RpdmUgc3Vic2NyaXB0aW9uIGZvdW5kJylcbiAgICB9XG5cbiAgICBjb25zdCBjdXJyZW50U3Vic2NyaXB0aW9uID0gYXdhaXQgc3RyaXBlLnN1YnNjcmlwdGlvbnMucmV0cmlldmUob3JnLnN0cmlwZV9zdWJzY3JpcHRpb25faWQpXG4gICAgY29uc3QgbmV3UGxhbiA9IFNVQlNDUklQVElPTl9QTEFOU1tuZXdQbGFuSWRdXG5cbiAgICBpZiAoIW5ld1BsYW4pIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignSW52YWxpZCBwbGFuIElEJylcbiAgICB9XG5cbiAgICAvLyBDYWxjdWxhdGUgcHJvcmF0aW9uIGlmIG5lZWRlZFxuICAgIGxldCBwcm9yYXRpb25BbW91bnQgPSAwXG4gICAgaWYgKG9wdGlvbnMucHJvcmF0ZSkge1xuICAgICAgcHJvcmF0aW9uQW1vdW50ID0gYXdhaXQgdGhpcy5jYWxjdWxhdGVQcm9yYXRpb24oXG4gICAgICAgIGN1cnJlbnRTdWJzY3JpcHRpb24sXG4gICAgICAgIG5ld1BsYW4uc3RyaXBlUHJpY2VJZFxuICAgICAgKVxuICAgIH1cblxuICAgIC8vIFVwZGF0ZSB0aGUgc3Vic2NyaXB0aW9uXG4gICAgY29uc3QgdXBkYXRlZFN1YnNjcmlwdGlvbiA9IGF3YWl0IHN0cmlwZS5zdWJzY3JpcHRpb25zLnVwZGF0ZShvcmcuc3RyaXBlX3N1YnNjcmlwdGlvbl9pZCwge1xuICAgICAgaXRlbXM6IFtcbiAgICAgICAge1xuICAgICAgICAgIGlkOiBjdXJyZW50U3Vic2NyaXB0aW9uLml0ZW1zLmRhdGFbMF0uaWQsXG4gICAgICAgICAgcHJpY2U6IG5ld1BsYW4uc3RyaXBlUHJpY2VJZCxcbiAgICAgICAgfSxcbiAgICAgIF0sXG4gICAgICBwcm9yYXRpb25fYmVoYXZpb3I6IG9wdGlvbnMucHJvcmF0ZSA/ICdjcmVhdGVfcHJvcmF0aW9ucycgOiAnbm9uZScsXG4gICAgICBiaWxsaW5nX2N5Y2xlX2FuY2hvcjogb3B0aW9ucy5iaWxsaW5nQ3ljbGVBbmNob3IgPT09ICdub3cnID8gJ25vdycgOiAndW5jaGFuZ2VkJyxcbiAgICAgIHRyaWFsX2VuZDogb3B0aW9ucy50cmlhbEVuZCA/IE1hdGguZmxvb3Iob3B0aW9ucy50cmlhbEVuZC5nZXRUaW1lKCkgLyAxMDAwKSA6IHVuZGVmaW5lZCxcbiAgICAgIG1ldGFkYXRhOiB7XG4gICAgICAgIC4uLmN1cnJlbnRTdWJzY3JpcHRpb24ubWV0YWRhdGEsXG4gICAgICAgIHByZXZpb3VzUGxhbjogb3JnLnN1YnNjcmlwdGlvbl90aWVyLFxuICAgICAgICB1cGdyYWRlRGF0ZTogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgICAgICAuLi5vcHRpb25zLm1ldGFkYXRhLFxuICAgICAgfSxcbiAgICB9KVxuXG4gICAgLy8gVXBkYXRlIG9yZ2FuaXphdGlvbiByZWNvcmRcbiAgICBhd2FpdCBzdXBhYmFzZVxuICAgICAgLmZyb20oJ29yZ2FuaXphdGlvbnMnKVxuICAgICAgLnVwZGF0ZSh7XG4gICAgICAgIHN1YnNjcmlwdGlvbl90aWVyOiBuZXdQbGFuSWQsXG4gICAgICAgIHVwZGF0ZWRfYXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgIH0pXG4gICAgICAuZXEoJ2lkJywgb3JnYW5pemF0aW9uSWQpXG5cbiAgICAvLyBMb2cgdGhlIGNoYW5nZVxuICAgIGF3YWl0IHRoaXMubG9nU3Vic2NyaXB0aW9uQ2hhbmdlKG9yZ2FuaXphdGlvbklkLCB7XG4gICAgICBmcm9tOiBvcmcuc3Vic2NyaXB0aW9uX3RpZXIsXG4gICAgICB0bzogbmV3UGxhbklkLFxuICAgICAgZWZmZWN0aXZlRGF0ZTogbmV3IERhdGUoKSxcbiAgICAgIHByb3JhdGlvbkFtb3VudCxcbiAgICAgIHJlYXNvbjogJ3VwZ3JhZGUnLFxuICAgIH0pXG5cbiAgICAvLyBVcGRhdGUgdXNhZ2UgbGltaXRzXG4gICAgYXdhaXQgdGhpcy5nZXRVc2FnZVRyYWNrZXIoKS51cGRhdGVQbGFuTGltaXRzKG9yZ2FuaXphdGlvbklkLCBuZXdQbGFuSWQpXG5cbiAgICAvLyBTZW5kIHVwZ3JhZGUgbm90aWZpY2F0aW9uXG4gICAgYXdhaXQgdGhpcy5nZXROb3RpZmljYXRpb25TZXJ2aWNlKCkuc2VuZFBsYW5VcGdyYWRlTm90aWZpY2F0aW9uKG9yZ2FuaXphdGlvbklkLCBuZXdQbGFuSWQpXG5cbiAgICByZXR1cm4ge1xuICAgICAgc3Vic2NyaXB0aW9uOiB1cGRhdGVkU3Vic2NyaXB0aW9uLFxuICAgICAgcHJvcmF0aW9uQW1vdW50LFxuICAgIH1cbiAgfVxuXG4gIGFzeW5jIGRvd25ncmFkZVN1YnNjcmlwdGlvbihcbiAgICBvcmdhbml6YXRpb25JZDogc3RyaW5nLFxuICAgIG5ld1BsYW5JZDoga2V5b2YgdHlwZW9mIFNVQlNDUklQVElPTl9QTEFOUyxcbiAgICBvcHRpb25zOiBQbGFuQ2hhbmdlT3B0aW9ucyA9IHsgcHJvcmF0ZTogdHJ1ZSB9XG4gICk6IFByb21pc2U8eyBzdWJzY3JpcHRpb246IFN0cmlwZS5TdWJzY3JpcHRpb247IHByb3JhdGlvbkFtb3VudDogbnVtYmVyIH0+IHtcbiAgICBjb25zdCBzdXBhYmFzZSA9IGF3YWl0IHRoaXMuc3VwYWJhc2VcblxuICAgIC8vIEdldCBjdXJyZW50IHN1YnNjcmlwdGlvblxuICAgIGNvbnN0IHsgZGF0YTogb3JnIH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgICAgLmZyb20oJ29yZ2FuaXphdGlvbnMnKVxuICAgICAgLnNlbGVjdCgnc3RyaXBlX3N1YnNjcmlwdGlvbl9pZCwgc3Vic2NyaXB0aW9uX3RpZXInKVxuICAgICAgLmVxKCdpZCcsIG9yZ2FuaXphdGlvbklkKVxuICAgICAgLnNpbmdsZSgpXG5cbiAgICBpZiAoIW9yZz8uc3RyaXBlX3N1YnNjcmlwdGlvbl9pZCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdObyBhY3RpdmUgc3Vic2NyaXB0aW9uIGZvdW5kJylcbiAgICB9XG5cbiAgICBjb25zdCBjdXJyZW50U3Vic2NyaXB0aW9uID0gYXdhaXQgc3RyaXBlLnN1YnNjcmlwdGlvbnMucmV0cmlldmUob3JnLnN0cmlwZV9zdWJzY3JpcHRpb25faWQpXG4gICAgY29uc3QgbmV3UGxhbiA9IFNVQlNDUklQVElPTl9QTEFOU1tuZXdQbGFuSWRdXG5cbiAgICAvLyBDaGVjayB1c2FnZSBsaW1pdHMgYmVmb3JlIGRvd25ncmFkZVxuICAgIGNvbnN0IGN1cnJlbnRVc2FnZSA9IGF3YWl0IHRoaXMuZ2V0VXNhZ2VUcmFja2VyKCkuZ2V0Q3VycmVudFVzYWdlKG9yZ2FuaXphdGlvbklkKVxuICAgIGNvbnN0IG5ld0xpbWl0cyA9IGF3YWl0IHRoaXMuZ2V0VXNhZ2VUcmFja2VyKCkuZ2V0UGxhbkxpbWl0cyhuZXdQbGFuSWQpXG5cbiAgICBjb25zdCB1c2FnZVZpb2xhdGlvbnMgPSB0aGlzLmNoZWNrVXNhZ2VWaW9sYXRpb25zKGN1cnJlbnRVc2FnZSwgbmV3TGltaXRzKVxuICAgIGlmICh1c2FnZVZpb2xhdGlvbnMubGVuZ3RoID4gMCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBDYW5ub3QgZG93bmdyYWRlOiBDdXJyZW50IHVzYWdlIGV4Y2VlZHMgbmV3IHBsYW4gbGltaXRzOiAke3VzYWdlVmlvbGF0aW9ucy5qb2luKCcsICcpfWApXG4gICAgfVxuXG4gICAgLy8gQ2FsY3VsYXRlIHByb3JhdGlvbiAodXN1YWxseSBhIGNyZWRpdCBmb3IgZG93bmdyYWRlKVxuICAgIGxldCBwcm9yYXRpb25BbW91bnQgPSAwXG4gICAgaWYgKG9wdGlvbnMucHJvcmF0ZSkge1xuICAgICAgcHJvcmF0aW9uQW1vdW50ID0gYXdhaXQgdGhpcy5jYWxjdWxhdGVQcm9yYXRpb24oXG4gICAgICAgIGN1cnJlbnRTdWJzY3JpcHRpb24sXG4gICAgICAgIG5ld1BsYW4uc3RyaXBlUHJpY2VJZFxuICAgICAgKVxuICAgIH1cblxuICAgIC8vIFVwZGF0ZSB0aGUgc3Vic2NyaXB0aW9uXG4gICAgY29uc3QgdXBkYXRlZFN1YnNjcmlwdGlvbiA9IGF3YWl0IHN0cmlwZS5zdWJzY3JpcHRpb25zLnVwZGF0ZShvcmcuc3RyaXBlX3N1YnNjcmlwdGlvbl9pZCwge1xuICAgICAgaXRlbXM6IFtcbiAgICAgICAge1xuICAgICAgICAgIGlkOiBjdXJyZW50U3Vic2NyaXB0aW9uLml0ZW1zLmRhdGFbMF0uaWQsXG4gICAgICAgICAgcHJpY2U6IG5ld1BsYW4uc3RyaXBlUHJpY2VJZCxcbiAgICAgICAgfSxcbiAgICAgIF0sXG4gICAgICBwcm9yYXRpb25fYmVoYXZpb3I6IG9wdGlvbnMucHJvcmF0ZSA/ICdjcmVhdGVfcHJvcmF0aW9ucycgOiAnbm9uZScsXG4gICAgICBtZXRhZGF0YToge1xuICAgICAgICAuLi5jdXJyZW50U3Vic2NyaXB0aW9uLm1ldGFkYXRhLFxuICAgICAgICBwcmV2aW91c1BsYW46IG9yZy5zdWJzY3JpcHRpb25fdGllcixcbiAgICAgICAgZG93bmdyYWRlRGF0ZTogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgICAgICAuLi5vcHRpb25zLm1ldGFkYXRhLFxuICAgICAgfSxcbiAgICB9KVxuXG4gICAgLy8gVXBkYXRlIG9yZ2FuaXphdGlvbiByZWNvcmRcbiAgICBhd2FpdCBzdXBhYmFzZVxuICAgICAgLmZyb20oJ29yZ2FuaXphdGlvbnMnKVxuICAgICAgLnVwZGF0ZSh7XG4gICAgICAgIHN1YnNjcmlwdGlvbl90aWVyOiBuZXdQbGFuSWQsXG4gICAgICAgIHVwZGF0ZWRfYXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgIH0pXG4gICAgICAuZXEoJ2lkJywgb3JnYW5pemF0aW9uSWQpXG5cbiAgICAvLyBMb2cgdGhlIGNoYW5nZVxuICAgIGF3YWl0IHRoaXMubG9nU3Vic2NyaXB0aW9uQ2hhbmdlKG9yZ2FuaXphdGlvbklkLCB7XG4gICAgICBmcm9tOiBvcmcuc3Vic2NyaXB0aW9uX3RpZXIsXG4gICAgICB0bzogbmV3UGxhbklkLFxuICAgICAgZWZmZWN0aXZlRGF0ZTogbmV3IERhdGUoKSxcbiAgICAgIHByb3JhdGlvbkFtb3VudCxcbiAgICAgIHJlYXNvbjogJ2Rvd25ncmFkZScsXG4gICAgfSlcblxuICAgIC8vIEVuZm9yY2UgbmV3IGxpbWl0c1xuICAgIGF3YWl0IHRoaXMuZ2V0VXNhZ2VUcmFja2VyKCkuZW5mb3JjZURvd25ncmFkZUxpbWl0cyhvcmdhbml6YXRpb25JZCwgbmV3UGxhbklkKVxuXG4gICAgLy8gU2VuZCBkb3duZ3JhZGUgbm90aWZpY2F0aW9uXG4gICAgYXdhaXQgdGhpcy5nZXROb3RpZmljYXRpb25TZXJ2aWNlKCkuc2VuZFBsYW5Eb3duZ3JhZGVOb3RpZmljYXRpb24ob3JnYW5pemF0aW9uSWQsIG5ld1BsYW5JZClcblxuICAgIHJldHVybiB7XG4gICAgICBzdWJzY3JpcHRpb246IHVwZGF0ZWRTdWJzY3JpcHRpb24sXG4gICAgICBwcm9yYXRpb25BbW91bnQsXG4gICAgfVxuICB9XG5cbiAgYXN5bmMgY2FuY2VsU3Vic2NyaXB0aW9uKFxuICAgIG9yZ2FuaXphdGlvbklkOiBzdHJpbmcsXG4gICAgb3B0aW9uczogQ2FuY2VsbGF0aW9uT3B0aW9uc1xuICApOiBQcm9taXNlPHsgc3Vic2NyaXB0aW9uOiBTdHJpcGUuU3Vic2NyaXB0aW9uOyBlZmZlY3RpdmVEYXRlOiBEYXRlIH0+IHtcbiAgICBjb25zdCBzdXBhYmFzZSA9IGF3YWl0IHRoaXMuc3VwYWJhc2VcblxuICAgIC8vIEdldCBjdXJyZW50IHN1YnNjcmlwdGlvblxuICAgIGNvbnN0IHsgZGF0YTogb3JnIH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgICAgLmZyb20oJ29yZ2FuaXphdGlvbnMnKVxuICAgICAgLnNlbGVjdCgnc3RyaXBlX3N1YnNjcmlwdGlvbl9pZCwgc3Vic2NyaXB0aW9uX3RpZXInKVxuICAgICAgLmVxKCdpZCcsIG9yZ2FuaXphdGlvbklkKVxuICAgICAgLnNpbmdsZSgpXG5cbiAgICBpZiAoIW9yZz8uc3RyaXBlX3N1YnNjcmlwdGlvbl9pZCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdObyBhY3RpdmUgc3Vic2NyaXB0aW9uIGZvdW5kJylcbiAgICB9XG5cbiAgICBsZXQgY2FuY2VsZWRTdWJzY3JpcHRpb246IFN0cmlwZS5TdWJzY3JpcHRpb25cbiAgICBsZXQgZWZmZWN0aXZlRGF0ZTogRGF0ZVxuXG4gICAgaWYgKG9wdGlvbnMuaW1tZWRpYXRlKSB7XG4gICAgICAvLyBDYW5jZWwgaW1tZWRpYXRlbHlcbiAgICAgIGNhbmNlbGVkU3Vic2NyaXB0aW9uID0gYXdhaXQgc3RyaXBlLnN1YnNjcmlwdGlvbnMuY2FuY2VsKG9yZy5zdHJpcGVfc3Vic2NyaXB0aW9uX2lkKVxuICAgICAgZWZmZWN0aXZlRGF0ZSA9IG5ldyBEYXRlKClcblxuICAgICAgLy8gVXBkYXRlIG9yZ2FuaXphdGlvbiBpbW1lZGlhdGVseVxuICAgICAgYXdhaXQgc3VwYWJhc2VcbiAgICAgICAgLmZyb20oJ29yZ2FuaXphdGlvbnMnKVxuICAgICAgICAudXBkYXRlKHtcbiAgICAgICAgICBzdWJzY3JpcHRpb25fc3RhdHVzOiAnY2FuY2VsbGVkJyxcbiAgICAgICAgICBzdWJzY3JpcHRpb25fdGllcjogb3B0aW9ucy5kb3duZ3JhZGVUb0ZyZWUgPyAnc3RhcnRlcicgOiBvcmcuc3Vic2NyaXB0aW9uX3RpZXIsXG4gICAgICAgICAgdXBkYXRlZF9hdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgICAgICB9KVxuICAgICAgICAuZXEoJ2lkJywgb3JnYW5pemF0aW9uSWQpXG5cbiAgICAgIC8vIEVuZm9yY2UgZnJlZSB0aWVyIGxpbWl0cyBpZiBkb3duZ3JhZGluZ1xuICAgICAgaWYgKG9wdGlvbnMuZG93bmdyYWRlVG9GcmVlKSB7XG4gICAgICAgIGF3YWl0IHRoaXMuZ2V0VXNhZ2VUcmFja2VyKCkuZW5mb3JjZURvd25ncmFkZUxpbWl0cyhvcmdhbml6YXRpb25JZCwgJ3N0YXJ0ZXInKVxuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICAvLyBDYW5jZWwgYXQgcGVyaW9kIGVuZFxuICAgICAgY2FuY2VsZWRTdWJzY3JpcHRpb24gPSBhd2FpdCBzdHJpcGUuc3Vic2NyaXB0aW9ucy51cGRhdGUob3JnLnN0cmlwZV9zdWJzY3JpcHRpb25faWQsIHtcbiAgICAgICAgY2FuY2VsX2F0X3BlcmlvZF9lbmQ6IHRydWUsXG4gICAgICAgIG1ldGFkYXRhOiB7XG4gICAgICAgICAgY2FuY2VsbGF0aW9uUmVhc29uOiBvcHRpb25zLnJlYXNvbixcbiAgICAgICAgICBjYW5jZWxsYXRpb25GZWVkYmFjazogb3B0aW9ucy5mZWVkYmFjayB8fCAnJyxcbiAgICAgICAgICBjYW5jZWxsZWRBdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgICAgICB9LFxuICAgICAgfSlcbiAgICAgIGVmZmVjdGl2ZURhdGUgPSBuZXcgRGF0ZShjYW5jZWxlZFN1YnNjcmlwdGlvbi5jdXJyZW50X3BlcmlvZF9lbmQgKiAxMDAwKVxuICAgIH1cblxuICAgIC8vIExvZyBjYW5jZWxsYXRpb25cbiAgICBhd2FpdCB0aGlzLmxvZ1N1YnNjcmlwdGlvbkNoYW5nZShvcmdhbml6YXRpb25JZCwge1xuICAgICAgZnJvbTogb3JnLnN1YnNjcmlwdGlvbl90aWVyLFxuICAgICAgdG86ICdjYW5jZWxsZWQnLFxuICAgICAgZWZmZWN0aXZlRGF0ZSxcbiAgICAgIHJlYXNvbjogJ2NhbmNlbGxhdGlvbicsXG4gICAgfSlcblxuICAgIC8vIFN0b3JlIGNhbmNlbGxhdGlvbiBkZXRhaWxzXG4gICAgYXdhaXQgc3VwYWJhc2VcbiAgICAgIC5mcm9tKCdzdWJzY3JpcHRpb25fY2FuY2VsbGF0aW9ucycpXG4gICAgICAuaW5zZXJ0KHtcbiAgICAgICAgb3JnYW5pemF0aW9uX2lkOiBvcmdhbml6YXRpb25JZCxcbiAgICAgICAgc3Vic2NyaXB0aW9uX2lkOiBvcmcuc3RyaXBlX3N1YnNjcmlwdGlvbl9pZCxcbiAgICAgICAgcmVhc29uOiBvcHRpb25zLnJlYXNvbixcbiAgICAgICAgZmVlZGJhY2s6IG9wdGlvbnMuZmVlZGJhY2ssXG4gICAgICAgIGltbWVkaWF0ZTogb3B0aW9ucy5pbW1lZGlhdGUsXG4gICAgICAgIGNhbmNlbGxlZF9hdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgICAgICBlZmZlY3RpdmVfZGF0ZTogZWZmZWN0aXZlRGF0ZS50b0lTT1N0cmluZygpLFxuICAgICAgfSlcblxuICAgIC8vIFNlbmQgY2FuY2VsbGF0aW9uIG5vdGlmaWNhdGlvblxuICAgIGF3YWl0IHRoaXMuZ2V0Tm90aWZpY2F0aW9uU2VydmljZSgpLnNlbmRTdWJzY3JpcHRpb25DYW5jZWxsYXRpb24ob3JnYW5pemF0aW9uSWQpXG5cbiAgICAvLyBPZmZlciByZXRlbnRpb24gaWYgcmVxdWVzdGVkXG4gICAgaWYgKG9wdGlvbnMub2ZmZXJSZXRlbnRpb24pIHtcbiAgICAgIGF3YWl0IHRoaXMub2ZmZXJSZXRlbnRpb25EaXNjb3VudChvcmdhbml6YXRpb25JZClcbiAgICB9XG5cbiAgICByZXR1cm4ge1xuICAgICAgc3Vic2NyaXB0aW9uOiBjYW5jZWxlZFN1YnNjcmlwdGlvbixcbiAgICAgIGVmZmVjdGl2ZURhdGUsXG4gICAgfVxuICB9XG5cbiAgYXN5bmMgcmVhY3RpdmF0ZVN1YnNjcmlwdGlvbihcbiAgICBvcmdhbml6YXRpb25JZDogc3RyaW5nLFxuICAgIHBsYW5JZDoga2V5b2YgdHlwZW9mIFNVQlNDUklQVElPTl9QTEFOU1xuICApOiBQcm9taXNlPFN0cmlwZS5TdWJzY3JpcHRpb24+IHtcbiAgICBjb25zdCBzdXBhYmFzZSA9IGF3YWl0IHRoaXMuc3VwYWJhc2VcblxuICAgIC8vIEdldCBvcmdhbml6YXRpb24gZGV0YWlsc1xuICAgIGNvbnN0IHsgZGF0YTogb3JnIH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgICAgLmZyb20oJ29yZ2FuaXphdGlvbnMnKVxuICAgICAgLnNlbGVjdCgnc3RyaXBlX2N1c3RvbWVyX2lkLCBzdHJpcGVfc3Vic2NyaXB0aW9uX2lkJylcbiAgICAgIC5lcSgnaWQnLCBvcmdhbml6YXRpb25JZClcbiAgICAgIC5zaW5nbGUoKVxuXG4gICAgaWYgKCFvcmc/LnN0cmlwZV9jdXN0b21lcl9pZCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdObyBjdXN0b21lciBmb3VuZCcpXG4gICAgfVxuXG4gICAgbGV0IHN1YnNjcmlwdGlvbjogU3RyaXBlLlN1YnNjcmlwdGlvblxuXG4gICAgaWYgKG9yZy5zdHJpcGVfc3Vic2NyaXB0aW9uX2lkKSB7XG4gICAgICAvLyBUcnkgdG8gcmVhY3RpdmF0ZSBleGlzdGluZyBzdWJzY3JpcHRpb25cbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGV4aXN0aW5nU3Vic2NyaXB0aW9uID0gYXdhaXQgc3RyaXBlLnN1YnNjcmlwdGlvbnMucmV0cmlldmUob3JnLnN0cmlwZV9zdWJzY3JpcHRpb25faWQpXG5cbiAgICAgICAgaWYgKGV4aXN0aW5nU3Vic2NyaXB0aW9uLnN0YXR1cyA9PT0gJ2NhbmNlbGVkJykge1xuICAgICAgICAgIC8vIENyZWF0ZSBuZXcgc3Vic2NyaXB0aW9uXG4gICAgICAgICAgc3Vic2NyaXB0aW9uID0gYXdhaXQgdGhpcy5jcmVhdGVOZXdTdWJzY3JpcHRpb24ob3JnLnN0cmlwZV9jdXN0b21lcl9pZCwgcGxhbklkLCBvcmdhbml6YXRpb25JZClcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAvLyBVcGRhdGUgZXhpc3Rpbmcgc3Vic2NyaXB0aW9uXG4gICAgICAgICAgc3Vic2NyaXB0aW9uID0gYXdhaXQgc3RyaXBlLnN1YnNjcmlwdGlvbnMudXBkYXRlKG9yZy5zdHJpcGVfc3Vic2NyaXB0aW9uX2lkLCB7XG4gICAgICAgICAgICBjYW5jZWxfYXRfcGVyaW9kX2VuZDogZmFsc2UsXG4gICAgICAgICAgICBpdGVtczogW1xuICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgaWQ6IGV4aXN0aW5nU3Vic2NyaXB0aW9uLml0ZW1zLmRhdGFbMF0uaWQsXG4gICAgICAgICAgICAgICAgcHJpY2U6IFNVQlNDUklQVElPTl9QTEFOU1twbGFuSWRdLnN0cmlwZVByaWNlSWQsXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBdLFxuICAgICAgICAgIH0pXG4gICAgICAgIH1cbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIC8vIENyZWF0ZSBuZXcgc3Vic2NyaXB0aW9uIGlmIGV4aXN0aW5nIG9uZSBpcyBub3QgZm91bmRcbiAgICAgICAgc3Vic2NyaXB0aW9uID0gYXdhaXQgdGhpcy5jcmVhdGVOZXdTdWJzY3JpcHRpb24ob3JnLnN0cmlwZV9jdXN0b21lcl9pZCwgcGxhbklkLCBvcmdhbml6YXRpb25JZClcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgLy8gQ3JlYXRlIG5ldyBzdWJzY3JpcHRpb25cbiAgICAgIHN1YnNjcmlwdGlvbiA9IGF3YWl0IHRoaXMuY3JlYXRlTmV3U3Vic2NyaXB0aW9uKG9yZy5zdHJpcGVfY3VzdG9tZXJfaWQsIHBsYW5JZCwgb3JnYW5pemF0aW9uSWQpXG4gICAgfVxuXG4gICAgLy8gVXBkYXRlIG9yZ2FuaXphdGlvblxuICAgIGF3YWl0IHN1cGFiYXNlXG4gICAgICAuZnJvbSgnb3JnYW5pemF0aW9ucycpXG4gICAgICAudXBkYXRlKHtcbiAgICAgICAgc3RyaXBlX3N1YnNjcmlwdGlvbl9pZDogc3Vic2NyaXB0aW9uLmlkLFxuICAgICAgICBzdWJzY3JpcHRpb25fc3RhdHVzOiAnYWN0aXZlJyxcbiAgICAgICAgc3Vic2NyaXB0aW9uX3RpZXI6IHBsYW5JZCxcbiAgICAgICAgdXBkYXRlZF9hdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgICAgfSlcbiAgICAgIC5lcSgnaWQnLCBvcmdhbml6YXRpb25JZClcblxuICAgIC8vIExvZyByZWFjdGl2YXRpb25cbiAgICBhd2FpdCB0aGlzLmxvZ1N1YnNjcmlwdGlvbkNoYW5nZShvcmdhbml6YXRpb25JZCwge1xuICAgICAgZnJvbTogJ2NhbmNlbGxlZCcsXG4gICAgICB0bzogcGxhbklkLFxuICAgICAgZWZmZWN0aXZlRGF0ZTogbmV3IERhdGUoKSxcbiAgICAgIHJlYXNvbjogJ3JlYWN0aXZhdGlvbicsXG4gICAgfSlcblxuICAgIC8vIFNlbmQgcmVhY3RpdmF0aW9uIG5vdGlmaWNhdGlvblxuICAgIGF3YWl0IHRoaXMuZ2V0Tm90aWZpY2F0aW9uU2VydmljZSgpLnNlbmRTdWJzY3JpcHRpb25SZWFjdGl2YXRpb24ob3JnYW5pemF0aW9uSWQsIHBsYW5JZClcblxuICAgIHJldHVybiBzdWJzY3JpcHRpb25cbiAgfVxuXG4gIGFzeW5jIHBhdXNlU3Vic2NyaXB0aW9uKFxuICAgIG9yZ2FuaXphdGlvbklkOiBzdHJpbmcsXG4gICAgcGF1c2VEdXJhdGlvbjogbnVtYmVyIC8vIGluIGRheXNcbiAgKTogUHJvbWlzZTxTdHJpcGUuU3Vic2NyaXB0aW9uPiB7XG4gICAgY29uc3Qgc3VwYWJhc2UgPSBhd2FpdCB0aGlzLnN1cGFiYXNlXG5cbiAgICAvLyBHZXQgY3VycmVudCBzdWJzY3JpcHRpb25cbiAgICBjb25zdCB7IGRhdGE6IG9yZyB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAgIC5mcm9tKCdvcmdhbml6YXRpb25zJylcbiAgICAgIC5zZWxlY3QoJ3N0cmlwZV9zdWJzY3JpcHRpb25faWQnKVxuICAgICAgLmVxKCdpZCcsIG9yZ2FuaXphdGlvbklkKVxuICAgICAgLnNpbmdsZSgpXG5cbiAgICBpZiAoIW9yZz8uc3RyaXBlX3N1YnNjcmlwdGlvbl9pZCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdObyBhY3RpdmUgc3Vic2NyaXB0aW9uIGZvdW5kJylcbiAgICB9XG5cbiAgICBjb25zdCBwYXVzZUVuZCA9IG5ldyBEYXRlKClcbiAgICBwYXVzZUVuZC5zZXREYXRlKHBhdXNlRW5kLmdldERhdGUoKSArIHBhdXNlRHVyYXRpb24pXG5cbiAgICAvLyBQYXVzZSB0aGUgc3Vic2NyaXB0aW9uXG4gICAgY29uc3QgcGF1c2VkU3Vic2NyaXB0aW9uID0gYXdhaXQgc3RyaXBlLnN1YnNjcmlwdGlvbnMudXBkYXRlKG9yZy5zdHJpcGVfc3Vic2NyaXB0aW9uX2lkLCB7XG4gICAgICBwYXVzZV9jb2xsZWN0aW9uOiB7XG4gICAgICAgIGJlaGF2aW9yOiAndm9pZCcsXG4gICAgICAgIHJlc3VtZXNfYXQ6IE1hdGguZmxvb3IocGF1c2VFbmQuZ2V0VGltZSgpIC8gMTAwMCksXG4gICAgICB9LFxuICAgICAgbWV0YWRhdGE6IHtcbiAgICAgICAgcGF1c2VkQXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgICAgcGF1c2VEdXJhdGlvbjogcGF1c2VEdXJhdGlvbi50b1N0cmluZygpLFxuICAgICAgfSxcbiAgICB9KVxuXG4gICAgLy8gVXBkYXRlIG9yZ2FuaXphdGlvbiBzdGF0dXNcbiAgICBhd2FpdCBzdXBhYmFzZVxuICAgICAgLmZyb20oJ29yZ2FuaXphdGlvbnMnKVxuICAgICAgLnVwZGF0ZSh7XG4gICAgICAgIHN1YnNjcmlwdGlvbl9zdGF0dXM6ICdwYXVzZWQnLFxuICAgICAgICB1cGRhdGVkX2F0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgICB9KVxuICAgICAgLmVxKCdpZCcsIG9yZ2FuaXphdGlvbklkKVxuXG4gICAgcmV0dXJuIHBhdXNlZFN1YnNjcmlwdGlvblxuICB9XG5cbiAgYXN5bmMgZ2V0U3Vic2NyaXB0aW9uTWV0cmljcyhvcmdhbml6YXRpb25JZDogc3RyaW5nKTogUHJvbWlzZTxTdWJzY3JpcHRpb25NZXRyaWNzIHwgbnVsbD4ge1xuICAgIGNvbnN0IHN1cGFiYXNlID0gYXdhaXQgdGhpcy5zdXBhYmFzZVxuXG4gICAgY29uc3QgeyBkYXRhOiBvcmcgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgICAuZnJvbSgnb3JnYW5pemF0aW9ucycpXG4gICAgICAuc2VsZWN0KCcqJylcbiAgICAgIC5lcSgnaWQnLCBvcmdhbml6YXRpb25JZClcbiAgICAgIC5zaW5nbGUoKVxuXG4gICAgaWYgKCFvcmc/LnN0cmlwZV9zdWJzY3JpcHRpb25faWQpIHtcbiAgICAgIHJldHVybiBudWxsXG4gICAgfVxuXG4gICAgY29uc3Qgc3Vic2NyaXB0aW9uID0gYXdhaXQgc3RyaXBlLnN1YnNjcmlwdGlvbnMucmV0cmlldmUob3JnLnN0cmlwZV9zdWJzY3JpcHRpb25faWQpXG4gICAgY29uc3QgcGxhbiA9IFNVQlNDUklQVElPTl9QTEFOU1tvcmcuc3Vic2NyaXB0aW9uX3RpZXIgYXMga2V5b2YgdHlwZW9mIFNVQlNDUklQVElPTl9QTEFOU11cblxuICAgIGNvbnN0IG1yciA9IHBsYW4ucHJpY2VcbiAgICBjb25zdCBhcnIgPSBtcnIgKiAxMlxuXG4gICAgcmV0dXJuIHtcbiAgICAgIGlkOiBzdWJzY3JpcHRpb24uaWQsXG4gICAgICBvcmdhbml6YXRpb25JZCxcbiAgICAgIHN0YXR1czogc3Vic2NyaXB0aW9uLnN0YXR1cyxcbiAgICAgIGN1cnJlbnRQbGFuOiBvcmcuc3Vic2NyaXB0aW9uX3RpZXIsXG4gICAgICBtcnIsXG4gICAgICBhcnIsXG4gICAgICB0cmlhbEVuZHNBdDogc3Vic2NyaXB0aW9uLnRyaWFsX2VuZCA/IG5ldyBEYXRlKHN1YnNjcmlwdGlvbi50cmlhbF9lbmQgKiAxMDAwKSA6IHVuZGVmaW5lZCxcbiAgICAgIGN1cnJlbnRQZXJpb2RTdGFydDogbmV3IERhdGUoc3Vic2NyaXB0aW9uLmN1cnJlbnRfcGVyaW9kX3N0YXJ0ICogMTAwMCksXG4gICAgICBjdXJyZW50UGVyaW9kRW5kOiBuZXcgRGF0ZShzdWJzY3JpcHRpb24uY3VycmVudF9wZXJpb2RfZW5kICogMTAwMCksXG4gICAgICBjYW5jZWxBdDogc3Vic2NyaXB0aW9uLmNhbmNlbF9hdCA/IG5ldyBEYXRlKHN1YnNjcmlwdGlvbi5jYW5jZWxfYXQgKiAxMDAwKSA6IHVuZGVmaW5lZCxcbiAgICAgIGNhbmNlbGVkQXQ6IHN1YnNjcmlwdGlvbi5jYW5jZWxlZF9hdCA/IG5ldyBEYXRlKHN1YnNjcmlwdGlvbi5jYW5jZWxlZF9hdCAqIDEwMDApIDogdW5kZWZpbmVkLFxuICAgICAgY2FuY2VsbGF0aW9uUmVhc29uOiBzdWJzY3JpcHRpb24ubWV0YWRhdGEuY2FuY2VsbGF0aW9uUmVhc29uLFxuICAgICAgcmVhY3RpdmF0aW9uRWxpZ2libGU6IHRoaXMuaXNSZWFjdGl2YXRpb25FbGlnaWJsZShzdWJzY3JpcHRpb24pLFxuICAgIH1cbiAgfVxuXG4gIGFzeW5jIGdldFN1YnNjcmlwdGlvbkhpc3RvcnkoXG4gICAgb3JnYW5pemF0aW9uSWQ6IHN0cmluZ1xuICApOiBQcm9taXNlPFN1YnNjcmlwdGlvbkNoYW5nZVtdPiB7XG4gICAgY29uc3Qgc3VwYWJhc2UgPSBhd2FpdCB0aGlzLnN1cGFiYXNlXG5cbiAgICBjb25zdCB7IGRhdGE6IGNoYW5nZXMgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgICAuZnJvbSgnc3Vic2NyaXB0aW9uX2NoYW5nZXMnKVxuICAgICAgLnNlbGVjdCgnKicpXG4gICAgICAuZXEoJ29yZ2FuaXphdGlvbl9pZCcsIG9yZ2FuaXphdGlvbklkKVxuICAgICAgLm9yZGVyKCdlZmZlY3RpdmVfZGF0ZScsIHsgYXNjZW5kaW5nOiBmYWxzZSB9KVxuXG4gICAgcmV0dXJuIGNoYW5nZXMgfHwgW11cbiAgfVxuXG4gIGFzeW5jIHByb2Nlc3NQZW5kaW5nQ2FuY2VsbGF0aW9ucygpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAvLyBHZXQgc3Vic2NyaXB0aW9ucyB0aGF0IGFyZSBzZXQgdG8gY2FuY2VsIGF0IHBlcmlvZCBlbmRcbiAgICBjb25zdCBzdWJzY3JpcHRpb25zID0gYXdhaXQgc3RyaXBlLnN1YnNjcmlwdGlvbnMubGlzdCh7XG4gICAgICBzdGF0dXM6ICdhY3RpdmUnLFxuICAgICAgY2FuY2VsX2F0X3BlcmlvZF9lbmQ6IHRydWUsXG4gICAgICBsaW1pdDogMTAwLFxuICAgIH0pXG5cbiAgICBmb3IgKGNvbnN0IHN1YnNjcmlwdGlvbiBvZiBzdWJzY3JpcHRpb25zLmRhdGEpIHtcbiAgICAgIGNvbnN0IG9yZ2FuaXphdGlvbklkID0gc3Vic2NyaXB0aW9uLm1ldGFkYXRhLm9yZ2FuaXphdGlvbklkXG4gICAgICBpZiAoIW9yZ2FuaXphdGlvbklkKSBjb250aW51ZVxuXG4gICAgICAvLyBDaGVjayBpZiBjYW5jZWxsYXRpb24gZGF0ZSBoYXMgcGFzc2VkXG4gICAgICBpZiAoc3Vic2NyaXB0aW9uLmN1cnJlbnRfcGVyaW9kX2VuZCAqIDEwMDAgPD0gRGF0ZS5ub3coKSkge1xuICAgICAgICBhd2FpdCB0aGlzLmZpbmFsaXplQ2FuY2VsbGF0aW9uKG9yZ2FuaXphdGlvbklkLCBzdWJzY3JpcHRpb24uaWQpXG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLy8gUHJpdmF0ZSBoZWxwZXIgbWV0aG9kc1xuICBwcml2YXRlIGFzeW5jIGNhbGN1bGF0ZVByb3JhdGlvbihcbiAgICBjdXJyZW50U3Vic2NyaXB0aW9uOiBTdHJpcGUuU3Vic2NyaXB0aW9uLFxuICAgIG5ld1ByaWNlSWQ6IHN0cmluZ1xuICApOiBQcm9taXNlPG51bWJlcj4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBwcmV2aWV3ID0gYXdhaXQgc3RyaXBlLmludm9pY2VzLnJldHJpZXZlVXBjb21pbmcoe1xuICAgICAgICBjdXN0b21lcjogY3VycmVudFN1YnNjcmlwdGlvbi5jdXN0b21lciBhcyBzdHJpbmcsXG4gICAgICAgIHN1YnNjcmlwdGlvbjogY3VycmVudFN1YnNjcmlwdGlvbi5pZCxcbiAgICAgICAgc3Vic2NyaXB0aW9uX2l0ZW1zOiBbXG4gICAgICAgICAge1xuICAgICAgICAgICAgaWQ6IGN1cnJlbnRTdWJzY3JpcHRpb24uaXRlbXMuZGF0YVswXS5pZCxcbiAgICAgICAgICAgIHByaWNlOiBuZXdQcmljZUlkLFxuICAgICAgICAgIH0sXG4gICAgICAgIF0sXG4gICAgICAgIHN1YnNjcmlwdGlvbl9wcm9yYXRpb25fYmVoYXZpb3I6ICdjcmVhdGVfcHJvcmF0aW9ucycsXG4gICAgICB9KVxuXG4gICAgICByZXR1cm4gcHJldmlldy5hbW91bnRfZHVlXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGNhbGN1bGF0aW5nIHByb3JhdGlvbjonLCBlcnJvcilcbiAgICAgIHJldHVybiAwXG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBjaGVja1VzYWdlVmlvbGF0aW9ucyhjdXJyZW50VXNhZ2U6IGFueSwgbmV3TGltaXRzOiBhbnkpOiBzdHJpbmdbXSB7XG4gICAgY29uc3QgdmlvbGF0aW9uczogc3RyaW5nW10gPSBbXVxuXG4gICAgaWYgKG5ld0xpbWl0cy5tYXhVc2VycyAhPT0gLTEgJiYgY3VycmVudFVzYWdlLnVzZXJzID4gbmV3TGltaXRzLm1heFVzZXJzKSB7XG4gICAgICB2aW9sYXRpb25zLnB1c2goYFVzZXJzICgke2N1cnJlbnRVc2FnZS51c2Vyc30vJHtuZXdMaW1pdHMubWF4VXNlcnN9KWApXG4gICAgfVxuXG4gICAgaWYgKG5ld0xpbWl0cy5tYXhDb250YWN0cyAhPT0gLTEgJiYgY3VycmVudFVzYWdlLmNvbnRhY3RzID4gbmV3TGltaXRzLm1heENvbnRhY3RzKSB7XG4gICAgICB2aW9sYXRpb25zLnB1c2goYENvbnRhY3RzICgke2N1cnJlbnRVc2FnZS5jb250YWN0c30vJHtuZXdMaW1pdHMubWF4Q29udGFjdHN9KWApXG4gICAgfVxuXG4gICAgaWYgKG5ld0xpbWl0cy5tYXhNZXNzYWdlcyAhPT0gLTEgJiYgY3VycmVudFVzYWdlLm1lc3NhZ2VzID4gbmV3TGltaXRzLm1heE1lc3NhZ2VzKSB7XG4gICAgICB2aW9sYXRpb25zLnB1c2goYE1lc3NhZ2VzICgke2N1cnJlbnRVc2FnZS5tZXNzYWdlc30vJHtuZXdMaW1pdHMubWF4TWVzc2FnZXN9KWApXG4gICAgfVxuXG4gICAgcmV0dXJuIHZpb2xhdGlvbnNcbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgY3JlYXRlTmV3U3Vic2NyaXB0aW9uKFxuICAgIGN1c3RvbWVySWQ6IHN0cmluZyxcbiAgICBwbGFuSWQ6IGtleW9mIHR5cGVvZiBTVUJTQ1JJUFRJT05fUExBTlMsXG4gICAgb3JnYW5pemF0aW9uSWQ6IHN0cmluZ1xuICApOiBQcm9taXNlPFN0cmlwZS5TdWJzY3JpcHRpb24+IHtcbiAgICBjb25zdCBwbGFuID0gU1VCU0NSSVBUSU9OX1BMQU5TW3BsYW5JZF1cblxuICAgIHJldHVybiBhd2FpdCBzdHJpcGUuc3Vic2NyaXB0aW9ucy5jcmVhdGUoe1xuICAgICAgY3VzdG9tZXI6IGN1c3RvbWVySWQsXG4gICAgICBpdGVtczogW3sgcHJpY2U6IHBsYW4uc3RyaXBlUHJpY2VJZCB9XSxcbiAgICAgIG1ldGFkYXRhOiB7XG4gICAgICAgIG9yZ2FuaXphdGlvbklkLFxuICAgICAgICBwbGFuSWQsXG4gICAgICB9LFxuICAgIH0pXG4gIH1cblxuICBwcml2YXRlIGlzUmVhY3RpdmF0aW9uRWxpZ2libGUoc3Vic2NyaXB0aW9uOiBTdHJpcGUuU3Vic2NyaXB0aW9uKTogYm9vbGVhbiB7XG4gICAgLy8gQ2hlY2sgaWYgc3Vic2NyaXB0aW9uIHdhcyBjYW5jZWxlZCB3aXRoaW4gdGhlIGxhc3QgMzAgZGF5c1xuICAgIGlmICghc3Vic2NyaXB0aW9uLmNhbmNlbGVkX2F0KSByZXR1cm4gZmFsc2VcblxuICAgIGNvbnN0IGNhbmNlbGVkRGF0ZSA9IG5ldyBEYXRlKHN1YnNjcmlwdGlvbi5jYW5jZWxlZF9hdCAqIDEwMDApXG4gICAgY29uc3QgZGF5c1NpbmNlQ2FuY2VsbGF0aW9uID0gKERhdGUubm93KCkgLSBjYW5jZWxlZERhdGUuZ2V0VGltZSgpKSAvICgxMDAwICogNjAgKiA2MCAqIDI0KVxuXG4gICAgcmV0dXJuIGRheXNTaW5jZUNhbmNlbGxhdGlvbiA8PSAzMFxuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBsb2dTdWJzY3JpcHRpb25DaGFuZ2UoXG4gICAgb3JnYW5pemF0aW9uSWQ6IHN0cmluZyxcbiAgICBjaGFuZ2U6IFN1YnNjcmlwdGlvbkNoYW5nZVxuICApOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBjb25zdCBzdXBhYmFzZSA9IGF3YWl0IHRoaXMuc3VwYWJhc2VcblxuICAgIGF3YWl0IHN1cGFiYXNlXG4gICAgICAuZnJvbSgnc3Vic2NyaXB0aW9uX2NoYW5nZXMnKVxuICAgICAgLmluc2VydCh7XG4gICAgICAgIG9yZ2FuaXphdGlvbl9pZDogb3JnYW5pemF0aW9uSWQsXG4gICAgICAgIGZyb21fcGxhbjogY2hhbmdlLmZyb20sXG4gICAgICAgIHRvX3BsYW46IGNoYW5nZS50byxcbiAgICAgICAgZWZmZWN0aXZlX2RhdGU6IGNoYW5nZS5lZmZlY3RpdmVEYXRlLnRvSVNPU3RyaW5nKCksXG4gICAgICAgIHByb3JhdGlvbl9hbW91bnQ6IGNoYW5nZS5wcm9yYXRpb25BbW91bnQgfHwgMCxcbiAgICAgICAgcmVhc29uOiBjaGFuZ2UucmVhc29uLFxuICAgICAgICBjcmVhdGVkX2F0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgICB9KVxuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBvZmZlclJldGVudGlvbkRpc2NvdW50KG9yZ2FuaXphdGlvbklkOiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAvLyBJbXBsZW1lbnQgcmV0ZW50aW9uIG9mZmVyIGxvZ2ljXG4gICAgY29uc29sZS5sb2coYE9mZmVyaW5nIHJldGVudGlvbiBkaXNjb3VudCB0byBvcmdhbml6YXRpb24gJHtvcmdhbml6YXRpb25JZH1gKVxuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBmaW5hbGl6ZUNhbmNlbGxhdGlvbihvcmdhbml6YXRpb25JZDogc3RyaW5nLCBzdWJzY3JpcHRpb25JZDogc3RyaW5nKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgY29uc3Qgc3VwYWJhc2UgPSBhd2FpdCB0aGlzLnN1cGFiYXNlXG5cbiAgICBhd2FpdCBzdXBhYmFzZVxuICAgICAgLmZyb20oJ29yZ2FuaXphdGlvbnMnKVxuICAgICAgLnVwZGF0ZSh7XG4gICAgICAgIHN1YnNjcmlwdGlvbl9zdGF0dXM6ICdjYW5jZWxsZWQnLFxuICAgICAgICBzdWJzY3JpcHRpb25fdGllcjogJ3N0YXJ0ZXInLFxuICAgICAgICBzdHJpcGVfc3Vic2NyaXB0aW9uX2lkOiBudWxsLFxuICAgICAgICB1cGRhdGVkX2F0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgICB9KVxuICAgICAgLmVxKCdpZCcsIG9yZ2FuaXphdGlvbklkKVxuXG4gICAgLy8gRW5mb3JjZSBmcmVlIHRpZXIgbGltaXRzXG4gICAgYXdhaXQgdGhpcy5nZXRVc2FnZVRyYWNrZXIoKS5lbmZvcmNlRG93bmdyYWRlTGltaXRzKG9yZ2FuaXphdGlvbklkLCAnc3RhcnRlcicpXG4gIH1cbn0iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7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