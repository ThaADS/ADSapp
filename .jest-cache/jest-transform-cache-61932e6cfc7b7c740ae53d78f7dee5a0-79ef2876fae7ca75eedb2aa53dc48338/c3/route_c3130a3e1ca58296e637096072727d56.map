{"version":3,"names":["GET","cov_5pzql6p80","f","s","POST","request","user","_apiutils","requireAuthenticatedUser","profile","getUserOrganization","id","body","json","format","b","filters","fields","includeStats","includes","_server","NextResponse","error","status","allowedFields","invalidFields","filter","field","length","join","supabase","_server1","createClient","countQuery","from","select","count","eq","organization_id","applyFilters","exportConfig","queue","_queue","BulkOperationQueue","operation","createOperation","organizationId","userId","type","totalItems","configuration","createSuccessResponse","estimatedContacts","console","createErrorResponse","searchParams","URL","url","get","split","segment","tags","Boolean","limit","Math","min","max","parseInt","query","generateSelectString","applySegmentFilter","overlaps","data","contacts","order","ascending","formattedData","formatExportData","headers","search","or","Array","isArray","blocked","undefined","createdAfter","gte","createdBefore","lte","lastMessageAfter","lastMessageBefore","thirtyDaysAgo","Date","now","toISOString","thirtyDaysAgoInactive","sevenDaysAgo","contains","selectFields","processedContacts","map","contact","processedContact","convertToCSV","Object","keys","csvContent","row","header","value","replace"],"sources":["C:\\Ai Projecten\\ADSapp\\src\\app\\api\\contacts\\export\\route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server'\nimport { requireAuthenticatedUser, getUserOrganization, createErrorResponse, createSuccessResponse } from '@/lib/api-utils'\nimport { BulkOperationQueue } from '@/lib/bulk-operations/queue'\nimport { createClient } from '@/lib/supabase/server'\n\nexport async function POST(request: NextRequest) {\n  try {\n    const user = await requireAuthenticatedUser()\n    const profile = await getUserOrganization(user.id)\n\n    const body = await request.json()\n    const {\n      format = 'csv',\n      filters = {},\n      fields = ['name', 'phone_number', 'email', 'tags', 'created_at', 'last_message_at'],\n      includeStats = false\n    } = body\n\n    // Validate format\n    if (!['csv', 'xlsx', 'json'].includes(format)) {\n      return NextResponse.json(\n        { error: 'Invalid format. Supported formats: csv, xlsx, json' },\n        { status: 400 }\n      )\n    }\n\n    // Validate fields\n    const allowedFields = [\n      'id', 'name', 'phone_number', 'whatsapp_id', 'email', 'tags', 'notes',\n      'is_blocked', 'created_at', 'updated_at', 'last_message_at'\n    ]\n\n    const invalidFields = fields.filter(field => !allowedFields.includes(field))\n    if (invalidFields.length > 0) {\n      return NextResponse.json(\n        { error: `Invalid fields: ${invalidFields.join(', ')}` },\n        { status: 400 }\n      )\n    }\n\n    const supabase = await createClient()\n\n    // Count contacts that match filters\n    let countQuery = supabase\n      .from('contacts')\n      .select('id', { count: 'exact' })\n      .eq('organization_id', profile.organization_id)\n\n    // Apply filters\n    countQuery = applyFilters(countQuery, filters)\n\n    const { count } = await countQuery\n\n    if (count === 0) {\n      return NextResponse.json(\n        { error: 'No contacts match the specified filters' },\n        { status: 400 }\n      )\n    }\n\n    // Create export configuration\n    const exportConfig = {\n      format,\n      filters,\n      fields,\n      includeStats\n    }\n\n    // Create bulk operation\n    const queue = new BulkOperationQueue()\n    const operation = await queue.createOperation({\n      organizationId: profile.organization_id,\n      userId: user.id,\n      type: 'bulk_contact_export',\n      status: 'queued',\n      totalItems: count || 0,\n      configuration: exportConfig\n    })\n\n    return createSuccessResponse({\n      operation,\n      estimatedContacts: count,\n      format,\n      fields,\n      filters\n    }, 201)\n\n  } catch (error) {\n    console.error('Contact export error:', error)\n    return createErrorResponse(error)\n  }\n}\n\nexport async function GET(request: NextRequest) {\n  try {\n    const user = await requireAuthenticatedUser()\n    const profile = await getUserOrganization(user.id)\n\n    const { searchParams } = new URL(request.url)\n    const format = searchParams.get('format') || 'csv'\n    const fields = searchParams.get('fields')?.split(',') || ['name', 'phone_number', 'email']\n    const segment = searchParams.get('segment')\n    const tags = searchParams.get('tags')?.split(',').filter(Boolean)\n    const limit = Math.min(1000, Math.max(1, parseInt(searchParams.get('limit') || '100')))\n\n    // For small exports, return data directly\n    if (limit <= 100) {\n      const supabase = await createClient()\n\n      let query = supabase\n        .from('contacts')\n        .select(generateSelectString(fields))\n        .eq('organization_id', profile.organization_id)\n        .limit(limit)\n\n      // Apply filters\n      if (segment) {\n        query = applySegmentFilter(query, segment)\n      }\n\n      if (tags && tags.length > 0) {\n        query = query.overlaps('tags', tags)\n      }\n\n      const { data: contacts, error } = await query.order('created_at', { ascending: false })\n\n      if (error) {\n        throw error\n      }\n\n      // Format data based on requested format\n      const formattedData = formatExportData(contacts || [], fields, format)\n\n      if (format === 'csv') {\n        return new NextResponse(formattedData, {\n          headers: {\n            'Content-Type': 'text/csv',\n            'Content-Disposition': 'attachment; filename=\"contacts.csv\"'\n          }\n        })\n      }\n\n      return createSuccessResponse({\n        contacts: formattedData,\n        count: contacts?.length || 0,\n        format,\n        fields\n      })\n    }\n\n    // For larger exports, create bulk operation\n    return NextResponse.json(\n      { error: 'Use POST method for exports larger than 100 contacts' },\n      { status: 400 }\n    )\n\n  } catch (error) {\n    console.error('Direct contact export error:', error)\n    return createErrorResponse(error)\n  }\n}\n\nfunction applyFilters(query: any, filters: any) {\n  if (filters.search) {\n    query = query.or(`name.ilike.%${filters.search}%,phone_number.ilike.%${filters.search}%,email.ilike.%${filters.search}%`)\n  }\n\n  if (filters.tags && Array.isArray(filters.tags) && filters.tags.length > 0) {\n    query = query.overlaps('tags', filters.tags)\n  }\n\n  if (filters.segment) {\n    query = applySegmentFilter(query, filters.segment)\n  }\n\n  if (filters.blocked !== undefined) {\n    query = query.eq('is_blocked', filters.blocked)\n  }\n\n  if (filters.createdAfter) {\n    query = query.gte('created_at', filters.createdAfter)\n  }\n\n  if (filters.createdBefore) {\n    query = query.lte('created_at', filters.createdBefore)\n  }\n\n  if (filters.lastMessageAfter) {\n    query = query.gte('last_message_at', filters.lastMessageAfter)\n  }\n\n  if (filters.lastMessageBefore) {\n    query = query.lte('last_message_at', filters.lastMessageBefore)\n  }\n\n  return query\n}\n\nfunction applySegmentFilter(query: any, segment: string) {\n  switch (segment) {\n    case 'active':\n      const thirtyDaysAgo = new Date(Date.now() - 30 * 24 * 60 * 60 * 1000).toISOString()\n      return query.gte('last_message_at', thirtyDaysAgo)\n\n    case 'inactive':\n      const thirtyDaysAgoInactive = new Date(Date.now() - 30 * 24 * 60 * 60 * 1000).toISOString()\n      return query.or(`last_message_at.is.null,last_message_at.lt.${thirtyDaysAgoInactive}`)\n\n    case 'new':\n      const sevenDaysAgo = new Date(Date.now() - 7 * 24 * 60 * 60 * 1000).toISOString()\n      return query.gte('created_at', sevenDaysAgo)\n\n    case 'vip':\n      return query.contains('tags', ['vip'])\n\n    case 'blocked':\n      return query.eq('is_blocked', true)\n\n    default:\n      return query\n  }\n}\n\nfunction generateSelectString(fields: string[]): string {\n  // Ensure we always select ID for data integrity\n  const selectFields = ['id', ...fields.filter(f => f !== 'id')]\n  return selectFields.join(', ')\n}\n\nfunction formatExportData(contacts: any[], fields: string[], format: string): any {\n  const processedContacts = contacts.map(contact => {\n    const processedContact: any = {}\n\n    for (const field of fields) {\n      switch (field) {\n        case 'tags':\n          processedContact[field] = Array.isArray(contact[field])\n            ? contact[field].join(', ')\n            : contact[field] || ''\n          break\n\n        case 'created_at':\n        case 'updated_at':\n        case 'last_message_at':\n          processedContact[field] = contact[field]\n            ? new Date(contact[field]).toISOString()\n            : ''\n          break\n\n        default:\n          processedContact[field] = contact[field] || ''\n      }\n    }\n\n    return processedContact\n  })\n\n  if (format === 'csv') {\n    return convertToCSV(processedContacts)\n  }\n\n  return processedContacts\n}\n\nfunction convertToCSV(data: any[]): string {\n  if (data.length === 0) return ''\n\n  const headers = Object.keys(data[0])\n  const csvContent = [\n    headers.join(','),\n    ...data.map(row =>\n      headers.map(header => {\n        const value = row[header]\n        // Escape quotes and wrap in quotes if contains comma or quotes\n        if (typeof value === 'string' && (value.includes(',') || value.includes('\"'))) {\n          return `\"${value.replace(/\"/g, '\"\"')}\"`\n        }\n        return value\n      }).join(',')\n    )\n  ].join('\\n')\n\n  return csvContent\n}"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}