{"version":3,"names":["GET","cov_29trtecjbw","f","s","OPTIONS","POST","rateLimitStore","Map","request","headersList","_headers","headers","forwardedFor","get","realIP","ipAddress","b","split","userAgent","body","json","business_scenario","_server","NextResponse","success","error","status","validScenarios","includes","rateLimitResult","checkRateLimit","allowed","rate_limit","ip_address","current_sessions","currentCount","sessions_in_window","is_blocked","reset_time","Date","resetTime","toISOString","supabaseUrl","process","env","NEXT_PUBLIC_SUPABASE_URL","supabaseServiceKey","SUPABASE_SERVICE_ROLE_KEY","console","supabase","_supabasejs","createClient","sessionManager","_demo","DemoSessionManager","result","createSession","referrer","utm_params","timestamp","updateRateLimit","accessToken","generateDemoAccessToken","session","token","organization","id","dashboardUrl","NEXT_PUBLIC_APP_URL","trackEvent","event_type","action","category","label","metadata","user_agent","response","data","name","slug","access_token","dashboard_url","max_sessions","max_sessions_per_hour","available_scenarios","session_duration_minutes","now","windowMs","maxRequests","ip","entries","delete","existing","count","set","sessionToken","organizationId"],"sources":["C:\\Ai Projecten\\ADSapp\\src\\app\\api\\demo\\start\\route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server'\nimport { headers } from 'next/headers'\nimport { createClient } from '@supabase/supabase-js'\nimport { DemoSessionManager } from '@/lib/demo'\nimport {\n  CreateDemoSessionRequest,\n  CreateDemoSessionResponse,\n  BusinessScenario\n} from '@/types/demo'\n\n// Rate limiting store (in production, use Redis)\nconst rateLimitStore = new Map<string, { count: number; resetTime: number }>()\n\n/**\n * Create a new demo session\n * POST /api/demo/start\n */\nexport async function POST(request: NextRequest) {\n  try {\n    // Get client IP and user agent\n    const headersList = headers()\n    const forwardedFor = headersList.get('x-forwarded-for')\n    const realIP = headersList.get('x-real-ip')\n    const ipAddress = forwardedFor?.split(',')[0] || realIP || 'unknown'\n    const userAgent = headersList.get('user-agent') || 'unknown'\n\n    // Parse request body\n    const body: CreateDemoSessionRequest = await request.json()\n\n    // Validate required fields\n    if (!body.business_scenario) {\n      return NextResponse.json(\n        {\n          success: false,\n          error: 'Business scenario is required'\n        } as CreateDemoSessionResponse,\n        { status: 400 }\n      )\n    }\n\n    // Validate business scenario\n    const validScenarios: BusinessScenario[] = [\n      'retail', 'restaurant', 'real_estate', 'healthcare', 'education',\n      'ecommerce', 'automotive', 'travel', 'fitness', 'generic'\n    ]\n\n    if (!validScenarios.includes(body.business_scenario)) {\n      return NextResponse.json(\n        {\n          success: false,\n          error: 'Invalid business scenario'\n        } as CreateDemoSessionResponse,\n        { status: 400 }\n      )\n    }\n\n    // Check rate limiting\n    const rateLimitResult = checkRateLimit(ipAddress)\n    if (!rateLimitResult.allowed) {\n      return NextResponse.json(\n        {\n          success: false,\n          error: 'Rate limit exceeded. Please try again later.',\n          rate_limit: {\n            ip_address: ipAddress,\n            current_sessions: rateLimitResult.currentCount,\n            sessions_in_window: rateLimitResult.currentCount,\n            is_blocked: true,\n            reset_time: new Date(rateLimitResult.resetTime).toISOString()\n          }\n        } as CreateDemoSessionResponse,\n        { status: 429 }\n      )\n    }\n\n    // Initialize Supabase client\n    const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL\n    const supabaseServiceKey = process.env.SUPABASE_SERVICE_ROLE_KEY\n\n    if (!supabaseUrl || !supabaseServiceKey) {\n      console.error('Missing Supabase configuration')\n      return NextResponse.json(\n        {\n          success: false,\n          error: 'Service configuration error'\n        } as CreateDemoSessionResponse,\n        { status: 500 }\n      )\n    }\n\n    const supabase = createClient(supabaseUrl, supabaseServiceKey)\n\n    // Create demo session\n    const sessionManager = new DemoSessionManager(supabase)\n    const result = await sessionManager.createSession(\n      body.business_scenario,\n      ipAddress,\n      userAgent,\n      {\n        referrer: body.referrer,\n        utm_params: body.utm_params,\n        timestamp: new Date().toISOString()\n      }\n    )\n\n    if (result.error) {\n      return NextResponse.json(\n        {\n          success: false,\n          error: result.error\n        } as CreateDemoSessionResponse,\n        { status: 400 }\n      )\n    }\n\n    // Update rate limit counter\n    updateRateLimit(ipAddress)\n\n    // Generate access token (in a real implementation, this would be a JWT)\n    const accessToken = generateDemoAccessToken(result.session.token, result.organization.id)\n\n    // Generate dashboard URL\n    const dashboardUrl = `${process.env.NEXT_PUBLIC_APP_URL}/demo/${result.session.token}/dashboard`\n\n    // Track demo creation analytics\n    await sessionManager.trackEvent(result.session.id, {\n      event_type: 'conversion',\n      action: 'demo_session_created',\n      category: 'demo',\n      label: body.business_scenario,\n      metadata: {\n        ip_address: ipAddress,\n        user_agent: userAgent,\n        referrer: body.referrer,\n        utm_params: body.utm_params\n      }\n    })\n\n    const response: CreateDemoSessionResponse = {\n      success: true,\n      data: {\n        session: result.session,\n        organization: {\n          id: result.organization.id,\n          name: result.organization.name,\n          slug: result.organization.slug\n        },\n        access_token: accessToken,\n        dashboard_url: dashboardUrl\n      }\n    }\n\n    return NextResponse.json(response, { status: 201 })\n\n  } catch (error) {\n    console.error('Error creating demo session:', error)\n\n    return NextResponse.json(\n      {\n        success: false,\n        error: 'Failed to create demo session. Please try again.'\n      } as CreateDemoSessionResponse,\n      { status: 500 }\n    )\n  }\n}\n\n/**\n * Get demo session creation limits and info\n * GET /api/demo/start\n */\nexport async function GET(request: NextRequest) {\n  try {\n    const headersList = headers()\n    const forwardedFor = headersList.get('x-forwarded-for')\n    const realIP = headersList.get('x-real-ip')\n    const ipAddress = forwardedFor?.split(',')[0] || realIP || 'unknown'\n\n    const rateLimitResult = checkRateLimit(ipAddress)\n\n    return NextResponse.json({\n      success: true,\n      data: {\n        rate_limit: {\n          ip_address: ipAddress,\n          current_sessions: rateLimitResult.currentCount,\n          max_sessions: 3, // From DEFAULT_DEMO_SECURITY_POLICY\n          sessions_in_window: rateLimitResult.currentCount,\n          max_sessions_per_hour: 10,\n          is_blocked: !rateLimitResult.allowed,\n          reset_time: new Date(rateLimitResult.resetTime).toISOString()\n        },\n        available_scenarios: [\n          'retail',\n          'restaurant',\n          'real_estate',\n          'healthcare',\n          'education',\n          'ecommerce',\n          'automotive',\n          'travel',\n          'fitness',\n          'generic'\n        ],\n        session_duration_minutes: 30\n      }\n    })\n\n  } catch (error) {\n    console.error('Error getting demo info:', error)\n\n    return NextResponse.json(\n      {\n        success: false,\n        error: 'Failed to get demo information'\n      },\n      { status: 500 }\n    )\n  }\n}\n\n/**\n * Simple rate limiting implementation\n * In production, use Redis or a proper rate limiting service\n */\nfunction checkRateLimit(ipAddress: string): {\n  allowed: boolean\n  currentCount: number\n  resetTime: number\n} {\n  const now = Date.now()\n  const windowMs = 60 * 60 * 1000 // 1 hour\n  const maxRequests = 10\n\n  // Clean up expired entries\n  for (const [ip, data] of rateLimitStore.entries()) {\n    if (now > data.resetTime) {\n      rateLimitStore.delete(ip)\n    }\n  }\n\n  const existing = rateLimitStore.get(ipAddress)\n\n  if (!existing) {\n    return {\n      allowed: true,\n      currentCount: 0,\n      resetTime: now + windowMs\n    }\n  }\n\n  return {\n    allowed: existing.count < maxRequests,\n    currentCount: existing.count,\n    resetTime: existing.resetTime\n  }\n}\n\nfunction updateRateLimit(ipAddress: string): void {\n  const now = Date.now()\n  const windowMs = 60 * 60 * 1000 // 1 hour\n\n  const existing = rateLimitStore.get(ipAddress)\n\n  if (!existing || now > existing.resetTime) {\n    rateLimitStore.set(ipAddress, {\n      count: 1,\n      resetTime: now + windowMs\n    })\n  } else {\n    rateLimitStore.set(ipAddress, {\n      count: existing.count + 1,\n      resetTime: existing.resetTime\n    })\n  }\n}\n\n/**\n * Generate a demo access token\n * In production, use proper JWT with expiration\n */\nfunction generateDemoAccessToken(sessionToken: string, organizationId: string): string {\n  // Simple token format: demo_[sessionToken]_[organizationId]_[timestamp]\n  const timestamp = Date.now()\n  return `demo_${sessionToken}_${organizationId}_${timestamp}`\n}\n\n/**\n * OPTIONS handler for CORS\n */\nexport async function OPTIONS(request: NextRequest) {\n  return new NextResponse(null, {\n    status: 200,\n    headers: {\n      'Access-Control-Allow-Origin': '*',\n      'Access-Control-Allow-Methods': 'GET, POST, OPTIONS',\n      'Access-Control-Allow-Headers': 'Content-Type, Authorization',\n    },\n  })\n}"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;MA2KsBA,IAAA;IAAA;IAAAC,cAAA,GAAAC,CAAA;IAAAD,cAAA,GAAAE,CAAA;WAAAH,GAAA;;MAuHAI,QAAA;IAAA;IAAAH,cAAA,GAAAC,CAAA;IAAAD,cAAA,GAAAE,CAAA;WAAAC,OAAA;;MAjRAC,KAAA;IAAA;IAAAJ,cAAA,GAAAC,CAAA;IAAAD,cAAA,GAAAE,CAAA;WAAAE,IAAA;;;;;kCAjBoB;;;kCAClB;;;kCACK;;;mCACM;AAOnC;AACA,MAAMC,cAAA;AAAA;AAAA,CAAAL,cAAA,GAAAE,CAAA,QAAiB,IAAII,GAAA;AAMpB,eAAeF,KAAKG,OAAoB;EAAA;EAAAP,cAAA,GAAAC,CAAA;EAAAD,cAAA,GAAAE,CAAA;EAC7C,IAAI;IACF;IACA,MAAMM,WAAA;IAAA;IAAA,CAAAR,cAAA,GAAAE,CAAA,QAAc,IAAAO,QAAA,CAAAC,OAAO;IAC3B,MAAMC,YAAA;IAAA;IAAA,CAAAX,cAAA,GAAAE,CAAA,QAAeM,WAAA,CAAYI,GAAG,CAAC;IACrC,MAAMC,MAAA;IAAA;IAAA,CAAAb,cAAA,GAAAE,CAAA,QAASM,WAAA,CAAYI,GAAG,CAAC;IAC/B,MAAME,SAAA;IAAA;IAAA,CAAAd,cAAA,GAAAE,CAAA;IAAY;IAAA,CAAAF,cAAA,GAAAe,CAAA,UAAAJ,YAAA,EAAcK,KAAA,CAAM,IAAI,CAAC,EAAE;IAAA;IAAA,CAAAhB,cAAA,GAAAe,CAAA,UAAIF,MAAA;IAAA;IAAA,CAAAb,cAAA,GAAAe,CAAA,UAAU;IAC3D,MAAME,SAAA;IAAA;IAAA,CAAAjB,cAAA,GAAAE,CAAA;IAAY;IAAA,CAAAF,cAAA,GAAAe,CAAA,UAAAP,WAAA,CAAYI,GAAG,CAAC;IAAA;IAAA,CAAAZ,cAAA,GAAAe,CAAA,UAAiB;IAEnD;IACA,MAAMG,IAAA;IAAA;IAAA,CAAAlB,cAAA,GAAAE,CAAA,QAAiC,MAAMK,OAAA,CAAQY,IAAI;IAEzD;IAAA;IAAAnB,cAAA,GAAAE,CAAA;IACA,IAAI,CAACgB,IAAA,CAAKE,iBAAiB,EAAE;MAAA;MAAApB,cAAA,GAAAe,CAAA;MAAAf,cAAA,GAAAE,CAAA;MAC3B,OAAOmB,OAAA,CAAAC,YAAY,CAACH,IAAI,CACtB;QACEI,OAAA,EAAS;QACTC,KAAA,EAAO;MACT,GACA;QAAEC,MAAA,EAAQ;MAAI;IAElB;IAAA;IAAA;MAAAzB,cAAA,GAAAe,CAAA;IAAA;IAEA;IACA,MAAMW,cAAA;IAAA;IAAA,CAAA1B,cAAA,GAAAE,CAAA,QAAqC,CACzC,UAAU,cAAc,eAAe,cAAc,aACrD,aAAa,cAAc,UAAU,WAAW,UACjD;IAAA;IAAAF,cAAA,GAAAE,CAAA;IAED,IAAI,CAACwB,cAAA,CAAeC,QAAQ,CAACT,IAAA,CAAKE,iBAAiB,GAAG;MAAA;MAAApB,cAAA,GAAAe,CAAA;MAAAf,cAAA,GAAAE,CAAA;MACpD,OAAOmB,OAAA,CAAAC,YAAY,CAACH,IAAI,CACtB;QACEI,OAAA,EAAS;QACTC,KAAA,EAAO;MACT,GACA;QAAEC,MAAA,EAAQ;MAAI;IAElB;IAAA;IAAA;MAAAzB,cAAA,GAAAe,CAAA;IAAA;IAEA;IACA,MAAMa,eAAA;IAAA;IAAA,CAAA5B,cAAA,GAAAE,CAAA,QAAkB2B,cAAA,CAAef,SAAA;IAAA;IAAAd,cAAA,GAAAE,CAAA;IACvC,IAAI,CAAC0B,eAAA,CAAgBE,OAAO,EAAE;MAAA;MAAA9B,cAAA,GAAAe,CAAA;MAAAf,cAAA,GAAAE,CAAA;MAC5B,OAAOmB,OAAA,CAAAC,YAAY,CAACH,IAAI,CACtB;QACEI,OAAA,EAAS;QACTC,KAAA,EAAO;QACPO,UAAA,EAAY;UACVC,UAAA,EAAYlB,SAAA;UACZmB,gBAAA,EAAkBL,eAAA,CAAgBM,YAAY;UAC9CC,kBAAA,EAAoBP,eAAA,CAAgBM,YAAY;UAChDE,UAAA,EAAY;UACZC,UAAA,EAAY,IAAIC,IAAA,CAAKV,eAAA,CAAgBW,SAAS,EAAEC,WAAW;QAC7D;MACF,GACA;QAAEf,MAAA,EAAQ;MAAI;IAElB;IAAA;IAAA;MAAAzB,cAAA,GAAAe,CAAA;IAAA;IAEA;IACA,MAAM0B,WAAA;IAAA;IAAA,CAAAzC,cAAA,GAAAE,CAAA,QAAcwC,OAAA,CAAQC,GAAG,CAACC,wBAAwB;IACxD,MAAMC,kBAAA;IAAA;IAAA,CAAA7C,cAAA,GAAAE,CAAA,QAAqBwC,OAAA,CAAQC,GAAG,CAACG,yBAAyB;IAAA;IAAA9C,cAAA,GAAAE,CAAA;IAEhE;IAAI;IAAA,CAAAF,cAAA,GAAAe,CAAA,WAAC0B,WAAA;IAAA;IAAA,CAAAzC,cAAA,GAAAe,CAAA,UAAe,CAAC8B,kBAAA,GAAoB;MAAA;MAAA7C,cAAA,GAAAe,CAAA;MAAAf,cAAA,GAAAE,CAAA;MACvC6C,OAAA,CAAQvB,KAAK,CAAC;MAAA;MAAAxB,cAAA,GAAAE,CAAA;MACd,OAAOmB,OAAA,CAAAC,YAAY,CAACH,IAAI,CACtB;QACEI,OAAA,EAAS;QACTC,KAAA,EAAO;MACT,GACA;QAAEC,MAAA,EAAQ;MAAI;IAElB;IAAA;IAAA;MAAAzB,cAAA,GAAAe,CAAA;IAAA;IAEA,MAAMiC,QAAA;IAAA;IAAA,CAAAhD,cAAA,GAAAE,CAAA,QAAW,IAAA+C,WAAA,CAAAC,YAAY,EAACT,WAAA,EAAaI,kBAAA;IAE3C;IACA,MAAMM,cAAA;IAAA;IAAA,CAAAnD,cAAA,GAAAE,CAAA,QAAiB,IAAIkD,KAAA,CAAAC,kBAAkB,CAACL,QAAA;IAC9C,MAAMM,MAAA;IAAA;IAAA,CAAAtD,cAAA,GAAAE,CAAA,QAAS,MAAMiD,cAAA,CAAeI,aAAa,CAC/CrC,IAAA,CAAKE,iBAAiB,EACtBN,SAAA,EACAG,SAAA,EACA;MACEuC,QAAA,EAAUtC,IAAA,CAAKsC,QAAQ;MACvBC,UAAA,EAAYvC,IAAA,CAAKuC,UAAU;MAC3BC,SAAA,EAAW,IAAIpB,IAAA,GAAOE,WAAW;IACnC;IAAA;IAAAxC,cAAA,GAAAE,CAAA;IAGF,IAAIoD,MAAA,CAAO9B,KAAK,EAAE;MAAA;MAAAxB,cAAA,GAAAe,CAAA;MAAAf,cAAA,GAAAE,CAAA;MAChB,OAAOmB,OAAA,CAAAC,YAAY,CAACH,IAAI,CACtB;QACEI,OAAA,EAAS;QACTC,KAAA,EAAO8B,MAAA,CAAO9B;MAChB,GACA;QAAEC,MAAA,EAAQ;MAAI;IAElB;IAAA;IAAA;MAAAzB,cAAA,GAAAe,CAAA;IAAA;IAEA;IAAAf,cAAA,GAAAE,CAAA;IACAyD,eAAA,CAAgB7C,SAAA;IAEhB;IACA,MAAM8C,WAAA;IAAA;IAAA,CAAA5D,cAAA,GAAAE,CAAA,QAAc2D,uBAAA,CAAwBP,MAAA,CAAOQ,OAAO,CAACC,KAAK,EAAET,MAAA,CAAOU,YAAY,CAACC,EAAE;IAExF;IACA,MAAMC,YAAA;IAAA;IAAA,CAAAlE,cAAA,GAAAE,CAAA,QAAe,GAAGwC,OAAA,CAAQC,GAAG,CAACwB,mBAAmB,SAASb,MAAA,CAAOQ,OAAO,CAACC,KAAK,YAAY;IAEhG;IAAA;IAAA/D,cAAA,GAAAE,CAAA;IACA,MAAMiD,cAAA,CAAeiB,UAAU,CAACd,MAAA,CAAOQ,OAAO,CAACG,EAAE,EAAE;MACjDI,UAAA,EAAY;MACZC,MAAA,EAAQ;MACRC,QAAA,EAAU;MACVC,KAAA,EAAOtD,IAAA,CAAKE,iBAAiB;MAC7BqD,QAAA,EAAU;QACRzC,UAAA,EAAYlB,SAAA;QACZ4D,UAAA,EAAYzD,SAAA;QACZuC,QAAA,EAAUtC,IAAA,CAAKsC,QAAQ;QACvBC,UAAA,EAAYvC,IAAA,CAAKuC;MACnB;IACF;IAEA,MAAMkB,QAAA;IAAA;IAAA,CAAA3E,cAAA,GAAAE,CAAA,QAAsC;MAC1CqB,OAAA,EAAS;MACTqD,IAAA,EAAM;QACJd,OAAA,EAASR,MAAA,CAAOQ,OAAO;QACvBE,YAAA,EAAc;UACZC,EAAA,EAAIX,MAAA,CAAOU,YAAY,CAACC,EAAE;UAC1BY,IAAA,EAAMvB,MAAA,CAAOU,YAAY,CAACa,IAAI;UAC9BC,IAAA,EAAMxB,MAAA,CAAOU,YAAY,CAACc;QAC5B;QACAC,YAAA,EAAcnB,WAAA;QACdoB,aAAA,EAAed;MACjB;IACF;IAAA;IAAAlE,cAAA,GAAAE,CAAA;IAEA,OAAOmB,OAAA,CAAAC,YAAY,CAACH,IAAI,CAACwD,QAAA,EAAU;MAAElD,MAAA,EAAQ;IAAI;EAEnD,EAAE,OAAOD,KAAA,EAAO;IAAA;IAAAxB,cAAA,GAAAE,CAAA;IACd6C,OAAA,CAAQvB,KAAK,CAAC,gCAAgCA,KAAA;IAAA;IAAAxB,cAAA,GAAAE,CAAA;IAE9C,OAAOmB,OAAA,CAAAC,YAAY,CAACH,IAAI,CACtB;MACEI,OAAA,EAAS;MACTC,KAAA,EAAO;IACT,GACA;MAAEC,MAAA,EAAQ;IAAI;EAElB;AACF;AAMO,eAAe1B,IAAIQ,OAAoB;EAAA;EAAAP,cAAA,GAAAC,CAAA;EAAAD,cAAA,GAAAE,CAAA;EAC5C,IAAI;IACF,MAAMM,WAAA;IAAA;IAAA,CAAAR,cAAA,GAAAE,CAAA,QAAc,IAAAO,QAAA,CAAAC,OAAO;IAC3B,MAAMC,YAAA;IAAA;IAAA,CAAAX,cAAA,GAAAE,CAAA,QAAeM,WAAA,CAAYI,GAAG,CAAC;IACrC,MAAMC,MAAA;IAAA;IAAA,CAAAb,cAAA,GAAAE,CAAA,QAASM,WAAA,CAAYI,GAAG,CAAC;IAC/B,MAAME,SAAA;IAAA;IAAA,CAAAd,cAAA,GAAAE,CAAA;IAAY;IAAA,CAAAF,cAAA,GAAAe,CAAA,UAAAJ,YAAA,EAAcK,KAAA,CAAM,IAAI,CAAC,EAAE;IAAA;IAAA,CAAAhB,cAAA,GAAAe,CAAA,UAAIF,MAAA;IAAA;IAAA,CAAAb,cAAA,GAAAe,CAAA,UAAU;IAE3D,MAAMa,eAAA;IAAA;IAAA,CAAA5B,cAAA,GAAAE,CAAA,QAAkB2B,cAAA,CAAef,SAAA;IAAA;IAAAd,cAAA,GAAAE,CAAA;IAEvC,OAAOmB,OAAA,CAAAC,YAAY,CAACH,IAAI,CAAC;MACvBI,OAAA,EAAS;MACTqD,IAAA,EAAM;QACJ7C,UAAA,EAAY;UACVC,UAAA,EAAYlB,SAAA;UACZmB,gBAAA,EAAkBL,eAAA,CAAgBM,YAAY;UAC9C+C,YAAA,EAAc;UACd9C,kBAAA,EAAoBP,eAAA,CAAgBM,YAAY;UAChDgD,qBAAA,EAAuB;UACvB9C,UAAA,EAAY,CAACR,eAAA,CAAgBE,OAAO;UACpCO,UAAA,EAAY,IAAIC,IAAA,CAAKV,eAAA,CAAgBW,SAAS,EAAEC,WAAW;QAC7D;QACA2C,mBAAA,EAAqB,CACnB,UACA,cACA,eACA,cACA,aACA,aACA,cACA,UACA,WACA,UACD;QACDC,wBAAA,EAA0B;MAC5B;IACF;EAEF,EAAE,OAAO5D,KAAA,EAAO;IAAA;IAAAxB,cAAA,GAAAE,CAAA;IACd6C,OAAA,CAAQvB,KAAK,CAAC,4BAA4BA,KAAA;IAAA;IAAAxB,cAAA,GAAAE,CAAA;IAE1C,OAAOmB,OAAA,CAAAC,YAAY,CAACH,IAAI,CACtB;MACEI,OAAA,EAAS;MACTC,KAAA,EAAO;IACT,GACA;MAAEC,MAAA,EAAQ;IAAI;EAElB;AACF;AAEA;;;;AAIA,SAASI,eAAef,SAAiB;EAAA;EAAAd,cAAA,GAAAC,CAAA;EAKvC,MAAMoF,GAAA;EAAA;EAAA,CAAArF,cAAA,GAAAE,CAAA,QAAMoC,IAAA,CAAK+C,GAAG;EACpB,MAAMC,QAAA;EAAA;EAAA,CAAAtF,cAAA,GAAAE,CAAA,QAAW,KAAK,KAAK,MAAK;EAAA;EAChC,MAAMqF,WAAA;EAAA;EAAA,CAAAvF,cAAA,GAAAE,CAAA,QAAc;EAEpB;EAAA;EAAAF,cAAA,GAAAE,CAAA;EACA,KAAK,MAAM,CAACsF,EAAA,EAAIZ,IAAA,CAAK,IAAIvE,cAAA,CAAeoF,OAAO,IAAI;IAAA;IAAAzF,cAAA,GAAAE,CAAA;IACjD,IAAImF,GAAA,GAAMT,IAAA,CAAKrC,SAAS,EAAE;MAAA;MAAAvC,cAAA,GAAAe,CAAA;MAAAf,cAAA,GAAAE,CAAA;MACxBG,cAAA,CAAeqF,MAAM,CAACF,EAAA;IACxB;IAAA;IAAA;MAAAxF,cAAA,GAAAe,CAAA;IAAA;EACF;EAEA,MAAM4E,QAAA;EAAA;EAAA,CAAA3F,cAAA,GAAAE,CAAA,QAAWG,cAAA,CAAeO,GAAG,CAACE,SAAA;EAAA;EAAAd,cAAA,GAAAE,CAAA;EAEpC,IAAI,CAACyF,QAAA,EAAU;IAAA;IAAA3F,cAAA,GAAAe,CAAA;IAAAf,cAAA,GAAAE,CAAA;IACb,OAAO;MACL4B,OAAA,EAAS;MACTI,YAAA,EAAc;MACdK,SAAA,EAAW8C,GAAA,GAAMC;IACnB;EACF;EAAA;EAAA;IAAAtF,cAAA,GAAAe,CAAA;EAAA;EAAAf,cAAA,GAAAE,CAAA;EAEA,OAAO;IACL4B,OAAA,EAAS6D,QAAA,CAASC,KAAK,GAAGL,WAAA;IAC1BrD,YAAA,EAAcyD,QAAA,CAASC,KAAK;IAC5BrD,SAAA,EAAWoD,QAAA,CAASpD;EACtB;AACF;AAEA,SAASoB,gBAAgB7C,SAAiB;EAAA;EAAAd,cAAA,GAAAC,CAAA;EACxC,MAAMoF,GAAA;EAAA;EAAA,CAAArF,cAAA,GAAAE,CAAA,QAAMoC,IAAA,CAAK+C,GAAG;EACpB,MAAMC,QAAA;EAAA;EAAA,CAAAtF,cAAA,GAAAE,CAAA,QAAW,KAAK,KAAK,MAAK;EAAA;EAEhC,MAAMyF,QAAA;EAAA;EAAA,CAAA3F,cAAA,GAAAE,CAAA,QAAWG,cAAA,CAAeO,GAAG,CAACE,SAAA;EAAA;EAAAd,cAAA,GAAAE,CAAA;EAEpC;EAAI;EAAA,CAAAF,cAAA,GAAAe,CAAA,YAAC4E,QAAA;EAAA;EAAA,CAAA3F,cAAA,GAAAe,CAAA,WAAYsE,GAAA,GAAMM,QAAA,CAASpD,SAAS,GAAE;IAAA;IAAAvC,cAAA,GAAAe,CAAA;IAAAf,cAAA,GAAAE,CAAA;IACzCG,cAAA,CAAewF,GAAG,CAAC/E,SAAA,EAAW;MAC5B8E,KAAA,EAAO;MACPrD,SAAA,EAAW8C,GAAA,GAAMC;IACnB;EACF,OAAO;IAAA;IAAAtF,cAAA,GAAAe,CAAA;IAAAf,cAAA,GAAAE,CAAA;IACLG,cAAA,CAAewF,GAAG,CAAC/E,SAAA,EAAW;MAC5B8E,KAAA,EAAOD,QAAA,CAASC,KAAK,GAAG;MACxBrD,SAAA,EAAWoD,QAAA,CAASpD;IACtB;EACF;AACF;AAEA;;;;AAIA,SAASsB,wBAAwBiC,YAAoB,EAAEC,cAAsB;EAAA;EAAA/F,cAAA,GAAAC,CAAA;EAC3E;EACA,MAAMyD,SAAA;EAAA;EAAA,CAAA1D,cAAA,GAAAE,CAAA,QAAYoC,IAAA,CAAK+C,GAAG;EAAA;EAAArF,cAAA,GAAAE,CAAA;EAC1B,OAAO,QAAQ4F,YAAA,IAAgBC,cAAA,IAAkBrC,SAAA,EAAW;AAC9D;AAKO,eAAevD,QAAQI,OAAoB;EAAA;EAAAP,cAAA,GAAAC,CAAA;EAAAD,cAAA,GAAAE,CAAA;EAChD,OAAO,IAAImB,OAAA,CAAAC,YAAY,CAAC,MAAM;IAC5BG,MAAA,EAAQ;IACRf,OAAA,EAAS;MACP,+BAA+B;MAC/B,gCAAgC;MAChC,gCAAgC;IAClC;EACF;AACF","ignoreList":[]}