{"version":3,"sources":["C:\\Ai Projecten\\ADSapp\\tests\\integration\\job-queue.test.ts"],"sourcesContent":["/**\n * Job Queue Integration Tests\n *\n * Tests for BullMQ job queue system including processors, API endpoints, and queue management.\n */\n\nimport { getQueueManager, initializeQueueManager } from '@/lib/queue/queue-manager';\nimport { QueueName, JobPriority } from '@/lib/queue/bull-config';\n\ndescribe('Job Queue System', () => {\n  let queueManager: any;\n\n  beforeAll(async () => {\n    // Initialize queue manager for tests\n    queueManager = await initializeQueueManager();\n  });\n\n  afterAll(async () => {\n    // Cleanup: shutdown queue manager\n    if (queueManager) {\n      await queueManager.shutdown();\n    }\n  });\n\n  describe('Queue Manager', () => {\n    it('should initialize all queues', () => {\n      expect(queueManager).toBeDefined();\n      expect(queueManager.getQueue(QueueName.BULK_MESSAGE)).toBeDefined();\n      expect(queueManager.getQueue(QueueName.CONTACT_IMPORT)).toBeDefined();\n      expect(queueManager.getQueue(QueueName.TEMPLATE_PROCESSING)).toBeDefined();\n      expect(queueManager.getQueue(QueueName.EMAIL_NOTIFICATION)).toBeDefined();\n    });\n\n    it('should add job to queue', async () => {\n      const jobData = {\n        organizationId: 'test-org',\n        userId: 'test-user',\n        contacts: [\n          {\n            id: 'contact-1',\n            phone: '+1234567890',\n            name: 'Test Contact'\n          }\n        ],\n        messageContent: 'Test message'\n      };\n\n      const jobId = await queueManager.addJob(\n        QueueName.BULK_MESSAGE,\n        'test-bulk-message',\n        jobData,\n        { priority: JobPriority.CRITICAL }\n      );\n\n      expect(jobId).toBeDefined();\n      expect(typeof jobId).toBe('string');\n    });\n\n    it('should get job status', async () => {\n      const jobData = {\n        organizationId: 'test-org',\n        userId: 'test-user',\n        contacts: [{ id: '1', phone: '+1234567890', name: 'Test' }],\n        messageContent: 'Test'\n      };\n\n      const jobId = await queueManager.addJob(\n        QueueName.BULK_MESSAGE,\n        'test-job',\n        jobData\n      );\n\n      const job = await queueManager.getJob(QueueName.BULK_MESSAGE, jobId);\n\n      expect(job).toBeDefined();\n      expect(job.id).toBe(jobId);\n      expect(job.queueName).toBe(QueueName.BULK_MESSAGE);\n      expect(job.data).toEqual(jobData);\n    });\n\n    it('should cancel job', async () => {\n      const jobData = {\n        organizationId: 'test-org',\n        userId: 'test-user',\n        contacts: [{ id: '1', phone: '+1234567890', name: 'Test' }],\n        messageContent: 'Test'\n      };\n\n      const jobId = await queueManager.addJob(\n        QueueName.BULK_MESSAGE,\n        'test-job',\n        jobData,\n        { delay: 10000 } // Delay to ensure we can cancel\n      );\n\n      const cancelled = await queueManager.cancelJob(\n        QueueName.BULK_MESSAGE,\n        jobId\n      );\n\n      expect(cancelled).toBe(true);\n    });\n\n    it('should get queue statistics', async () => {\n      const stats = await queueManager.getQueueStatistics(\n        QueueName.BULK_MESSAGE\n      );\n\n      expect(stats).toBeDefined();\n      expect(typeof stats.waiting).toBe('number');\n      expect(typeof stats.active).toBe('number');\n      expect(typeof stats.completed).toBe('number');\n      expect(typeof stats.failed).toBe('number');\n    });\n\n    it('should get all queue statistics', async () => {\n      const allStats = await queueManager.getAllQueueStatistics();\n\n      expect(allStats).toBeDefined();\n      expect(allStats[QueueName.BULK_MESSAGE]).toBeDefined();\n      expect(allStats[QueueName.CONTACT_IMPORT]).toBeDefined();\n      expect(allStats[QueueName.TEMPLATE_PROCESSING]).toBeDefined();\n      expect(allStats[QueueName.EMAIL_NOTIFICATION]).toBeDefined();\n    });\n\n    it('should pause and resume queue', async () => {\n      await queueManager.pauseQueue(QueueName.BULK_MESSAGE);\n\n      const statsAfterPause = await queueManager.getQueueStatistics(\n        QueueName.BULK_MESSAGE\n      );\n      expect(statsAfterPause.paused).toBeGreaterThan(0);\n\n      await queueManager.resumeQueue(QueueName.BULK_MESSAGE);\n\n      const statsAfterResume = await queueManager.getQueueStatistics(\n        QueueName.BULK_MESSAGE\n      );\n      expect(statsAfterResume.paused).toBe(0);\n    });\n\n    it('should perform health check', async () => {\n      const health = await queueManager.healthCheck();\n\n      expect(health).toBeDefined();\n      expect(health.healthy).toBe(true);\n      expect(health.queues).toBeDefined();\n      expect(health.queues[QueueName.BULK_MESSAGE]).toBeDefined();\n      expect(health.queues[QueueName.BULK_MESSAGE].healthy).toBe(true);\n    });\n  });\n\n  describe('Job Processors', () => {\n    describe('Bulk Message Processor', () => {\n      it('should validate job data structure', () => {\n        const validJobData = {\n          organizationId: 'org-123',\n          userId: 'user-456',\n          contacts: [\n            {\n              id: 'contact-1',\n              phone: '+1234567890',\n              name: 'John Doe',\n              variables: { order_id: '12345' }\n            }\n          ],\n          messageContent: 'Hello {{name}}, order {{order_id}} ready!',\n          messageType: 'text'\n        };\n\n        expect(validJobData.organizationId).toBeDefined();\n        expect(validJobData.userId).toBeDefined();\n        expect(Array.isArray(validJobData.contacts)).toBe(true);\n        expect(validJobData.contacts.length).toBeGreaterThan(0);\n        expect(validJobData.messageContent).toBeDefined();\n      });\n    });\n\n    describe('Contact Import Processor', () => {\n      it('should validate import data structure', () => {\n        const validImportData = {\n          organizationId: 'org-123',\n          userId: 'user-456',\n          contacts: [\n            {\n              phone: '+1234567890',\n              name: 'John Doe',\n              email: 'john@example.com',\n              tags: ['customer'],\n              customFields: { company: 'Acme Inc' }\n            }\n          ],\n          importOptions: {\n            updateExisting: false,\n            skipDuplicates: true,\n            validatePhone: true\n          }\n        };\n\n        expect(validImportData.organizationId).toBeDefined();\n        expect(validImportData.userId).toBeDefined();\n        expect(Array.isArray(validImportData.contacts)).toBe(true);\n        expect(validImportData.importOptions).toBeDefined();\n      });\n\n      it('should validate phone number format', () => {\n        const phoneNumbers = [\n          { input: '+1234567890', valid: true },\n          { input: '1234567890', valid: true },\n          { input: '(123) 456-7890', valid: true },\n          { input: '123', valid: false },\n          { input: 'invalid', valid: false }\n        ];\n\n        phoneNumbers.forEach((test) => {\n          const cleaned = test.input.replace(/\\D/g, '');\n          const isValid = cleaned.length >= 10 && cleaned.length <= 15;\n          expect(isValid).toBe(test.valid);\n        });\n      });\n    });\n\n    describe('Template Processor', () => {\n      it('should extract template variables', () => {\n        const template = 'Hello {{name}}, your order {{order_id}} is ready!';\n        const regex = /{{([^}]+)}}/g;\n        const variables: string[] = [];\n        let match;\n\n        while ((match = regex.exec(template)) !== null) {\n          variables.push(match[1].trim());\n        }\n\n        expect(variables).toEqual(['name', 'order_id']);\n      });\n\n      it('should substitute variables correctly', () => {\n        const template = 'Hello {{name}}, order {{order_id}} ready!';\n        const variables = { name: 'John', order_id: '12345' };\n\n        let result = template;\n        for (const [key, value] of Object.entries(variables)) {\n          const regex = new RegExp(`{{\\\\s*${key}\\\\s*}}`, 'g');\n          result = result.replace(regex, value);\n        }\n\n        expect(result).toBe('Hello John, order 12345 ready!');\n      });\n    });\n\n    describe('Email Notification Processor', () => {\n      it('should validate email format', () => {\n        const emails = [\n          { email: 'test@example.com', valid: true },\n          { email: 'user+tag@domain.co.uk', valid: true },\n          { email: 'invalid', valid: false },\n          { email: '@example.com', valid: false },\n          { email: 'test@', valid: false }\n        ];\n\n        const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n\n        emails.forEach((test) => {\n          const isValid = emailRegex.test(test.email);\n          expect(isValid).toBe(test.valid);\n        });\n      });\n    });\n  });\n\n  describe('Job Priority', () => {\n    it('should have correct priority values', () => {\n      expect(JobPriority.CRITICAL).toBe(1);\n      expect(JobPriority.HIGH).toBe(2);\n      expect(JobPriority.NORMAL).toBe(3);\n      expect(JobPriority.LOW).toBe(4);\n    });\n\n    it('should process higher priority jobs first', async () => {\n      const lowPriorityJobId = await queueManager.addJob(\n        QueueName.BULK_MESSAGE,\n        'low-priority',\n        { organizationId: 'org', userId: 'user', contacts: [], messageContent: 'Low' },\n        { priority: JobPriority.LOW }\n      );\n\n      const highPriorityJobId = await queueManager.addJob(\n        QueueName.BULK_MESSAGE,\n        'high-priority',\n        { organizationId: 'org', userId: 'user', contacts: [], messageContent: 'High' },\n        { priority: JobPriority.CRITICAL }\n      );\n\n      expect(lowPriorityJobId).toBeDefined();\n      expect(highPriorityJobId).toBeDefined();\n      // High priority job should be processed before low priority\n      // (This is handled by BullMQ internally)\n    });\n  });\n\n  describe('Error Handling', () => {\n    it('should handle missing queue gracefully', async () => {\n      const invalidQueueName = 'invalid-queue' as QueueName;\n\n      await expect(\n        queueManager.addJob(invalidQueueName, 'test', {})\n      ).rejects.toThrow();\n    });\n\n    it('should handle invalid job ID gracefully', async () => {\n      const job = await queueManager.getJob(\n        QueueName.BULK_MESSAGE,\n        'non-existent-id'\n      );\n\n      expect(job).toBeNull();\n    });\n\n    it('should handle cancellation of completed job', async () => {\n      // Try to cancel a non-existent or completed job\n      const cancelled = await queueManager.cancelJob(\n        QueueName.BULK_MESSAGE,\n        'non-existent-id'\n      );\n\n      expect(cancelled).toBe(false);\n    });\n  });\n});\n"],"names":["describe","queueManager","beforeAll","initializeQueueManager","afterAll","shutdown","it","expect","toBeDefined","getQueue","QueueName","BULK_MESSAGE","CONTACT_IMPORT","TEMPLATE_PROCESSING","EMAIL_NOTIFICATION","jobData","organizationId","userId","contacts","id","phone","name","messageContent","jobId","addJob","priority","JobPriority","CRITICAL","toBe","job","getJob","queueName","data","toEqual","delay","cancelled","cancelJob","stats","getQueueStatistics","waiting","active","completed","failed","allStats","getAllQueueStatistics","pauseQueue","statsAfterPause","paused","toBeGreaterThan","resumeQueue","statsAfterResume","health","healthCheck","healthy","queues","validJobData","variables","order_id","messageType","Array","isArray","length","validImportData","email","tags","customFields","company","importOptions","updateExisting","skipDuplicates","validatePhone","phoneNumbers","input","valid","forEach","test","cleaned","replace","isValid","template","regex","match","exec","push","trim","result","key","value","Object","entries","RegExp","emails","emailRegex","HIGH","NORMAL","LOW","lowPriorityJobId","highPriorityJobId","invalidQueueName","rejects","toThrow","toBeNull"],"mappings":"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"}