{"version":3,"names":["WhatsAppBusinessAPI","cov_1egdxbc3bi","f","s","WhatsAppConfigManager","constructor","config","client","_client","WhatsAppClient","accessToken","phoneNumberId","runSetupWizard","organizationId","steps","id","title","description","status","verifyCredentials","error","Error","b","message","phoneInfo","getPhoneNumberInfo","verified_name","setupWebhook","sendTestMessage","profile","getBusinessProfile","name","saveConfiguration","response","fetch","appId","headers","ok","appInfo","json","requiredPermissions","webhookUrl","process","env","NEXT_PUBLIC_APP_URL","method","body","JSON","stringify","object","callback_url","verify_token","webhookVerifyToken","fields","testMessage","sendTextMessage","phoneNumber","businessAccountId","category","vertical","email","websites","profilePictureUrl","profile_picture_url","updateBusinessProfile","updateData","supabase","_server","createClient","from","update","whatsapp_business_account_id","whatsapp_phone_number_id","updated_at","Date","toISOString","eq","validateWebhook","signature","payload","appSecret","expectedSignature","_crypto","default","createHmac","digest","timingSafeEqual","Buffer","replace","handleWebhookVerification","mode","token","challenge","verifyToken","getRateLimits","console","healthCheck","health","api","webhook","businessAccount","getConfig","data","organization","select","single","WHATSAPP_ACCESS_TOKEN","WHATSAPP_APP_ID","WHATSAPP_APP_SECRET","whatsapp_phone_number","WHATSAPP_WEBHOOK_VERIFY_TOKEN","isConfigured","validateConfig","errors","push","length","valid"],"sources":["C:\\Ai Projecten\\ADSapp\\src\\lib\\whatsapp\\business-api.ts"],"sourcesContent":["import { createClient } from '@/lib/supabase/server'\nimport { WhatsAppClient } from './client'\nimport crypto from 'crypto'\n\nexport interface WhatsAppBusinessConfig {\n  accessToken: string\n  appId: string\n  appSecret: string\n  businessAccountId: string\n  phoneNumberId: string\n  phoneNumber: string\n  webhookVerifyToken: string\n}\n\nexport interface WhatsAppSetupStep {\n  id: string\n  title: string\n  description: string\n  status: 'pending' | 'in_progress' | 'completed' | 'failed'\n  error?: string\n}\n\nexport interface BusinessProfile {\n  name: string\n  category: string\n  description?: string\n  email?: string\n  websites?: string[]\n  address?: {\n    street: string\n    city: string\n    state: string\n    zip: string\n    country: string\n  }\n  profilePictureUrl?: string\n}\n\nexport class WhatsAppBusinessAPI {\n  private client: WhatsAppClient\n  private config: WhatsAppBusinessConfig\n\n  constructor(config: WhatsAppBusinessConfig) {\n    this.config = config\n    this.client = new WhatsAppClient(config.accessToken, config.phoneNumberId)\n  }\n\n  /**\n   * WhatsApp Business Setup Wizard\n   */\n  async runSetupWizard(organizationId: string): Promise<WhatsAppSetupStep[]> {\n    const steps: WhatsAppSetupStep[] = [\n      {\n        id: 'verify_credentials',\n        title: 'Verify API Credentials',\n        description: 'Testing access token and app credentials',\n        status: 'pending'\n      },\n      {\n        id: 'verify_phone_number',\n        title: 'Verify Phone Number',\n        description: 'Validating WhatsApp Business phone number',\n        status: 'pending'\n      },\n      {\n        id: 'setup_webhook',\n        title: 'Configure Webhook',\n        description: 'Setting up webhook URL and verification',\n        status: 'pending'\n      },\n      {\n        id: 'test_messaging',\n        title: 'Test Messaging',\n        description: 'Sending test message to verify integration',\n        status: 'pending'\n      },\n      {\n        id: 'setup_business_profile',\n        title: 'Setup Business Profile',\n        description: 'Configuring business information and profile',\n        status: 'pending'\n      },\n      {\n        id: 'save_configuration',\n        title: 'Save Configuration',\n        description: 'Storing configuration in database',\n        status: 'pending'\n      }\n    ]\n\n    // Step 1: Verify API Credentials\n    steps[0].status = 'in_progress'\n    try {\n      await this.verifyCredentials()\n      steps[0].status = 'completed'\n    } catch (error) {\n      steps[0].status = 'failed'\n      steps[0].error = error instanceof Error ? error.message : 'Unknown error'\n      return steps\n    }\n\n    // Step 2: Verify Phone Number\n    steps[1].status = 'in_progress'\n    try {\n      const phoneInfo = await this.getPhoneNumberInfo()\n      if (phoneInfo.verified_name && phoneInfo.status === 'CONNECTED') {\n        steps[1].status = 'completed'\n      } else {\n        throw new Error('Phone number not verified or not connected')\n      }\n    } catch (error) {\n      steps[1].status = 'failed'\n      steps[1].error = error instanceof Error ? error.message : 'Unknown error'\n      return steps\n    }\n\n    // Step 3: Setup Webhook\n    steps[2].status = 'in_progress'\n    try {\n      await this.setupWebhook()\n      steps[2].status = 'completed'\n    } catch (error) {\n      steps[2].status = 'failed'\n      steps[2].error = error instanceof Error ? error.message : 'Unknown error'\n      return steps\n    }\n\n    // Step 4: Test Messaging\n    steps[3].status = 'in_progress'\n    try {\n      // Send a test message to the business phone number\n      await this.sendTestMessage()\n      steps[3].status = 'completed'\n    } catch (error) {\n      steps[3].status = 'failed'\n      steps[3].error = error instanceof Error ? error.message : 'Unknown error'\n      return steps\n    }\n\n    // Step 5: Setup Business Profile\n    steps[4].status = 'in_progress'\n    try {\n      const profile = await this.getBusinessProfile()\n      if (profile.name) {\n        steps[4].status = 'completed'\n      } else {\n        throw new Error('Business profile not complete')\n      }\n    } catch (error) {\n      steps[4].status = 'failed'\n      steps[4].error = error instanceof Error ? error.message : 'Unknown error'\n      return steps\n    }\n\n    // Step 6: Save Configuration\n    steps[5].status = 'in_progress'\n    try {\n      await this.saveConfiguration(organizationId)\n      steps[5].status = 'completed'\n    } catch (error) {\n      steps[5].status = 'failed'\n      steps[5].error = error instanceof Error ? error.message : 'Unknown error'\n      return steps\n    }\n\n    return steps\n  }\n\n  /**\n   * Verify API credentials and permissions\n   */\n  async verifyCredentials(): Promise<boolean> {\n    try {\n      const response = await fetch(`https://graph.facebook.com/v18.0/${this.config.appId}`, {\n        headers: {\n          'Authorization': `Bearer ${this.config.accessToken}`,\n        },\n      })\n\n      if (!response.ok) {\n        throw new Error('Invalid access token or app ID')\n      }\n\n      const appInfo = await response.json()\n\n      // Verify app has necessary permissions\n      const requiredPermissions = ['whatsapp_business_messaging', 'whatsapp_business_management']\n      // Note: In practice, you'd check app permissions here\n\n      return true\n    } catch (error) {\n      throw new Error(`Credential verification failed: ${error instanceof Error ? error.message : 'Unknown error'}`)\n    }\n  }\n\n  /**\n   * Get phone number information and verification status\n   */\n  async getPhoneNumberInfo(): Promise<{ id: string; display_phone_number: string; verified_name?: string; status?: string }> {\n    try {\n      const response = await fetch(`https://graph.facebook.com/v18.0/${this.config.phoneNumberId}`, {\n        headers: {\n          'Authorization': `Bearer ${this.config.accessToken}`,\n        },\n      })\n\n      if (!response.ok) {\n        throw new Error('Failed to get phone number information')\n      }\n\n      return await response.json()\n    } catch (error) {\n      throw new Error(`Phone number verification failed: ${error instanceof Error ? error.message : 'Unknown error'}`)\n    }\n  }\n\n  /**\n   * Setup webhook configuration\n   */\n  async setupWebhook(): Promise<boolean> {\n    try {\n      const webhookUrl = `${process.env.NEXT_PUBLIC_APP_URL}/api/webhooks/whatsapp`\n\n      const response = await fetch(`https://graph.facebook.com/v18.0/${this.config.appId}/subscriptions`, {\n        method: 'POST',\n        headers: {\n          'Authorization': `Bearer ${this.config.accessToken}`,\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          object: 'whatsapp_business_account',\n          callback_url: webhookUrl,\n          verify_token: this.config.webhookVerifyToken,\n          fields: ['messages', 'message_deliveries', 'message_reads', 'message_reactions']\n        }),\n      })\n\n      if (!response.ok) {\n        const error = await response.json()\n        throw new Error(`Webhook setup failed: ${error.error?.message || 'Unknown error'}`)\n      }\n\n      return true\n    } catch (error) {\n      throw new Error(`Webhook configuration failed: ${error instanceof Error ? error.message : 'Unknown error'}`)\n    }\n  }\n\n  /**\n   * Send a test message to verify integration\n   */\n  async sendTestMessage(): Promise<boolean> {\n    try {\n      // Send a test message to the business phone number itself\n      const testMessage = 'WhatsApp Business API integration test successful! ðŸŽ‰'\n      await this.client.sendTextMessage(this.config.phoneNumber, testMessage)\n      return true\n    } catch (error) {\n      throw new Error(`Test message failed: ${error instanceof Error ? error.message : 'Unknown error'}`)\n    }\n  }\n\n  /**\n   * Get business profile information\n   */\n  async getBusinessProfile(): Promise<BusinessProfile> {\n    try {\n      const response = await fetch(`https://graph.facebook.com/v18.0/${this.config.businessAccountId}`, {\n        headers: {\n          'Authorization': `Bearer ${this.config.accessToken}`,\n        },\n      })\n\n      if (!response.ok) {\n        throw new Error('Failed to get business profile')\n      }\n\n      const profile = await response.json()\n      return {\n        name: profile.name,\n        category: profile.vertical || 'Business',\n        description: profile.description,\n        email: profile.email,\n        websites: profile.websites || [],\n        profilePictureUrl: profile.profile_picture_url\n      }\n    } catch (error) {\n      throw new Error(`Failed to get business profile: ${error instanceof Error ? error.message : 'Unknown error'}`)\n    }\n  }\n\n  /**\n   * Update business profile\n   */\n  async updateBusinessProfile(profile: Partial<BusinessProfile>): Promise<boolean> {\n    try {\n      const updateData: Record<string, unknown> = {}\n\n      if (profile.name) updateData.name = profile.name\n      if (profile.category) updateData.vertical = profile.category\n      if (profile.description) updateData.description = profile.description\n      if (profile.email) updateData.email = profile.email\n      if (profile.websites) updateData.websites = profile.websites\n\n      const response = await fetch(`https://graph.facebook.com/v18.0/${this.config.businessAccountId}`, {\n        method: 'POST',\n        headers: {\n          'Authorization': `Bearer ${this.config.accessToken}`,\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify(updateData),\n      })\n\n      if (!response.ok) {\n        const error = await response.json()\n        throw new Error(`Profile update failed: ${error.error?.message || 'Unknown error'}`)\n      }\n\n      return true\n    } catch (error) {\n      throw new Error(`Failed to update business profile: ${error instanceof Error ? error.message : 'Unknown error'}`)\n    }\n  }\n\n  /**\n   * Save configuration to database\n   */\n  async saveConfiguration(organizationId: string): Promise<boolean> {\n    try {\n      const supabase = await createClient()\n\n      const { error } = await supabase\n        .from('organizations')\n        .update({\n          whatsapp_business_account_id: this.config.businessAccountId,\n          whatsapp_phone_number_id: this.config.phoneNumberId,\n          updated_at: new Date().toISOString()\n        })\n        .eq('id', organizationId)\n\n      if (error) {\n        throw new Error(`Database update failed: ${error.message}`)\n      }\n\n      // Store additional configuration in a separate table or encrypted field\n      // For security, don't store access tokens in plain text\n\n      return true\n    } catch (error) {\n      throw new Error(`Failed to save configuration: ${error instanceof Error ? error.message : 'Unknown error'}`)\n    }\n  }\n\n  /**\n   * Validate webhook signature for security\n   */\n  static validateWebhook(signature: string, payload: string, appSecret: string): boolean {\n    // crypto is now imported at the top\n\n    const expectedSignature = crypto\n      .createHmac('sha256', appSecret)\n      .update(payload)\n      .digest('hex')\n\n    return crypto.timingSafeEqual(\n      Buffer.from(signature.replace('sha256=', '')),\n      Buffer.from(expectedSignature)\n    )\n  }\n\n  /**\n   * Handle webhook verification challenge\n   */\n  static handleWebhookVerification(\n    mode: string,\n    token: string,\n    challenge: string,\n    verifyToken: string\n  ): string | null {\n    if (mode === 'subscribe' && token === verifyToken) {\n      return challenge\n    }\n    return null\n  }\n\n  /**\n   * Get WhatsApp Business API rate limits and usage\n   */\n  async getRateLimits(): Promise<{ messaging: { rate_limit: number; rate_limit_hit: boolean } }> {\n    try {\n      const response = await fetch(`https://graph.facebook.com/v18.0/${this.config.phoneNumberId}/insights`, {\n        headers: {\n          'Authorization': `Bearer ${this.config.accessToken}`,\n        },\n      })\n\n      if (!response.ok) {\n        throw new Error('Failed to get rate limits')\n      }\n\n      return await response.json()\n    } catch (error) {\n      console.error('Failed to get rate limits:', error)\n      return null\n    }\n  }\n\n  /**\n   * Test API connectivity and health\n   */\n  async healthCheck(): Promise<{\n    api: boolean\n    webhook: boolean\n    phoneNumber: boolean\n    businessAccount: boolean\n  }> {\n    const health = {\n      api: false,\n      webhook: false,\n      phoneNumber: false,\n      businessAccount: false\n    }\n\n    try {\n      // Test API access\n      await this.verifyCredentials()\n      health.api = true\n\n      // Test phone number\n      const phoneInfo = await this.getPhoneNumberInfo()\n      health.phoneNumber = phoneInfo.status === 'CONNECTED'\n\n      // Test business account\n      const profile = await this.getBusinessProfile()\n      health.businessAccount = !!profile.name\n\n      // Test webhook (would require actual webhook endpoint test)\n      health.webhook = true // Assume webhook is working if other tests pass\n\n    } catch (error) {\n      console.error('Health check failed:', error)\n    }\n\n    return health\n  }\n}\n\n/**\n * WhatsApp Business API Configuration Manager\n */\nexport class WhatsAppConfigManager {\n  static async getConfig(organizationId: string): Promise<WhatsAppBusinessConfig | null> {\n    try {\n      const supabase = await createClient()\n\n      const { data: organization } = await supabase\n        .from('organizations')\n        .select('*')\n        .eq('id', organizationId)\n        .single()\n\n      if (!organization?.whatsapp_phone_number_id) {\n        return null\n      }\n\n      // In production, decrypt these values\n      return {\n        accessToken: process.env.WHATSAPP_ACCESS_TOKEN!,\n        appId: process.env.WHATSAPP_APP_ID!,\n        appSecret: process.env.WHATSAPP_APP_SECRET!,\n        businessAccountId: organization.whatsapp_business_account_id!,\n        phoneNumberId: organization.whatsapp_phone_number_id,\n        phoneNumber: organization.whatsapp_phone_number || '',\n        webhookVerifyToken: process.env.WHATSAPP_WEBHOOK_VERIFY_TOKEN!\n      }\n    } catch (error) {\n      console.error('Failed to get WhatsApp config:', error)\n      return null\n    }\n  }\n\n  static async isConfigured(organizationId: string): Promise<boolean> {\n    const config = await this.getConfig(organizationId)\n    return config !== null && !!config.phoneNumberId && !!config.businessAccountId\n  }\n\n  static async validateConfig(config: WhatsAppBusinessConfig): Promise<{\n    valid: boolean\n    errors: string[]\n  }> {\n    const errors: string[] = []\n\n    if (!config.accessToken) errors.push('Access token is required')\n    if (!config.appId) errors.push('App ID is required')\n    if (!config.appSecret) errors.push('App secret is required')\n    if (!config.businessAccountId) errors.push('Business Account ID is required')\n    if (!config.phoneNumberId) errors.push('Phone Number ID is required')\n    if (!config.webhookVerifyToken) errors.push('Webhook verify token is required')\n\n    if (errors.length > 0) {\n      return { valid: false, errors }\n    }\n\n    // Test the configuration\n    try {\n      const api = new WhatsAppBusinessAPI(config)\n      await api.verifyCredentials()\n      return { valid: true, errors: [] }\n    } catch (error) {\n      return {\n        valid: false,\n        errors: [`Configuration test failed: ${error instanceof Error ? error.message : 'Unknown error'}`]\n      }\n    }\n  }\n}"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}