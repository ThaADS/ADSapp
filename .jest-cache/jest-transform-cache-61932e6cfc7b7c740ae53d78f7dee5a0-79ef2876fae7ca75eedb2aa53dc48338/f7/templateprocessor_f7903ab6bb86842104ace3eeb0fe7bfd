f444ea64b428ed22b6e1ed5bed337abc
"use strict";

/* istanbul ignore next */
function cov_nnig1ctfy() {
  var path = "C:\\Ai Projecten\\ADSapp\\src\\lib\\queue\\processors\\template-processor.ts";
  var hash = "64798bf3439d6cc95b5293ddde172c9df2a2c143";
  var global = new Function("return this")();
  var gcv = "__coverage__";
  var coverageData = {
    path: "C:\\Ai Projecten\\ADSapp\\src\\lib\\queue\\processors\\template-processor.ts",
    statementMap: {
      "0": {
        start: {
          line: 2,
          column: 0
        },
        end: {
          line: 4,
          column: 3
        }
      },
      "1": {
        start: {
          line: 5,
          column: 0
        },
        end: {
          line: 10,
          column: 3
        }
      },
      "2": {
        start: {
          line: 8,
          column: 8
        },
        end: {
          line: 8,
          column: 31
        }
      },
      "3": {
        start: {
          line: 11,
          column: 16
        },
        end: {
          line: 11,
          column: 48
        }
      },
      "4": {
        start: {
          line: 15,
          column: 21
        },
        end: {
          line: 15,
          column: 54
        }
      },
      "5": {
        start: {
          line: 16,
          column: 28
        },
        end: {
          line: 16,
          column: 148
        }
      },
      "6": {
        start: {
          line: 17,
          column: 4
        },
        end: {
          line: 19,
          column: 5
        }
      },
      "7": {
        start: {
          line: 18,
          column: 8
        },
        end: {
          line: 18,
          column: 68
        }
      },
      "8": {
        start: {
          line: 20,
          column: 4
        },
        end: {
          line: 20,
          column: 16
        }
      },
      "9": {
        start: {
          line: 25,
          column: 18
        },
        end: {
          line: 25,
          column: 32
        }
      },
      "10": {
        start: {
          line: 26,
          column: 22
        },
        end: {
          line: 26,
          column: 24
        }
      },
      "11": {
        start: {
          line: 28,
          column: 4
        },
        end: {
          line: 30,
          column: 5
        }
      },
      "12": {
        start: {
          line: 29,
          column: 8
        },
        end: {
          line: 29,
          column: 40
        }
      },
      "13": {
        start: {
          line: 31,
          column: 4
        },
        end: {
          line: 33,
          column: 6
        }
      },
      "14": {
        start: {
          line: 38,
          column: 20
        },
        end: {
          line: 38,
          column: 119
        }
      },
      "15": {
        start: {
          line: 38,
          column: 56
        },
        end: {
          line: 38,
          column: 118
        }
      },
      "16": {
        start: {
          line: 39,
          column: 4
        },
        end: {
          line: 42,
          column: 6
        }
      },
      "17": {
        start: {
          line: 47,
          column: 17
        },
        end: {
          line: 47,
          column: 25
        }
      },
      "18": {
        start: {
          line: 48,
          column: 4
        },
        end: {
          line: 51,
          column: 5
        }
      },
      "19": {
        start: {
          line: 49,
          column: 22
        },
        end: {
          line: 49,
          column: 59
        }
      },
      "20": {
        start: {
          line: 50,
          column: 8
        },
        end: {
          line: 50,
          column: 46
        }
      },
      "21": {
        start: {
          line: 52,
          column: 4
        },
        end: {
          line: 52,
          column: 18
        }
      },
      "22": {
        start: {
          line: 57,
          column: 4
        },
        end: {
          line: 77,
          column: 5
        }
      },
      "23": {
        start: {
          line: 60,
          column: 12
        },
        end: {
          line: 65,
          column: 13
        }
      },
      "24": {
        start: {
          line: 61,
          column: 16
        },
        end: {
          line: 61,
          column: 31
        }
      },
      "25": {
        start: {
          line: 62,
          column: 16
        },
        end: {
          line: 62,
          column: 29
        }
      },
      "26": {
        start: {
          line: 64,
          column: 16
        },
        end: {
          line: 64,
          column: 26
        }
      },
      "27": {
        start: {
          line: 68,
          column: 12
        },
        end: {
          line: 68,
          column: 50
        }
      },
      "28": {
        start: {
          line: 71,
          column: 25
        },
        end: {
          line: 71,
          column: 40
        }
      },
      "29": {
        start: {
          line: 72,
          column: 12
        },
        end: {
          line: 72,
          column: 54
        }
      },
      "30": {
        start: {
          line: 76,
          column: 12
        },
        end: {
          line: 76,
          column: 61
        }
      },
      "31": {
        start: {
          line: 84,
          column: 18
        },
        end: {
          line: 84,
          column: 81
        }
      },
      "32": {
        start: {
          line: 86,
          column: 4
        },
        end: {
          line: 86,
          column: 86
        }
      },
      "33": {
        start: {
          line: 87,
          column: 4
        },
        end: {
          line: 87,
          column: 17
        }
      },
      "34": {
        start: {
          line: 90,
          column: 22
        },
        end: {
          line: 90,
          column: 32
        }
      },
      "35": {
        start: {
          line: 91,
          column: 85
        },
        end: {
          line: 91,
          column: 93
        }
      },
      "36": {
        start: {
          line: 92,
          column: 4
        },
        end: {
          line: 92,
          column: 127
        }
      },
      "37": {
        start: {
          line: 93,
          column: 20
        },
        end: {
          line: 98,
          column: 5
        }
      },
      "38": {
        start: {
          line: 99,
          column: 4
        },
        end: {
          line: 219,
          column: 5
        }
      },
      "39": {
        start: {
          line: 101,
          column: 8
        },
        end: {
          line: 101,
          column: 76
        }
      },
      "40": {
        start: {
          line: 102,
          column: 25
        },
        end: {
          line: 102,
          column: 70
        }
      },
      "41": {
        start: {
          line: 103,
          column: 8
        },
        end: {
          line: 105,
          column: 9
        }
      },
      "42": {
        start: {
          line: 104,
          column: 12
        },
        end: {
          line: 104,
          column: 50
        }
      },
      "43": {
        start: {
          line: 107,
          column: 34
        },
        end: {
          line: 107,
          column: 76
        }
      },
      "44": {
        start: {
          line: 108,
          column: 8
        },
        end: {
          line: 108,
          column: 105
        }
      },
      "45": {
        start: {
          line: 110,
          column: 34
        },
        end: {
          line: 110,
          column: 36
        }
      },
      "46": {
        start: {
          line: 111,
          column: 8
        },
        end: {
          line: 146,
          column: 9
        }
      },
      "47": {
        start: {
          line: 111,
          column: 20
        },
        end: {
          line: 111,
          column: 21
        }
      },
      "48": {
        start: {
          line: 112,
          column: 30
        },
        end: {
          line: 112,
          column: 43
        }
      },
      "49": {
        start: {
          line: 113,
          column: 12
        },
        end: {
          line: 145,
          column: 13
        }
      },
      "50": {
        start: {
          line: 115,
          column: 35
        },
        end: {
          line: 115,
          column: 92
        }
      },
      "51": {
        start: {
          line: 116,
          column: 16
        },
        end: {
          line: 118,
          column: 17
        }
      },
      "52": {
        start: {
          line: 117,
          column: 20
        },
        end: {
          line: 117,
          column: 100
        }
      },
      "53": {
        start: {
          line: 120,
          column: 43
        },
        end: {
          line: 120,
          column: 45
        }
      },
      "54": {
        start: {
          line: 121,
          column: 16
        },
        end: {
          line: 123,
          column: 17
        }
      },
      "55": {
        start: {
          line: 122,
          column: 20
        },
        end: {
          line: 122,
          column: 83
        }
      },
      "56": {
        start: {
          line: 125,
          column: 44
        },
        end: {
          line: 125,
          column: 109
        }
      },
      "57": {
        start: {
          line: 127,
          column: 16
        },
        end: {
          line: 131,
          column: 19
        }
      },
      "58": {
        start: {
          line: 132,
          column: 16
        },
        end: {
          line: 132,
          column: 41
        }
      },
      "59": {
        start: {
          line: 134,
          column: 16
        },
        end: {
          line: 137,
          column: 17
        }
      },
      "60": {
        start: {
          line: 135,
          column: 37
        },
        end: {
          line: 135,
          column: 82
        }
      },
      "61": {
        start: {
          line: 136,
          column: 20
        },
        end: {
          line: 136,
          column: 55
        }
      },
      "62": {
        start: {
          line: 139,
          column: 16
        },
        end: {
          line: 139,
          column: 38
        }
      },
      "63": {
        start: {
          line: 140,
          column: 16
        },
        end: {
          line: 143,
          column: 19
        }
      },
      "64": {
        start: {
          line: 144,
          column: 16
        },
        end: {
          line: 144,
          column: 112
        }
      },
      "65": {
        start: {
          line: 149,
          column: 8
        },
        end: {
          line: 153,
          column: 9
        }
      },
      "66": {
        start: {
          line: 150,
          column: 12
        },
        end: {
          line: 150,
          column: 115
        }
      },
      "67": {
        start: {
          line: 151,
          column: 12
        },
        end: {
          line: 151,
          column: 113
        }
      },
      "68": {
        start: {
          line: 152,
          column: 12
        },
        end: {
          line: 152,
          column: 59
        }
      },
      "69": {
        start: {
          line: 154,
          column: 24
        },
        end: {
          line: 154,
          column: 34
        }
      },
      "70": {
        start: {
          line: 155,
          column: 25
        },
        end: {
          line: 155,
          column: 44
        }
      },
      "71": {
        start: {
          line: 157,
          column: 25
        },
        end: {
          line: 157,
          column: 58
        }
      },
      "72": {
        start: {
          line: 158,
          column: 8
        },
        end: {
          line: 178,
          column: 11
        }
      },
      "73": {
        start: {
          line: 179,
          column: 8
        },
        end: {
          line: 179,
          column: 182
        }
      },
      "74": {
        start: {
          line: 180,
          column: 8
        },
        end: {
          line: 193,
          column: 10
        }
      },
      "75": {
        start: {
          line: 195,
          column: 24
        },
        end: {
          line: 195,
          column: 34
        }
      },
      "76": {
        start: {
          line: 196,
          column: 25
        },
        end: {
          line: 196,
          column: 44
        }
      },
      "77": {
        start: {
          line: 198,
          column: 25
        },
        end: {
          line: 198,
          column: 58
        }
      },
      "78": {
        start: {
          line: 199,
          column: 8
        },
        end: {
          line: 217,
          column: 11
        }
      },
      "79": {
        start: {
          line: 218,
          column: 8
        },
        end: {
          line: 218,
          column: 20
        }
      }
    },
    fnMap: {
      "0": {
        name: "(anonymous_0)",
        decl: {
          start: {
            line: 7,
            column: 9
          },
          end: {
            line: 7,
            column: 10
          }
        },
        loc: {
          start: {
            line: 7,
            column: 20
          },
          end: {
            line: 9,
            column: 5
          }
        },
        line: 7
      },
      "1": {
        name: "getTemplate",
        decl: {
          start: {
            line: 14,
            column: 19
          },
          end: {
            line: 14,
            column: 30
          }
        },
        loc: {
          start: {
            line: 14,
            column: 59
          },
          end: {
            line: 21,
            column: 1
          }
        },
        line: 14
      },
      "2": {
        name: "extractTemplateVariables",
        decl: {
          start: {
            line: 24,
            column: 13
          },
          end: {
            line: 24,
            column: 37
          }
        },
        loc: {
          start: {
            line: 24,
            column: 47
          },
          end: {
            line: 34,
            column: 1
          }
        },
        line: 24
      },
      "3": {
        name: "validateVariables",
        decl: {
          start: {
            line: 37,
            column: 13
          },
          end: {
            line: 37,
            column: 30
          }
        },
        loc: {
          start: {
            line: 37,
            column: 69
          },
          end: {
            line: 43,
            column: 1
          }
        },
        line: 37
      },
      "4": {
        name: "(anonymous_4)",
        decl: {
          start: {
            line: 38,
            column: 45
          },
          end: {
            line: 38,
            column: 46
          }
        },
        loc: {
          start: {
            line: 38,
            column: 56
          },
          end: {
            line: 38,
            column: 118
          }
        },
        line: 38
      },
      "5": {
        name: "substituteTemplateVariables",
        decl: {
          start: {
            line: 46,
            column: 13
          },
          end: {
            line: 46,
            column: 40
          }
        },
        loc: {
          start: {
            line: 46,
            column: 62
          },
          end: {
            line: 53,
            column: 1
          }
        },
        line: 46
      },
      "6": {
        name: "sanitizeVariableValue",
        decl: {
          start: {
            line: 56,
            column: 13
          },
          end: {
            line: 56,
            column: 34
          }
        },
        loc: {
          start: {
            line: 56,
            column: 57
          },
          end: {
            line: 78,
            column: 1
          }
        },
        line: 56
      },
      "7": {
        name: "createBulkMessageJob",
        decl: {
          start: {
            line: 81,
            column: 19
          },
          end: {
            line: 81,
            column: 39
          }
        },
        loc: {
          start: {
            line: 81,
            column: 86
          },
          end: {
            line: 88,
            column: 1
          }
        },
        line: 81
      },
      "8": {
        name: "processTemplate",
        decl: {
          start: {
            line: 89,
            column: 15
          },
          end: {
            line: 89,
            column: 30
          }
        },
        loc: {
          start: {
            line: 89,
            column: 36
          },
          end: {
            line: 220,
            column: 1
          }
        },
        line: 89
      }
    },
    branchMap: {
      "0": {
        loc: {
          start: {
            line: 17,
            column: 4
          },
          end: {
            line: 19,
            column: 5
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 17,
            column: 4
          },
          end: {
            line: 19,
            column: 5
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 17
      },
      "1": {
        loc: {
          start: {
            line: 38,
            column: 56
          },
          end: {
            line: 38,
            column: 118
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 38,
            column: 56
          },
          end: {
            line: 38,
            column: 87
          }
        }, {
          start: {
            line: 38,
            column: 91
          },
          end: {
            line: 38,
            column: 118
          }
        }],
        line: 38
      },
      "2": {
        loc: {
          start: {
            line: 56,
            column: 42
          },
          end: {
            line: 56,
            column: 55
          }
        },
        type: "default-arg",
        locations: [{
          start: {
            line: 56,
            column: 49
          },
          end: {
            line: 56,
            column: 55
          }
        }],
        line: 56
      },
      "3": {
        loc: {
          start: {
            line: 57,
            column: 4
          },
          end: {
            line: 77,
            column: 5
          }
        },
        type: "switch",
        locations: [{
          start: {
            line: 58,
            column: 8
          },
          end: {
            line: 65,
            column: 13
          }
        }, {
          start: {
            line: 66,
            column: 8
          },
          end: {
            line: 68,
            column: 50
          }
        }, {
          start: {
            line: 69,
            column: 8
          },
          end: {
            line: 72,
            column: 54
          }
        }, {
          start: {
            line: 73,
            column: 8
          },
          end: {
            line: 73,
            column: 20
          }
        }, {
          start: {
            line: 74,
            column: 8
          },
          end: {
            line: 76,
            column: 61
          }
        }],
        line: 57
      },
      "4": {
        loc: {
          start: {
            line: 72,
            column: 19
          },
          end: {
            line: 72,
            column: 53
          }
        },
        type: "cond-expr",
        locations: [{
          start: {
            line: 72,
            column: 43
          },
          end: {
            line: 72,
            column: 45
          }
        }, {
          start: {
            line: 72,
            column: 48
          },
          end: {
            line: 72,
            column: 53
          }
        }],
        line: 72
      },
      "5": {
        loc: {
          start: {
            line: 103,
            column: 8
          },
          end: {
            line: 105,
            column: 9
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 103,
            column: 8
          },
          end: {
            line: 105,
            column: 9
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 103
      },
      "6": {
        loc: {
          start: {
            line: 116,
            column: 16
          },
          end: {
            line: 118,
            column: 17
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 116,
            column: 16
          },
          end: {
            line: 118,
            column: 17
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 116
      },
      "7": {
        loc: {
          start: {
            line: 134,
            column: 16
          },
          end: {
            line: 137,
            column: 17
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 134,
            column: 16
          },
          end: {
            line: 137,
            column: 17
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 134
      },
      "8": {
        loc: {
          start: {
            line: 134,
            column: 20
          },
          end: {
            line: 134,
            column: 63
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 134,
            column: 20
          },
          end: {
            line: 134,
            column: 32
          }
        }, {
          start: {
            line: 134,
            column: 36
          },
          end: {
            line: 134,
            column: 63
          }
        }],
        line: 134
      },
      "9": {
        loc: {
          start: {
            line: 142,
            column: 27
          },
          end: {
            line: 142,
            column: 86
          }
        },
        type: "cond-expr",
        locations: [{
          start: {
            line: 142,
            column: 52
          },
          end: {
            line: 142,
            column: 65
          }
        }, {
          start: {
            line: 142,
            column: 68
          },
          end: {
            line: 142,
            column: 86
          }
        }],
        line: 142
      },
      "10": {
        loc: {
          start: {
            line: 149,
            column: 8
          },
          end: {
            line: 153,
            column: 9
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 149,
            column: 8
          },
          end: {
            line: 153,
            column: 9
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 149
      },
      "11": {
        loc: {
          start: {
            line: 163,
            column: 20
          },
          end: {
            line: 163,
            column: 79
          }
        },
        type: "cond-expr",
        locations: [{
          start: {
            line: 163,
            column: 48
          },
          end: {
            line: 163,
            column: 59
          }
        }, {
          start: {
            line: 163,
            column: 62
          },
          end: {
            line: 163,
            column: 79
          }
        }],
        line: 163
      },
      "12": {
        loc: {
          start: {
            line: 173,
            column: 27
          },
          end: {
            line: 175,
            column: 20
          }
        },
        type: "cond-expr",
        locations: [{
          start: {
            line: 173,
            column: 55
          },
          end: {
            line: 175,
            column: 13
          }
        }, {
          start: {
            line: 175,
            column: 16
          },
          end: {
            line: 175,
            column: 20
          }
        }],
        line: 173
      },
      "13": {
        loc: {
          start: {
            line: 181,
            column: 19
          },
          end: {
            line: 181,
            column: 43
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 181,
            column: 19
          },
          end: {
            line: 181,
            column: 37
          }
        }, {
          start: {
            line: 181,
            column: 41
          },
          end: {
            line: 181,
            column: 43
          }
        }],
        line: 181
      },
      "14": {
        loc: {
          start: {
            line: 213,
            column: 23
          },
          end: {
            line: 213,
            column: 79
          }
        },
        type: "cond-expr",
        locations: [{
          start: {
            line: 213,
            column: 48
          },
          end: {
            line: 213,
            column: 61
          }
        }, {
          start: {
            line: 213,
            column: 64
          },
          end: {
            line: 213,
            column: 79
          }
        }],
        line: 213
      }
    },
    s: {
      "0": 0,
      "1": 0,
      "2": 0,
      "3": 0,
      "4": 0,
      "5": 0,
      "6": 0,
      "7": 0,
      "8": 0,
      "9": 0,
      "10": 0,
      "11": 0,
      "12": 0,
      "13": 0,
      "14": 0,
      "15": 0,
      "16": 0,
      "17": 0,
      "18": 0,
      "19": 0,
      "20": 0,
      "21": 0,
      "22": 0,
      "23": 0,
      "24": 0,
      "25": 0,
      "26": 0,
      "27": 0,
      "28": 0,
      "29": 0,
      "30": 0,
      "31": 0,
      "32": 0,
      "33": 0,
      "34": 0,
      "35": 0,
      "36": 0,
      "37": 0,
      "38": 0,
      "39": 0,
      "40": 0,
      "41": 0,
      "42": 0,
      "43": 0,
      "44": 0,
      "45": 0,
      "46": 0,
      "47": 0,
      "48": 0,
      "49": 0,
      "50": 0,
      "51": 0,
      "52": 0,
      "53": 0,
      "54": 0,
      "55": 0,
      "56": 0,
      "57": 0,
      "58": 0,
      "59": 0,
      "60": 0,
      "61": 0,
      "62": 0,
      "63": 0,
      "64": 0,
      "65": 0,
      "66": 0,
      "67": 0,
      "68": 0,
      "69": 0,
      "70": 0,
      "71": 0,
      "72": 0,
      "73": 0,
      "74": 0,
      "75": 0,
      "76": 0,
      "77": 0,
      "78": 0,
      "79": 0
    },
    f: {
      "0": 0,
      "1": 0,
      "2": 0,
      "3": 0,
      "4": 0,
      "5": 0,
      "6": 0,
      "7": 0,
      "8": 0
    },
    b: {
      "0": [0, 0],
      "1": [0, 0],
      "2": [0],
      "3": [0, 0, 0, 0, 0],
      "4": [0, 0],
      "5": [0, 0],
      "6": [0, 0],
      "7": [0, 0],
      "8": [0, 0],
      "9": [0, 0],
      "10": [0, 0],
      "11": [0, 0],
      "12": [0, 0],
      "13": [0, 0],
      "14": [0, 0]
    },
    inputSourceMap: {
      version: 3,
      sources: ["C:\\Ai Projecten\\ADSapp\\src\\lib\\queue\\processors\\template-processor.ts"],
      sourcesContent: ["import { Job } from 'bullmq';\nimport { createClient } from '@/lib/supabase/server';\n\n/**\n * Template Processor\n *\n * Handles message template compilation, variable substitution, and batch processing.\n * Used for scheduled campaigns and automated messaging.\n *\n * Features:\n * - Template compilation and caching\n * - Variable substitution with validation\n * - Batch message personalization\n * - Template preview generation\n * - Multi-tenant isolation\n *\n * @module template-processor\n */\n\n/**\n * Template variable definition\n */\nexport interface TemplateVariable {\n  name: string;\n  type: 'text' | 'number' | 'date' | 'url';\n  required: boolean;\n  defaultValue?: string;\n}\n\n/**\n * Template processing job data\n */\nexport interface TemplateProcessingJobData {\n  organizationId: string;\n  userId: string;\n  templateId: string;\n  recipients: Array<{\n    contactId: string;\n    phone: string;\n    variables: Record<string, string>;\n  }>;\n  scheduleAt?: string; // ISO 8601 timestamp\n  metadata?: Record<string, any>;\n}\n\n/**\n * Template processing job result\n */\nexport interface TemplateProcessingJobResult {\n  jobId: string;\n  organizationId: string;\n  templateId: string;\n  totalRecipients: number;\n  processedCount: number;\n  queuedCount: number;\n  failedCount: number;\n  errors: Array<{\n    contactId: string;\n    error: string;\n  }>;\n  bulkMessageJobId?: string; // ID of created bulk message job\n  startedAt: string;\n  completedAt: string;\n  duration: number;\n}\n\n/**\n * Get template from database\n */\nasync function getTemplate(templateId: string, organizationId: string) {\n  const supabase = await createClient();\n\n  const { data, error } = await supabase\n    .from('message_templates')\n    .select('*')\n    .eq('id', templateId)\n    .eq('organization_id', organizationId)\n    .single();\n\n  if (error) {\n    throw new Error(`Failed to get template: ${error.message}`);\n  }\n\n  return data;\n}\n\n/**\n * Extract variables from template content\n */\nfunction extractTemplateVariables(content: string): string[] {\n  const regex = /{{([^}]+)}}/g;\n  const variables: string[] = [];\n  let match;\n\n  while ((match = regex.exec(content)) !== null) {\n    variables.push(match[1].trim());\n  }\n\n  return [...new Set(variables)]; // Remove duplicates\n}\n\n/**\n * Validate required variables are provided\n */\nfunction validateVariables(\n  templateVariables: string[],\n  providedVariables: Record<string, string>\n): { valid: boolean; missing: string[] } {\n  const missing = templateVariables.filter(\n    (varName) => !(varName in providedVariables) || !providedVariables[varName]\n  );\n\n  return {\n    valid: missing.length === 0,\n    missing\n  };\n}\n\n/**\n * Substitute variables in template\n */\nfunction substituteTemplateVariables(\n  template: string,\n  variables: Record<string, string>\n): string {\n  let result = template;\n\n  for (const [key, value] of Object.entries(variables)) {\n    const regex = new RegExp(`{{\\\\s*${key}\\\\s*}}`, 'g');\n    result = result.replace(regex, value);\n  }\n\n  return result;\n}\n\n/**\n * Sanitize variable value\n */\nfunction sanitizeVariableValue(\n  value: string,\n  type: string = 'text'\n): string {\n  switch (type) {\n    case 'url':\n      // Basic URL validation\n      try {\n        new URL(value);\n        return value;\n      } catch {\n        return '';\n      }\n    case 'number':\n      // Remove non-numeric characters\n      return value.replace(/[^0-9.-]/g, '');\n    case 'date':\n      // Validate date format\n      const date = new Date(value);\n      return isNaN(date.getTime()) ? '' : value;\n    case 'text':\n    default:\n      // Remove special characters that might break WhatsApp formatting\n      return value.replace(/[^\\w\\s.,!?@#$%&()-]/g, '');\n  }\n}\n\n/**\n * Create bulk message job from processed templates\n */\nasync function createBulkMessageJob(\n  organizationId: string,\n  userId: string,\n  messages: Array<{\n    contactId: string;\n    phone: string;\n    content: string;\n  }>,\n  scheduleAt?: string\n): Promise<string> {\n  // This would integrate with the bulk message queue\n  // For now, we'll simulate job creation\n  const jobId = `bulk_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n\n  // TODO: Queue bulk message job\n  console.log(`Created bulk message job: ${jobId} for ${messages.length} messages`);\n\n  return jobId;\n}\n\n/**\n * Template processor function\n */\nexport async function processTemplate(\n  job: Job<TemplateProcessingJobData>\n): Promise<TemplateProcessingJobResult> {\n  const startTime = Date.now();\n  const {\n    organizationId,\n    userId,\n    templateId,\n    recipients,\n    scheduleAt,\n    metadata\n  } = job.data;\n\n  console.log(\n    `[TemplateProcessing] Starting job ${job.id} for template ${templateId} with ${recipients.length} recipients`\n  );\n\n  const results = {\n    processedCount: 0,\n    queuedCount: 0,\n    failedCount: 0,\n    errors: [] as Array<{\n      contactId: string;\n      error: string;\n    }>\n  };\n\n  try {\n    // Step 1: Get template\n    console.log(`[TemplateProcessing] Fetching template ${templateId}`);\n    const template = await getTemplate(templateId, organizationId);\n\n    if (!template) {\n      throw new Error('Template not found');\n    }\n\n    // Step 2: Extract required variables\n    const templateVariables = extractTemplateVariables(template.content);\n    console.log(\n      `[TemplateProcessing] Template requires variables: ${templateVariables.join(', ')}`\n    );\n\n    // Step 3: Process each recipient\n    const processedMessages: Array<{\n      contactId: string;\n      phone: string;\n      content: string;\n    }> = [];\n\n    for (let i = 0; i < recipients.length; i++) {\n      const recipient = recipients[i];\n\n      try {\n        // Validate required variables\n        const validation = validateVariables(\n          templateVariables,\n          recipient.variables\n        );\n\n        if (!validation.valid) {\n          throw new Error(\n            `Missing required variables: ${validation.missing.join(', ')}`\n          );\n        }\n\n        // Sanitize variable values\n        const sanitizedVariables: Record<string, string> = {};\n        for (const [key, value] of Object.entries(recipient.variables)) {\n          sanitizedVariables[key] = sanitizeVariableValue(value, 'text');\n        }\n\n        // Substitute variables\n        const personalizedContent = substituteTemplateVariables(\n          template.content,\n          sanitizedVariables\n        );\n\n        // Add to processed messages\n        processedMessages.push({\n          contactId: recipient.contactId,\n          phone: recipient.phone,\n          content: personalizedContent\n        });\n\n        results.processedCount++;\n\n        // Update progress\n        if (i % 10 === 0 || i === recipients.length - 1) {\n          const progress = Math.round(((i + 1) / recipients.length) * 100);\n          await job.updateProgress(progress);\n        }\n      } catch (error) {\n        results.failedCount++;\n        results.errors.push({\n          contactId: recipient.contactId,\n          error: error instanceof Error ? error.message : 'Processing error'\n        });\n\n        console.error(\n          `[TemplateProcessing] Error processing recipient ${recipient.contactId}:`,\n          error\n        );\n      }\n    }\n\n    // Step 4: Create bulk message job with processed messages\n    let bulkMessageJobId: string | undefined;\n    if (processedMessages.length > 0) {\n      console.log(\n        `[TemplateProcessing] Creating bulk message job for ${processedMessages.length} messages`\n      );\n\n      bulkMessageJobId = await createBulkMessageJob(\n        organizationId,\n        userId,\n        processedMessages,\n        scheduleAt\n      );\n\n      results.queuedCount = processedMessages.length;\n    }\n\n    const endTime = Date.now();\n    const duration = endTime - startTime;\n\n    // Log job completion to database\n    const supabase = await createClient();\n    await supabase.from('job_logs').insert({\n      job_id: job.id?.toString(),\n      job_type: 'template_processing',\n      organization_id: organizationId,\n      user_id: userId,\n      status: results.failedCount === 0 ? 'completed' : 'partial_success',\n      result: {\n        template_id: templateId,\n        total: recipients.length,\n        processed: results.processedCount,\n        queued: results.queuedCount,\n        failed: results.failedCount,\n        bulk_job_id: bulkMessageJobId,\n        duration: duration\n      },\n      error_details:\n        results.errors.length > 0 ? { errors: results.errors } : null,\n      started_at: new Date(startTime).toISOString(),\n      completed_at: new Date(endTime).toISOString()\n    });\n\n    console.log(\n      `[TemplateProcessing] Job ${job.id} completed: ${results.processedCount} processed, ${results.queuedCount} queued, ${results.failedCount} failed, ${duration}ms`\n    );\n\n    return {\n      jobId: job.id?.toString() || '',\n      organizationId,\n      templateId,\n      totalRecipients: recipients.length,\n      processedCount: results.processedCount,\n      queuedCount: results.queuedCount,\n      failedCount: results.failedCount,\n      errors: results.errors,\n      bulkMessageJobId,\n      startedAt: new Date(startTime).toISOString(),\n      completedAt: new Date(endTime).toISOString(),\n      duration\n    };\n  } catch (error) {\n    const endTime = Date.now();\n    const duration = endTime - startTime;\n\n    // Log failure\n    const supabase = await createClient();\n    await supabase.from('job_logs').insert({\n      job_id: job.id?.toString(),\n      job_type: 'template_processing',\n      organization_id: organizationId,\n      user_id: userId,\n      status: 'failed',\n      result: {\n        template_id: templateId,\n        total: recipients.length,\n        processed: 0,\n        failed: recipients.length,\n        duration: duration\n      },\n      error_details: {\n        error: error instanceof Error ? error.message : 'Unknown error'\n      },\n      started_at: new Date(startTime).toISOString(),\n      completed_at: new Date(endTime).toISOString()\n    });\n\n    throw error;\n  }\n}\n"],
      names: ["processTemplate", "getTemplate", "templateId", "organizationId", "supabase", "createClient", "data", "error", "from", "select", "eq", "single", "Error", "message", "extractTemplateVariables", "content", "regex", "variables", "match", "exec", "push", "trim", "Set", "validateVariables", "templateVariables", "providedVariables", "missing", "filter", "varName", "valid", "length", "substituteTemplateVariables", "template", "result", "key", "value", "Object", "entries", "RegExp", "replace", "sanitizeVariableValue", "type", "URL", "date", "Date", "isNaN", "getTime", "createBulkMessageJob", "userId", "messages", "scheduleAt", "jobId", "now", "Math", "random", "toString", "substr", "console", "log", "job", "startTime", "recipients", "metadata", "id", "results", "processedCount", "queuedCount", "failedCount", "errors", "join", "processedMessages", "i", "recipient", "validation", "sanitizedVariables", "personalizedContent", "contactId", "phone", "progress", "round", "updateProgress", "bulkMessageJobId", "endTime", "duration", "insert", "job_id", "job_type", "organization_id", "user_id", "status", "template_id", "total", "processed", "queued", "failed", "bulk_job_id", "error_details", "started_at", "toISOString", "completed_at", "totalRecipients", "startedAt", "completedAt"],
      mappings: "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"
    },
    _coverageSchema: "1a1c01bbd47fc00a2c39e90264f33305004495a9",
    hash: "64798bf3439d6cc95b5293ddde172c9df2a2c143"
  };
  var coverage = global[gcv] || (global[gcv] = {});
  if (!coverage[path] || coverage[path].hash !== hash) {
    coverage[path] = coverageData;
  }
  var actualCoverage = coverage[path];
  {
    // @ts-ignore
    cov_nnig1ctfy = function () {
      return actualCoverage;
    };
  }
  return actualCoverage;
}
cov_nnig1ctfy();
cov_nnig1ctfy().s[0]++;
Object.defineProperty(exports, "__esModule", {
  value: true
});
/* istanbul ignore next */
cov_nnig1ctfy().s[1]++;
Object.defineProperty(exports, "processTemplate", {
  enumerable: true,
  get: function () {
    /* istanbul ignore next */
    cov_nnig1ctfy().f[0]++;
    cov_nnig1ctfy().s[2]++;
    return processTemplate;
  }
});
const _server =
/* istanbul ignore next */
(cov_nnig1ctfy().s[3]++, require("../../supabase/server"));
/**
 * Get template from database
 */
async function getTemplate(templateId, organizationId) {
  /* istanbul ignore next */
  cov_nnig1ctfy().f[1]++;
  const supabase =
  /* istanbul ignore next */
  (cov_nnig1ctfy().s[4]++, await (0, _server.createClient)());
  const {
    data,
    error
  } =
  /* istanbul ignore next */
  (cov_nnig1ctfy().s[5]++, await supabase.from('message_templates').select('*').eq('id', templateId).eq('organization_id', organizationId).single());
  /* istanbul ignore next */
  cov_nnig1ctfy().s[6]++;
  if (error) {
    /* istanbul ignore next */
    cov_nnig1ctfy().b[0][0]++;
    cov_nnig1ctfy().s[7]++;
    throw new Error(`Failed to get template: ${error.message}`);
  } else
  /* istanbul ignore next */
  {
    cov_nnig1ctfy().b[0][1]++;
  }
  cov_nnig1ctfy().s[8]++;
  return data;
}
/**
 * Extract variables from template content
 */
function extractTemplateVariables(content) {
  /* istanbul ignore next */
  cov_nnig1ctfy().f[2]++;
  const regex =
  /* istanbul ignore next */
  (cov_nnig1ctfy().s[9]++, /{{([^}]+)}}/g);
  const variables =
  /* istanbul ignore next */
  (cov_nnig1ctfy().s[10]++, []);
  let match;
  /* istanbul ignore next */
  cov_nnig1ctfy().s[11]++;
  while ((match = regex.exec(content)) !== null) {
    /* istanbul ignore next */
    cov_nnig1ctfy().s[12]++;
    variables.push(match[1].trim());
  }
  /* istanbul ignore next */
  cov_nnig1ctfy().s[13]++;
  return [...new Set(variables)]; // Remove duplicates
}
/**
 * Validate required variables are provided
 */
function validateVariables(templateVariables, providedVariables) {
  /* istanbul ignore next */
  cov_nnig1ctfy().f[3]++;
  const missing =
  /* istanbul ignore next */
  (cov_nnig1ctfy().s[14]++, templateVariables.filter(varName => {
    /* istanbul ignore next */
    cov_nnig1ctfy().f[4]++;
    cov_nnig1ctfy().s[15]++;
    return /* istanbul ignore next */(cov_nnig1ctfy().b[1][0]++, !(varName in providedVariables)) ||
    /* istanbul ignore next */
    (cov_nnig1ctfy().b[1][1]++, !providedVariables[varName]);
  }));
  /* istanbul ignore next */
  cov_nnig1ctfy().s[16]++;
  return {
    valid: missing.length === 0,
    missing
  };
}
/**
 * Substitute variables in template
 */
function substituteTemplateVariables(template, variables) {
  /* istanbul ignore next */
  cov_nnig1ctfy().f[5]++;
  let result =
  /* istanbul ignore next */
  (cov_nnig1ctfy().s[17]++, template);
  /* istanbul ignore next */
  cov_nnig1ctfy().s[18]++;
  for (const [key, value] of Object.entries(variables)) {
    const regex =
    /* istanbul ignore next */
    (cov_nnig1ctfy().s[19]++, new RegExp(`{{\\s*${key}\\s*}}`, 'g'));
    /* istanbul ignore next */
    cov_nnig1ctfy().s[20]++;
    result = result.replace(regex, value);
  }
  /* istanbul ignore next */
  cov_nnig1ctfy().s[21]++;
  return result;
}
/**
 * Sanitize variable value
 */
function sanitizeVariableValue(value, type =
/* istanbul ignore next */
(cov_nnig1ctfy().b[2][0]++, 'text')) {
  /* istanbul ignore next */
  cov_nnig1ctfy().f[6]++;
  cov_nnig1ctfy().s[22]++;
  switch (type) {
    case 'url':
      /* istanbul ignore next */
      cov_nnig1ctfy().b[3][0]++;
      cov_nnig1ctfy().s[23]++;
      // Basic URL validation
      try {
        /* istanbul ignore next */
        cov_nnig1ctfy().s[24]++;
        new URL(value);
        /* istanbul ignore next */
        cov_nnig1ctfy().s[25]++;
        return value;
      } catch {
        /* istanbul ignore next */
        cov_nnig1ctfy().s[26]++;
        return '';
      }
    case 'number':
      /* istanbul ignore next */
      cov_nnig1ctfy().b[3][1]++;
      cov_nnig1ctfy().s[27]++;
      // Remove non-numeric characters
      return value.replace(/[^0-9.-]/g, '');
    case 'date':
      /* istanbul ignore next */
      cov_nnig1ctfy().b[3][2]++;
      // Validate date format
      const date =
      /* istanbul ignore next */
      (cov_nnig1ctfy().s[28]++, new Date(value));
      /* istanbul ignore next */
      cov_nnig1ctfy().s[29]++;
      return isNaN(date.getTime()) ?
      /* istanbul ignore next */
      (cov_nnig1ctfy().b[4][0]++, '') :
      /* istanbul ignore next */
      (cov_nnig1ctfy().b[4][1]++, value);
    case 'text':
      /* istanbul ignore next */
      cov_nnig1ctfy().b[3][3]++;
    default:
      /* istanbul ignore next */
      cov_nnig1ctfy().b[3][4]++;
      cov_nnig1ctfy().s[30]++;
      // Remove special characters that might break WhatsApp formatting
      return value.replace(/[^\w\s.,!?@#$%&()-]/g, '');
  }
}
/**
 * Create bulk message job from processed templates
 */
async function createBulkMessageJob(organizationId, userId, messages, scheduleAt) {
  /* istanbul ignore next */
  cov_nnig1ctfy().f[7]++;
  // This would integrate with the bulk message queue
  // For now, we'll simulate job creation
  const jobId =
  /* istanbul ignore next */
  (cov_nnig1ctfy().s[31]++, `bulk_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`);
  // TODO: Queue bulk message job
  /* istanbul ignore next */
  cov_nnig1ctfy().s[32]++;
  console.log(`Created bulk message job: ${jobId} for ${messages.length} messages`);
  /* istanbul ignore next */
  cov_nnig1ctfy().s[33]++;
  return jobId;
}
async function processTemplate(job) {
  /* istanbul ignore next */
  cov_nnig1ctfy().f[8]++;
  const startTime =
  /* istanbul ignore next */
  (cov_nnig1ctfy().s[34]++, Date.now());
  const {
    organizationId,
    userId,
    templateId,
    recipients,
    scheduleAt,
    metadata
  } =
  /* istanbul ignore next */
  (cov_nnig1ctfy().s[35]++, job.data);
  /* istanbul ignore next */
  cov_nnig1ctfy().s[36]++;
  console.log(`[TemplateProcessing] Starting job ${job.id} for template ${templateId} with ${recipients.length} recipients`);
  const results =
  /* istanbul ignore next */
  (cov_nnig1ctfy().s[37]++, {
    processedCount: 0,
    queuedCount: 0,
    failedCount: 0,
    errors: []
  });
  /* istanbul ignore next */
  cov_nnig1ctfy().s[38]++;
  try {
    /* istanbul ignore next */
    cov_nnig1ctfy().s[39]++;
    // Step 1: Get template
    console.log(`[TemplateProcessing] Fetching template ${templateId}`);
    const template =
    /* istanbul ignore next */
    (cov_nnig1ctfy().s[40]++, await getTemplate(templateId, organizationId));
    /* istanbul ignore next */
    cov_nnig1ctfy().s[41]++;
    if (!template) {
      /* istanbul ignore next */
      cov_nnig1ctfy().b[5][0]++;
      cov_nnig1ctfy().s[42]++;
      throw new Error('Template not found');
    } else
    /* istanbul ignore next */
    {
      cov_nnig1ctfy().b[5][1]++;
    }
    // Step 2: Extract required variables
    const templateVariables =
    /* istanbul ignore next */
    (cov_nnig1ctfy().s[43]++, extractTemplateVariables(template.content));
    /* istanbul ignore next */
    cov_nnig1ctfy().s[44]++;
    console.log(`[TemplateProcessing] Template requires variables: ${templateVariables.join(', ')}`);
    // Step 3: Process each recipient
    const processedMessages =
    /* istanbul ignore next */
    (cov_nnig1ctfy().s[45]++, []);
    /* istanbul ignore next */
    cov_nnig1ctfy().s[46]++;
    for (let i =
    /* istanbul ignore next */
    (cov_nnig1ctfy().s[47]++, 0); i < recipients.length; i++) {
      const recipient =
      /* istanbul ignore next */
      (cov_nnig1ctfy().s[48]++, recipients[i]);
      /* istanbul ignore next */
      cov_nnig1ctfy().s[49]++;
      try {
        // Validate required variables
        const validation =
        /* istanbul ignore next */
        (cov_nnig1ctfy().s[50]++, validateVariables(templateVariables, recipient.variables));
        /* istanbul ignore next */
        cov_nnig1ctfy().s[51]++;
        if (!validation.valid) {
          /* istanbul ignore next */
          cov_nnig1ctfy().b[6][0]++;
          cov_nnig1ctfy().s[52]++;
          throw new Error(`Missing required variables: ${validation.missing.join(', ')}`);
        } else
        /* istanbul ignore next */
        {
          cov_nnig1ctfy().b[6][1]++;
        }
        // Sanitize variable values
        const sanitizedVariables =
        /* istanbul ignore next */
        (cov_nnig1ctfy().s[53]++, {});
        /* istanbul ignore next */
        cov_nnig1ctfy().s[54]++;
        for (const [key, value] of Object.entries(recipient.variables)) {
          /* istanbul ignore next */
          cov_nnig1ctfy().s[55]++;
          sanitizedVariables[key] = sanitizeVariableValue(value, 'text');
        }
        // Substitute variables
        const personalizedContent =
        /* istanbul ignore next */
        (cov_nnig1ctfy().s[56]++, substituteTemplateVariables(template.content, sanitizedVariables));
        // Add to processed messages
        /* istanbul ignore next */
        cov_nnig1ctfy().s[57]++;
        processedMessages.push({
          contactId: recipient.contactId,
          phone: recipient.phone,
          content: personalizedContent
        });
        /* istanbul ignore next */
        cov_nnig1ctfy().s[58]++;
        results.processedCount++;
        // Update progress
        /* istanbul ignore next */
        cov_nnig1ctfy().s[59]++;
        if (
        /* istanbul ignore next */
        (cov_nnig1ctfy().b[8][0]++, i % 10 === 0) ||
        /* istanbul ignore next */
        (cov_nnig1ctfy().b[8][1]++, i === recipients.length - 1)) {
          /* istanbul ignore next */
          cov_nnig1ctfy().b[7][0]++;
          const progress =
          /* istanbul ignore next */
          (cov_nnig1ctfy().s[60]++, Math.round((i + 1) / recipients.length * 100));
          /* istanbul ignore next */
          cov_nnig1ctfy().s[61]++;
          await job.updateProgress(progress);
        } else
        /* istanbul ignore next */
        {
          cov_nnig1ctfy().b[7][1]++;
        }
      } catch (error) {
        /* istanbul ignore next */
        cov_nnig1ctfy().s[62]++;
        results.failedCount++;
        /* istanbul ignore next */
        cov_nnig1ctfy().s[63]++;
        results.errors.push({
          contactId: recipient.contactId,
          error: error instanceof Error ?
          /* istanbul ignore next */
          (cov_nnig1ctfy().b[9][0]++, error.message) :
          /* istanbul ignore next */
          (cov_nnig1ctfy().b[9][1]++, 'Processing error')
        });
        /* istanbul ignore next */
        cov_nnig1ctfy().s[64]++;
        console.error(`[TemplateProcessing] Error processing recipient ${recipient.contactId}:`, error);
      }
    }
    // Step 4: Create bulk message job with processed messages
    let bulkMessageJobId;
    /* istanbul ignore next */
    cov_nnig1ctfy().s[65]++;
    if (processedMessages.length > 0) {
      /* istanbul ignore next */
      cov_nnig1ctfy().b[10][0]++;
      cov_nnig1ctfy().s[66]++;
      console.log(`[TemplateProcessing] Creating bulk message job for ${processedMessages.length} messages`);
      /* istanbul ignore next */
      cov_nnig1ctfy().s[67]++;
      bulkMessageJobId = await createBulkMessageJob(organizationId, userId, processedMessages, scheduleAt);
      /* istanbul ignore next */
      cov_nnig1ctfy().s[68]++;
      results.queuedCount = processedMessages.length;
    } else
    /* istanbul ignore next */
    {
      cov_nnig1ctfy().b[10][1]++;
    }
    const endTime =
    /* istanbul ignore next */
    (cov_nnig1ctfy().s[69]++, Date.now());
    const duration =
    /* istanbul ignore next */
    (cov_nnig1ctfy().s[70]++, endTime - startTime);
    // Log job completion to database
    const supabase =
    /* istanbul ignore next */
    (cov_nnig1ctfy().s[71]++, await (0, _server.createClient)());
    /* istanbul ignore next */
    cov_nnig1ctfy().s[72]++;
    await supabase.from('job_logs').insert({
      job_id: job.id?.toString(),
      job_type: 'template_processing',
      organization_id: organizationId,
      user_id: userId,
      status: results.failedCount === 0 ?
      /* istanbul ignore next */
      (cov_nnig1ctfy().b[11][0]++, 'completed') :
      /* istanbul ignore next */
      (cov_nnig1ctfy().b[11][1]++, 'partial_success'),
      result: {
        template_id: templateId,
        total: recipients.length,
        processed: results.processedCount,
        queued: results.queuedCount,
        failed: results.failedCount,
        bulk_job_id: bulkMessageJobId,
        duration: duration
      },
      error_details: results.errors.length > 0 ?
      /* istanbul ignore next */
      (cov_nnig1ctfy().b[12][0]++, {
        errors: results.errors
      }) :
      /* istanbul ignore next */
      (cov_nnig1ctfy().b[12][1]++, null),
      started_at: new Date(startTime).toISOString(),
      completed_at: new Date(endTime).toISOString()
    });
    /* istanbul ignore next */
    cov_nnig1ctfy().s[73]++;
    console.log(`[TemplateProcessing] Job ${job.id} completed: ${results.processedCount} processed, ${results.queuedCount} queued, ${results.failedCount} failed, ${duration}ms`);
    /* istanbul ignore next */
    cov_nnig1ctfy().s[74]++;
    return {
      jobId:
      /* istanbul ignore next */
      (cov_nnig1ctfy().b[13][0]++, job.id?.toString()) ||
      /* istanbul ignore next */
      (cov_nnig1ctfy().b[13][1]++, ''),
      organizationId,
      templateId,
      totalRecipients: recipients.length,
      processedCount: results.processedCount,
      queuedCount: results.queuedCount,
      failedCount: results.failedCount,
      errors: results.errors,
      bulkMessageJobId,
      startedAt: new Date(startTime).toISOString(),
      completedAt: new Date(endTime).toISOString(),
      duration
    };
  } catch (error) {
    const endTime =
    /* istanbul ignore next */
    (cov_nnig1ctfy().s[75]++, Date.now());
    const duration =
    /* istanbul ignore next */
    (cov_nnig1ctfy().s[76]++, endTime - startTime);
    // Log failure
    const supabase =
    /* istanbul ignore next */
    (cov_nnig1ctfy().s[77]++, await (0, _server.createClient)());
    /* istanbul ignore next */
    cov_nnig1ctfy().s[78]++;
    await supabase.from('job_logs').insert({
      job_id: job.id?.toString(),
      job_type: 'template_processing',
      organization_id: organizationId,
      user_id: userId,
      status: 'failed',
      result: {
        template_id: templateId,
        total: recipients.length,
        processed: 0,
        failed: recipients.length,
        duration: duration
      },
      error_details: {
        error: error instanceof Error ?
        /* istanbul ignore next */
        (cov_nnig1ctfy().b[14][0]++, error.message) :
        /* istanbul ignore next */
        (cov_nnig1ctfy().b[14][1]++, 'Unknown error')
      },
      started_at: new Date(startTime).toISOString(),
      completed_at: new Date(endTime).toISOString()
    });
    /* istanbul ignore next */
    cov_nnig1ctfy().s[79]++;
    throw error;
  }
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJjb3Zfbm5pZzFjdGZ5IiwiYWN0dWFsQ292ZXJhZ2UiLCJzIiwicHJvY2Vzc1RlbXBsYXRlIiwiZ2V0VGVtcGxhdGUiLCJ0ZW1wbGF0ZUlkIiwib3JnYW5pemF0aW9uSWQiLCJmIiwic3VwYWJhc2UiLCJfc2VydmVyIiwiY3JlYXRlQ2xpZW50IiwiZGF0YSIsImVycm9yIiwiZnJvbSIsInNlbGVjdCIsImVxIiwic2luZ2xlIiwiYiIsIkVycm9yIiwibWVzc2FnZSIsImV4dHJhY3RUZW1wbGF0ZVZhcmlhYmxlcyIsImNvbnRlbnQiLCJyZWdleCIsInZhcmlhYmxlcyIsIm1hdGNoIiwiZXhlYyIsInB1c2giLCJ0cmltIiwiU2V0IiwidmFsaWRhdGVWYXJpYWJsZXMiLCJ0ZW1wbGF0ZVZhcmlhYmxlcyIsInByb3ZpZGVkVmFyaWFibGVzIiwibWlzc2luZyIsImZpbHRlciIsInZhck5hbWUiLCJ2YWxpZCIsImxlbmd0aCIsInN1YnN0aXR1dGVUZW1wbGF0ZVZhcmlhYmxlcyIsInRlbXBsYXRlIiwicmVzdWx0Iiwia2V5IiwidmFsdWUiLCJPYmplY3QiLCJlbnRyaWVzIiwiUmVnRXhwIiwicmVwbGFjZSIsInNhbml0aXplVmFyaWFibGVWYWx1ZSIsInR5cGUiLCJVUkwiLCJkYXRlIiwiRGF0ZSIsImlzTmFOIiwiZ2V0VGltZSIsImNyZWF0ZUJ1bGtNZXNzYWdlSm9iIiwidXNlcklkIiwibWVzc2FnZXMiLCJzY2hlZHVsZUF0Iiwiam9iSWQiLCJub3ciLCJNYXRoIiwicmFuZG9tIiwidG9TdHJpbmciLCJzdWJzdHIiLCJjb25zb2xlIiwibG9nIiwiam9iIiwic3RhcnRUaW1lIiwicmVjaXBpZW50cyIsIm1ldGFkYXRhIiwiaWQiLCJyZXN1bHRzIiwicHJvY2Vzc2VkQ291bnQiLCJxdWV1ZWRDb3VudCIsImZhaWxlZENvdW50IiwiZXJyb3JzIiwiam9pbiIsInByb2Nlc3NlZE1lc3NhZ2VzIiwiaSIsInJlY2lwaWVudCIsInZhbGlkYXRpb24iLCJzYW5pdGl6ZWRWYXJpYWJsZXMiLCJwZXJzb25hbGl6ZWRDb250ZW50IiwiY29udGFjdElkIiwicGhvbmUiLCJwcm9ncmVzcyIsInJvdW5kIiwidXBkYXRlUHJvZ3Jlc3MiLCJidWxrTWVzc2FnZUpvYklkIiwiZW5kVGltZSIsImR1cmF0aW9uIiwiaW5zZXJ0Iiwiam9iX2lkIiwiam9iX3R5cGUiLCJvcmdhbml6YXRpb25faWQiLCJ1c2VyX2lkIiwic3RhdHVzIiwidGVtcGxhdGVfaWQiLCJ0b3RhbCIsInByb2Nlc3NlZCIsInF1ZXVlZCIsImZhaWxlZCIsImJ1bGtfam9iX2lkIiwiZXJyb3JfZGV0YWlscyIsInN0YXJ0ZWRfYXQiLCJ0b0lTT1N0cmluZyIsImNvbXBsZXRlZF9hdCIsInRvdGFsUmVjaXBpZW50cyIsInN0YXJ0ZWRBdCIsImNvbXBsZXRlZEF0Il0sInNvdXJjZXMiOlsiQzpcXEFpIFByb2plY3RlblxcQURTYXBwXFxzcmNcXGxpYlxccXVldWVcXHByb2Nlc3NvcnNcXHRlbXBsYXRlLXByb2Nlc3Nvci50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBKb2IgfSBmcm9tICdidWxsbXEnO1xuaW1wb3J0IHsgY3JlYXRlQ2xpZW50IH0gZnJvbSAnQC9saWIvc3VwYWJhc2Uvc2VydmVyJztcblxuLyoqXG4gKiBUZW1wbGF0ZSBQcm9jZXNzb3JcbiAqXG4gKiBIYW5kbGVzIG1lc3NhZ2UgdGVtcGxhdGUgY29tcGlsYXRpb24sIHZhcmlhYmxlIHN1YnN0aXR1dGlvbiwgYW5kIGJhdGNoIHByb2Nlc3NpbmcuXG4gKiBVc2VkIGZvciBzY2hlZHVsZWQgY2FtcGFpZ25zIGFuZCBhdXRvbWF0ZWQgbWVzc2FnaW5nLlxuICpcbiAqIEZlYXR1cmVzOlxuICogLSBUZW1wbGF0ZSBjb21waWxhdGlvbiBhbmQgY2FjaGluZ1xuICogLSBWYXJpYWJsZSBzdWJzdGl0dXRpb24gd2l0aCB2YWxpZGF0aW9uXG4gKiAtIEJhdGNoIG1lc3NhZ2UgcGVyc29uYWxpemF0aW9uXG4gKiAtIFRlbXBsYXRlIHByZXZpZXcgZ2VuZXJhdGlvblxuICogLSBNdWx0aS10ZW5hbnQgaXNvbGF0aW9uXG4gKlxuICogQG1vZHVsZSB0ZW1wbGF0ZS1wcm9jZXNzb3JcbiAqL1xuXG4vKipcbiAqIFRlbXBsYXRlIHZhcmlhYmxlIGRlZmluaXRpb25cbiAqL1xuZXhwb3J0IGludGVyZmFjZSBUZW1wbGF0ZVZhcmlhYmxlIHtcbiAgbmFtZTogc3RyaW5nO1xuICB0eXBlOiAndGV4dCcgfCAnbnVtYmVyJyB8ICdkYXRlJyB8ICd1cmwnO1xuICByZXF1aXJlZDogYm9vbGVhbjtcbiAgZGVmYXVsdFZhbHVlPzogc3RyaW5nO1xufVxuXG4vKipcbiAqIFRlbXBsYXRlIHByb2Nlc3Npbmcgam9iIGRhdGFcbiAqL1xuZXhwb3J0IGludGVyZmFjZSBUZW1wbGF0ZVByb2Nlc3NpbmdKb2JEYXRhIHtcbiAgb3JnYW5pemF0aW9uSWQ6IHN0cmluZztcbiAgdXNlcklkOiBzdHJpbmc7XG4gIHRlbXBsYXRlSWQ6IHN0cmluZztcbiAgcmVjaXBpZW50czogQXJyYXk8e1xuICAgIGNvbnRhY3RJZDogc3RyaW5nO1xuICAgIHBob25lOiBzdHJpbmc7XG4gICAgdmFyaWFibGVzOiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+O1xuICB9PjtcbiAgc2NoZWR1bGVBdD86IHN0cmluZzsgLy8gSVNPIDg2MDEgdGltZXN0YW1wXG4gIG1ldGFkYXRhPzogUmVjb3JkPHN0cmluZywgYW55Pjtcbn1cblxuLyoqXG4gKiBUZW1wbGF0ZSBwcm9jZXNzaW5nIGpvYiByZXN1bHRcbiAqL1xuZXhwb3J0IGludGVyZmFjZSBUZW1wbGF0ZVByb2Nlc3NpbmdKb2JSZXN1bHQge1xuICBqb2JJZDogc3RyaW5nO1xuICBvcmdhbml6YXRpb25JZDogc3RyaW5nO1xuICB0ZW1wbGF0ZUlkOiBzdHJpbmc7XG4gIHRvdGFsUmVjaXBpZW50czogbnVtYmVyO1xuICBwcm9jZXNzZWRDb3VudDogbnVtYmVyO1xuICBxdWV1ZWRDb3VudDogbnVtYmVyO1xuICBmYWlsZWRDb3VudDogbnVtYmVyO1xuICBlcnJvcnM6IEFycmF5PHtcbiAgICBjb250YWN0SWQ6IHN0cmluZztcbiAgICBlcnJvcjogc3RyaW5nO1xuICB9PjtcbiAgYnVsa01lc3NhZ2VKb2JJZD86IHN0cmluZzsgLy8gSUQgb2YgY3JlYXRlZCBidWxrIG1lc3NhZ2Ugam9iXG4gIHN0YXJ0ZWRBdDogc3RyaW5nO1xuICBjb21wbGV0ZWRBdDogc3RyaW5nO1xuICBkdXJhdGlvbjogbnVtYmVyO1xufVxuXG4vKipcbiAqIEdldCB0ZW1wbGF0ZSBmcm9tIGRhdGFiYXNlXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIGdldFRlbXBsYXRlKHRlbXBsYXRlSWQ6IHN0cmluZywgb3JnYW5pemF0aW9uSWQ6IHN0cmluZykge1xuICBjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xuXG4gIGNvbnN0IHsgZGF0YSwgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgLmZyb20oJ21lc3NhZ2VfdGVtcGxhdGVzJylcbiAgICAuc2VsZWN0KCcqJylcbiAgICAuZXEoJ2lkJywgdGVtcGxhdGVJZClcbiAgICAuZXEoJ29yZ2FuaXphdGlvbl9pZCcsIG9yZ2FuaXphdGlvbklkKVxuICAgIC5zaW5nbGUoKTtcblxuICBpZiAoZXJyb3IpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYEZhaWxlZCB0byBnZXQgdGVtcGxhdGU6ICR7ZXJyb3IubWVzc2FnZX1gKTtcbiAgfVxuXG4gIHJldHVybiBkYXRhO1xufVxuXG4vKipcbiAqIEV4dHJhY3QgdmFyaWFibGVzIGZyb20gdGVtcGxhdGUgY29udGVudFxuICovXG5mdW5jdGlvbiBleHRyYWN0VGVtcGxhdGVWYXJpYWJsZXMoY29udGVudDogc3RyaW5nKTogc3RyaW5nW10ge1xuICBjb25zdCByZWdleCA9IC97eyhbXn1dKyl9fS9nO1xuICBjb25zdCB2YXJpYWJsZXM6IHN0cmluZ1tdID0gW107XG4gIGxldCBtYXRjaDtcblxuICB3aGlsZSAoKG1hdGNoID0gcmVnZXguZXhlYyhjb250ZW50KSkgIT09IG51bGwpIHtcbiAgICB2YXJpYWJsZXMucHVzaChtYXRjaFsxXS50cmltKCkpO1xuICB9XG5cbiAgcmV0dXJuIFsuLi5uZXcgU2V0KHZhcmlhYmxlcyldOyAvLyBSZW1vdmUgZHVwbGljYXRlc1xufVxuXG4vKipcbiAqIFZhbGlkYXRlIHJlcXVpcmVkIHZhcmlhYmxlcyBhcmUgcHJvdmlkZWRcbiAqL1xuZnVuY3Rpb24gdmFsaWRhdGVWYXJpYWJsZXMoXG4gIHRlbXBsYXRlVmFyaWFibGVzOiBzdHJpbmdbXSxcbiAgcHJvdmlkZWRWYXJpYWJsZXM6IFJlY29yZDxzdHJpbmcsIHN0cmluZz5cbik6IHsgdmFsaWQ6IGJvb2xlYW47IG1pc3Npbmc6IHN0cmluZ1tdIH0ge1xuICBjb25zdCBtaXNzaW5nID0gdGVtcGxhdGVWYXJpYWJsZXMuZmlsdGVyKFxuICAgICh2YXJOYW1lKSA9PiAhKHZhck5hbWUgaW4gcHJvdmlkZWRWYXJpYWJsZXMpIHx8ICFwcm92aWRlZFZhcmlhYmxlc1t2YXJOYW1lXVxuICApO1xuXG4gIHJldHVybiB7XG4gICAgdmFsaWQ6IG1pc3NpbmcubGVuZ3RoID09PSAwLFxuICAgIG1pc3NpbmdcbiAgfTtcbn1cblxuLyoqXG4gKiBTdWJzdGl0dXRlIHZhcmlhYmxlcyBpbiB0ZW1wbGF0ZVxuICovXG5mdW5jdGlvbiBzdWJzdGl0dXRlVGVtcGxhdGVWYXJpYWJsZXMoXG4gIHRlbXBsYXRlOiBzdHJpbmcsXG4gIHZhcmlhYmxlczogUmVjb3JkPHN0cmluZywgc3RyaW5nPlxuKTogc3RyaW5nIHtcbiAgbGV0IHJlc3VsdCA9IHRlbXBsYXRlO1xuXG4gIGZvciAoY29uc3QgW2tleSwgdmFsdWVdIG9mIE9iamVjdC5lbnRyaWVzKHZhcmlhYmxlcykpIHtcbiAgICBjb25zdCByZWdleCA9IG5ldyBSZWdFeHAoYHt7XFxcXHMqJHtrZXl9XFxcXHMqfX1gLCAnZycpO1xuICAgIHJlc3VsdCA9IHJlc3VsdC5yZXBsYWNlKHJlZ2V4LCB2YWx1ZSk7XG4gIH1cblxuICByZXR1cm4gcmVzdWx0O1xufVxuXG4vKipcbiAqIFNhbml0aXplIHZhcmlhYmxlIHZhbHVlXG4gKi9cbmZ1bmN0aW9uIHNhbml0aXplVmFyaWFibGVWYWx1ZShcbiAgdmFsdWU6IHN0cmluZyxcbiAgdHlwZTogc3RyaW5nID0gJ3RleHQnXG4pOiBzdHJpbmcge1xuICBzd2l0Y2ggKHR5cGUpIHtcbiAgICBjYXNlICd1cmwnOlxuICAgICAgLy8gQmFzaWMgVVJMIHZhbGlkYXRpb25cbiAgICAgIHRyeSB7XG4gICAgICAgIG5ldyBVUkwodmFsdWUpO1xuICAgICAgICByZXR1cm4gdmFsdWU7XG4gICAgICB9IGNhdGNoIHtcbiAgICAgICAgcmV0dXJuICcnO1xuICAgICAgfVxuICAgIGNhc2UgJ251bWJlcic6XG4gICAgICAvLyBSZW1vdmUgbm9uLW51bWVyaWMgY2hhcmFjdGVyc1xuICAgICAgcmV0dXJuIHZhbHVlLnJlcGxhY2UoL1teMC05Li1dL2csICcnKTtcbiAgICBjYXNlICdkYXRlJzpcbiAgICAgIC8vIFZhbGlkYXRlIGRhdGUgZm9ybWF0XG4gICAgICBjb25zdCBkYXRlID0gbmV3IERhdGUodmFsdWUpO1xuICAgICAgcmV0dXJuIGlzTmFOKGRhdGUuZ2V0VGltZSgpKSA/ICcnIDogdmFsdWU7XG4gICAgY2FzZSAndGV4dCc6XG4gICAgZGVmYXVsdDpcbiAgICAgIC8vIFJlbW92ZSBzcGVjaWFsIGNoYXJhY3RlcnMgdGhhdCBtaWdodCBicmVhayBXaGF0c0FwcCBmb3JtYXR0aW5nXG4gICAgICByZXR1cm4gdmFsdWUucmVwbGFjZSgvW15cXHdcXHMuLCE/QCMkJSYoKS1dL2csICcnKTtcbiAgfVxufVxuXG4vKipcbiAqIENyZWF0ZSBidWxrIG1lc3NhZ2Ugam9iIGZyb20gcHJvY2Vzc2VkIHRlbXBsYXRlc1xuICovXG5hc3luYyBmdW5jdGlvbiBjcmVhdGVCdWxrTWVzc2FnZUpvYihcbiAgb3JnYW5pemF0aW9uSWQ6IHN0cmluZyxcbiAgdXNlcklkOiBzdHJpbmcsXG4gIG1lc3NhZ2VzOiBBcnJheTx7XG4gICAgY29udGFjdElkOiBzdHJpbmc7XG4gICAgcGhvbmU6IHN0cmluZztcbiAgICBjb250ZW50OiBzdHJpbmc7XG4gIH0+LFxuICBzY2hlZHVsZUF0Pzogc3RyaW5nXG4pOiBQcm9taXNlPHN0cmluZz4ge1xuICAvLyBUaGlzIHdvdWxkIGludGVncmF0ZSB3aXRoIHRoZSBidWxrIG1lc3NhZ2UgcXVldWVcbiAgLy8gRm9yIG5vdywgd2UnbGwgc2ltdWxhdGUgam9iIGNyZWF0aW9uXG4gIGNvbnN0IGpvYklkID0gYGJ1bGtfJHtEYXRlLm5vdygpfV8ke01hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnN1YnN0cigyLCA5KX1gO1xuXG4gIC8vIFRPRE86IFF1ZXVlIGJ1bGsgbWVzc2FnZSBqb2JcbiAgY29uc29sZS5sb2coYENyZWF0ZWQgYnVsayBtZXNzYWdlIGpvYjogJHtqb2JJZH0gZm9yICR7bWVzc2FnZXMubGVuZ3RofSBtZXNzYWdlc2ApO1xuXG4gIHJldHVybiBqb2JJZDtcbn1cblxuLyoqXG4gKiBUZW1wbGF0ZSBwcm9jZXNzb3IgZnVuY3Rpb25cbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHByb2Nlc3NUZW1wbGF0ZShcbiAgam9iOiBKb2I8VGVtcGxhdGVQcm9jZXNzaW5nSm9iRGF0YT5cbik6IFByb21pc2U8VGVtcGxhdGVQcm9jZXNzaW5nSm9iUmVzdWx0PiB7XG4gIGNvbnN0IHN0YXJ0VGltZSA9IERhdGUubm93KCk7XG4gIGNvbnN0IHtcbiAgICBvcmdhbml6YXRpb25JZCxcbiAgICB1c2VySWQsXG4gICAgdGVtcGxhdGVJZCxcbiAgICByZWNpcGllbnRzLFxuICAgIHNjaGVkdWxlQXQsXG4gICAgbWV0YWRhdGFcbiAgfSA9IGpvYi5kYXRhO1xuXG4gIGNvbnNvbGUubG9nKFxuICAgIGBbVGVtcGxhdGVQcm9jZXNzaW5nXSBTdGFydGluZyBqb2IgJHtqb2IuaWR9IGZvciB0ZW1wbGF0ZSAke3RlbXBsYXRlSWR9IHdpdGggJHtyZWNpcGllbnRzLmxlbmd0aH0gcmVjaXBpZW50c2BcbiAgKTtcblxuICBjb25zdCByZXN1bHRzID0ge1xuICAgIHByb2Nlc3NlZENvdW50OiAwLFxuICAgIHF1ZXVlZENvdW50OiAwLFxuICAgIGZhaWxlZENvdW50OiAwLFxuICAgIGVycm9yczogW10gYXMgQXJyYXk8e1xuICAgICAgY29udGFjdElkOiBzdHJpbmc7XG4gICAgICBlcnJvcjogc3RyaW5nO1xuICAgIH0+XG4gIH07XG5cbiAgdHJ5IHtcbiAgICAvLyBTdGVwIDE6IEdldCB0ZW1wbGF0ZVxuICAgIGNvbnNvbGUubG9nKGBbVGVtcGxhdGVQcm9jZXNzaW5nXSBGZXRjaGluZyB0ZW1wbGF0ZSAke3RlbXBsYXRlSWR9YCk7XG4gICAgY29uc3QgdGVtcGxhdGUgPSBhd2FpdCBnZXRUZW1wbGF0ZSh0ZW1wbGF0ZUlkLCBvcmdhbml6YXRpb25JZCk7XG5cbiAgICBpZiAoIXRlbXBsYXRlKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ1RlbXBsYXRlIG5vdCBmb3VuZCcpO1xuICAgIH1cblxuICAgIC8vIFN0ZXAgMjogRXh0cmFjdCByZXF1aXJlZCB2YXJpYWJsZXNcbiAgICBjb25zdCB0ZW1wbGF0ZVZhcmlhYmxlcyA9IGV4dHJhY3RUZW1wbGF0ZVZhcmlhYmxlcyh0ZW1wbGF0ZS5jb250ZW50KTtcbiAgICBjb25zb2xlLmxvZyhcbiAgICAgIGBbVGVtcGxhdGVQcm9jZXNzaW5nXSBUZW1wbGF0ZSByZXF1aXJlcyB2YXJpYWJsZXM6ICR7dGVtcGxhdGVWYXJpYWJsZXMuam9pbignLCAnKX1gXG4gICAgKTtcblxuICAgIC8vIFN0ZXAgMzogUHJvY2VzcyBlYWNoIHJlY2lwaWVudFxuICAgIGNvbnN0IHByb2Nlc3NlZE1lc3NhZ2VzOiBBcnJheTx7XG4gICAgICBjb250YWN0SWQ6IHN0cmluZztcbiAgICAgIHBob25lOiBzdHJpbmc7XG4gICAgICBjb250ZW50OiBzdHJpbmc7XG4gICAgfT4gPSBbXTtcblxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcmVjaXBpZW50cy5sZW5ndGg7IGkrKykge1xuICAgICAgY29uc3QgcmVjaXBpZW50ID0gcmVjaXBpZW50c1tpXTtcblxuICAgICAgdHJ5IHtcbiAgICAgICAgLy8gVmFsaWRhdGUgcmVxdWlyZWQgdmFyaWFibGVzXG4gICAgICAgIGNvbnN0IHZhbGlkYXRpb24gPSB2YWxpZGF0ZVZhcmlhYmxlcyhcbiAgICAgICAgICB0ZW1wbGF0ZVZhcmlhYmxlcyxcbiAgICAgICAgICByZWNpcGllbnQudmFyaWFibGVzXG4gICAgICAgICk7XG5cbiAgICAgICAgaWYgKCF2YWxpZGF0aW9uLnZhbGlkKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgICAgYE1pc3NpbmcgcmVxdWlyZWQgdmFyaWFibGVzOiAke3ZhbGlkYXRpb24ubWlzc2luZy5qb2luKCcsICcpfWBcbiAgICAgICAgICApO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gU2FuaXRpemUgdmFyaWFibGUgdmFsdWVzXG4gICAgICAgIGNvbnN0IHNhbml0aXplZFZhcmlhYmxlczogUmVjb3JkPHN0cmluZywgc3RyaW5nPiA9IHt9O1xuICAgICAgICBmb3IgKGNvbnN0IFtrZXksIHZhbHVlXSBvZiBPYmplY3QuZW50cmllcyhyZWNpcGllbnQudmFyaWFibGVzKSkge1xuICAgICAgICAgIHNhbml0aXplZFZhcmlhYmxlc1trZXldID0gc2FuaXRpemVWYXJpYWJsZVZhbHVlKHZhbHVlLCAndGV4dCcpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gU3Vic3RpdHV0ZSB2YXJpYWJsZXNcbiAgICAgICAgY29uc3QgcGVyc29uYWxpemVkQ29udGVudCA9IHN1YnN0aXR1dGVUZW1wbGF0ZVZhcmlhYmxlcyhcbiAgICAgICAgICB0ZW1wbGF0ZS5jb250ZW50LFxuICAgICAgICAgIHNhbml0aXplZFZhcmlhYmxlc1xuICAgICAgICApO1xuXG4gICAgICAgIC8vIEFkZCB0byBwcm9jZXNzZWQgbWVzc2FnZXNcbiAgICAgICAgcHJvY2Vzc2VkTWVzc2FnZXMucHVzaCh7XG4gICAgICAgICAgY29udGFjdElkOiByZWNpcGllbnQuY29udGFjdElkLFxuICAgICAgICAgIHBob25lOiByZWNpcGllbnQucGhvbmUsXG4gICAgICAgICAgY29udGVudDogcGVyc29uYWxpemVkQ29udGVudFxuICAgICAgICB9KTtcblxuICAgICAgICByZXN1bHRzLnByb2Nlc3NlZENvdW50Kys7XG5cbiAgICAgICAgLy8gVXBkYXRlIHByb2dyZXNzXG4gICAgICAgIGlmIChpICUgMTAgPT09IDAgfHwgaSA9PT0gcmVjaXBpZW50cy5sZW5ndGggLSAxKSB7XG4gICAgICAgICAgY29uc3QgcHJvZ3Jlc3MgPSBNYXRoLnJvdW5kKCgoaSArIDEpIC8gcmVjaXBpZW50cy5sZW5ndGgpICogMTAwKTtcbiAgICAgICAgICBhd2FpdCBqb2IudXBkYXRlUHJvZ3Jlc3MocHJvZ3Jlc3MpO1xuICAgICAgICB9XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICByZXN1bHRzLmZhaWxlZENvdW50Kys7XG4gICAgICAgIHJlc3VsdHMuZXJyb3JzLnB1c2goe1xuICAgICAgICAgIGNvbnRhY3RJZDogcmVjaXBpZW50LmNvbnRhY3RJZCxcbiAgICAgICAgICBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnUHJvY2Vzc2luZyBlcnJvcidcbiAgICAgICAgfSk7XG5cbiAgICAgICAgY29uc29sZS5lcnJvcihcbiAgICAgICAgICBgW1RlbXBsYXRlUHJvY2Vzc2luZ10gRXJyb3IgcHJvY2Vzc2luZyByZWNpcGllbnQgJHtyZWNpcGllbnQuY29udGFjdElkfTpgLFxuICAgICAgICAgIGVycm9yXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gU3RlcCA0OiBDcmVhdGUgYnVsayBtZXNzYWdlIGpvYiB3aXRoIHByb2Nlc3NlZCBtZXNzYWdlc1xuICAgIGxldCBidWxrTWVzc2FnZUpvYklkOiBzdHJpbmcgfCB1bmRlZmluZWQ7XG4gICAgaWYgKHByb2Nlc3NlZE1lc3NhZ2VzLmxlbmd0aCA+IDApIHtcbiAgICAgIGNvbnNvbGUubG9nKFxuICAgICAgICBgW1RlbXBsYXRlUHJvY2Vzc2luZ10gQ3JlYXRpbmcgYnVsayBtZXNzYWdlIGpvYiBmb3IgJHtwcm9jZXNzZWRNZXNzYWdlcy5sZW5ndGh9IG1lc3NhZ2VzYFxuICAgICAgKTtcblxuICAgICAgYnVsa01lc3NhZ2VKb2JJZCA9IGF3YWl0IGNyZWF0ZUJ1bGtNZXNzYWdlSm9iKFxuICAgICAgICBvcmdhbml6YXRpb25JZCxcbiAgICAgICAgdXNlcklkLFxuICAgICAgICBwcm9jZXNzZWRNZXNzYWdlcyxcbiAgICAgICAgc2NoZWR1bGVBdFxuICAgICAgKTtcblxuICAgICAgcmVzdWx0cy5xdWV1ZWRDb3VudCA9IHByb2Nlc3NlZE1lc3NhZ2VzLmxlbmd0aDtcbiAgICB9XG5cbiAgICBjb25zdCBlbmRUaW1lID0gRGF0ZS5ub3coKTtcbiAgICBjb25zdCBkdXJhdGlvbiA9IGVuZFRpbWUgLSBzdGFydFRpbWU7XG5cbiAgICAvLyBMb2cgam9iIGNvbXBsZXRpb24gdG8gZGF0YWJhc2VcbiAgICBjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xuICAgIGF3YWl0IHN1cGFiYXNlLmZyb20oJ2pvYl9sb2dzJykuaW5zZXJ0KHtcbiAgICAgIGpvYl9pZDogam9iLmlkPy50b1N0cmluZygpLFxuICAgICAgam9iX3R5cGU6ICd0ZW1wbGF0ZV9wcm9jZXNzaW5nJyxcbiAgICAgIG9yZ2FuaXphdGlvbl9pZDogb3JnYW5pemF0aW9uSWQsXG4gICAgICB1c2VyX2lkOiB1c2VySWQsXG4gICAgICBzdGF0dXM6IHJlc3VsdHMuZmFpbGVkQ291bnQgPT09IDAgPyAnY29tcGxldGVkJyA6ICdwYXJ0aWFsX3N1Y2Nlc3MnLFxuICAgICAgcmVzdWx0OiB7XG4gICAgICAgIHRlbXBsYXRlX2lkOiB0ZW1wbGF0ZUlkLFxuICAgICAgICB0b3RhbDogcmVjaXBpZW50cy5sZW5ndGgsXG4gICAgICAgIHByb2Nlc3NlZDogcmVzdWx0cy5wcm9jZXNzZWRDb3VudCxcbiAgICAgICAgcXVldWVkOiByZXN1bHRzLnF1ZXVlZENvdW50LFxuICAgICAgICBmYWlsZWQ6IHJlc3VsdHMuZmFpbGVkQ291bnQsXG4gICAgICAgIGJ1bGtfam9iX2lkOiBidWxrTWVzc2FnZUpvYklkLFxuICAgICAgICBkdXJhdGlvbjogZHVyYXRpb25cbiAgICAgIH0sXG4gICAgICBlcnJvcl9kZXRhaWxzOlxuICAgICAgICByZXN1bHRzLmVycm9ycy5sZW5ndGggPiAwID8geyBlcnJvcnM6IHJlc3VsdHMuZXJyb3JzIH0gOiBudWxsLFxuICAgICAgc3RhcnRlZF9hdDogbmV3IERhdGUoc3RhcnRUaW1lKS50b0lTT1N0cmluZygpLFxuICAgICAgY29tcGxldGVkX2F0OiBuZXcgRGF0ZShlbmRUaW1lKS50b0lTT1N0cmluZygpXG4gICAgfSk7XG5cbiAgICBjb25zb2xlLmxvZyhcbiAgICAgIGBbVGVtcGxhdGVQcm9jZXNzaW5nXSBKb2IgJHtqb2IuaWR9IGNvbXBsZXRlZDogJHtyZXN1bHRzLnByb2Nlc3NlZENvdW50fSBwcm9jZXNzZWQsICR7cmVzdWx0cy5xdWV1ZWRDb3VudH0gcXVldWVkLCAke3Jlc3VsdHMuZmFpbGVkQ291bnR9IGZhaWxlZCwgJHtkdXJhdGlvbn1tc2BcbiAgICApO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIGpvYklkOiBqb2IuaWQ/LnRvU3RyaW5nKCkgfHwgJycsXG4gICAgICBvcmdhbml6YXRpb25JZCxcbiAgICAgIHRlbXBsYXRlSWQsXG4gICAgICB0b3RhbFJlY2lwaWVudHM6IHJlY2lwaWVudHMubGVuZ3RoLFxuICAgICAgcHJvY2Vzc2VkQ291bnQ6IHJlc3VsdHMucHJvY2Vzc2VkQ291bnQsXG4gICAgICBxdWV1ZWRDb3VudDogcmVzdWx0cy5xdWV1ZWRDb3VudCxcbiAgICAgIGZhaWxlZENvdW50OiByZXN1bHRzLmZhaWxlZENvdW50LFxuICAgICAgZXJyb3JzOiByZXN1bHRzLmVycm9ycyxcbiAgICAgIGJ1bGtNZXNzYWdlSm9iSWQsXG4gICAgICBzdGFydGVkQXQ6IG5ldyBEYXRlKHN0YXJ0VGltZSkudG9JU09TdHJpbmcoKSxcbiAgICAgIGNvbXBsZXRlZEF0OiBuZXcgRGF0ZShlbmRUaW1lKS50b0lTT1N0cmluZygpLFxuICAgICAgZHVyYXRpb25cbiAgICB9O1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnN0IGVuZFRpbWUgPSBEYXRlLm5vdygpO1xuICAgIGNvbnN0IGR1cmF0aW9uID0gZW5kVGltZSAtIHN0YXJ0VGltZTtcblxuICAgIC8vIExvZyBmYWlsdXJlXG4gICAgY29uc3Qgc3VwYWJhc2UgPSBhd2FpdCBjcmVhdGVDbGllbnQoKTtcbiAgICBhd2FpdCBzdXBhYmFzZS5mcm9tKCdqb2JfbG9ncycpLmluc2VydCh7XG4gICAgICBqb2JfaWQ6IGpvYi5pZD8udG9TdHJpbmcoKSxcbiAgICAgIGpvYl90eXBlOiAndGVtcGxhdGVfcHJvY2Vzc2luZycsXG4gICAgICBvcmdhbml6YXRpb25faWQ6IG9yZ2FuaXphdGlvbklkLFxuICAgICAgdXNlcl9pZDogdXNlcklkLFxuICAgICAgc3RhdHVzOiAnZmFpbGVkJyxcbiAgICAgIHJlc3VsdDoge1xuICAgICAgICB0ZW1wbGF0ZV9pZDogdGVtcGxhdGVJZCxcbiAgICAgICAgdG90YWw6IHJlY2lwaWVudHMubGVuZ3RoLFxuICAgICAgICBwcm9jZXNzZWQ6IDAsXG4gICAgICAgIGZhaWxlZDogcmVjaXBpZW50cy5sZW5ndGgsXG4gICAgICAgIGR1cmF0aW9uOiBkdXJhdGlvblxuICAgICAgfSxcbiAgICAgIGVycm9yX2RldGFpbHM6IHtcbiAgICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ1Vua25vd24gZXJyb3InXG4gICAgICB9LFxuICAgICAgc3RhcnRlZF9hdDogbmV3IERhdGUoc3RhcnRUaW1lKS50b0lTT1N0cmluZygpLFxuICAgICAgY29tcGxldGVkX2F0OiBuZXcgRGF0ZShlbmRUaW1lKS50b0lTT1N0cmluZygpXG4gICAgfSk7XG5cbiAgICB0aHJvdyBlcnJvcjtcbiAgfVxufVxuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7SUF3RVU7SUFBQUEsYUFBQSxZQUFBQSxDQUFBO01BQUEsT0FBQUMsY0FBQTtJQUFBO0VBQUE7RUFBQSxPQUFBQSxjQUFBO0FBQUE7QUFBQUQsYUFBQTtB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