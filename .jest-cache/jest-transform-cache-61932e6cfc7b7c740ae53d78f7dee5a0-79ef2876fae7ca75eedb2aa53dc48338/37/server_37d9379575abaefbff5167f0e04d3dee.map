{"version":3,"names":["SUBSCRIPTION_PLANS","cov_2crn53ipo0","f","s","StripeService","stripe","_buildsafeinit","createBuildSafeService","_stripe","default","requireEnvVar","apiVersion","starter","id","name","description","price","interval","stripePriceId","features","limits","maxUsers","maxContacts","maxMessages","automationRules","professional","enterprise","createCustomer","organizationId","email","supabase","_server","createClient","data","organization","from","select","eq","single","stripe_customer_id","b","customer","customers","create","metadata","update","createCheckoutSession","planId","customerId","plan","Error","sessionParams","mode","payment_method_types","line_items","quantity","success_url","process","env","NEXT_PUBLIC_APP_URL","cancel_url","session","checkout","sessions","createPortalSession","billingPortal","return_url","getSubscription","subscriptionId","subscriptions","retrieve","expand","cancelSubscription","cancel","updateSubscription","subscription","items","proration_behavior","handleWebhook","rawBody","signature","endpointSecret","event","webhooks","constructEvent","error","processWebhookEvent","type","handleCheckoutCompleted","object","handleSubscriptionUpdated","handleSubscriptionDeleted","handlePaymentFailed","console","log","stripe_subscription_id","subscription_status","subscription_tier","key","Object","entries","status","invoice","getPlanLimits","checkUsageLimits","count","userCount","contactCount","Promise","all","head","startOfMonth","Date","setDate","setHours","messageCount","gte","toISOString","users","current","limit","unlimited","contacts","messages"],"sources":["C:\\Ai Projecten\\ADSapp\\src\\lib\\stripe\\server.ts"],"sourcesContent":["import Stripe from 'stripe'\nimport { createClient } from '@/lib/supabase/server'\nimport { requireEnvVar, createBuildSafeService } from '@/lib/build-safe-init'\n\n// Build-safe Stripe client initialization\nconst stripe = createBuildSafeService(() => {\n  return new Stripe(requireEnvVar('STRIPE_SECRET_KEY'), {\n    apiVersion: '2024-12-18.acacia',\n  })\n}, 'Stripe')\n\n// Build-safe subscription plans configuration\nexport const SUBSCRIPTION_PLANS = {\n  starter: {\n    id: 'starter',\n    name: 'Starter',\n    description: 'Perfect for small businesses',\n    price: 29,\n    interval: 'month' as const,\n    stripePriceId: requireEnvVar('STRIPE_STARTER_PRICE_ID'),\n    features: [\n      '1,000 messages/month',\n      '3 team members',\n      'Basic automation',\n      'Standard support',\n      'WhatsApp integration',\n    ],\n    limits: {\n      maxUsers: 3,\n      maxContacts: 1000,\n      maxMessages: 1000,\n      automationRules: 5,\n    }\n  },\n  professional: {\n    id: 'professional',\n    name: 'Professional',\n    description: 'For growing teams',\n    price: 79,\n    interval: 'month' as const,\n    stripePriceId: requireEnvVar('STRIPE_PROFESSIONAL_PRICE_ID'),\n    features: [\n      '10,000 messages/month',\n      '10 team members',\n      'Advanced automation',\n      'Priority support',\n      'WhatsApp integration',\n      'Analytics & reports',\n      'Custom templates',\n    ],\n    limits: {\n      maxUsers: 10,\n      maxContacts: 10000,\n      maxMessages: 10000,\n      automationRules: 20,\n    }\n  },\n  enterprise: {\n    id: 'enterprise',\n    name: 'Enterprise',\n    description: 'For large organizations',\n    price: 199,\n    interval: 'month' as const,\n    stripePriceId: requireEnvVar('STRIPE_ENTERPRISE_PRICE_ID'),\n    features: [\n      'Unlimited messages',\n      'Unlimited team members',\n      'Custom automation',\n      '24/7 phone support',\n      'WhatsApp integration',\n      'Advanced analytics',\n      'Custom integrations',\n      'SSO & security',\n    ],\n    limits: {\n      maxUsers: -1, // unlimited\n      maxContacts: -1,\n      maxMessages: -1,\n      automationRules: -1,\n    }\n  }\n}\n\nexport class StripeService {\n  static async createCustomer(organizationId: string, email: string, name: string) {\n    const supabase = await createClient()\n\n    // Check if customer already exists\n    const { data: organization } = await supabase\n      .from('organizations')\n      .select('stripe_customer_id')\n      .eq('id', organizationId)\n      .single()\n\n    if (organization?.stripe_customer_id) {\n      return organization.stripe_customer_id\n    }\n\n    // Create new Stripe customer\n    const customer = await stripe.customers.create({\n      email,\n      name,\n      metadata: {\n        organizationId,\n      },\n    })\n\n    // Update organization with customer ID\n    await supabase\n      .from('organizations')\n      .update({ stripe_customer_id: customer.id })\n      .eq('id', organizationId)\n\n    return customer.id\n  }\n\n  static async createCheckoutSession(\n    organizationId: string,\n    planId: keyof typeof SUBSCRIPTION_PLANS,\n    customerId?: string\n  ) {\n    const plan = SUBSCRIPTION_PLANS[planId]\n    if (!plan) {\n      throw new Error('Invalid plan ID')\n    }\n\n    const sessionParams: Stripe.Checkout.SessionCreateParams = {\n      mode: 'subscription',\n      payment_method_types: ['card'],\n      line_items: [\n        {\n          price: plan.stripePriceId,\n          quantity: 1,\n        },\n      ],\n      success_url: `${process.env.NEXT_PUBLIC_APP_URL}/dashboard/settings/billing?session_id={CHECKOUT_SESSION_ID}`,\n      cancel_url: `${process.env.NEXT_PUBLIC_APP_URL}/dashboard/settings/billing`,\n      metadata: {\n        organizationId,\n        planId,\n      },\n    }\n\n    if (customerId) {\n      sessionParams.customer = customerId\n    }\n\n    const session = await stripe.checkout.sessions.create(sessionParams)\n    return session\n  }\n\n  static async createPortalSession(customerId: string) {\n    const session = await stripe.billingPortal.sessions.create({\n      customer: customerId,\n      return_url: `${process.env.NEXT_PUBLIC_APP_URL}/dashboard/settings/billing`,\n    })\n\n    return session\n  }\n\n  static async getSubscription(subscriptionId: string) {\n    return await stripe.subscriptions.retrieve(subscriptionId, {\n      expand: ['default_payment_method'],\n    })\n  }\n\n  static async cancelSubscription(subscriptionId: string) {\n    return await stripe.subscriptions.cancel(subscriptionId)\n  }\n\n  static async updateSubscription(\n    subscriptionId: string,\n    planId: keyof typeof SUBSCRIPTION_PLANS\n  ) {\n    const plan = SUBSCRIPTION_PLANS[planId]\n    const subscription = await stripe.subscriptions.retrieve(subscriptionId)\n\n    return await stripe.subscriptions.update(subscriptionId, {\n      items: [\n        {\n          id: subscription.items.data[0].id,\n          price: plan.stripePriceId,\n        },\n      ],\n      proration_behavior: 'create_prorations',\n    })\n  }\n\n  static async handleWebhook(\n    rawBody: string,\n    signature: string\n  ): Promise<Stripe.Event> {\n    const endpointSecret = requireEnvVar('STRIPE_WEBHOOK_SECRET')\n\n    try {\n      const event = stripe.webhooks.constructEvent(\n        rawBody,\n        signature,\n        endpointSecret\n      )\n\n      return event\n    } catch (error) {\n      throw new Error(`Webhook signature verification failed: ${error}`)\n    }\n  }\n\n  static async processWebhookEvent(event: Stripe.Event) {\n    const supabase = await createClient()\n\n    switch (event.type) {\n      case 'checkout.session.completed':\n        await this.handleCheckoutCompleted(event.data.object as Stripe.Checkout.Session)\n        break\n\n      case 'customer.subscription.updated':\n      case 'customer.subscription.created':\n        await this.handleSubscriptionUpdated(event.data.object as Stripe.Subscription)\n        break\n\n      case 'customer.subscription.deleted':\n        await this.handleSubscriptionDeleted(event.data.object as Stripe.Subscription)\n        break\n\n      case 'invoice.payment_failed':\n        await this.handlePaymentFailed(event.data.object as Stripe.Invoice)\n        break\n\n      default:\n        console.log(`Unhandled webhook event type: ${event.type}`)\n    }\n  }\n\n  private static async handleCheckoutCompleted(session: Stripe.Checkout.Session) {\n    const supabase = await createClient()\n    const { organizationId, planId } = session.metadata!\n\n    if (session.subscription) {\n      // Update organization with subscription details\n      await supabase\n        .from('organizations')\n        .update({\n          stripe_customer_id: session.customer as string,\n          stripe_subscription_id: session.subscription as string,\n          subscription_status: 'active',\n          subscription_tier: planId,\n        })\n        .eq('id', organizationId)\n    }\n  }\n\n  private static async handleSubscriptionUpdated(subscription: Stripe.Subscription) {\n    const supabase = await createClient()\n    const organizationId = subscription.metadata.organizationId\n\n    if (!organizationId) return\n\n    // Determine plan from price ID\n    let planId: keyof typeof SUBSCRIPTION_PLANS = 'starter'\n    for (const [key, plan] of Object.entries(SUBSCRIPTION_PLANS)) {\n      if (subscription.items.data[0]?.price.id === plan.stripePriceId) {\n        planId = key as keyof typeof SUBSCRIPTION_PLANS\n        break\n      }\n    }\n\n    await supabase\n      .from('organizations')\n      .update({\n        subscription_status: subscription.status === 'active' ? 'active' :\n                           subscription.status === 'past_due' ? 'past_due' :\n                           subscription.status === 'canceled' ? 'cancelled' : 'active',\n        subscription_tier: planId,\n      })\n      .eq('id', organizationId)\n  }\n\n  private static async handleSubscriptionDeleted(subscription: Stripe.Subscription) {\n    const supabase = await createClient()\n    const organizationId = subscription.metadata.organizationId\n\n    if (!organizationId) return\n\n    await supabase\n      .from('organizations')\n      .update({\n        subscription_status: 'cancelled',\n        stripe_subscription_id: null,\n      })\n      .eq('id', organizationId)\n  }\n\n  private static async handlePaymentFailed(invoice: Stripe.Invoice) {\n    const supabase = await createClient()\n\n    if (!invoice.subscription) return\n\n    const subscription = await stripe.subscriptions.retrieve(invoice.subscription as string)\n    const organizationId = subscription.metadata.organizationId\n\n    if (!organizationId) return\n\n    await supabase\n      .from('organizations')\n      .update({\n        subscription_status: 'past_due',\n      })\n      .eq('id', organizationId)\n\n    // TODO: Send email notification to organization owner\n  }\n\n  static getPlanLimits(planId: string) {\n    const plan = SUBSCRIPTION_PLANS[planId as keyof typeof SUBSCRIPTION_PLANS]\n    return plan?.limits || SUBSCRIPTION_PLANS.starter.limits\n  }\n\n  static async checkUsageLimits(organizationId: string) {\n    const supabase = await createClient()\n\n    const { data: organization } = await supabase\n      .from('organizations')\n      .select('subscription_tier')\n      .eq('id', organizationId)\n      .single()\n\n    if (!organization) return null\n\n    const limits = this.getPlanLimits(organization.subscription_tier)\n\n    // Get current usage\n    const [\n      { count: userCount },\n      { count: contactCount },\n    ] = await Promise.all([\n      supabase\n        .from('profiles')\n        .select('*', { count: 'exact', head: true })\n        .eq('organization_id', organizationId),\n\n      supabase\n        .from('contacts')\n        .select('*', { count: 'exact', head: true })\n        .eq('organization_id', organizationId),\n    ])\n\n    // Get message count for current month\n    const startOfMonth = new Date()\n    startOfMonth.setDate(1)\n    startOfMonth.setHours(0, 0, 0, 0)\n\n    const { count: messageCount } = await supabase\n      .from('messages')\n      .select('*, conversation!inner(*)', { count: 'exact', head: true })\n      .eq('conversation.organization_id', organizationId)\n      .gte('created_at', startOfMonth.toISOString())\n\n    return {\n      users: {\n        current: userCount || 0,\n        limit: limits.maxUsers,\n        unlimited: limits.maxUsers === -1,\n      },\n      contacts: {\n        current: contactCount || 0,\n        limit: limits.maxContacts,\n        unlimited: limits.maxContacts === -1,\n      },\n      messages: {\n        current: messageCount || 0,\n        limit: limits.maxMessages,\n        unlimited: limits.maxMessages === -1,\n      },\n    }\n  }\n}\n\nexport { stripe }"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}