6fb825455c2b574614c8e1b9fdcd24d0
"use strict";

/* istanbul ignore next */
function cov_16wlsq8v2i() {
  var path = "C:\\Ai Projecten\\ADSapp\\src\\app\\api\\onboarding\\route.ts";
  var hash = "ee5d60be04095e48e4738fce6d77d2dc072653e5";
  var global = new Function("return this")();
  var gcv = "__coverage__";
  var coverageData = {
    path: "C:\\Ai Projecten\\ADSapp\\src\\app\\api\\onboarding\\route.ts",
    statementMap: {
      "0": {
        start: {
          line: 2,
          column: 0
        },
        end: {
          line: 4,
          column: 3
        }
      },
      "1": {
        start: {
          line: 5,
          column: 0
        },
        end: {
          line: 10,
          column: 3
        }
      },
      "2": {
        start: {
          line: 8,
          column: 8
        },
        end: {
          line: 8,
          column: 20
        }
      },
      "3": {
        start: {
          line: 11,
          column: 16
        },
        end: {
          line: 11,
          column: 38
        }
      },
      "4": {
        start: {
          line: 12,
          column: 17
        },
        end: {
          line: 12,
          column: 56
        }
      },
      "5": {
        start: {
          line: 14,
          column: 4
        },
        end: {
          line: 150,
          column: 5
        }
      },
      "6": {
        start: {
          line: 15,
          column: 21
        },
        end: {
          line: 15,
          column: 41
        }
      },
      "7": {
        start: {
          line: 16,
          column: 8
        },
        end: {
          line: 19,
          column: 11
        }
      },
      "8": {
        start: {
          line: 20,
          column: 112
        },
        end: {
          line: 20,
          column: 116
        }
      },
      "9": {
        start: {
          line: 22,
          column: 8
        },
        end: {
          line: 28,
          column: 9
        }
      },
      "10": {
        start: {
          line: 23,
          column: 12
        },
        end: {
          line: 27,
          column: 15
        }
      },
      "11": {
        start: {
          line: 30,
          column: 8
        },
        end: {
          line: 40,
          column: 9
        }
      },
      "12": {
        start: {
          line: 35,
          column: 12
        },
        end: {
          line: 39,
          column: 15
        }
      },
      "13": {
        start: {
          line: 42,
          column: 25
        },
        end: {
          line: 42,
          column: 59
        }
      },
      "14": {
        start: {
          line: 44,
          column: 53
        },
        end: {
          line: 44,
          column: 82
        }
      },
      "15": {
        start: {
          line: 45,
          column: 8
        },
        end: {
          line: 52,
          column: 9
        }
      },
      "16": {
        start: {
          line: 46,
          column: 12
        },
        end: {
          line: 46,
          column: 52
        }
      },
      "17": {
        start: {
          line: 47,
          column: 12
        },
        end: {
          line: 51,
          column: 15
        }
      },
      "18": {
        start: {
          line: 53,
          column: 8
        },
        end: {
          line: 53,
          column: 64
        }
      },
      "19": {
        start: {
          line: 55,
          column: 68
        },
        end: {
          line: 55,
          column: 152
        }
      },
      "20": {
        start: {
          line: 56,
          column: 8
        },
        end: {
          line: 63,
          column: 9
        }
      },
      "21": {
        start: {
          line: 57,
          column: 12
        },
        end: {
          line: 57,
          column: 69
        }
      },
      "22": {
        start: {
          line: 58,
          column: 12
        },
        end: {
          line: 62,
          column: 15
        }
      },
      "23": {
        start: {
          line: 64,
          column: 8
        },
        end: {
          line: 70,
          column: 9
        }
      },
      "24": {
        start: {
          line: 65,
          column: 12
        },
        end: {
          line: 69,
          column: 15
        }
      },
      "25": {
        start: {
          line: 72,
          column: 60
        },
        end: {
          line: 72,
          column: 140
        }
      },
      "26": {
        start: {
          line: 73,
          column: 8
        },
        end: {
          line: 80,
          column: 9
        }
      },
      "27": {
        start: {
          line: 74,
          column: 12
        },
        end: {
          line: 74,
          column: 70
        }
      },
      "28": {
        start: {
          line: 75,
          column: 12
        },
        end: {
          line: 79,
          column: 15
        }
      },
      "29": {
        start: {
          line: 81,
          column: 8
        },
        end: {
          line: 87,
          column: 9
        }
      },
      "30": {
        start: {
          line: 82,
          column: 12
        },
        end: {
          line: 86,
          column: 15
        }
      },
      "31": {
        start: {
          line: 89,
          column: 8
        },
        end: {
          line: 89,
          column: 48
        }
      },
      "32": {
        start: {
          line: 91,
          column: 59
        },
        end: {
          line: 98,
          column: 28
        }
      },
      "33": {
        start: {
          line: 99,
          column: 8
        },
        end: {
          line: 106,
          column: 9
        }
      },
      "34": {
        start: {
          line: 100,
          column: 12
        },
        end: {
          line: 100,
          column: 68
        }
      },
      "35": {
        start: {
          line: 101,
          column: 12
        },
        end: {
          line: 105,
          column: 15
        }
      },
      "36": {
        start: {
          line: 107,
          column: 8
        },
        end: {
          line: 107,
          column: 65
        }
      },
      "37": {
        start: {
          line: 109,
          column: 62
        },
        end: {
          line: 114,
          column: 46
        }
      },
      "38": {
        start: {
          line: 115,
          column: 8
        },
        end: {
          line: 124,
          column: 9
        }
      },
      "39": {
        start: {
          line: 116,
          column: 12
        },
        end: {
          line: 116,
          column: 65
        }
      },
      "40": {
        start: {
          line: 118,
          column: 12
        },
        end: {
          line: 118,
          column: 87
        }
      },
      "41": {
        start: {
          line: 119,
          column: 12
        },
        end: {
          line: 123,
          column: 15
        }
      },
      "42": {
        start: {
          line: 125,
          column: 8
        },
        end: {
          line: 125,
          column: 52
        }
      },
      "43": {
        start: {
          line: 127,
          column: 8
        },
        end: {
          line: 142,
          column: 11
        }
      },
      "44": {
        start: {
          line: 144,
          column: 8
        },
        end: {
          line: 144,
          column: 54
        }
      },
      "45": {
        start: {
          line: 145,
          column: 8
        },
        end: {
          line: 149,
          column: 11
        }
      }
    },
    fnMap: {
      "0": {
        name: "(anonymous_0)",
        decl: {
          start: {
            line: 7,
            column: 9
          },
          end: {
            line: 7,
            column: 10
          }
        },
        loc: {
          start: {
            line: 7,
            column: 20
          },
          end: {
            line: 9,
            column: 5
          }
        },
        line: 7
      },
      "1": {
        name: "POST",
        decl: {
          start: {
            line: 13,
            column: 15
          },
          end: {
            line: 13,
            column: 19
          }
        },
        loc: {
          start: {
            line: 13,
            column: 29
          },
          end: {
            line: 151,
            column: 1
          }
        },
        line: 13
      }
    },
    branchMap: {
      "0": {
        loc: {
          start: {
            line: 18,
            column: 39
          },
          end: {
            line: 18,
            column: 91
          }
        },
        type: "cond-expr",
        locations: [{
          start: {
            line: 18,
            column: 72
          },
          end: {
            line: 18,
            column: 84
          }
        }, {
          start: {
            line: 18,
            column: 87
          },
          end: {
            line: 18,
            column: 91
          }
        }],
        line: 18
      },
      "1": {
        loc: {
          start: {
            line: 22,
            column: 8
          },
          end: {
            line: 28,
            column: 9
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 22,
            column: 8
          },
          end: {
            line: 28,
            column: 9
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 22
      },
      "2": {
        loc: {
          start: {
            line: 22,
            column: 12
          },
          end: {
            line: 22,
            column: 65
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 22,
            column: 12
          },
          end: {
            line: 22,
            column: 29
          }
        }, {
          start: {
            line: 22,
            column: 33
          },
          end: {
            line: 22,
            column: 43
          }
        }, {
          start: {
            line: 22,
            column: 47
          },
          end: {
            line: 22,
            column: 56
          }
        }, {
          start: {
            line: 22,
            column: 60
          },
          end: {
            line: 22,
            column: 65
          }
        }],
        line: 22
      },
      "3": {
        loc: {
          start: {
            line: 30,
            column: 8
          },
          end: {
            line: 40,
            column: 9
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 30,
            column: 8
          },
          end: {
            line: 40,
            column: 9
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 30
      },
      "4": {
        loc: {
          start: {
            line: 45,
            column: 8
          },
          end: {
            line: 52,
            column: 9
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 45,
            column: 8
          },
          end: {
            line: 52,
            column: 9
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 45
      },
      "5": {
        loc: {
          start: {
            line: 45,
            column: 12
          },
          end: {
            line: 45,
            column: 30
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 45,
            column: 12
          },
          end: {
            line: 45,
            column: 21
          }
        }, {
          start: {
            line: 45,
            column: 25
          },
          end: {
            line: 45,
            column: 30
          }
        }],
        line: 45
      },
      "6": {
        loc: {
          start: {
            line: 56,
            column: 8
          },
          end: {
            line: 63,
            column: 9
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 56,
            column: 8
          },
          end: {
            line: 63,
            column: 9
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 56
      },
      "7": {
        loc: {
          start: {
            line: 56,
            column: 12
          },
          end: {
            line: 56,
            column: 70
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 56,
            column: 12
          },
          end: {
            line: 56,
            column: 29
          }
        }, {
          start: {
            line: 56,
            column: 33
          },
          end: {
            line: 56,
            column: 70
          }
        }],
        line: 56
      },
      "8": {
        loc: {
          start: {
            line: 64,
            column: 8
          },
          end: {
            line: 70,
            column: 9
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 64,
            column: 8
          },
          end: {
            line: 70,
            column: 9
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 64
      },
      "9": {
        loc: {
          start: {
            line: 73,
            column: 8
          },
          end: {
            line: 80,
            column: 9
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 73,
            column: 8
          },
          end: {
            line: 80,
            column: 9
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 73
      },
      "10": {
        loc: {
          start: {
            line: 73,
            column: 12
          },
          end: {
            line: 73,
            column: 62
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 73,
            column: 12
          },
          end: {
            line: 73,
            column: 25
          }
        }, {
          start: {
            line: 73,
            column: 29
          },
          end: {
            line: 73,
            column: 62
          }
        }],
        line: 73
      },
      "11": {
        loc: {
          start: {
            line: 81,
            column: 8
          },
          end: {
            line: 87,
            column: 9
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 81,
            column: 8
          },
          end: {
            line: 87,
            column: 9
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 81
      },
      "12": {
        loc: {
          start: {
            line: 94,
            column: 38
          },
          end: {
            line: 94,
            column: 65
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 94,
            column: 38
          },
          end: {
            line: 94,
            column: 57
          }
        }, {
          start: {
            line: 94,
            column: 61
          },
          end: {
            line: 94,
            column: 65
          }
        }],
        line: 94
      },
      "13": {
        loc: {
          start: {
            line: 95,
            column: 42
          },
          end: {
            line: 95,
            column: 75
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 95,
            column: 42
          },
          end: {
            line: 95,
            column: 67
          }
        }, {
          start: {
            line: 95,
            column: 71
          },
          end: {
            line: 95,
            column: 75
          }
        }],
        line: 95
      },
      "14": {
        loc: {
          start: {
            line: 99,
            column: 8
          },
          end: {
            line: 106,
            column: 9
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 99,
            column: 8
          },
          end: {
            line: 106,
            column: 9
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 99
      },
      "15": {
        loc: {
          start: {
            line: 99,
            column: 12
          },
          end: {
            line: 99,
            column: 40
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 99,
            column: 12
          },
          end: {
            line: 99,
            column: 20
          }
        }, {
          start: {
            line: 99,
            column: 24
          },
          end: {
            line: 99,
            column: 40
          }
        }],
        line: 99
      },
      "16": {
        loc: {
          start: {
            line: 102,
            column: 57
          },
          end: {
            line: 102,
            column: 93
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 102,
            column: 57
          },
          end: {
            line: 102,
            column: 74
          }
        }, {
          start: {
            line: 102,
            column: 78
          },
          end: {
            line: 102,
            column: 93
          }
        }],
        line: 102
      },
      "17": {
        loc: {
          start: {
            line: 115,
            column: 8
          },
          end: {
            line: 124,
            column: 9
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 115,
            column: 8
          },
          end: {
            line: 124,
            column: 9
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 115
      }
    },
    s: {
      "0": 0,
      "1": 0,
      "2": 0,
      "3": 0,
      "4": 0,
      "5": 0,
      "6": 0,
      "7": 0,
      "8": 0,
      "9": 0,
      "10": 0,
      "11": 0,
      "12": 0,
      "13": 0,
      "14": 0,
      "15": 0,
      "16": 0,
      "17": 0,
      "18": 0,
      "19": 0,
      "20": 0,
      "21": 0,
      "22": 0,
      "23": 0,
      "24": 0,
      "25": 0,
      "26": 0,
      "27": 0,
      "28": 0,
      "29": 0,
      "30": 0,
      "31": 0,
      "32": 0,
      "33": 0,
      "34": 0,
      "35": 0,
      "36": 0,
      "37": 0,
      "38": 0,
      "39": 0,
      "40": 0,
      "41": 0,
      "42": 0,
      "43": 0,
      "44": 0,
      "45": 0
    },
    f: {
      "0": 0,
      "1": 0
    },
    b: {
      "0": [0, 0],
      "1": [0, 0],
      "2": [0, 0, 0, 0],
      "3": [0, 0],
      "4": [0, 0],
      "5": [0, 0],
      "6": [0, 0],
      "7": [0, 0],
      "8": [0, 0],
      "9": [0, 0],
      "10": [0, 0],
      "11": [0, 0],
      "12": [0, 0],
      "13": [0, 0],
      "14": [0, 0],
      "15": [0, 0],
      "16": [0, 0],
      "17": [0, 0]
    },
    inputSourceMap: {
      version: 3,
      sources: ["C:\\Ai Projecten\\ADSapp\\src\\app\\api\\onboarding\\route.ts"],
      sourcesContent: ["import { NextRequest, NextResponse } from 'next/server'\nimport { createClient } from '@/lib/supabase/server'\n\nexport async function POST(request: NextRequest) {\n  try {\n    const body = await request.json()\n    console.log('Onboarding request received:', { ...body, whatsappBusinessAccountId: body.whatsappBusinessAccountId ? '[REDACTED]' : null })\n\n    const {\n      organizationName,\n      subdomain,\n      whatsappPhoneNumber,\n      whatsappBusinessAccountId,\n      fullName,\n      role,\n    } = body\n\n    // Validate required fields\n    if (!organizationName || !subdomain || !fullName || !role) {\n      return NextResponse.json(\n        { error: 'Missing required fields: organizationName, subdomain, fullName, and role are required' },\n        { status: 400 }\n      )\n    }\n\n    // Validate role\n    if (!['owner', 'admin', 'agent'].includes(role)) {\n      return NextResponse.json(\n        { error: 'Invalid role. Must be owner, admin, or agent' },\n        { status: 400 }\n      )\n    }\n\n    // Create Supabase client\n    const supabase = await createClient()\n\n    // Get current authenticated user\n    const { data: { user }, error: authError } = await supabase.auth.getUser()\n\n    if (authError || !user) {\n      console.error('Auth error:', authError)\n      return NextResponse.json(\n        { error: 'You must be authenticated to complete onboarding' },\n        { status: 401 }\n      )\n    }\n\n    console.log('Authenticated user:', user.id, user.email)\n\n    // Check if user already has an organization\n    const { data: existingProfile, error: profileCheckError } = await supabase\n      .from('profiles')\n      .select('organization_id')\n      .eq('id', user.id)\n      .single()\n\n    if (profileCheckError && profileCheckError.code !== 'PGRST116') {\n      console.error('Profile check error:', profileCheckError)\n      return NextResponse.json(\n        { error: 'Failed to check existing profile' },\n        { status: 500 }\n      )\n    }\n\n    if (existingProfile?.organization_id) {\n      return NextResponse.json(\n        { error: 'You are already part of an organization' },\n        { status: 400 }\n      )\n    }\n\n    // Check if subdomain is already taken\n    const { data: existingOrg, error: orgCheckError } = await supabase\n      .from('organizations')\n      .select('id')\n      .eq('slug', subdomain)\n      .single()\n\n    if (orgCheckError && orgCheckError.code !== 'PGRST116') {\n      console.error('Organization check error:', orgCheckError)\n      return NextResponse.json(\n        { error: 'Failed to validate subdomain' },\n        { status: 500 }\n      )\n    }\n\n    if (existingOrg) {\n      return NextResponse.json(\n        { error: 'This subdomain is already taken. Please choose another one.' },\n        { status: 400 }\n      )\n    }\n\n    // Start transaction: Create organization and update profile\n    console.log('Creating organization...')\n\n    // Step 1: Create organization\n    const { data: newOrganization, error: orgError } = await supabase\n      .from('organizations')\n      .insert({\n        name: organizationName,\n        slug: subdomain,\n        whatsapp_phone_number_id: whatsappPhoneNumber || null,\n        whatsapp_business_account_id: whatsappBusinessAccountId || null,\n        subscription_status: 'trial',\n        subscription_tier: 'starter',\n      })\n      .select()\n      .single()\n\n    if (orgError || !newOrganization) {\n      console.error('Organization creation error:', orgError)\n      return NextResponse.json(\n        { error: `Failed to create organization: ${orgError?.message || 'Unknown error'}` },\n        { status: 500 }\n      )\n    }\n\n    console.log('Organization created:', newOrganization.id)\n\n    // Step 2: Update user profile\n    const { data: updatedProfile, error: profileError } = await supabase\n      .from('profiles')\n      .update({\n        organization_id: newOrganization.id,\n        full_name: fullName,\n        role: role,\n        updated_at: new Date().toISOString(),\n      })\n      .eq('id', user.id)\n      .select()\n      .single()\n\n    if (profileError) {\n      console.error('Profile update error:', profileError)\n\n      // Rollback: Delete the created organization\n      await supabase\n        .from('organizations')\n        .delete()\n        .eq('id', newOrganization.id)\n\n      return NextResponse.json(\n        { error: `Failed to update profile: ${profileError.message}` },\n        { status: 500 }\n      )\n    }\n\n    console.log('Profile updated successfully')\n\n    // Success response\n    return NextResponse.json({\n      success: true,\n      message: 'Onboarding completed successfully',\n      data: {\n        organization: {\n          id: newOrganization.id,\n          name: newOrganization.name,\n          slug: newOrganization.slug,\n        },\n        profile: {\n          id: updatedProfile.id,\n          full_name: updatedProfile.full_name,\n          role: updatedProfile.role,\n        },\n      },\n    })\n  } catch (error) {\n    console.error('Onboarding API error:', error)\n    return NextResponse.json(\n      { error: 'An unexpected error occurred during onboarding' },\n      { status: 500 }\n    )\n  }\n}"],
      names: ["POST", "request", "body", "json", "console", "log", "whatsappBusinessAccountId", "organizationName", "subdomain", "whatsappPhoneNumber", "fullName", "role", "NextResponse", "error", "status", "includes", "supabase", "createClient", "data", "user", "authError", "auth", "getUser", "id", "email", "existingProfile", "profileCheckError", "from", "select", "eq", "single", "code", "organization_id", "existingOrg", "orgCheckError", "newOrganization", "orgError", "insert", "name", "slug", "whatsapp_phone_number_id", "whatsapp_business_account_id", "subscription_status", "subscription_tier", "message", "updatedProfile", "profileError", "update", "full_name", "updated_at", "Date", "toISOString", "delete", "success", "organization", "profile"],
      mappings: "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"
    },
    _coverageSchema: "1a1c01bbd47fc00a2c39e90264f33305004495a9",
    hash: "ee5d60be04095e48e4738fce6d77d2dc072653e5"
  };
  var coverage = global[gcv] || (global[gcv] = {});
  if (!coverage[path] || coverage[path].hash !== hash) {
    coverage[path] = coverageData;
  }
  var actualCoverage = coverage[path];
  {
    // @ts-ignore
    cov_16wlsq8v2i = function () {
      return actualCoverage;
    };
  }
  return actualCoverage;
}
cov_16wlsq8v2i();
cov_16wlsq8v2i().s[0]++;
Object.defineProperty(exports, "__esModule", {
  value: true
});
/* istanbul ignore next */
cov_16wlsq8v2i().s[1]++;
Object.defineProperty(exports, "POST", {
  enumerable: true,
  get: function () {
    /* istanbul ignore next */
    cov_16wlsq8v2i().f[0]++;
    cov_16wlsq8v2i().s[2]++;
    return POST;
  }
});
const _server =
/* istanbul ignore next */
(cov_16wlsq8v2i().s[3]++, require("next/server"));
const _server1 =
/* istanbul ignore next */
(cov_16wlsq8v2i().s[4]++, require("../../../lib/supabase/server"));
async function POST(request) {
  /* istanbul ignore next */
  cov_16wlsq8v2i().f[1]++;
  cov_16wlsq8v2i().s[5]++;
  try {
    const body =
    /* istanbul ignore next */
    (cov_16wlsq8v2i().s[6]++, await request.json());
    /* istanbul ignore next */
    cov_16wlsq8v2i().s[7]++;
    console.log('Onboarding request received:', {
      ...body,
      whatsappBusinessAccountId: body.whatsappBusinessAccountId ?
      /* istanbul ignore next */
      (cov_16wlsq8v2i().b[0][0]++, '[REDACTED]') :
      /* istanbul ignore next */
      (cov_16wlsq8v2i().b[0][1]++, null)
    });
    const {
      organizationName,
      subdomain,
      whatsappPhoneNumber,
      whatsappBusinessAccountId,
      fullName,
      role
    } =
    /* istanbul ignore next */
    (cov_16wlsq8v2i().s[8]++, body);
    // Validate required fields
    /* istanbul ignore next */
    cov_16wlsq8v2i().s[9]++;
    if (
    /* istanbul ignore next */
    (cov_16wlsq8v2i().b[2][0]++, !organizationName) ||
    /* istanbul ignore next */
    (cov_16wlsq8v2i().b[2][1]++, !subdomain) ||
    /* istanbul ignore next */
    (cov_16wlsq8v2i().b[2][2]++, !fullName) ||
    /* istanbul ignore next */
    (cov_16wlsq8v2i().b[2][3]++, !role)) {
      /* istanbul ignore next */
      cov_16wlsq8v2i().b[1][0]++;
      cov_16wlsq8v2i().s[10]++;
      return _server.NextResponse.json({
        error: 'Missing required fields: organizationName, subdomain, fullName, and role are required'
      }, {
        status: 400
      });
    } else
    /* istanbul ignore next */
    {
      cov_16wlsq8v2i().b[1][1]++;
    }
    // Validate role
    cov_16wlsq8v2i().s[11]++;
    if (!['owner', 'admin', 'agent'].includes(role)) {
      /* istanbul ignore next */
      cov_16wlsq8v2i().b[3][0]++;
      cov_16wlsq8v2i().s[12]++;
      return _server.NextResponse.json({
        error: 'Invalid role. Must be owner, admin, or agent'
      }, {
        status: 400
      });
    } else
    /* istanbul ignore next */
    {
      cov_16wlsq8v2i().b[3][1]++;
    }
    // Create Supabase client
    const supabase =
    /* istanbul ignore next */
    (cov_16wlsq8v2i().s[13]++, await (0, _server1.createClient)());
    // Get current authenticated user
    const {
      data: {
        user
      },
      error: authError
    } =
    /* istanbul ignore next */
    (cov_16wlsq8v2i().s[14]++, await supabase.auth.getUser());
    /* istanbul ignore next */
    cov_16wlsq8v2i().s[15]++;
    if (
    /* istanbul ignore next */
    (cov_16wlsq8v2i().b[5][0]++, authError) ||
    /* istanbul ignore next */
    (cov_16wlsq8v2i().b[5][1]++, !user)) {
      /* istanbul ignore next */
      cov_16wlsq8v2i().b[4][0]++;
      cov_16wlsq8v2i().s[16]++;
      console.error('Auth error:', authError);
      /* istanbul ignore next */
      cov_16wlsq8v2i().s[17]++;
      return _server.NextResponse.json({
        error: 'You must be authenticated to complete onboarding'
      }, {
        status: 401
      });
    } else
    /* istanbul ignore next */
    {
      cov_16wlsq8v2i().b[4][1]++;
    }
    cov_16wlsq8v2i().s[18]++;
    console.log('Authenticated user:', user.id, user.email);
    // Check if user already has an organization
    const {
      data: existingProfile,
      error: profileCheckError
    } =
    /* istanbul ignore next */
    (cov_16wlsq8v2i().s[19]++, await supabase.from('profiles').select('organization_id').eq('id', user.id).single());
    /* istanbul ignore next */
    cov_16wlsq8v2i().s[20]++;
    if (
    /* istanbul ignore next */
    (cov_16wlsq8v2i().b[7][0]++, profileCheckError) &&
    /* istanbul ignore next */
    (cov_16wlsq8v2i().b[7][1]++, profileCheckError.code !== 'PGRST116')) {
      /* istanbul ignore next */
      cov_16wlsq8v2i().b[6][0]++;
      cov_16wlsq8v2i().s[21]++;
      console.error('Profile check error:', profileCheckError);
      /* istanbul ignore next */
      cov_16wlsq8v2i().s[22]++;
      return _server.NextResponse.json({
        error: 'Failed to check existing profile'
      }, {
        status: 500
      });
    } else
    /* istanbul ignore next */
    {
      cov_16wlsq8v2i().b[6][1]++;
    }
    cov_16wlsq8v2i().s[23]++;
    if (existingProfile?.organization_id) {
      /* istanbul ignore next */
      cov_16wlsq8v2i().b[8][0]++;
      cov_16wlsq8v2i().s[24]++;
      return _server.NextResponse.json({
        error: 'You are already part of an organization'
      }, {
        status: 400
      });
    } else
    /* istanbul ignore next */
    {
      cov_16wlsq8v2i().b[8][1]++;
    }
    // Check if subdomain is already taken
    const {
      data: existingOrg,
      error: orgCheckError
    } =
    /* istanbul ignore next */
    (cov_16wlsq8v2i().s[25]++, await supabase.from('organizations').select('id').eq('slug', subdomain).single());
    /* istanbul ignore next */
    cov_16wlsq8v2i().s[26]++;
    if (
    /* istanbul ignore next */
    (cov_16wlsq8v2i().b[10][0]++, orgCheckError) &&
    /* istanbul ignore next */
    (cov_16wlsq8v2i().b[10][1]++, orgCheckError.code !== 'PGRST116')) {
      /* istanbul ignore next */
      cov_16wlsq8v2i().b[9][0]++;
      cov_16wlsq8v2i().s[27]++;
      console.error('Organization check error:', orgCheckError);
      /* istanbul ignore next */
      cov_16wlsq8v2i().s[28]++;
      return _server.NextResponse.json({
        error: 'Failed to validate subdomain'
      }, {
        status: 500
      });
    } else
    /* istanbul ignore next */
    {
      cov_16wlsq8v2i().b[9][1]++;
    }
    cov_16wlsq8v2i().s[29]++;
    if (existingOrg) {
      /* istanbul ignore next */
      cov_16wlsq8v2i().b[11][0]++;
      cov_16wlsq8v2i().s[30]++;
      return _server.NextResponse.json({
        error: 'This subdomain is already taken. Please choose another one.'
      }, {
        status: 400
      });
    } else
    /* istanbul ignore next */
    {
      cov_16wlsq8v2i().b[11][1]++;
    }
    // Start transaction: Create organization and update profile
    cov_16wlsq8v2i().s[31]++;
    console.log('Creating organization...');
    // Step 1: Create organization
    const {
      data: newOrganization,
      error: orgError
    } =
    /* istanbul ignore next */
    (cov_16wlsq8v2i().s[32]++, await supabase.from('organizations').insert({
      name: organizationName,
      slug: subdomain,
      whatsapp_phone_number_id:
      /* istanbul ignore next */
      (cov_16wlsq8v2i().b[12][0]++, whatsappPhoneNumber) ||
      /* istanbul ignore next */
      (cov_16wlsq8v2i().b[12][1]++, null),
      whatsapp_business_account_id:
      /* istanbul ignore next */
      (cov_16wlsq8v2i().b[13][0]++, whatsappBusinessAccountId) ||
      /* istanbul ignore next */
      (cov_16wlsq8v2i().b[13][1]++, null),
      subscription_status: 'trial',
      subscription_tier: 'starter'
    }).select().single());
    /* istanbul ignore next */
    cov_16wlsq8v2i().s[33]++;
    if (
    /* istanbul ignore next */
    (cov_16wlsq8v2i().b[15][0]++, orgError) ||
    /* istanbul ignore next */
    (cov_16wlsq8v2i().b[15][1]++, !newOrganization)) {
      /* istanbul ignore next */
      cov_16wlsq8v2i().b[14][0]++;
      cov_16wlsq8v2i().s[34]++;
      console.error('Organization creation error:', orgError);
      /* istanbul ignore next */
      cov_16wlsq8v2i().s[35]++;
      return _server.NextResponse.json({
        error: `Failed to create organization: ${
        /* istanbul ignore next */
        (cov_16wlsq8v2i().b[16][0]++, orgError?.message) ||
        /* istanbul ignore next */
        (cov_16wlsq8v2i().b[16][1]++, 'Unknown error')}`
      }, {
        status: 500
      });
    } else
    /* istanbul ignore next */
    {
      cov_16wlsq8v2i().b[14][1]++;
    }
    cov_16wlsq8v2i().s[36]++;
    console.log('Organization created:', newOrganization.id);
    // Step 2: Update user profile
    const {
      data: updatedProfile,
      error: profileError
    } =
    /* istanbul ignore next */
    (cov_16wlsq8v2i().s[37]++, await supabase.from('profiles').update({
      organization_id: newOrganization.id,
      full_name: fullName,
      role: role,
      updated_at: new Date().toISOString()
    }).eq('id', user.id).select().single());
    /* istanbul ignore next */
    cov_16wlsq8v2i().s[38]++;
    if (profileError) {
      /* istanbul ignore next */
      cov_16wlsq8v2i().b[17][0]++;
      cov_16wlsq8v2i().s[39]++;
      console.error('Profile update error:', profileError);
      // Rollback: Delete the created organization
      /* istanbul ignore next */
      cov_16wlsq8v2i().s[40]++;
      await supabase.from('organizations').delete().eq('id', newOrganization.id);
      /* istanbul ignore next */
      cov_16wlsq8v2i().s[41]++;
      return _server.NextResponse.json({
        error: `Failed to update profile: ${profileError.message}`
      }, {
        status: 500
      });
    } else
    /* istanbul ignore next */
    {
      cov_16wlsq8v2i().b[17][1]++;
    }
    cov_16wlsq8v2i().s[42]++;
    console.log('Profile updated successfully');
    // Success response
    /* istanbul ignore next */
    cov_16wlsq8v2i().s[43]++;
    return _server.NextResponse.json({
      success: true,
      message: 'Onboarding completed successfully',
      data: {
        organization: {
          id: newOrganization.id,
          name: newOrganization.name,
          slug: newOrganization.slug
        },
        profile: {
          id: updatedProfile.id,
          full_name: updatedProfile.full_name,
          role: updatedProfile.role
        }
      }
    });
  } catch (error) {
    /* istanbul ignore next */
    cov_16wlsq8v2i().s[44]++;
    console.error('Onboarding API error:', error);
    /* istanbul ignore next */
    cov_16wlsq8v2i().s[45]++;
    return _server.NextResponse.json({
      error: 'An unexpected error occurred during onboarding'
    }, {
      status: 500
    });
  }
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJjb3ZfMTZ3bHNxOHYyaSIsImFjdHVhbENvdmVyYWdlIiwicyIsIlBPU1QiLCJyZXF1ZXN0IiwiZiIsImJvZHkiLCJqc29uIiwiY29uc29sZSIsImxvZyIsIndoYXRzYXBwQnVzaW5lc3NBY2NvdW50SWQiLCJiIiwib3JnYW5pemF0aW9uTmFtZSIsInN1YmRvbWFpbiIsIndoYXRzYXBwUGhvbmVOdW1iZXIiLCJmdWxsTmFtZSIsInJvbGUiLCJfc2VydmVyIiwiTmV4dFJlc3BvbnNlIiwiZXJyb3IiLCJzdGF0dXMiLCJpbmNsdWRlcyIsInN1cGFiYXNlIiwiX3NlcnZlcjEiLCJjcmVhdGVDbGllbnQiLCJkYXRhIiwidXNlciIsImF1dGhFcnJvciIsImF1dGgiLCJnZXRVc2VyIiwiaWQiLCJlbWFpbCIsImV4aXN0aW5nUHJvZmlsZSIsInByb2ZpbGVDaGVja0Vycm9yIiwiZnJvbSIsInNlbGVjdCIsImVxIiwic2luZ2xlIiwiY29kZSIsIm9yZ2FuaXphdGlvbl9pZCIsImV4aXN0aW5nT3JnIiwib3JnQ2hlY2tFcnJvciIsIm5ld09yZ2FuaXphdGlvbiIsIm9yZ0Vycm9yIiwiaW5zZXJ0IiwibmFtZSIsInNsdWciLCJ3aGF0c2FwcF9waG9uZV9udW1iZXJfaWQiLCJ3aGF0c2FwcF9idXNpbmVzc19hY2NvdW50X2lkIiwic3Vic2NyaXB0aW9uX3N0YXR1cyIsInN1YnNjcmlwdGlvbl90aWVyIiwibWVzc2FnZSIsInVwZGF0ZWRQcm9maWxlIiwicHJvZmlsZUVycm9yIiwidXBkYXRlIiwiZnVsbF9uYW1lIiwidXBkYXRlZF9hdCIsIkRhdGUiLCJ0b0lTT1N0cmluZyIsImRlbGV0ZSIsInN1Y2Nlc3MiLCJvcmdhbml6YXRpb24iLCJwcm9maWxlIl0sInNvdXJjZXMiOlsiQzpcXEFpIFByb2plY3RlblxcQURTYXBwXFxzcmNcXGFwcFxcYXBpXFxvbmJvYXJkaW5nXFxyb3V0ZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBOZXh0UmVxdWVzdCwgTmV4dFJlc3BvbnNlIH0gZnJvbSAnbmV4dC9zZXJ2ZXInXG5pbXBvcnQgeyBjcmVhdGVDbGllbnQgfSBmcm9tICdAL2xpYi9zdXBhYmFzZS9zZXJ2ZXInXG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBQT1NUKHJlcXVlc3Q6IE5leHRSZXF1ZXN0KSB7XG4gIHRyeSB7XG4gICAgY29uc3QgYm9keSA9IGF3YWl0IHJlcXVlc3QuanNvbigpXG4gICAgY29uc29sZS5sb2coJ09uYm9hcmRpbmcgcmVxdWVzdCByZWNlaXZlZDonLCB7IC4uLmJvZHksIHdoYXRzYXBwQnVzaW5lc3NBY2NvdW50SWQ6IGJvZHkud2hhdHNhcHBCdXNpbmVzc0FjY291bnRJZCA/ICdbUkVEQUNURURdJyA6IG51bGwgfSlcblxuICAgIGNvbnN0IHtcbiAgICAgIG9yZ2FuaXphdGlvbk5hbWUsXG4gICAgICBzdWJkb21haW4sXG4gICAgICB3aGF0c2FwcFBob25lTnVtYmVyLFxuICAgICAgd2hhdHNhcHBCdXNpbmVzc0FjY291bnRJZCxcbiAgICAgIGZ1bGxOYW1lLFxuICAgICAgcm9sZSxcbiAgICB9ID0gYm9keVxuXG4gICAgLy8gVmFsaWRhdGUgcmVxdWlyZWQgZmllbGRzXG4gICAgaWYgKCFvcmdhbml6YXRpb25OYW1lIHx8ICFzdWJkb21haW4gfHwgIWZ1bGxOYW1lIHx8ICFyb2xlKSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHsgZXJyb3I6ICdNaXNzaW5nIHJlcXVpcmVkIGZpZWxkczogb3JnYW5pemF0aW9uTmFtZSwgc3ViZG9tYWluLCBmdWxsTmFtZSwgYW5kIHJvbGUgYXJlIHJlcXVpcmVkJyB9LFxuICAgICAgICB7IHN0YXR1czogNDAwIH1cbiAgICAgIClcbiAgICB9XG5cbiAgICAvLyBWYWxpZGF0ZSByb2xlXG4gICAgaWYgKCFbJ293bmVyJywgJ2FkbWluJywgJ2FnZW50J10uaW5jbHVkZXMocm9sZSkpIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAgeyBlcnJvcjogJ0ludmFsaWQgcm9sZS4gTXVzdCBiZSBvd25lciwgYWRtaW4sIG9yIGFnZW50JyB9LFxuICAgICAgICB7IHN0YXR1czogNDAwIH1cbiAgICAgIClcbiAgICB9XG5cbiAgICAvLyBDcmVhdGUgU3VwYWJhc2UgY2xpZW50XG4gICAgY29uc3Qgc3VwYWJhc2UgPSBhd2FpdCBjcmVhdGVDbGllbnQoKVxuXG4gICAgLy8gR2V0IGN1cnJlbnQgYXV0aGVudGljYXRlZCB1c2VyXG4gICAgY29uc3QgeyBkYXRhOiB7IHVzZXIgfSwgZXJyb3I6IGF1dGhFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2UuYXV0aC5nZXRVc2VyKClcblxuICAgIGlmIChhdXRoRXJyb3IgfHwgIXVzZXIpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0F1dGggZXJyb3I6JywgYXV0aEVycm9yKVxuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICB7IGVycm9yOiAnWW91IG11c3QgYmUgYXV0aGVudGljYXRlZCB0byBjb21wbGV0ZSBvbmJvYXJkaW5nJyB9LFxuICAgICAgICB7IHN0YXR1czogNDAxIH1cbiAgICAgIClcbiAgICB9XG5cbiAgICBjb25zb2xlLmxvZygnQXV0aGVudGljYXRlZCB1c2VyOicsIHVzZXIuaWQsIHVzZXIuZW1haWwpXG5cbiAgICAvLyBDaGVjayBpZiB1c2VyIGFscmVhZHkgaGFzIGFuIG9yZ2FuaXphdGlvblxuICAgIGNvbnN0IHsgZGF0YTogZXhpc3RpbmdQcm9maWxlLCBlcnJvcjogcHJvZmlsZUNoZWNrRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgICAuZnJvbSgncHJvZmlsZXMnKVxuICAgICAgLnNlbGVjdCgnb3JnYW5pemF0aW9uX2lkJylcbiAgICAgIC5lcSgnaWQnLCB1c2VyLmlkKVxuICAgICAgLnNpbmdsZSgpXG5cbiAgICBpZiAocHJvZmlsZUNoZWNrRXJyb3IgJiYgcHJvZmlsZUNoZWNrRXJyb3IuY29kZSAhPT0gJ1BHUlNUMTE2Jykge1xuICAgICAgY29uc29sZS5lcnJvcignUHJvZmlsZSBjaGVjayBlcnJvcjonLCBwcm9maWxlQ2hlY2tFcnJvcilcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAgeyBlcnJvcjogJ0ZhaWxlZCB0byBjaGVjayBleGlzdGluZyBwcm9maWxlJyB9LFxuICAgICAgICB7IHN0YXR1czogNTAwIH1cbiAgICAgIClcbiAgICB9XG5cbiAgICBpZiAoZXhpc3RpbmdQcm9maWxlPy5vcmdhbml6YXRpb25faWQpIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAgeyBlcnJvcjogJ1lvdSBhcmUgYWxyZWFkeSBwYXJ0IG9mIGFuIG9yZ2FuaXphdGlvbicgfSxcbiAgICAgICAgeyBzdGF0dXM6IDQwMCB9XG4gICAgICApXG4gICAgfVxuXG4gICAgLy8gQ2hlY2sgaWYgc3ViZG9tYWluIGlzIGFscmVhZHkgdGFrZW5cbiAgICBjb25zdCB7IGRhdGE6IGV4aXN0aW5nT3JnLCBlcnJvcjogb3JnQ2hlY2tFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAgIC5mcm9tKCdvcmdhbml6YXRpb25zJylcbiAgICAgIC5zZWxlY3QoJ2lkJylcbiAgICAgIC5lcSgnc2x1ZycsIHN1YmRvbWFpbilcbiAgICAgIC5zaW5nbGUoKVxuXG4gICAgaWYgKG9yZ0NoZWNrRXJyb3IgJiYgb3JnQ2hlY2tFcnJvci5jb2RlICE9PSAnUEdSU1QxMTYnKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdPcmdhbml6YXRpb24gY2hlY2sgZXJyb3I6Jywgb3JnQ2hlY2tFcnJvcilcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAgeyBlcnJvcjogJ0ZhaWxlZCB0byB2YWxpZGF0ZSBzdWJkb21haW4nIH0sXG4gICAgICAgIHsgc3RhdHVzOiA1MDAgfVxuICAgICAgKVxuICAgIH1cblxuICAgIGlmIChleGlzdGluZ09yZykge1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICB7IGVycm9yOiAnVGhpcyBzdWJkb21haW4gaXMgYWxyZWFkeSB0YWtlbi4gUGxlYXNlIGNob29zZSBhbm90aGVyIG9uZS4nIH0sXG4gICAgICAgIHsgc3RhdHVzOiA0MDAgfVxuICAgICAgKVxuICAgIH1cblxuICAgIC8vIFN0YXJ0IHRyYW5zYWN0aW9uOiBDcmVhdGUgb3JnYW5pemF0aW9uIGFuZCB1cGRhdGUgcHJvZmlsZVxuICAgIGNvbnNvbGUubG9nKCdDcmVhdGluZyBvcmdhbml6YXRpb24uLi4nKVxuXG4gICAgLy8gU3RlcCAxOiBDcmVhdGUgb3JnYW5pemF0aW9uXG4gICAgY29uc3QgeyBkYXRhOiBuZXdPcmdhbml6YXRpb24sIGVycm9yOiBvcmdFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAgIC5mcm9tKCdvcmdhbml6YXRpb25zJylcbiAgICAgIC5pbnNlcnQoe1xuICAgICAgICBuYW1lOiBvcmdhbml6YXRpb25OYW1lLFxuICAgICAgICBzbHVnOiBzdWJkb21haW4sXG4gICAgICAgIHdoYXRzYXBwX3Bob25lX251bWJlcl9pZDogd2hhdHNhcHBQaG9uZU51bWJlciB8fCBudWxsLFxuICAgICAgICB3aGF0c2FwcF9idXNpbmVzc19hY2NvdW50X2lkOiB3aGF0c2FwcEJ1c2luZXNzQWNjb3VudElkIHx8IG51bGwsXG4gICAgICAgIHN1YnNjcmlwdGlvbl9zdGF0dXM6ICd0cmlhbCcsXG4gICAgICAgIHN1YnNjcmlwdGlvbl90aWVyOiAnc3RhcnRlcicsXG4gICAgICB9KVxuICAgICAgLnNlbGVjdCgpXG4gICAgICAuc2luZ2xlKClcblxuICAgIGlmIChvcmdFcnJvciB8fCAhbmV3T3JnYW5pemF0aW9uKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdPcmdhbml6YXRpb24gY3JlYXRpb24gZXJyb3I6Jywgb3JnRXJyb3IpXG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHsgZXJyb3I6IGBGYWlsZWQgdG8gY3JlYXRlIG9yZ2FuaXphdGlvbjogJHtvcmdFcnJvcj8ubWVzc2FnZSB8fCAnVW5rbm93biBlcnJvcid9YCB9LFxuICAgICAgICB7IHN0YXR1czogNTAwIH1cbiAgICAgIClcbiAgICB9XG5cbiAgICBjb25zb2xlLmxvZygnT3JnYW5pemF0aW9uIGNyZWF0ZWQ6JywgbmV3T3JnYW5pemF0aW9uLmlkKVxuXG4gICAgLy8gU3RlcCAyOiBVcGRhdGUgdXNlciBwcm9maWxlXG4gICAgY29uc3QgeyBkYXRhOiB1cGRhdGVkUHJvZmlsZSwgZXJyb3I6IHByb2ZpbGVFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAgIC5mcm9tKCdwcm9maWxlcycpXG4gICAgICAudXBkYXRlKHtcbiAgICAgICAgb3JnYW5pemF0aW9uX2lkOiBuZXdPcmdhbml6YXRpb24uaWQsXG4gICAgICAgIGZ1bGxfbmFtZTogZnVsbE5hbWUsXG4gICAgICAgIHJvbGU6IHJvbGUsXG4gICAgICAgIHVwZGF0ZWRfYXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgIH0pXG4gICAgICAuZXEoJ2lkJywgdXNlci5pZClcbiAgICAgIC5zZWxlY3QoKVxuICAgICAgLnNpbmdsZSgpXG5cbiAgICBpZiAocHJvZmlsZUVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdQcm9maWxlIHVwZGF0ZSBlcnJvcjonLCBwcm9maWxlRXJyb3IpXG5cbiAgICAgIC8vIFJvbGxiYWNrOiBEZWxldGUgdGhlIGNyZWF0ZWQgb3JnYW5pemF0aW9uXG4gICAgICBhd2FpdCBzdXBhYmFzZVxuICAgICAgICAuZnJvbSgnb3JnYW5pemF0aW9ucycpXG4gICAgICAgIC5kZWxldGUoKVxuICAgICAgICAuZXEoJ2lkJywgbmV3T3JnYW5pemF0aW9uLmlkKVxuXG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHsgZXJyb3I6IGBGYWlsZWQgdG8gdXBkYXRlIHByb2ZpbGU6ICR7cHJvZmlsZUVycm9yLm1lc3NhZ2V9YCB9LFxuICAgICAgICB7IHN0YXR1czogNTAwIH1cbiAgICAgIClcbiAgICB9XG5cbiAgICBjb25zb2xlLmxvZygnUHJvZmlsZSB1cGRhdGVkIHN1Y2Nlc3NmdWxseScpXG5cbiAgICAvLyBTdWNjZXNzIHJlc3BvbnNlXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHtcbiAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICBtZXNzYWdlOiAnT25ib2FyZGluZyBjb21wbGV0ZWQgc3VjY2Vzc2Z1bGx5JyxcbiAgICAgIGRhdGE6IHtcbiAgICAgICAgb3JnYW5pemF0aW9uOiB7XG4gICAgICAgICAgaWQ6IG5ld09yZ2FuaXphdGlvbi5pZCxcbiAgICAgICAgICBuYW1lOiBuZXdPcmdhbml6YXRpb24ubmFtZSxcbiAgICAgICAgICBzbHVnOiBuZXdPcmdhbml6YXRpb24uc2x1ZyxcbiAgICAgICAgfSxcbiAgICAgICAgcHJvZmlsZToge1xuICAgICAgICAgIGlkOiB1cGRhdGVkUHJvZmlsZS5pZCxcbiAgICAgICAgICBmdWxsX25hbWU6IHVwZGF0ZWRQcm9maWxlLmZ1bGxfbmFtZSxcbiAgICAgICAgICByb2xlOiB1cGRhdGVkUHJvZmlsZS5yb2xlLFxuICAgICAgICB9LFxuICAgICAgfSxcbiAgICB9KVxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ09uYm9hcmRpbmcgQVBJIGVycm9yOicsIGVycm9yKVxuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgIHsgZXJyb3I6ICdBbiB1bmV4cGVjdGVkIGVycm9yIG9jY3VycmVkIGR1cmluZyBvbmJvYXJkaW5nJyB9LFxuICAgICAgeyBzdGF0dXM6IDUwMCB9XG4gICAgKVxuICB9XG59Il0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7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R0FBQVcsQ0FBQTtNQUFBWCxjQUFBLEdBQUFFLENBQUE7TUFDaEJNLE9BQUEsQ0FBUVcsS0FBSyxDQUFDLHlCQUF5QmtDLFlBQUE7TUFFdkM7TUFBQTtNQUFBckQsY0FBQSxHQUFBRSxDQUFBO01BQ0EsTUFBTW9CLFFBQUEsQ0FDSFksSUFBSSxDQUFDLGlCQUNMeUIsTUFBTSxHQUNOdkIsRUFBRSxDQUFDLE1BQU1NLGVBQUEsQ0FBZ0JaLEVBQUU7TUFBQTtNQUFBOUIsY0FBQSxHQUFBRSxDQUFBO01BRTlCLE9BQU9lLE9BQUEsQ0FBQUMsWUFBWSxDQUFDWCxJQUFJLENBQ3RCO1FBQUVZLEtBQUEsRUFBTyw2QkFBNkJrQyxZQUFBLENBQWFGLE9BQU87TUFBRyxHQUM3RDtRQUFFL0IsTUFBQSxFQUFRO01BQUk7SUFFbEI7SUFBQTtJQUFBO01BQUFwQixjQUFBLEdBQUFXLENBQUE7SUFBQTtJQUFBWCxjQUFBLEdBQUFFLENBQUE7SUFFQU0sT0FBQSxDQUFRQyxHQUFHLENBQUM7SUFFWjtJQUFBO0lBQUFULGNBQUEsR0FBQUUsQ0FBQTtJQUNBLE9BQU9lLE9BQUEsQ0FBQUMsWUFBWSxDQUFDWCxJQUFJLENBQUM7TUFDdkJxRCxPQUFBLEVBQVM7TUFDVFQsT0FBQSxFQUFTO01BQ1QxQixJQUFBLEVBQU07UUFDSm9DLFlBQUEsRUFBYztVQUNaL0IsRUFBQSxFQUFJWSxlQUFBLENBQWdCWixFQUFFO1VBQ3RCZSxJQUFBLEVBQU1ILGVBQUEsQ0FBZ0JHLElBQUk7VUFDMUJDLElBQUEsRUFBTUosZUFBQSxDQUFnQkk7UUFDeEI7UUFDQWdCLE9BQUEsRUFBUztVQUNQaEMsRUFBQSxFQUFJc0IsY0FBQSxDQUFldEIsRUFBRTtVQUNyQnlCLFNBQUEsRUFBV0gsY0FBQSxDQUFlRyxTQUFTO1VBQ25DdkMsSUFBQSxFQUFNb0MsY0FBQSxDQUFlcEM7UUFDdkI7TUFDRjtJQUNGO0VBQ0YsRUFBRSxPQUFPRyxLQUFBLEVBQU87SUFBQTtJQUFBbkIsY0FBQSxHQUFBRSxDQUFBO0lBQ2RNLE9BQUEsQ0FBUVcsS0FBSyxDQUFDLHlCQUF5QkEsS0FBQTtJQUFBO0lBQUFuQixjQUFBLEdBQUFFLENBQUE7SUFDdkMsT0FBT2UsT0FBQSxDQUFBQyxZQUFZLENBQUNYLElBQUksQ0FDdEI7TUFBRVksS0FBQSxFQUFPO0lBQWlELEdBQzFEO01BQUVDLE1BQUEsRUFBUTtJQUFJO0VBRWxCO0FBQ0YiLCJpZ25vcmVMaXN0IjpbXX0=