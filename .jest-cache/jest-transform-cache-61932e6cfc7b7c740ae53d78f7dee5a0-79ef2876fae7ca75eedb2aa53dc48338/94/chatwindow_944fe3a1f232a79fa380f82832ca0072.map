{"version":3,"names":["cov_bsmb1or2c","actualCoverage","s","ChatWindow","conversation","profile","onShowDetails","showDetails","f","messages","setMessages","_react","useState","isLoading","setIsLoading","useEffect","id","b","fetchMessages","response","fetch","ok","data","json","error","console","handleSendMessage","content","type","method","headers","body","JSON","stringify","prev","message","Error","getPriorityColor","priority","_jsxruntime","jsxs","className","jsx","contact","name","charAt","toUpperCase","phone_number","slice","Fragment","value","status","onChange","e","log","target","assigned_agent","full_name","onClick","fill","stroke","viewBox","strokeLinecap","strokeLinejoin","strokeWidth","d","_messagelist","MessageList","currentUserId","_messageinput","MessageInput","onSendMessage"],"sources":["C:\\Ai Projecten\\ADSapp\\src\\components\\inbox\\chat-window.tsx"],"sourcesContent":["'use client'\n\nimport { useState, useEffect, useRef } from 'react'\nimport { MessageList } from './message-list'\nimport { MessageInput } from './message-input'\nimport type { ConversationWithDetails, MessageWithSender } from '@/types'\n\ninterface ChatWindowProps {\n  conversation: ConversationWithDetails\n  profile: any\n  onShowDetails: () => void\n  showDetails: boolean\n}\n\nexport function ChatWindow({ conversation, profile, onShowDetails, showDetails }: ChatWindowProps) {\n  const [messages, setMessages] = useState<MessageWithSender[]>([])\n  const [isLoading, setIsLoading] = useState(false)\n\n  // Fetch messages for the conversation\n  useEffect(() => {\n    if (conversation.id) {\n      fetchMessages()\n    }\n  }, [conversation.id])\n\n  const fetchMessages = async () => {\n    setIsLoading(true)\n    try {\n      const response = await fetch(`/api/conversations/${conversation.id}/messages`)\n      if (response.ok) {\n        const data = await response.json()\n        setMessages(data.messages || [])\n      }\n    } catch (error) {\n      console.error('Failed to fetch messages:', error)\n    } finally {\n      setIsLoading(false)\n    }\n  }\n\n  const handleSendMessage = async (content: string, type = 'text') => {\n    try {\n      const response = await fetch(`/api/conversations/${conversation.id}/messages`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({ content, type }),\n      })\n\n      if (response.ok) {\n        const data = await response.json()\n        setMessages(prev => [...prev, data.message])\n      } else {\n        const error = await response.json()\n        throw new Error(error.error || 'Failed to send message')\n      }\n    } catch (error) {\n      console.error('Failed to send message:', error)\n      // TODO: Show error toast\n    }\n  }\n\n  const getPriorityColor = (priority: string) => {\n    switch (priority) {\n      case 'urgent':\n        return 'text-red-600'\n      case 'high':\n        return 'text-orange-600'\n      case 'medium':\n        return 'text-yellow-600'\n      case 'low':\n        return 'text-green-600'\n      default:\n        return 'text-gray-600'\n    }\n  }\n\n  return (\n    <div className=\"flex flex-col h-full\">\n      {/* Chat Header */}\n      <div className=\"px-6 py-4 border-b border-gray-200 bg-white\">\n        <div className=\"flex items-center justify-between\">\n          <div className=\"flex items-center space-x-3\">\n            {/* Contact Avatar */}\n            <div className=\"w-10 h-10 rounded-full bg-green-500 flex items-center justify-center\">\n              <span className=\"text-sm font-medium text-white\">\n                {conversation.contact.name?.charAt(0).toUpperCase() ||\n                 conversation.contact.phone_number.slice(-2).toUpperCase()}\n              </span>\n            </div>\n\n            {/* Contact Info */}\n            <div>\n              <h2 className=\"text-lg font-semibold text-gray-900\">\n                {conversation.contact.name || 'Unknown Contact'}\n              </h2>\n              <div className=\"flex items-center space-x-2 text-sm text-gray-500\">\n                <span>{conversation.contact.phone_number}</span>\n                {conversation.priority !== 'medium' && (\n                  <>\n                    <span>â€¢</span>\n                    <span className={`font-medium ${getPriorityColor(conversation.priority)}`}>\n                      {conversation.priority} priority\n                    </span>\n                  </>\n                )}\n              </div>\n            </div>\n          </div>\n\n          {/* Actions */}\n          <div className=\"flex items-center space-x-2\">\n            {/* Status Dropdown */}\n            <select\n              value={conversation.status}\n              className=\"text-sm border border-gray-300 rounded-md px-3 py-1 bg-white focus:outline-none focus:ring-2 focus:ring-green-500\"\n              onChange={(e) => {\n                // TODO: Update conversation status\n                console.log('Status changed to:', e.target.value)\n              }}\n            >\n              <option value=\"open\">Open</option>\n              <option value=\"pending\">Pending</option>\n              <option value=\"resolved\">Resolved</option>\n              <option value=\"closed\">Closed</option>\n            </select>\n\n            {/* Assign Button */}\n            <button className=\"text-sm text-gray-600 hover:text-gray-900 px-3 py-1 border border-gray-300 rounded-md\">\n              {conversation.assigned_agent\n                ? `Assigned to ${conversation.assigned_agent.full_name}`\n                : 'Assign'\n              }\n            </button>\n\n            {/* Details Toggle */}\n            <button\n              onClick={onShowDetails}\n              className={`p-2 rounded-md hover:bg-gray-100 ${\n                showDetails ? 'bg-green-100 text-green-600' : 'text-gray-600'\n              }`}\n            >\n              <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\n              </svg>\n            </button>\n          </div>\n        </div>\n      </div>\n\n      {/* Messages */}\n      <div className=\"flex-1 overflow-hidden\">\n        {isLoading ? (\n          <div className=\"flex items-center justify-center h-full\">\n            <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-green-600\"></div>\n          </div>\n        ) : (\n          <MessageList messages={messages} currentUserId={profile.id} />\n        )}\n      </div>\n\n      {/* Message Input */}\n      <MessageInput onSendMessage={handleSendMessage} />\n    </div>\n  )\n}"],"mappings":"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","ignoreList":[]}