{"version":3,"sources":["C:\\Ai Projecten\\ADSapp\\tests\\unit\\lib\\cache\\cache-manager.test.ts"],"sourcesContent":["/**\n * Cache Manager Unit Tests\n *\n * Tests the multi-layer cache manager (L1: Memory, L2: Redis, L3: Database)\n * Focuses on cache hit/miss scenarios, TTL expiration, tenant isolation,\n * and error handling.\n */\n\nimport {\n  CacheManager,\n  getCacheManager,\n  resetCacheManager,\n} from '@/lib/cache/cache-manager';\n\n// Mock dependencies\njest.mock('@/lib/cache/l1-cache');\njest.mock('@/lib/cache/redis-client');\n\nimport { L1Cache, getL1Cache } from '@/lib/cache/l1-cache';\nimport * as redisClient from '@/lib/cache/redis-client';\n\ndescribe('CacheManager - Multi-Layer Caching', () => {\n  let cacheManager: CacheManager;\n  let mockL1Cache: jest.Mocked<L1Cache>;\n  let mockRedisGet: jest.MockedFunction<typeof redisClient.getCached>;\n  let mockRedisSet: jest.MockedFunction<typeof redisClient.setCached>;\n  let mockRedisDelete: jest.MockedFunction<typeof redisClient.deleteCached>;\n  let mockRedisDeletePattern: jest.MockedFunction<typeof redisClient.deletePattern>;\n  let mockRedisIsAvailable: jest.MockedFunction<typeof redisClient.isRedisAvailable>;\n\n  beforeEach(() => {\n    // Reset cache manager\n    resetCacheManager();\n\n    // Create mock L1 cache\n    mockL1Cache = {\n      get: jest.fn<any>(),\n      set: jest.fn<any>(),\n      delete: jest.fn<any>(),\n      clear: jest.fn<any>(),\n      has: jest.fn<any>(),\n      keys: jest.fn<any>(),\n      size: jest.fn<any>(),\n      getStats: jest.fn<any>(),\n      resetStats: jest.fn<any>(),\n    } as any;\n\n    // Mock getL1Cache to return our mock\n    (getL1Cache as jest.MockedFunction<typeof getL1Cache>) = jest\n      .fn()\n      .mockReturnValue(mockL1Cache);\n\n    // Mock Redis client functions\n    mockRedisGet = jest.fn() as any;\n    mockRedisSet = jest.fn() as any;\n    mockRedisDelete = jest.fn() as any;\n    mockRedisDeletePattern = jest.fn() as any;\n    mockRedisIsAvailable = jest.fn().mockResolvedValue(true) as any;\n\n    (redisClient.getCached as any) = mockRedisGet;\n    (redisClient.setCached as any) = mockRedisSet;\n    (redisClient.deleteCached as any) = mockRedisDelete;\n    (redisClient.deletePattern as any) = mockRedisDeletePattern;\n    (redisClient.isRedisAvailable as any) = mockRedisIsAvailable;\n\n    // Create fresh cache manager instance\n    cacheManager = new CacheManager({\n      l1Enabled: true,\n      l2Enabled: true,\n      l1TTL: 60,\n      l2TTL: 900,\n      enableMonitoring: false,\n      writeThrough: true,\n      warmOnMiss: true,\n    });\n  });\n\n  afterEach(() => {\n    jest.clearAllMocks();\n    resetCacheManager();\n  });\n\n  describe('L1 Cache (In-Memory)', () => {\n    it('should return cached value from L1 on cache hit', async () => {\n      // Arrange\n      const tenant = 'tenant-1';\n      const resource = 'users';\n      const id = 'user-123';\n      const cachedData = { id: 'user-123', name: 'Test User' };\n      const fetchFn = jest.fn().mockResolvedValue({ id: 'user-123', name: 'Fetched User' });\n\n      mockL1Cache.get.mockReturnValue(cachedData);\n\n      // Act\n      const result = await cacheManager.get(tenant, resource, id, fetchFn);\n\n      // Assert\n      expect(result.data).toEqual(cachedData);\n      expect(result.metadata.source).toBe('l1');\n      expect(mockL1Cache.get).toHaveBeenCalledTimes(1);\n      expect(mockRedisGet).not.toHaveBeenCalled();\n      expect(fetchFn).not.toHaveBeenCalled();\n    });\n\n    it('should miss L1 cache after TTL expiration', async () => {\n      // Arrange\n      const tenant = 'tenant-1';\n      const resource = 'users';\n      const id = 'user-123';\n      const freshData = { id: 'user-123', name: 'Fresh User' };\n      const fetchFn = jest.fn().mockResolvedValue(freshData);\n\n      // L1 miss, L2 miss, fetch from database\n      mockL1Cache.get.mockReturnValue(null);\n      mockRedisGet.mockResolvedValue(null);\n\n      // Act\n      const result = await cacheManager.get(tenant, resource, id, fetchFn);\n\n      // Assert\n      expect(result.data).toEqual(freshData);\n      expect(result.metadata.source).toBe('l3');\n      expect(mockL1Cache.get).toHaveBeenCalled();\n      expect(mockRedisGet).toHaveBeenCalled();\n      expect(fetchFn).toHaveBeenCalledTimes(1);\n    });\n  });\n\n  describe('L2 Cache (Redis)', () => {\n    it('should return cached value from L2 on L1 miss', async () => {\n      // Arrange\n      const tenant = 'tenant-1';\n      const resource = 'organizations';\n      const id = 'org-456';\n      const cachedData = { id: 'org-456', name: 'Test Org' };\n      const fetchFn = jest.fn().mockResolvedValue({ id: 'org-456', name: 'Fetched Org' });\n\n      // L1 miss, L2 hit\n      mockL1Cache.get.mockReturnValue(null);\n      mockRedisGet.mockResolvedValue(cachedData);\n\n      // Act\n      const result = await cacheManager.get(tenant, resource, id, fetchFn);\n\n      // Assert\n      expect(result.data).toEqual(cachedData);\n      expect(result.metadata.source).toBe('l2');\n      expect(mockL1Cache.get).toHaveBeenCalled();\n      expect(mockRedisGet).toHaveBeenCalled();\n      expect(mockL1Cache.set).toHaveBeenCalled(); // Warm L1 cache\n      expect(fetchFn).not.toHaveBeenCalled();\n    });\n\n    it('should fallback to L3 on Redis connection failure', async () => {\n      // Arrange\n      const tenant = 'tenant-1';\n      const resource = 'contacts';\n      const id = 'contact-789';\n      const freshData = { id: 'contact-789', name: 'Fresh Contact' };\n      const fetchFn = jest.fn().mockResolvedValue(freshData);\n\n      // L1 miss, L2 error (Redis unavailable)\n      mockL1Cache.get.mockReturnValue(null);\n      mockRedisGet.mockRejectedValue(new Error('Redis connection failed'));\n\n      // Act\n      const result = await cacheManager.get(tenant, resource, id, fetchFn);\n\n      // Assert\n      expect(result.data).toEqual(freshData);\n      expect(result.metadata.source).toBe('l3');\n      expect(fetchFn).toHaveBeenCalledTimes(1);\n    });\n  });\n\n  describe('L3 Cache (Database)', () => {\n    it('should fetch from database on complete cache miss', async () => {\n      // Arrange\n      const tenant = 'tenant-1';\n      const resource = 'messages';\n      const id = 'msg-999';\n      const databaseData = { id: 'msg-999', content: 'Database Message' };\n      const fetchFn = jest.fn().mockResolvedValue(databaseData);\n\n      // Complete cache miss\n      mockL1Cache.get.mockReturnValue(null);\n      mockRedisGet.mockResolvedValue(null);\n\n      // Act\n      const result = await cacheManager.get(tenant, resource, id, fetchFn);\n\n      // Assert\n      expect(result.data).toEqual(databaseData);\n      expect(result.metadata.source).toBe('l3');\n      expect(fetchFn).toHaveBeenCalledTimes(1);\n      expect(mockL1Cache.set).toHaveBeenCalled(); // Write-through to L1\n      expect(mockRedisSet).toHaveBeenCalled(); // Write-through to L2\n    });\n  });\n\n  describe('Tenant Isolation', () => {\n    it('should not leak data between tenants', async () => {\n      // Arrange\n      const tenant1 = 'tenant-alice';\n      const tenant2 = 'tenant-bob';\n      const resource = 'sensitive-data';\n      const id = 'data-1';\n\n      const tenant1Data = { id: 'data-1', tenant: 'alice', secret: 'alice-secret' };\n      const tenant2Data = { id: 'data-1', tenant: 'bob', secret: 'bob-secret' };\n\n      const fetchFn1 = jest.fn().mockResolvedValue(tenant1Data);\n      const fetchFn2 = jest.fn().mockResolvedValue(tenant2Data);\n\n      // Cache miss for both\n      mockL1Cache.get.mockReturnValue(null);\n      mockRedisGet.mockResolvedValue(null);\n\n      // Act\n      const result1 = await cacheManager.get(tenant1, resource, id, fetchFn1);\n      const result2 = await cacheManager.get(tenant2, resource, id, fetchFn2);\n\n      // Assert\n      expect(result1.data.secret).toBe('alice-secret');\n      expect(result2.data.secret).toBe('bob-secret');\n      expect(result1.metadata.tenant).toBe(tenant1);\n      expect(result2.metadata.tenant).toBe(tenant2);\n      expect(fetchFn1).toHaveBeenCalledTimes(1);\n      expect(fetchFn2).toHaveBeenCalledTimes(1);\n    });\n  });\n\n  describe('Cache Invalidation', () => {\n    it('should invalidate all cache layers for a resource', async () => {\n      // Arrange\n      const tenant = 'tenant-1';\n      const resource = 'users';\n\n      mockL1Cache.keys.mockReturnValue([\n        'tenant-1:users:123',\n        'tenant-1:users:456',\n        'tenant-1:organizations:789',\n      ]);\n      mockRedisDeletePattern.mockResolvedValue(5);\n\n      // Act\n      const deletedCount = await cacheManager.invalidate(tenant, resource);\n\n      // Assert\n      expect(deletedCount).toBeGreaterThan(0);\n      expect(mockL1Cache.delete).toHaveBeenCalled();\n      expect(mockRedisDeletePattern).toHaveBeenCalledWith('tenant-1:users:*');\n    });\n  });\n\n  describe('Performance Metrics', () => {\n    it('should track cache hit rates correctly', async () => {\n      // Arrange\n      const tenant = 'tenant-1';\n      const resource = 'users';\n      const fetchFn = jest.fn().mockResolvedValue({ id: 'user-1', name: 'User' });\n\n      // Simulate: 2 L1 hits, 1 L2 hit, 1 L3 hit (total 4 requests)\n      mockL1Cache.get\n        .mockReturnValueOnce({ id: 'user-1' }) // L1 hit\n        .mockReturnValueOnce({ id: 'user-2' }) // L1 hit\n        .mockReturnValueOnce(null) // L1 miss\n        .mockReturnValueOnce(null); // L1 miss\n\n      mockRedisGet\n        .mockResolvedValueOnce({ id: 'user-3' }) // L2 hit\n        .mockResolvedValueOnce(null); // L2 miss\n\n      // Act\n      await cacheManager.get(tenant, resource, 'user-1', fetchFn);\n      await cacheManager.get(tenant, resource, 'user-2', fetchFn);\n      await cacheManager.get(tenant, resource, 'user-3', fetchFn);\n      await cacheManager.get(tenant, resource, 'user-4', fetchFn);\n\n      const performance = cacheManager.getPerformance();\n\n      // Assert\n      expect(performance.totalRequests).toBe(4);\n      expect(performance.l1Hits).toBe(2);\n      expect(performance.l2Hits).toBe(1);\n      expect(performance.l3Hits).toBe(1);\n      expect(performance.l1HitRate).toBe(50); // 2/4 * 100\n      expect(performance.l2HitRate).toBe(75); // (2+1)/4 * 100\n      expect(performance.averageLatency).toBeGreaterThan(0);\n    });\n  });\n\n  describe('Health Check', () => {\n    it('should report healthy when all layers available', async () => {\n      // Arrange\n      mockRedisIsAvailable.mockResolvedValue(true);\n\n      // Act\n      const health = await cacheManager.healthCheck();\n\n      // Assert\n      expect(health.l1Available).toBe(true);\n      expect(health.l2Available).toBe(true);\n      expect(health.overall).toBe('healthy');\n    });\n\n    it('should report degraded when Redis is unavailable', async () => {\n      // Arrange\n      mockRedisIsAvailable.mockResolvedValue(false);\n\n      // Act\n      const health = await cacheManager.healthCheck();\n\n      // Assert\n      expect(health.l1Available).toBe(true);\n      expect(health.l2Available).toBe(false);\n      expect(health.overall).toBe('degraded');\n    });\n  });\n});\n"],"names":["jest","mock","describe","cacheManager","mockL1Cache","mockRedisGet","mockRedisSet","mockRedisDelete","mockRedisDeletePattern","mockRedisIsAvailable","beforeEach","resetCacheManager","get","fn","set","delete","clear","has","keys","size","getStats","resetStats","getL1Cache","mockReturnValue","mockResolvedValue","redisClient","getCached","setCached","deleteCached","deletePattern","isRedisAvailable","CacheManager","l1Enabled","l2Enabled","l1TTL","l2TTL","enableMonitoring","writeThrough","warmOnMiss","afterEach","clearAllMocks","it","tenant","resource","id","cachedData","name","fetchFn","result","expect","data","toEqual","metadata","source","toBe","toHaveBeenCalledTimes","not","toHaveBeenCalled","freshData","mockRejectedValue","Error","databaseData","content","tenant1","tenant2","tenant1Data","secret","tenant2Data","fetchFn1","fetchFn2","result1","result2","deletedCount","invalidate","toBeGreaterThan","toHaveBeenCalledWith","mockReturnValueOnce","mockResolvedValueOnce","performance","getPerformance","totalRequests","l1Hits","l2Hits","l3Hits","l1HitRate","l2HitRate","averageLatency","health","healthCheck","l1Available","l2Available","overall"],"mappings":"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"}