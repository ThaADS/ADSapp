{"version":3,"sources":["C:\\Ai Projecten\\ADSapp\\tests\\unit\\queue\\job-queue-unit.test.ts"],"sourcesContent":["/**\n * Job Queue Unit Tests\n *\n * Tests for job queue creation, enqueueing, and retry logic with exponential backoff.\n *\n * @module tests/unit/queue/job-queue-unit\n */\n\nimport { QueueManager, CreateJobOptions } from '@/lib/queue/queue-manager';\nimport { QueueName, JobPriority } from '@/lib/queue/bull-config';\n\n// Mock BullMQ\njest.mock('bullmq', () => {\n  const mockJob = {\n    id: 'job-123',\n    name: 'test-job',\n    data: {},\n    progress: 0,\n    attemptsMade: 0,\n    opts: { attempts: 3, delay: 0 },\n    timestamp: Date.now(),\n    getState: jest.fn().mockResolvedValue('waiting'),\n    retry: jest.fn(),\n    remove: jest.fn(),\n  };\n\n  return {\n    Queue: jest.fn().mockImplementation(() => ({\n      add: jest.fn().mockResolvedValue(mockJob),\n      getJob: jest.fn().mockResolvedValue(mockJob),\n      getFailed: jest.fn().mockResolvedValue([]),\n      clean: jest.fn().mockResolvedValue([]),\n      pause: jest.fn(),\n      resume: jest.fn(),\n      close: jest.fn(),\n      name: 'test-queue',\n    })),\n    Worker: jest.fn().mockImplementation(() => ({\n      on: jest.fn(),\n      close: jest.fn(),\n    })),\n    QueueEvents: jest.fn().mockImplementation(() => ({\n      on: jest.fn(),\n      close: jest.fn(),\n    })),\n    Job: mockJob,\n  };\n});\n\n// Mock queue configuration\njest.mock('@/lib/queue/bull-config', () => ({\n  QueueName: {\n    BULK_MESSAGE: 'bulk-message',\n    CONTACT_IMPORT: 'contact-import',\n    TEMPLATE_PROCESSING: 'template-processing',\n    EMAIL_NOTIFICATION: 'email-notification',\n  },\n  JobPriority: {\n    HIGH: 1,\n    NORMAL: 5,\n    LOW: 10,\n  },\n  createQueue: jest.fn((name) => {\n    const { Queue } = require('bullmq');\n    return new Queue();\n  }),\n  createWorker: jest.fn(() => {\n    const { Worker } = require('bullmq');\n    return new Worker();\n  }),\n  createQueueEvents: jest.fn(() => {\n    const { QueueEvents } = require('bullmq');\n    return new QueueEvents();\n  }),\n  getQueueStats: jest.fn().mockResolvedValue({\n    waiting: 0,\n    active: 0,\n    completed: 0,\n    failed: 0,\n    delayed: 0,\n  }),\n  gracefulShutdown: jest.fn(),\n}));\n\n// Mock queue processors\njest.mock('@/lib/queue/processors/bulk-message-processor', () => ({\n  processBulkMessage: jest.fn(),\n}));\njest.mock('@/lib/queue/processors/contact-import-processor', () => ({\n  processContactImport: jest.fn(),\n}));\njest.mock('@/lib/queue/processors/template-processor', () => ({\n  processTemplate: jest.fn(),\n}));\njest.mock('@/lib/queue/processors/email-notification-processor', () => ({\n  processEmailNotification: jest.fn(),\n}));\n\ndescribe('Job Queue', () => {\n  let manager: QueueManager;\n\n  beforeEach(async () => {\n    jest.clearAllMocks();\n    manager = new QueueManager();\n    await manager.initialize();\n  });\n\n  afterEach(async () => {\n    await manager.shutdown();\n  });\n\n  describe('Test 15: Job Creation and Enqueueing', () => {\n    it('should create and enqueue a job successfully', async () => {\n      // Arrange\n      const jobData = {\n        recipients: ['+1234567890'],\n        message: 'Test message',\n        tenantId: 'tenant-123',\n      };\n\n      const options: CreateJobOptions = {\n        priority: JobPriority.NORMAL,\n        attempts: 3,\n      };\n\n      // Act\n      const jobId = await manager.addJob(\n        QueueName.BULK_MESSAGE,\n        'send-bulk-message',\n        jobData,\n        options\n      );\n\n      // Assert\n      expect(jobId).toBeDefined();\n      expect(jobId).toBe('job-123');\n      expect(manager.getQueue(QueueName.BULK_MESSAGE)).toBeDefined();\n    });\n\n    it('should enqueue high priority job with correct priority', async () => {\n      // Arrange\n      const jobData = {\n        recipients: ['+1234567890'],\n        message: 'Urgent message',\n        tenantId: 'tenant-123',\n      };\n\n      const options: CreateJobOptions = {\n        priority: JobPriority.HIGH,\n        attempts: 5,\n      };\n\n      // Act\n      const jobId = await manager.addJob(\n        QueueName.BULK_MESSAGE,\n        'urgent-message',\n        jobData,\n        options\n      );\n\n      // Assert\n      expect(jobId).toBeDefined();\n      const queue = manager.getQueue(QueueName.BULK_MESSAGE);\n      expect(queue).toBeDefined();\n    });\n\n    it('should enqueue job with delay', async () => {\n      // Arrange\n      const jobData = {\n        recipients: ['+1234567890'],\n        message: 'Scheduled message',\n        tenantId: 'tenant-123',\n      };\n\n      const options: CreateJobOptions = {\n        priority: JobPriority.NORMAL,\n        delay: 60000, // 1 minute delay\n        attempts: 3,\n      };\n\n      // Act\n      const jobId = await manager.addJob(\n        QueueName.BULK_MESSAGE,\n        'scheduled-message',\n        jobData,\n        options\n      );\n\n      // Assert\n      expect(jobId).toBeDefined();\n    });\n\n    it('should throw error when enqueueing to non-existent queue', async () => {\n      // Arrange\n      const jobData = { test: 'data' };\n\n      // Act & Assert\n      await expect(\n        manager.addJob('non-existent-queue' as QueueName, 'test', jobData)\n      ).rejects.toThrow('Queue non-existent-queue not initialized');\n    });\n\n    it('should get job information after creation', async () => {\n      // Arrange\n      const jobData = {\n        recipients: ['+1234567890'],\n        message: 'Test message',\n        tenantId: 'tenant-123',\n      };\n\n      // Act\n      const jobId = await manager.addJob(\n        QueueName.BULK_MESSAGE,\n        'test-job',\n        jobData\n      );\n\n      const jobInfo = await manager.getJob(QueueName.BULK_MESSAGE, jobId);\n\n      // Assert\n      expect(jobInfo).toBeDefined();\n      expect(jobInfo?.id).toBe(jobId);\n      expect(jobInfo?.name).toBe('test-job');\n      expect(jobInfo?.state).toBe('waiting');\n    });\n\n    it('should return null for non-existent job', async () => {\n      // Arrange\n      const { Queue } = require('bullmq');\n      const queue = manager.getQueue(QueueName.BULK_MESSAGE);\n      queue.getJob = jest.fn().mockResolvedValue(null);\n\n      // Act\n      const jobInfo = await manager.getJob(QueueName.BULK_MESSAGE, 'non-existent');\n\n      // Assert\n      expect(jobInfo).toBeNull();\n    });\n  });\n\n  describe('Test 16: Job Retry Logic with Exponential Backoff', () => {\n    it('should retry failed job with exponential backoff', async () => {\n      // Arrange\n      const jobData = {\n        recipients: ['+1234567890'],\n        message: 'Test message',\n        tenantId: 'tenant-123',\n      };\n\n      const options: CreateJobOptions = {\n        priority: JobPriority.NORMAL,\n        attempts: 5,\n        backoff: {\n          type: 'exponential',\n          delay: 1000, // Start with 1 second\n        },\n      };\n\n      // Act\n      const jobId = await manager.addJob(\n        QueueName.BULK_MESSAGE,\n        'retry-test',\n        jobData,\n        options\n      );\n\n      // Assert\n      expect(jobId).toBeDefined();\n      const queue = manager.getQueue(QueueName.BULK_MESSAGE);\n      expect(queue).toBeDefined();\n      // Verify that backoff configuration was set\n    });\n\n    it('should retry job manually', async () => {\n      // Arrange\n      const jobData = {\n        recipients: ['+1234567890'],\n        message: 'Failed message',\n        tenantId: 'tenant-123',\n      };\n\n      const jobId = await manager.addJob(\n        QueueName.BULK_MESSAGE,\n        'manual-retry-test',\n        jobData\n      );\n\n      // Act\n      const result = await manager.retryJob(QueueName.BULK_MESSAGE, jobId);\n\n      // Assert\n      expect(result).toBe(true);\n    });\n\n    it('should return false when retrying non-existent job', async () => {\n      // Arrange\n      const { Queue } = require('bullmq');\n      const queue = manager.getQueue(QueueName.BULK_MESSAGE);\n      queue.getJob = jest.fn().mockResolvedValue(null);\n\n      // Act\n      const result = await manager.retryJob(QueueName.BULK_MESSAGE, 'non-existent');\n\n      // Assert\n      expect(result).toBe(false);\n    });\n\n    it('should use fixed backoff strategy', async () => {\n      // Arrange\n      const jobData = {\n        recipients: ['+1234567890'],\n        message: 'Test message',\n        tenantId: 'tenant-123',\n      };\n\n      const options: CreateJobOptions = {\n        priority: JobPriority.NORMAL,\n        attempts: 3,\n        backoff: {\n          type: 'fixed',\n          delay: 5000, // Fixed 5 second delay\n        },\n      };\n\n      // Act\n      const jobId = await manager.addJob(\n        QueueName.BULK_MESSAGE,\n        'fixed-backoff-test',\n        jobData,\n        options\n      );\n\n      // Assert\n      expect(jobId).toBeDefined();\n    });\n\n    it('should handle job cancellation', async () => {\n      // Arrange\n      const jobData = {\n        recipients: ['+1234567890'],\n        message: 'Test message',\n        tenantId: 'tenant-123',\n      };\n\n      const jobId = await manager.addJob(\n        QueueName.BULK_MESSAGE,\n        'cancel-test',\n        jobData\n      );\n\n      // Act\n      const result = await manager.cancelJob(QueueName.BULK_MESSAGE, jobId);\n\n      // Assert\n      expect(result).toBe(true);\n    });\n\n    it('should return false when canceling non-existent job', async () => {\n      // Arrange\n      const { Queue } = require('bullmq');\n      const queue = manager.getQueue(QueueName.BULK_MESSAGE);\n      queue.getJob = jest.fn().mockResolvedValue(null);\n\n      // Act\n      const result = await manager.cancelJob(QueueName.BULK_MESSAGE, 'non-existent');\n\n      // Assert\n      expect(result).toBe(false);\n    });\n\n    it('should get failed jobs list', async () => {\n      // Arrange\n      const mockFailedJobs = [\n        {\n          id: 'failed-job-1',\n          name: 'failed-message',\n          data: { message: 'Failed' },\n          progress: 0,\n          attemptsMade: 3,\n          opts: { attempts: 3, delay: 0 },\n          timestamp: Date.now(),\n          failedReason: 'Network error',\n          getState: jest.fn().mockResolvedValue('failed'),\n        },\n      ];\n\n      const { Queue } = require('bullmq');\n      const queue = manager.getQueue(QueueName.BULK_MESSAGE);\n      queue.getFailed = jest.fn().mockResolvedValue(mockFailedJobs);\n\n      // Act\n      const failedJobs = await manager.getFailedJobs(QueueName.BULK_MESSAGE, 0, 10);\n\n      // Assert\n      expect(failedJobs).toBeDefined();\n      expect(Array.isArray(failedJobs)).toBe(true);\n      expect(failedJobs.length).toBe(1);\n      expect(failedJobs[0].id).toBe('failed-job-1');\n      expect(failedJobs[0].failedReason).toBe('Network error');\n    });\n\n    it('should clean completed jobs', async () => {\n      // Arrange\n      const { Queue } = require('bullmq');\n      const queue = manager.getQueue(QueueName.BULK_MESSAGE);\n      queue.clean = jest.fn().mockResolvedValue(['job-1', 'job-2', 'job-3']);\n\n      // Act\n      const cleanedJobs = await manager.cleanCompletedJobs(\n        QueueName.BULK_MESSAGE,\n        3600000\n      );\n\n      // Assert\n      expect(cleanedJobs).toBeDefined();\n      expect(Array.isArray(cleanedJobs)).toBe(true);\n      expect(cleanedJobs.length).toBe(3);\n    });\n\n    it('should clean failed jobs', async () => {\n      // Arrange\n      const { Queue } = require('bullmq');\n      const queue = manager.getQueue(QueueName.BULK_MESSAGE);\n      queue.clean = jest.fn().mockResolvedValue(['failed-job-1', 'failed-job-2']);\n\n      // Act\n      const cleanedJobs = await manager.cleanFailedJobs(\n        QueueName.BULK_MESSAGE,\n        86400000\n      );\n\n      // Assert\n      expect(cleanedJobs).toBeDefined();\n      expect(Array.isArray(cleanedJobs)).toBe(true);\n      expect(cleanedJobs.length).toBe(2);\n    });\n  });\n});\n"],"names":["jest","mock","mockJob","id","name","data","progress","attemptsMade","opts","attempts","delay","timestamp","Date","now","getState","fn","mockResolvedValue","retry","remove","Queue","mockImplementation","add","getJob","getFailed","clean","pause","resume","close","Worker","on","QueueEvents","Job","QueueName","BULK_MESSAGE","CONTACT_IMPORT","TEMPLATE_PROCESSING","EMAIL_NOTIFICATION","JobPriority","HIGH","NORMAL","LOW","createQueue","require","createWorker","createQueueEvents","getQueueStats","waiting","active","completed","failed","delayed","gracefulShutdown","processBulkMessage","processContactImport","processTemplate","processEmailNotification","describe","manager","beforeEach","clearAllMocks","QueueManager","initialize","afterEach","shutdown","it","jobData","recipients","message","tenantId","options","priority","jobId","addJob","expect","toBeDefined","toBe","getQueue","queue","test","rejects","toThrow","jobInfo","state","toBeNull","backoff","type","result","retryJob","cancelJob","mockFailedJobs","failedReason","failedJobs","getFailedJobs","Array","isArray","length","cleanedJobs","cleanCompletedJobs","cleanFailedJobs"],"mappings":"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"}