{"version":3,"names":["cov_1qxib0gfe2","path","hash","global","Function","gcv","coverageData","statementMap","start","line","column","end","fnMap","name","decl","loc","branchMap","type","locations","undefined","s","f","b","inputSourceMap","version","sources","sourcesContent","names","mappings","_coverageSchema","coverage","actualCoverage","POST","request","supabase","_server1","createClient","body","json","userId","token","_server","NextResponse","error","status","_mfa","isValidMFATokenFormat","result","verifyMFAToken","valid","success","message","console"],"sources":["C:\\Ai Projecten\\ADSapp\\src\\app\\api\\auth\\mfa\\login-verify\\route.ts"],"sourcesContent":["/**\n * MFA Login Verification API Endpoint\n *\n * POST /api/auth/mfa/login-verify\n * Verify MFA token during login flow\n *\n * Security: Used during authentication process (before full session)\n */\n\nimport { NextRequest, NextResponse } from 'next/server';\nimport { createClient } from '@/lib/supabase/server';\nimport { verifyMFAToken, isValidMFATokenFormat } from '@/lib/auth/mfa';\n\nexport async function POST(request: NextRequest) {\n  try {\n    const supabase = await createClient();\n\n    // Parse request body\n    const body = await request.json();\n    const { userId, token } = body;\n\n    if (!userId || typeof userId !== 'string') {\n      return NextResponse.json(\n        { error: 'User ID is required' },\n        { status: 400 }\n      );\n    }\n\n    if (!token || typeof token !== 'string') {\n      return NextResponse.json(\n        { error: 'Verification token is required' },\n        { status: 400 }\n      );\n    }\n\n    // Validate token format\n    if (!isValidMFATokenFormat(token)) {\n      return NextResponse.json(\n        { error: 'Invalid token format. Must be 6 digits or XXXX-XXXX backup code.' },\n        { status: 400 }\n      );\n    }\n\n    // Verify MFA token\n    const result = await verifyMFAToken(userId, token);\n\n    if (!result.valid) {\n      // TODO WEEK 5+: Create audit_logs table for security auditing\n      // Log failed attempt\n      // await supabase.from('audit_logs').insert({\n      //   user_id: userId,\n      //   action: 'mfa_login_failed',\n      //   details: { error: result.error },\n      //   timestamp: new Date().toISOString(),\n      // });\n\n      return NextResponse.json(\n        { error: result.error || 'Invalid verification code' },\n        { status: 401 }\n      );\n    }\n\n    // TODO WEEK 5+: Create audit_logs table for security auditing\n    // Log successful MFA verification\n    // await supabase.from('audit_logs').insert({\n    //   user_id: userId,\n    //   action: 'mfa_login_verified',\n    //   timestamp: new Date().toISOString(),\n    // });\n\n    return NextResponse.json({\n      success: true,\n      message: 'MFA verification successful',\n    });\n  } catch (error) {\n    console.error('[MFA Login Verification Error]:', error);\n\n    return NextResponse.json(\n      { error: 'Failed to verify MFA token' },\n      { status: 500 }\n    );\n  }\n}\n"],"mappings":"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","ignoreList":[]}