{"version":3,"names":["cov_2izbh9vhev","actualCoverage","s","WebSocketClient","f","useWebSocket","constructor","organizationId","ws","reconnectAttempts","maxReconnectAttempts","reconnectDelay","connect","window","b","supabase","_client","createClient","channel","on","event","schema","table","filter","payload","handleNewMessage","new","handleConversationUpdate","subscribe","error","console","scheduleReconnect","message","dispatchEvent","CustomEvent","detail","conversation","setTimeout","disconnect","close","client"],"sources":["C:\\Ai Projecten\\ADSapp\\src\\lib\\websocket\\client.ts"],"sourcesContent":["'use client'\n\nimport { createClient } from '@/lib/supabase/client'\n\nexport class WebSocketClient {\n  private ws: WebSocket | null = null\n  private reconnectAttempts = 0\n  private maxReconnectAttempts = 5\n  private reconnectDelay = 1000\n\n  constructor(private organizationId: string) {}\n\n  connect() {\n    if (typeof window === 'undefined') return\n\n    try {\n      // Use Supabase Realtime for WebSocket connections\n      const supabase = createClient()\n      \n      // Subscribe to real-time changes for messages\n      const channel = supabase\n        .channel(`organization:${this.organizationId}`)\n        .on(\n          'postgres_changes',\n          {\n            event: 'INSERT',\n            schema: 'public',\n            table: 'messages',\n            filter: `organization_id=eq.${this.organizationId}`\n          },\n          (payload) => {\n            this.handleNewMessage(payload.new)\n          }\n        )\n        .on(\n          'postgres_changes',\n          {\n            event: 'UPDATE',\n            schema: 'public',\n            table: 'conversations',\n            filter: `organization_id=eq.${this.organizationId}`\n          },\n          (payload) => {\n            this.handleConversationUpdate(payload.new)\n          }\n        )\n        .subscribe()\n\n      return channel\n    } catch (error) {\n      console.error('WebSocket connection failed:', error)\n      this.scheduleReconnect()\n    }\n  }\n\n  private handleNewMessage(message: Record<string, unknown>) {\n    // Dispatch custom event for new messages\n    window.dispatchEvent(new CustomEvent('newMessage', {\n      detail: message\n    }))\n  }\n\n  private handleConversationUpdate(conversation: Record<string, unknown>) {\n    // Dispatch custom event for conversation updates\n    window.dispatchEvent(new CustomEvent('conversationUpdate', {\n      detail: conversation\n    }))\n  }\n\n  private scheduleReconnect() {\n    if (this.reconnectAttempts < this.maxReconnectAttempts) {\n      setTimeout(() => {\n        this.reconnectAttempts++\n        this.connect()\n      }, this.reconnectDelay * this.reconnectAttempts)\n    }\n  }\n\n  disconnect() {\n    if (this.ws) {\n      this.ws.close()\n      this.ws = null\n    }\n  }\n}\n\n// Hook for using WebSocket in React components\nexport function useWebSocket(organizationId: string) {\n  const client = new WebSocketClient(organizationId)\n  \n  return {\n    connect: () => client.connect(),\n    disconnect: () => client.disconnect()\n  }\n}\n"],"mappings":"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","ignoreList":[]}