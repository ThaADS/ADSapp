{"version":3,"names":["DELETE","cov_2aspsm171v","f","s","GET","PUT","request","params","middlewareResponse","_middleware","standardApiMiddleware","b","organizationId","getTenantContext","id","supabase","_server1","createClient","data","template","error","from","select","eq","single","_server","NextResponse","json","status","usage","order","ascending","limit","last30Days","Date","now","recentUsage","filter","u","created_at","templateWithStats","usageStats","totalUsage","length","lastUsed","_apiutils","createSuccessResponse","console","createErrorResponse","body","name","content","category","variables","whatsappTemplate","submitToWhatsApp","is_active","existingTemplate","updateData","updated_at","toISOString","undefined","whatsappClient","_enhancedclient","getWhatsAppClient","org","whatsapp_business_account_id","whatsapp_template_name","deleteTemplate","warn","whatsappTemplateId","createTemplate","whatsapp_template_id","whatsapp_status","whatsapp_template_data","message","updatedTemplate","update","bulkOps","in","contains","templateId","delete"],"sources":["C:\\Ai Projecten\\ADSapp\\src\\app\\api\\templates\\[id]\\route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server'\nimport { requireAuthenticatedUser, getUserOrganization, createErrorResponse, createSuccessResponse } from '@/lib/api-utils'\nimport { getWhatsAppClient } from '@/lib/whatsapp/enhanced-client'\nimport { createClient } from '@/lib/supabase/server'\nimport { standardApiMiddleware, getTenantContext } from '@/lib/middleware'\n\nexport async function GET(\n  request: NextRequest,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  // Apply standard API middleware (tenant validation + standard rate limiting)\n  const middlewareResponse = await standardApiMiddleware(request);\n  if (middlewareResponse) return middlewareResponse;\n\n  try {\n    // Get tenant context from middleware (already validated)\n    const { organizationId } = getTenantContext(request);\n    const { id } = await params;\n\n    const supabase = await createClient()\n\n    const { data: template, error } = await supabase\n      .from('message_templates')\n      .select('*')\n      .eq('id', id)\n      .eq('organization_id', organizationId)\n      .single()\n\n    if (error || !template) {\n      return NextResponse.json(\n        { error: 'Template not found' },\n        { status: 404 }\n      )\n    }\n\n    // Get usage statistics\n    const { data: usage } = await supabase\n      .from('messages')\n      .select('id, created_at')\n      .eq('template_id', template.id)\n      .order('created_at', { ascending: false })\n      .limit(100)\n\n    // Get recent usage breakdown\n    const last30Days = new Date(Date.now() - 30 * 24 * 60 * 60 * 1000)\n    const recentUsage = (usage || []).filter(u => new Date(u.created_at) >= last30Days)\n\n    const templateWithStats = {\n      ...template,\n      usageStats: {\n        totalUsage: usage?.length || 0,\n        recentUsage: recentUsage.length,\n        lastUsed: usage?.[0]?.created_at || null\n      }\n    }\n\n    return createSuccessResponse(templateWithStats)\n\n  } catch (error) {\n    console.error('Error fetching template:', error)\n    return createErrorResponse(error)\n  }\n}\n\nexport async function PUT(\n  request: NextRequest,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  // Apply standard API middleware (tenant validation + standard rate limiting)\n  const middlewareResponse = await standardApiMiddleware(request);\n  if (middlewareResponse) return middlewareResponse;\n\n  try {\n    // Get tenant context from middleware (already validated)\n    const { organizationId } = getTenantContext(request);\n    const { id } = await params;\n\n    const body = await request.json()\n    const {\n      name,\n      content,\n      category,\n      variables,\n      whatsappTemplate,\n      submitToWhatsApp = false,\n      is_active\n    } = body\n\n    const supabase = await createClient()\n\n    // Check if template exists\n    const { data: existingTemplate } = await supabase\n      .from('message_templates')\n      .select('*')\n      .eq('id', id)\n      .eq('organization_id', organizationId)\n      .single()\n\n    if (!existingTemplate) {\n      return NextResponse.json(\n        { error: 'Template not found' },\n        { status: 404 }\n      )\n    }\n\n    const updateData: any = {\n      updated_at: new Date().toISOString()\n    }\n\n    if (name !== undefined) updateData.name = name\n    if (content !== undefined) updateData.content = content\n    if (category !== undefined) updateData.category = category\n    if (variables !== undefined) updateData.variables = variables\n    if (is_active !== undefined) updateData.is_active = is_active\n\n    // Handle WhatsApp template updates\n    if (submitToWhatsApp && whatsappTemplate) {\n      try {\n        const whatsappClient = await getWhatsAppClient(organizationId)\n\n        // Get organization's business account ID\n        const { data: org } = await supabase\n          .from('organizations')\n          .select('whatsapp_business_account_id')\n          .eq('id', organizationId)\n          .single()\n\n        if (!org?.whatsapp_business_account_id) {\n          return NextResponse.json(\n            { error: 'WhatsApp Business Account not configured' },\n            { status: 400 }\n          )\n        }\n\n        // If template already exists in WhatsApp, delete and recreate\n        if (existingTemplate.whatsapp_template_name) {\n          try {\n            await whatsappClient.deleteTemplate(\n              org.whatsapp_business_account_id,\n              existingTemplate.whatsapp_template_name\n            )\n          } catch (error) {\n            console.warn('Failed to delete existing WhatsApp template:', error)\n          }\n        }\n\n        const whatsappTemplateId = await whatsappClient.createTemplate(\n          org.whatsapp_business_account_id,\n          whatsappTemplate\n        )\n\n        updateData.whatsapp_template_id = whatsappTemplateId\n        updateData.whatsapp_template_name = whatsappTemplate.name\n        updateData.whatsapp_status = 'pending'\n        updateData.whatsapp_template_data = whatsappTemplate\n\n      } catch (error) {\n        console.error('Error updating WhatsApp template:', error)\n        return NextResponse.json(\n          { error: `Failed to update WhatsApp template: ${error.message}` },\n          { status: 400 }\n        )\n      }\n    }\n\n    // Update template\n    const { data: updatedTemplate, error } = await supabase\n      .from('message_templates')\n      .update(updateData)\n      .eq('id', id)\n      .eq('organization_id', organizationId)\n      .select()\n      .single()\n\n    if (error) {\n      throw error\n    }\n\n    return createSuccessResponse(updatedTemplate)\n\n  } catch (error) {\n    console.error('Error updating template:', error)\n    return createErrorResponse(error)\n  }\n}\n\nexport async function DELETE(\n  request: NextRequest,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  // Apply standard API middleware (tenant validation + standard rate limiting)\n  const middlewareResponse = await standardApiMiddleware(request);\n  if (middlewareResponse) return middlewareResponse;\n\n  try {\n    // Get tenant context from middleware (already validated)\n    const { organizationId } = getTenantContext(request);\n    const { id } = await params;\n\n    const supabase = await createClient()\n\n    // Check if template exists\n    const { data: template } = await supabase\n      .from('message_templates')\n      .select('*')\n      .eq('id', id)\n      .eq('organization_id', organizationId)\n      .single()\n\n    if (!template) {\n      return NextResponse.json(\n        { error: 'Template not found' },\n        { status: 404 }\n      )\n    }\n\n    // Check if template is being used in any bulk operations\n    const { data: bulkOps } = await supabase\n      .from('bulk_operations')\n      .select('id')\n      .eq('organization_id', organizationId)\n      .eq('type', 'bulk_message')\n      .in('status', ['queued', 'processing'])\n      .contains('configuration', { templateId: id })\n\n    if (bulkOps && bulkOps.length > 0) {\n      return NextResponse.json(\n        { error: 'Cannot delete template while it is being used in active bulk operations' },\n        { status: 400 }\n      )\n    }\n\n    // Delete from WhatsApp if it exists there\n    if (template.whatsapp_template_name) {\n      try {\n        const whatsappClient = await getWhatsAppClient(organizationId)\n\n        const { data: org } = await supabase\n          .from('organizations')\n          .select('whatsapp_business_account_id')\n          .eq('id', organizationId)\n          .single()\n\n        if (org?.whatsapp_business_account_id) {\n          await whatsappClient.deleteTemplate(\n            org.whatsapp_business_account_id,\n            template.whatsapp_template_name\n          )\n        }\n      } catch (error) {\n        console.warn('Failed to delete WhatsApp template:', error)\n        // Continue with database deletion even if WhatsApp deletion fails\n      }\n    }\n\n    // Delete template from database\n    const { error } = await supabase\n      .from('message_templates')\n      .delete()\n      .eq('id', id)\n      .eq('organization_id', organizationId)\n\n    if (error) {\n      throw error\n    }\n\n    return createSuccessResponse({\n      id: id,\n      message: 'Template deleted successfully'\n    })\n\n  } catch (error) {\n    console.error('Error deleting template:', error)\n    return createErrorResponse(error)\n  }\n}"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}