{"version":3,"names":["RedisRateLimiter","cov_2htjrkari0","f","s","apiRateLimit","authRateLimit","createIpRateLimit","createRateLimit","createUserRateLimit","ddosProtection","passwordResetRateLimit","rateLimiter","strictRateLimit","RateLimiter","constructor","store","cleanupInterval","setInterval","cleanup","now","Date","Object","keys","forEach","key","resetTime","b","isRateLimited","options","windowStart","windowEnd","windowMs","count","entry","maxRequests","limited","remaining","rateLimit","request","keyGenerator","getDefaultKey","result","headers","Headers","set","toString","Math","ceil","_server","NextResponse","json","error","message","retryAfter","status","forwarded","get","realIp","ip","split","userAgent","slice","redisClient","redis","floor","redisKey","pipeline","incr","expire","results","exec","console","authorization","token","replace","payload","JSON","parse","atob","sub","user_id"],"sources":["C:\\Ai Projecten\\ADSapp\\src\\lib\\security\\rate-limit.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server'\n\ninterface RateLimitOptions {\n  windowMs: number // Time window in milliseconds\n  maxRequests: number // Maximum number of requests per window\n  message?: string // Custom error message\n  keyGenerator?: (request: NextRequest) => string // Custom key generator\n  skipSuccessfulRequests?: boolean // Skip counting successful requests\n  skipFailedRequests?: boolean // Skip counting failed requests\n}\n\ninterface RateLimitStore {\n  [key: string]: {\n    count: number\n    resetTime: number\n  }\n}\n\nclass RateLimiter {\n  private store: RateLimitStore = {}\n  private cleanupInterval: NodeJS.Timeout\n\n  constructor() {\n    // Clean up expired entries every 5 minutes\n    this.cleanupInterval = setInterval(() => {\n      this.cleanup()\n    }, 5 * 60 * 1000)\n  }\n\n  private cleanup() {\n    const now = Date.now()\n    Object.keys(this.store).forEach(key => {\n      if (this.store[key].resetTime < now) {\n        delete this.store[key]\n      }\n    })\n  }\n\n  async isRateLimited(key: string, options: RateLimitOptions): Promise<{\n    limited: boolean\n    remaining: number\n    resetTime: number\n  }> {\n    const now = Date.now()\n    const windowStart = now\n    const windowEnd = windowStart + options.windowMs\n\n    // Get or create entry\n    if (!this.store[key] || this.store[key].resetTime < now) {\n      this.store[key] = {\n        count: 0,\n        resetTime: windowEnd\n      }\n    }\n\n    const entry = this.store[key]\n\n    // Check if limit exceeded\n    if (entry.count >= options.maxRequests) {\n      return {\n        limited: true,\n        remaining: 0,\n        resetTime: entry.resetTime\n      }\n    }\n\n    // Increment counter\n    entry.count++\n\n    return {\n      limited: false,\n      remaining: options.maxRequests - entry.count,\n      resetTime: entry.resetTime\n    }\n  }\n}\n\nconst rateLimiter = new RateLimiter()\n\nexport function createRateLimit(options: RateLimitOptions) {\n  return async function rateLimit(request: NextRequest): Promise<NextResponse | null> {\n    const key = options.keyGenerator\n      ? options.keyGenerator(request)\n      : getDefaultKey(request)\n\n    const result = await rateLimiter.isRateLimited(key, options)\n\n    // Add rate limit headers\n    const headers = new Headers()\n    headers.set('X-RateLimit-Limit', options.maxRequests.toString())\n    headers.set('X-RateLimit-Remaining', result.remaining.toString())\n    headers.set('X-RateLimit-Reset', Math.ceil(result.resetTime / 1000).toString())\n\n    if (result.limited) {\n      return NextResponse.json(\n        {\n          error: options.message || 'Too many requests',\n          retryAfter: Math.ceil((result.resetTime - Date.now()) / 1000)\n        },\n        {\n          status: 429,\n          headers\n        }\n      )\n    }\n\n    return null // Not rate limited\n  }\n}\n\nfunction getDefaultKey(request: NextRequest): string {\n  // Use IP address as default key\n  const forwarded = request.headers.get('x-forwarded-for')\n  const realIp = request.headers.get('x-real-ip')\n  const ip = forwarded?.split(',')[0] || realIp || 'unknown'\n\n  // Include user agent to prevent simple IP spoofing\n  const userAgent = request.headers.get('user-agent') || 'unknown'\n\n  return `${ip}:${userAgent.slice(0, 50)}`\n}\n\n// Predefined rate limiters for common use cases\nexport const authRateLimit = createRateLimit({\n  windowMs: 15 * 60 * 1000, // 15 minutes\n  maxRequests: 5, // 5 attempts per 15 minutes\n  message: 'Too many authentication attempts, please try again later'\n})\n\nexport const apiRateLimit = createRateLimit({\n  windowMs: 60 * 1000, // 1 minute\n  maxRequests: 60, // 60 requests per minute\n  message: 'API rate limit exceeded'\n})\n\nexport const strictRateLimit = createRateLimit({\n  windowMs: 60 * 1000, // 1 minute\n  maxRequests: 10, // 10 requests per minute\n  message: 'Rate limit exceeded'\n})\n\nexport const passwordResetRateLimit = createRateLimit({\n  windowMs: 60 * 60 * 1000, // 1 hour\n  maxRequests: 3, // 3 attempts per hour\n  message: 'Too many password reset attempts, please try again later'\n})\n\n// Advanced rate limiting with Redis (for production use)\nexport class RedisRateLimiter {\n  private redis: any\n\n  constructor(redisClient: any) {\n    this.redis = redisClient\n  }\n\n  async isRateLimited(key: string, options: RateLimitOptions): Promise<{\n    limited: boolean\n    remaining: number\n    resetTime: number\n  }> {\n    const now = Date.now()\n    const windowStart = Math.floor(now / options.windowMs) * options.windowMs\n    const windowEnd = windowStart + options.windowMs\n    const redisKey = `rate_limit:${key}:${windowStart}`\n\n    try {\n      // Use Redis pipeline for atomic operations\n      const pipeline = this.redis.pipeline()\n      pipeline.incr(redisKey)\n      pipeline.expire(redisKey, Math.ceil(options.windowMs / 1000))\n\n      const results = await pipeline.exec()\n      const count = results[0][1]\n\n      if (count > options.maxRequests) {\n        return {\n          limited: true,\n          remaining: 0,\n          resetTime: windowEnd\n        }\n      }\n\n      return {\n        limited: false,\n        remaining: options.maxRequests - count,\n        resetTime: windowEnd\n      }\n    } catch (error) {\n      console.error('Redis rate limiting error:', error)\n      // Fallback to allowing the request if Redis is down\n      return {\n        limited: false,\n        remaining: options.maxRequests,\n        resetTime: windowEnd\n      }\n    }\n  }\n}\n\n// DDOS protection\nexport const ddosProtection = createRateLimit({\n  windowMs: 1000, // 1 second\n  maxRequests: 100, // 100 requests per second\n  message: 'Request rate too high, possible DDoS attack detected'\n})\n\n// IP-based rate limiting\nexport function createIpRateLimit(options: RateLimitOptions) {\n  return createRateLimit({\n    ...options,\n    keyGenerator: (request: NextRequest) => {\n      const forwarded = request.headers.get('x-forwarded-for')\n      const realIp = request.headers.get('x-real-ip')\n      return forwarded?.split(',')[0] || realIp || 'unknown'\n    }\n  })\n}\n\n// User-based rate limiting (requires authentication)\nexport function createUserRateLimit(options: RateLimitOptions) {\n  return createRateLimit({\n    ...options,\n    keyGenerator: (request: NextRequest) => {\n      // Extract user ID from JWT token or session\n      const authorization = request.headers.get('authorization')\n      if (authorization) {\n        try {\n          // Parse JWT token to get user ID\n          const token = authorization.replace('Bearer ', '')\n          const payload = JSON.parse(atob(token.split('.')[1]))\n          return `user:${payload.sub || payload.user_id}`\n        } catch {\n          // Fallback to IP if token is invalid\n          return getDefaultKey(request)\n        }\n      }\n      return getDefaultKey(request)\n    }\n  })\n}\n\n// Export the main rate limiter instance for custom use\nexport { rateLimiter }"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}