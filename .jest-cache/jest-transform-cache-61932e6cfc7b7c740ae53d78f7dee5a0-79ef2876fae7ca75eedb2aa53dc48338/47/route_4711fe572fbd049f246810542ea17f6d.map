{"version":3,"names":["GET","cov_1zbklbmqb4","f","s","POST","request","user","_apiutils","requireAuthenticatedUser","profile","getUserOrganization","id","body","json","message","recipients","templateId","scheduling","b","Array","isArray","length","_server","NextResponse","error","status","supabase","_server1","createClient","processedRecipients","recipient","contactId","phoneNumber","data","contact","from","select","eq","organization_id","single","phone_number","newContact","insert","name","metadata","created_for_bulk_message","push","variables","type","template","content","whatsapp_template_name","config","queue","_queue","BulkOperationQueue","operation","createOperation","organizationId","userId","totalItems","configuration","createSuccessResponse","estimatedCompletion","calculateEstimatedCompletion","delay","console","createErrorResponse","searchParams","URL","url","get","limit","Math","min","max","parseInt","offset","result","listOperations","operations","pagination","total","hasMore","recipientCount","baseTime","delayTime","bufferTime","totalTime","completionTime","Date","now","toISOString"],"sources":["C:\\Ai Projecten\\ADSapp\\src\\app\\api\\bulk\\messages\\route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server'\nimport { requireAuthenticatedUser, getUserOrganization, createErrorResponse, createSuccessResponse } from '@/lib/api-utils'\nimport { BulkOperationQueue, BulkMessageConfig } from '@/lib/bulk-operations/queue'\nimport { createClient } from '@/lib/supabase/server'\n\nexport async function POST(request: NextRequest) {\n  try {\n    // Authenticate user\n    const user = await requireAuthenticatedUser()\n    const profile = await getUserOrganization(user.id)\n\n    const body = await request.json()\n    const {\n      message,\n      recipients,\n      templateId,\n      scheduling\n    } = body\n\n    if (!message || !recipients || !Array.isArray(recipients) || recipients.length === 0) {\n      return NextResponse.json(\n        { error: 'Message and recipients array are required' },\n        { status: 400 }\n      )\n    }\n\n    if (recipients.length > 10000) {\n      return NextResponse.json(\n        { error: 'Maximum 10,000 recipients allowed per bulk message' },\n        { status: 400 }\n      )\n    }\n\n    const supabase = await createClient()\n\n    // Process recipients - can be contact IDs or phone numbers\n    const processedRecipients = []\n\n    for (const recipient of recipients) {\n      let contactId: string\n      let phoneNumber: string\n\n      if (recipient.contactId) {\n        // Validate contact exists and belongs to organization\n        const { data: contact } = await supabase\n          .from('contacts')\n          .select('id, phone_number')\n          .eq('id', recipient.contactId)\n          .eq('organization_id', profile.organization_id)\n          .single()\n\n        if (!contact) {\n          return NextResponse.json(\n            { error: `Contact ${recipient.contactId} not found` },\n            { status: 400 }\n          )\n        }\n\n        contactId = contact.id\n        phoneNumber = contact.phone_number\n      } else if (recipient.phoneNumber) {\n        // Find or create contact by phone number\n        let { data: contact } = await supabase\n          .from('contacts')\n          .select('id, phone_number')\n          .eq('phone_number', recipient.phoneNumber)\n          .eq('organization_id', profile.organization_id)\n          .single()\n\n        if (!contact) {\n          // Create new contact\n          const { data: newContact, error } = await supabase\n            .from('contacts')\n            .insert({\n              organization_id: profile.organization_id,\n              phone_number: recipient.phoneNumber,\n              name: recipient.name || null,\n              metadata: { created_for_bulk_message: true }\n            })\n            .select()\n            .single()\n\n          if (error) {\n            return NextResponse.json(\n              { error: `Failed to create contact for ${recipient.phoneNumber}: ${error.message}` },\n              { status: 400 }\n            )\n          }\n\n          contact = newContact\n        }\n\n        contactId = contact.id\n        phoneNumber = contact.phone_number\n      } else {\n        return NextResponse.json(\n          { error: 'Each recipient must have either contactId or phoneNumber' },\n          { status: 400 }\n        )\n      }\n\n      processedRecipients.push({\n        contactId,\n        phoneNumber,\n        variables: recipient.variables || {}\n      })\n    }\n\n    // Validate template if using template message\n    if (message.type === 'template') {\n      if (!templateId) {\n        return NextResponse.json(\n          { error: 'Template ID is required for template messages' },\n          { status: 400 }\n        )\n      }\n\n      const { data: template } = await supabase\n        .from('message_templates')\n        .select('*')\n        .eq('id', templateId)\n        .eq('organization_id', profile.organization_id)\n        .eq('is_active', true)\n        .single()\n\n      if (!template) {\n        return NextResponse.json(\n          { error: 'Template not found or inactive' },\n          { status: 400 }\n        )\n      }\n\n      // Update message with template name\n      message.content = template.whatsapp_template_name || template.name\n    }\n\n    // Create bulk message configuration\n    const config: BulkMessageConfig = {\n      templateId,\n      message,\n      recipients: processedRecipients,\n      scheduling\n    }\n\n    // Create bulk operation\n    const queue = new BulkOperationQueue()\n    const operation = await queue.createOperation({\n      organizationId: profile.organization_id,\n      userId: user.id,\n      type: 'bulk_message',\n      status: 'queued',\n      totalItems: processedRecipients.length,\n      configuration: config\n    })\n\n    return createSuccessResponse({\n      operation,\n      estimatedCompletion: calculateEstimatedCompletion(processedRecipients.length, scheduling?.delay),\n      message: 'Bulk message operation created and queued for processing'\n    }, 201)\n\n  } catch (error) {\n    console.error('Bulk message error:', error)\n    return createErrorResponse(error)\n  }\n}\n\nexport async function GET(request: NextRequest) {\n  try {\n    // Authenticate user\n    const user = await requireAuthenticatedUser()\n    const profile = await getUserOrganization(user.id)\n\n    const { searchParams } = new URL(request.url)\n    const status = searchParams.get('status')\n    const limit = Math.min(50, Math.max(1, parseInt(searchParams.get('limit') || '20')))\n    const offset = Math.max(0, parseInt(searchParams.get('offset') || '0'))\n\n    const queue = new BulkOperationQueue()\n    const result = await queue.listOperations(profile.organization_id, {\n      type: 'bulk_message',\n      status: status as any,\n      limit,\n      offset\n    })\n\n    return createSuccessResponse({\n      operations: result.operations,\n      pagination: {\n        limit,\n        offset,\n        total: result.total,\n        hasMore: offset + limit < result.total\n      }\n    })\n\n  } catch (error) {\n    console.error('List bulk messages error:', error)\n    return createErrorResponse(error)\n  }\n}\n\nfunction calculateEstimatedCompletion(recipientCount: number, delay?: number): string {\n  // Base processing time per message (assuming 1 second per message)\n  const baseTime = recipientCount * 1000\n\n  // Add delay time between messages\n  const delayTime = delay ? (recipientCount - 1) * delay * 1000 : 0\n\n  // Add some buffer time for processing\n  const bufferTime = recipientCount * 200\n\n  const totalTime = baseTime + delayTime + bufferTime\n  const completionTime = new Date(Date.now() + totalTime)\n\n  return completionTime.toISOString()\n}"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}