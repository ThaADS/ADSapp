# Plan 25-04: Dependency Cleanup

**Phase:** 25 - Database Types & Technical Debt
**Plan:** 04 of 04
**Wave:** 3 (After 25-02, 25-03)
**Date:** 2026-02-03

## Objective

Remove duplicate and unused dependencies, specifically the reactflow → @xyflow/react migration and any other dependency issues.

## Prerequisites

- Plan 25-02 complete (source files type-safe)
- Plan 25-03 complete (tests working)

## Success Criteria

1. Only @xyflow/react installed (no reactflow)
2. No unused dependencies in package.json
3. npm audit shows no high/critical vulnerabilities
4. Bundle size reduced

## Current State

```bash
# Check for duplicate react-flow packages
npm ls reactflow
npm ls @xyflow/react

# Check bundle size
npm run analyze
```

## Tasks

### Task 1: React Flow Migration

Replace all reactflow imports with @xyflow/react:

```typescript
// Before
import ReactFlow, { Node, Edge } from 'reactflow'
import 'reactflow/dist/style.css'

// After
import { ReactFlow, Node, Edge } from '@xyflow/react'
import '@xyflow/react/dist/style.css'
```

### Task 2: Find and Replace Imports

```bash
# Find all reactflow imports
grep -r "from 'reactflow'" src/ --include="*.ts" --include="*.tsx"
grep -r "from \"reactflow\"" src/ --include="*.ts" --include="*.tsx"
grep -r "reactflow/dist" src/ --include="*.ts" --include="*.tsx" --include="*.css"
```

### Task 3: Update Package.json

```bash
# Remove old package
npm uninstall reactflow

# Verify @xyflow/react is installed
npm ls @xyflow/react
```

### Task 4: Audit Unused Dependencies

```bash
# Install depcheck
npx depcheck

# Review and remove unused packages
npm uninstall <unused-package>
```

### Task 5: Security Audit

```bash
# Run audit
npm audit

# Fix automatically where possible
npm audit fix

# Review remaining issues
npm audit --json | jq '.vulnerabilities | to_entries[] | select(.value.severity == "high" or .value.severity == "critical")'
```

## Files to Modify

| File | Action | Description |
|------|--------|-------------|
| `package.json` | Update | Remove reactflow, update versions |
| `package-lock.json` | Regenerate | Fresh lockfile |
| `src/components/workflow/*.tsx` | Update | Fix imports |
| `src/app/dashboard/workflows/*.tsx` | Update | Fix imports |

## API Changes (@xyflow/react vs reactflow)

Most APIs are compatible, but some changes:

```typescript
// Node data type is now generic
type CustomNode = Node<CustomData>

// useReactFlow hook works the same
const { fitView, zoomIn } = useReactFlow()

// Some props renamed
// nodesDraggable → now always true by default
// elementsSelectable → selectionOnDrag
```

## Validation

```bash
# Verify no reactflow references
grep -r "reactflow" src/ | wc -l
# Should be 0

# Build check
npm run build

# Run workflow-related tests
npm test -- --testPathPattern=workflow

# Bundle analysis
npm run analyze
```

## Bundle Size Goals

| Package | Before | After |
|---------|--------|-------|
| reactflow | ~200KB | 0 |
| @xyflow/react | 0 | ~180KB |
| Total saved | - | ~20KB |

## Estimated Effort

- Duration: 1-2 hours
- Complexity: Low
- Risk: Low (well-defined migration)

## Dependencies

- Plan 25-02 (imports must work)
- Plan 25-03 (tests must pass)

## Notes

- @xyflow/react is the official successor to reactflow
- Both packages maintained by same team
- Migration is mostly import path changes
- Some edge cases in custom node renderers
