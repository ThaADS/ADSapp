# Plan 25-02: Remove @ts-nocheck from Source Files

**Phase:** 25 - Database Types & Technical Debt
**Plan:** 02 of 04
**Wave:** 2 (Parallel with 25-03)
**Date:** 2026-02-03

## Objective

Remove all @ts-nocheck directives from source files in `src/` directory and fix the resulting type errors.

## Prerequisites

- Plan 25-01 complete (fresh database types available)
- TypeScript strict mode enforced

## Success Criteria

1. Zero @ts-nocheck directives in src/ directory
2. All TypeScript files compile without errors
3. Build passes successfully
4. No runtime regressions

## Current State Analysis

```bash
# Count @ts-nocheck files
grep -r "@ts-nocheck" src/ --include="*.ts" --include="*.tsx" | wc -l
# Expected: ~200+ files
```

## Tasks

### Task 1: Categorize Files by Directory
Files to fix grouped by directory for systematic approach:

**Priority 1 - Core Types (Wave 2a):**
- `src/types/*.ts` - Type definitions
- `src/lib/supabase/*.ts` - Database client

**Priority 2 - API Routes (Wave 2b):**
- `src/app/api/**/*.ts` - All API routes

**Priority 3 - Components (Wave 2c):**
- `src/components/**/*.tsx` - UI components

**Priority 4 - Lib Functions (Wave 2d):**
- `src/lib/**/*.ts` - Utility libraries

### Task 2: Fix Type Issues Pattern

Common patterns to fix:
```typescript
// Before: Untyped Supabase response
const { data } = await supabase.from('table').select()

// After: Typed response
const { data } = await supabase.from('table').select()
// Type is now inferred from database.ts
```

### Task 3: Remove @ts-nocheck and Fix Errors

For each file:
1. Remove `// @ts-nocheck` comment
2. Run `npx tsc --noEmit <file>`
3. Fix each type error
4. Verify no runtime changes

### Task 4: Batch Processing Script

```bash
# Find all files with @ts-nocheck
find src/ -name "*.ts" -o -name "*.tsx" | xargs grep -l "@ts-nocheck" > ts-nocheck-files.txt

# Process count
wc -l ts-nocheck-files.txt
```

## Files to Modify

| Directory | Estimated Files | Priority |
|-----------|-----------------|----------|
| `src/types/` | ~10 | 1 |
| `src/lib/supabase/` | ~5 | 1 |
| `src/app/api/` | ~100 | 2 |
| `src/components/` | ~50 | 3 |
| `src/lib/` | ~40 | 4 |

## Common Type Fixes

### Fix 1: Async Supabase Client
```typescript
// Before
const supabase = createClient()

// After
const supabase = await createClient()
```

### Fix 2: Database Row Types
```typescript
// Before
const org: any = data

// After
import { Database } from '@/types/database'
type Organization = Database['public']['Tables']['organizations']['Row']
const org: Organization = data
```

### Fix 3: Insert/Update Types
```typescript
// Before
await supabase.from('table').insert({ ... })

// After
type InsertType = Database['public']['Tables']['table']['Insert']
const payload: InsertType = { ... }
await supabase.from('table').insert(payload)
```

## Validation

```bash
# Full type check
npm run type-check

# Build test
npm run build

# Count remaining @ts-nocheck
grep -r "@ts-nocheck" src/ --include="*.ts" --include="*.tsx" | wc -l
# Should be 0
```

## Rollback

Git commit before each batch of changes for easy revert.

## Estimated Effort

- Duration: 4-8 hours (depending on error count)
- Complexity: Medium
- Risk: Medium (many files touched)

## Dependencies

- Plan 25-01 (database types)

## Notes

- Work in batches by directory to avoid overwhelming changes
- Commit after each directory is clean
- Some files may require interface updates
- Use `Database['public']['Tables']['tablename']['Row']` pattern consistently
